{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"source/images/3.png","path":"images/3.png","modified":0,"renderable":0},{"_id":"source/images/image-20190728183409195.png","path":"images/image-20190728183409195.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/404.html","path":"404.html","modified":0,"renderable":1},{"_id":"themes/ayer/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"source/images/image-20190728191505258.png","path":"images/image-20190728191505258.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207144736880.png","path":"images/image-20191207144736880.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207145008765.png","path":"images/image-20191207145008765.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207152244301.png","path":"images/image-20191207152244301.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207150016196.png","path":"images/image-20191207150016196.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207150104135.png","path":"images/image-20191207150104135.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207152343686.png","path":"images/image-20191207152343686.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154542523.png","path":"images/image-20191207154542523.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154806418.png","path":"images/image-20191207154806418.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/css/main.js","path":"css/main.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/main.js.map","path":"css/main.js.map","modified":0,"renderable":1},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer-side.svg","path":"images/ayer-side.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer.png","path":"images/ayer.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer.svg","path":"images/ayer.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/forkme.png","path":"images/forkme.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover7.jpg","path":"images/cover7.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/logo.png","path":"images/logo.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/ayer.js","path":"js/ayer.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","path":"js/busuanzi-2.3.pure.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/pace.min.js","path":"js/pace.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/jquery.justifiedGallery.min.js","path":"js/jquery.justifiedGallery.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/share.js","path":"js/share.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/tocbot.min.js","path":"js/tocbot.min.js","modified":0,"renderable":1},{"_id":"source/images/16ee2c228a6ffd63.png","path":"images/16ee2c228a6ffd63.png","modified":0,"renderable":0},{"_id":"source/images/image-20190728192227358.png","path":"images/image-20190728192227358.png","modified":0,"renderable":0},{"_id":"source/images/image-20190728195058507.png","path":"images/image-20190728195058507.png","modified":0,"renderable":0},{"_id":"source/images/image-20190728195121612.png","path":"images/image-20190728195121612.png","modified":0,"renderable":0},{"_id":"source/images/image-20191123234325831.png","path":"images/image-20191123234325831.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207125203878.png","path":"images/image-20191207125203878.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154357109.png","path":"images/image-20191207154357109.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154505224.png","path":"images/image-20191207154505224.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/main.css","path":"css/main.css","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover2.jpg","path":"images/cover2.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/sponsor.jpg","path":"images/sponsor.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"source/images/image-20191123234557023.png","path":"images/image-20191123234557023.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207150530465.png","path":"images/image-20191207150530465.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207152034072.png","path":"images/image-20191207152034072.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154655011.png","path":"images/image-20191207154655011.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/css/main.css.map","path":"css/main.css.map","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover6.jpg","path":"images/cover6.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/wechat.jpg","path":"images/wechat.jpg","modified":0,"renderable":1},{"_id":"source/images/image-20190728192207836.png","path":"images/image-20190728192207836.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207133620959.png","path":"images/image-20191207133620959.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207133758025.png","path":"images/image-20191207133758025.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207154738162.png","path":"images/image-20191207154738162.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/images/alipay.jpg","path":"images/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover1.jpg","path":"images/cover1.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover3.jpg","path":"images/cover3.jpg","modified":0,"renderable":1},{"_id":"source/images/16ee2c8c324e66aa.png","path":"images/16ee2c8c324e66aa.png","modified":0,"renderable":0},{"_id":"source/images/image-20191123234358451.png","path":"images/image-20191123234358451.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207151955114.png","path":"images/image-20191207151955114.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/images/forrestgump.png","path":"images/forrestgump.png","modified":0,"renderable":1},{"_id":"source/images/image-20191207145612200.png","path":"images/image-20191207145612200.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207145449056.png","path":"images/image-20191207145449056.png","modified":0,"renderable":0},{"_id":"source/images/image-20191123234150228-4523763.png","path":"images/image-20191123234150228-4523763.png","modified":0,"renderable":0},{"_id":"source/images/image-20191123234150228.png","path":"images/image-20191123234150228.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/images/cover4.jpg","path":"images/cover4.jpg","modified":0,"renderable":1},{"_id":"source/images/image-20190728193013770.png","path":"images/image-20190728193013770.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/images/cover5.jpg","path":"images/cover5.jpg","modified":0,"renderable":1},{"_id":"source/images/image-20191207125851843.png","path":"images/image-20191207125851843.png","modified":0,"renderable":0},{"_id":"source/images/image-20191207125855636.png","path":"images/image-20191207125855636.png","modified":0,"renderable":0},{"_id":"source/images/image-20190728192558243.png","path":"images/image-20190728192558243.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/ayer/.DS_Store","hash":"02a2bd38e3a49b334a1c43636afcc1ce2a681bca","modified":1583303224239},{"_id":"themes/ayer/logo.png","hash":"e510368457aa419a54af6e531b62acda8f2d0418","modified":1533784966000},{"_id":"themes/ayer/package.json","hash":"d465439de5dec52bb6cde8813dfd6ad7804b89e9","modified":1583148734000},{"_id":"themes/ayer/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1583300651041},{"_id":"themes/ayer/_config.yml","hash":"0e4dd16ee6fc37b19f333f6d991b39f569fd723b","modified":1583365167847},{"_id":"source/.DS_Store","hash":"5b3cbaee1a2bade525909680fc7cd16df6408b5a","modified":1583365808496},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1583364766746},{"_id":"source/_posts/spring boot从零搭建登录注册功能并进行所有接口验证.md","hash":"a0c995b593900a3a004ef6d1b5aa4b6de16fa71e","modified":1583368369829},{"_id":"source/_posts/spring boot同时上传多个图片和下载.md","hash":"9692a36b3af671779710e2443e591126c2581169","modified":1583368384278},{"_id":"source/_posts/spring boot生成动态验证码并验证.md","hash":"ac68426052b35639a9d0e2df7c72afa5fff5474d","modified":1583368376720},{"_id":"source/_posts/RESETful API 设计规范.md","hash":"90c66fd04ad4dde8cb1ce5004b03311d3f40430e","modified":1583368313064},{"_id":"source/about/me.md","hash":"2033592d749d7b5ac727ed42ea481a14770012c1","modified":1583364991898},{"_id":"source/_posts/前端规范.md","hash":"9c56498fa07f5d004309d33e35222270d3c11e2f","modified":1583368275568},{"_id":"source/about/.DS_Store","hash":"c934c578851226df897f9f055500bc432206e6f3","modified":1583365816666},{"_id":"source/categories/index.md","hash":"b2078052e67ad52731b1976a503bb3767d77b4bb","modified":1583368184269},{"_id":"source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1583322657138},{"_id":"source/images/3.png","hash":"3577bc8b67ef89e5a12af275616d9e5ac99c3af8","modified":1583298828614},{"_id":"source/images/image-20190728183409195.png","hash":"cd5d93a5bc6db0ff188036839cc9714c4482fda4","modified":1583292720471},{"_id":"source/tags/index.md","hash":"90767e0c37365ffc39b883ae1cf80132b10b27af","modified":1583368195334},{"_id":"themes/ayer/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1583148734000},{"_id":"themes/ayer/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1583148734000},{"_id":"themes/ayer/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1583148734000},{"_id":"themes/ayer/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1583148734000},{"_id":"themes/ayer/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1583148734000},{"_id":"themes/ayer/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1583148734000},{"_id":"themes/ayer/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1583148734000},{"_id":"themes/ayer/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1583148734000},{"_id":"themes/ayer/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1583148734000},{"_id":"themes/ayer/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1583148734000},{"_id":"themes/ayer/languages/zh-CN.yml","hash":"1ef52d096f074d88399ef1fa80d2f78a81d4b83c","modified":1583148734000},{"_id":"themes/ayer/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1583148734000},{"_id":"themes/ayer/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1583148734000},{"_id":"themes/ayer/layout/layout.ejs","hash":"b33fcc957459ade3c32e1330cf7a6b3dd43f5530","modified":1583148734000},{"_id":"themes/ayer/layout/index.ejs","hash":"77347cbb8635611d8b1fb84bde75f9dedaf8632d","modified":1583148734000},{"_id":"themes/ayer/layout/categories.ejs","hash":"673e8cb93639525c08ee0b0cb9db44b3a628960c","modified":1583148734000},{"_id":"themes/ayer/layout/page.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1583148734000},{"_id":"themes/ayer/layout/post.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1583148734000},{"_id":"themes/ayer/layout/tags.ejs","hash":"88b34dd8d7b1e64fa27aa6ed72af996cf6700809","modified":1583148734000},{"_id":"themes/ayer/scripts/default_config.js","hash":"f66d38c4050bcc989f20a1503a9a6f8e1553c983","modified":1583148734000},{"_id":"themes/ayer/source/.DS_Store","hash":"857ef7f7c8f5c1fa689ef56bb76e65c95d4df6d1","modified":1583303219237},{"_id":"themes/ayer/source/404.html","hash":"788929fab7b99dd74575399f41cddae6f63ce1f4","modified":1583148734000},{"_id":"themes/ayer/source/favicon.ico","hash":"afd24f361abae0529f0117fda9e7d54b855882d8","modified":1583363313102},{"_id":"themes/ayer/source-src/main.js","hash":"259db8c3f78497d082ed2a48f03e71f1ab0c84ac","modified":1583148734000},{"_id":"themes/ayer/source-src/.DS_Store","hash":"30d5ed8f70a864082f2817b61d5979a0ede9f61e","modified":1583303191185},{"_id":"source/images/image-20190728191505258.png","hash":"7b539b5d352acc8b52d865f348ffa05e751cd4fc","modified":1583292720475},{"_id":"source/images/image-20191207144736880.png","hash":"49bfb69d7ecef5e09744a5e49b0d72e9c496349b","modified":1583292720603},{"_id":"source/images/image-20191207145008765.png","hash":"f460e4765f57ae96f6b22d4f1fa9cb67ee7be767","modified":1583292720605},{"_id":"source/images/image-20191207152244301.png","hash":"5608dcdf71716232f84cb93751422cb8598dea3c","modified":1583292720634},{"_id":"source/images/image-20191207150016196.png","hash":"a3e19dd788c11f5c4e087ca93cd057393a1436b3","modified":1583292720625},{"_id":"source/images/image-20191207150104135.png","hash":"507fe2645141054bafa608831e0ff169b97442db","modified":1583292720626},{"_id":"source/images/image-20191207152343686.png","hash":"f1f10eb7b8b0b0c6a8fadf8bea9b84a21dca10bc","modified":1583292720635},{"_id":"source/images/image-20191207154542523.png","hash":"f92510b2ee87efa0481069dcd044c73e0eb31a3d","modified":1583292720642},{"_id":"source/images/image-20191207154806418.png","hash":"56165176abd80cfe4d82fe3c3d2fdb8141715d18","modified":1583292720649},{"_id":"themes/ayer/layout/_partial/after-footer.ejs","hash":"49a6d44d6ee80f54f52dbe66af7729133316ae15","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/archive.ejs","hash":"a7065fad7532c5f727e8d0e18771616fea662944","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/archive-post.ejs","hash":"9be7173badcca6582c1136204adb3aa432aada21","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/article.ejs","hash":"107409fb15073ed4b17a84019f2efc48126ef0f4","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/ayer.ejs","hash":"5285576a1dff353bb8e2eb56de5103982251d60b","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/footer.ejs","hash":"c239c769f68ab74c25360af9bd5f8f786322284e","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/baidu-analytics.ejs","hash":"f0e6e88f9f7eb08b8fe51449a8a3016273507924","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/head.ejs","hash":"ffa5f5cfc45e4b4c5047e9281a1f3f4d2f9cbf1f","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/mathjax.ejs","hash":"4d633c6cc375a0c81fe0ed2a114b1ac4c3cec2d9","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/google-analytics.ejs","hash":"5b389110f4d3b727c33c48f088a8bc7f8b577d19","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/modal.ejs","hash":"cf441365eff1f8143e3c9ae54954d0ebe0a358e5","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/music.ejs","hash":"cde5caf73f120b1300ec7539bbf675597688c734","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/sidebar.ejs","hash":"e3b411aef6e5f25f6c5c66b93d653ef70da8d4af","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/totop.ejs","hash":"9075ecf308ca4a1db0b6f6d3c6064a6d7ef28512","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/viewer.ejs","hash":"bae69921b34a9f2c5060ed0804ffec9c89a9882b","modified":1583148734000},{"_id":"themes/ayer/scripts/filters/index.js","hash":"e435b782178da75656f9616c7af564fb9ff0de50","modified":1583148734000},{"_id":"themes/ayer/scripts/filters/meta_generator.js","hash":"8b3435c4312516dcc266c6b9b8d156a000ca700d","modified":1583148734000},{"_id":"themes/ayer/scripts/helpers/ayer-plus-vendors.js","hash":"7b3df58faaa875d17afbf74ddef5601116f2ce3d","modified":1583148734000},{"_id":"themes/ayer/scripts/helpers/wordcount.js","hash":"f9c8fceb2130929b8f11e22b1c3476c99d1574a8","modified":1583148734000},{"_id":"themes/ayer/scripts/lib/core.js","hash":"7908a82a86d63f35c6f785cacb1cfaf99ae7e0f9","modified":1583148734000},{"_id":"themes/ayer/source/css/main.js","hash":"058e23ad72709efbbfb7e0637ff5b0e3a745ba20","modified":1583148734000},{"_id":"themes/ayer/source/css/main.js.map","hash":"55a8999eb16e8db4264a51b896695f2dc995355d","modified":1583148734000},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.css","hash":"2e6a66987dbc7a57bbfd2655bce166739b4ba426","modified":1583148734000},{"_id":"themes/ayer/source/images/ayer-side.svg","hash":"bf0fc3e052e60c2a10d9dffa7b746358c4c33d6a","modified":1583148734000},{"_id":"themes/ayer/source/images/ayer.png","hash":"94ede98236a9506e41b39493f72ef2f457858e41","modified":1583148734000},{"_id":"themes/ayer/source/images/ayer.svg","hash":"1c87519aec678f95895c8480ddf44b371479f2f5","modified":1583148734000},{"_id":"themes/ayer/source/images/forkme.png","hash":"b43e6e18b84edc40636204aa0eb9f266ef54a4e7","modified":1583148734000},{"_id":"themes/ayer/source/images/cover7.jpg","hash":"27e67d0ac848efa0f0195352a4b14a2f108565bf","modified":1583148734000},{"_id":"themes/ayer/source/images/logo.png","hash":"e510368457aa419a54af6e531b62acda8f2d0418","modified":1533784966000},{"_id":"themes/ayer/source/js/ayer.js","hash":"691b842cd3cae5fffa6aa56c64a6ba567ff2db96","modified":1583148734000},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1583148734000},{"_id":"themes/ayer/source/js/pace.min.js","hash":"d32ab818e0f97d3b0c80f5631fc23d8a0cb52795","modified":1583148734000},{"_id":"themes/ayer/source/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1583148734000},{"_id":"themes/ayer/source/js/jquery.justifiedGallery.min.js","hash":"73b9373cd80bdbf77e711818095f3f120a019547","modified":1583148734000},{"_id":"themes/ayer/source/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1583148734000},{"_id":"themes/ayer/source/js/share.js","hash":"4e7b425356244bd9c5650ff25c2d4473e448d4c7","modified":1583148734000},{"_id":"themes/ayer/source-src/css/404.styl","hash":"14b2fec2da86081f0545732552aa5f07b545c19a","modified":1583148734000},{"_id":"themes/ayer/source/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_mixins.styl","hash":"6959409df2dd0a1ca05be0c0e9b2a884efdfb82d","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_extend.styl","hash":"8dedef428b6ac7d629e1d1f6039b0f60dacc4c5e","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_normalize.styl","hash":"b3337320133b7a336db7033aa6bbe94b054c0b21","modified":1583148734000},{"_id":"themes/ayer/source-src/css/style.styl","hash":"c221f5e09c8b59a496c86526f10fd384ba0782cb","modified":1583148734000},{"_id":"source/images/16ee2c228a6ffd63.png","hash":"90b7831505ab5fb36ffed04ba128510226728254","modified":1583292720463},{"_id":"themes/ayer/source-src/css/_variables.styl","hash":"910dd0682971a616e1610daec23e7ff5a556df98","modified":1583148734000},{"_id":"source/images/image-20190728192227358.png","hash":"7a19b042808737759d8e8d8b32956081b04d1bda","modified":1583292720485},{"_id":"source/images/image-20190728195058507.png","hash":"81236c20de5b266ab47265be4f0aad467bcb8688","modified":1583292720518},{"_id":"source/images/image-20190728195121612.png","hash":"2e75f1e49c076770394ac9271a846a535f218160","modified":1583292720520},{"_id":"source/images/image-20191123234325831.png","hash":"f841325a48a2bb2c7a76bd2ea80fbf5af0413aec","modified":1583292720534},{"_id":"source/images/image-20191207125203878.png","hash":"95ca88fd985dbdacb87ef0ffa4c1f8a3b744f870","modified":1583292720557},{"_id":"source/images/image-20191207154357109.png","hash":"c242fc1b589055594bfde9e209a610f73c749708","modified":1583292720637},{"_id":"source/images/image-20191207154505224.png","hash":"1892a4c51068408ad3684aad8ea5b0e769f7fe2b","modified":1583292720640},{"_id":"themes/ayer/screenshots/hexo-theme-ayer.png","hash":"265e0aaad0962caf7a7cae5ce98f1390c6716592","modified":1583148734000},{"_id":"themes/ayer/source/fancybox/jquery.fancybox.min.js","hash":"b2b093d8f5ffeee250c8d0d3a2285a213318e4ea","modified":1583148734000},{"_id":"themes/ayer/source/css/main.css","hash":"2f743ebf069e0872579042277d97c0194aad8dee","modified":1583148734000},{"_id":"themes/ayer/source/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1583148734000},{"_id":"themes/ayer/source/images/sponsor.jpg","hash":"d19df6ddd7ca4ce5fe23db4ec2865265efa7ea54","modified":1583148734000},{"_id":"themes/ayer/source/js/jquery-2.0.3.min.js","hash":"800edb7787c30f4982bf38f2cb8f4f6fb61340e9","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_remixicon.styl","hash":"cc890008a02430abe15a9cbbdfd87f0dcbedd0b6","modified":1583148734000},{"_id":"source/images/image-20191123234557023.png","hash":"8b018f7f5d5a32ada7e905ab655f8ca1e6d1425a","modified":1583292720547},{"_id":"source/images/image-20191207150530465.png","hash":"b7d08f3ea30ba66d9b66f7f1e8a14b00f554aad5","modified":1583292720628},{"_id":"source/images/image-20191207152034072.png","hash":"fdbeb9f4b63862e016773f6b39824d2cb4187960","modified":1583292720633},{"_id":"source/images/image-20191207154655011.png","hash":"8cd8a0bea212789767d5508b444c41f5e39d1532","modified":1583292720644},{"_id":"themes/ayer/layout/_partial/post/albums.ejs","hash":"acb6d9628b7a2de4f32a84c6f652ac7207d14517","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/busuanzi.ejs","hash":"2e8836ce04ef22cf8d9ba228363f5b050cd0da03","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/category.ejs","hash":"85f0ebeceee1c32623bfa1e4170dbe1e34442fea","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/gitalk.ejs","hash":"83d8e78f5463aa00c5a7ea939fd044765c8e8d2a","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/gallery.ejs","hash":"5f8487fe7bed9a09001c6655244ff35f583cf1eb","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/justifiedGallery.ejs","hash":"17ccb9fc394d11412619a153997bb87650799c6e","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/nav.ejs","hash":"e59198918e92ef92156aeefbf6023584ac1cae64","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/search.ejs","hash":"2c9d19d1685e834aa2020998da2a2d259ce9b9ff","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/share.ejs","hash":"0a364766931f48df60b7c92fec8fde1067a93e00","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/title.ejs","hash":"f0d33ad99a924d48d9e59427a9b99df7606905ee","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/topping.ejs","hash":"f38faa84eb1b2aa47ac897b27fc2222eaaf83d2e","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/tocbot.ejs","hash":"9898b0dd9237e21908ba40292a8a9f947bed44d2","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/word.ejs","hash":"4a255a8eb9ed8aa9d69a1ad05cb23b385c7fe02f","modified":1583148734000},{"_id":"themes/ayer/layout/_partial/post/valine.ejs","hash":"6250f3c87a4bf3d437291128c7e60608cf807e10","modified":1583148734000},{"_id":"themes/ayer/source/css/main.css.map","hash":"735beac4b0a3930bd7ce9d7c9394409781f80ff4","modified":1583148734000},{"_id":"themes/ayer/source/images/cover6.jpg","hash":"46942a4d90cac9ef8f33ae3e83ccf9aa7190bed6","modified":1583148734000},{"_id":"themes/ayer/source/images/wechat.jpg","hash":"49fa2b6bcabf4b73299e500be662dae7ecadc5fd","modified":1583322770562},{"_id":"themes/ayer/source-src/css/_partial/apple.styl","hash":"e06dce604cc58ec39d677e4e59910c2725684901","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/albums.styl","hash":"0659d5f7469f24a415354ff767d949926465d515","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/articles.styl","hash":"39a0bc6c5cf85f0527d6ee81f6feebce8550c1dd","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/ayer.styl","hash":"ba60927da23bc78380da026af365dffeb1bb1f68","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/archive.styl","hash":"3e61c25e6ae9a25196c6d904731cf6821c950341","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/article.styl","hash":"e35354b75f5101c768061c30e275b9cc924a45a7","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/categories.styl","hash":"67f4824419c497e54469094f239978dd888a9706","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/gallery.styl","hash":"7bdc2c9fb4971dbd7511c5cbb69bd611f20db591","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/gitalk.styl","hash":"3706eef2e0541493f1679a30241d279e29dfdc17","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/float.styl","hash":"d888df89a172e4c8119cb8740fc1eae1a9539157","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/footer.styl","hash":"0384890ec33e8e710edcf4fc60d37ca82a499343","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/layout.styl","hash":"1d24e74260340bba52b921a137bc9fe30c7b377e","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/highlight.styl","hash":"e894b3a1aff76e84137e1e6db59a75afd0a53f52","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/justifiedGallery.styl","hash":"e7b5784ffd501f98216a717f876f2adb23fa5cd9","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/lists.styl","hash":"da8a82a48852411c10e279dfee43038d46f4f273","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/mobile.styl","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/pace.styl","hash":"bde7bf3577c66a3ac829410d52fa2144212282ef","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/reward.styl","hash":"cde3b6af618e530a70bc8f37912e33822c721e52","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/navbar.styl","hash":"bc477e4905ab88da711e0049ac3866dd1f88f80a","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/search.styl","hash":"f81076fc6d4a83be3371bcb79ab54d88e2605714","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/totop.styl","hash":"4bae031b6852384666cdf36e98c6bbbba1281453","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/sidebar.styl","hash":"600c70f1de82da5223af290d47a583f9c379d188","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/share.styl","hash":"9ce2dd3ffdc4e170dfcb975a7158f913bc40b8d8","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/tag.styl","hash":"87df748185edfba222c3f9a4b9ef8eee0e8e5ad3","modified":1583148734000},{"_id":"themes/ayer/source-src/css/_partial/tocbot.styl","hash":"2031db5cb7bb77f263d0d83d24b76d7a5a20e0b8","modified":1583148734000},{"_id":"source/images/image-20190728192207836.png","hash":"2d542d4fb67bf3ec44db14596ccefdf6f67f3fa9","modified":1583292720479},{"_id":"source/images/image-20191207133620959.png","hash":"540c2fbb977ca49142ef9c5a3d2d5314e02c48f3","modified":1583292720593},{"_id":"source/images/image-20191207133758025.png","hash":"01ed942499a34e8f56abdfda711368fb78fdd256","modified":1583292720601},{"_id":"source/images/image-20191207154738162.png","hash":"e31e274491b3e1965801fab78891c6623cea0931","modified":1583292720647},{"_id":"themes/ayer/source/images/alipay.jpg","hash":"5f4d1cede3c8a7b1e5732168a2a0415d29c825c1","modified":1583322757414},{"_id":"themes/ayer/source/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1583148734000},{"_id":"themes/ayer/source/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1583148734000},{"_id":"source/images/16ee2c8c324e66aa.png","hash":"bff9e315b0ec51f3c9eb56aabd702a3bf3dc80f3","modified":1583292720469},{"_id":"source/images/image-20191123234358451.png","hash":"c2e2f450f4b682416a7007c58df3231e2a3b2c15","modified":1583292720541},{"_id":"source/images/image-20191207151955114.png","hash":"b8936190956711497b84738e5e71394b733c51b5","modified":1583292720631},{"_id":"themes/ayer/source/images/forrestgump.png","hash":"18ad6a8ba815878e36a0d5562136dc4fb8920c12","modified":1583148734000},{"_id":"source/images/image-20191207145612200.png","hash":"aae6933c8228554f179874163ea3af755a20e06c","modified":1583292720624},{"_id":"source/images/image-20191207145449056.png","hash":"92c9bdb2a2b4c5c171426352d4bab1078e9bdc08","modified":1583292720615},{"_id":"source/images/image-20191123234150228-4523763.png","hash":"5fcc501ae2a5d8d939ad2c3f37326528d4974190","modified":1583292720523},{"_id":"source/images/image-20191123234150228.png","hash":"5fcc501ae2a5d8d939ad2c3f37326528d4974190","modified":1583292720528},{"_id":"themes/ayer/source/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1583148734000},{"_id":"source/images/image-20190728193013770.png","hash":"6d63f67e51d1a5629a7eb8edba3997b35c483d2a","modified":1583292720510},{"_id":"themes/ayer/source/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1583148734000},{"_id":"source/images/image-20191207125851843.png","hash":"e770e2a94793426c9bfb9fbd84243fd6cac6c887","modified":1583292720575},{"_id":"source/images/image-20191207125855636.png","hash":"e770e2a94793426c9bfb9fbd84243fd6cac6c887","modified":1583292720582},{"_id":"source/images/image-20190728192558243.png","hash":"33241feb94b9a3f0b61d3007a8e05efa3d384560","modified":1583292720491},{"_id":"public/about/me.html","hash":"f2068dfc9f7dfba3b92208ab939c88161fbaeb2b","modified":1583368398580},{"_id":"public/categories/index.html","hash":"a330e6ac5452e0ba2e0f06eab42601e1a3e79037","modified":1583368398580},{"_id":"public/tags/index.html","hash":"56cf5fd89b5de76cdb842104aca3d014747a539d","modified":1583368398580},{"_id":"public/archives/index.html","hash":"6960a8bbf2d3a173467ea9e844e739d44cbb17ea","modified":1583368398580},{"_id":"public/archives/2020/index.html","hash":"e422ef60377e5876d8812324a16fe98b5b13e8aa","modified":1583368398580},{"_id":"public/archives/2020/03/index.html","hash":"bbd2c1f2314fbc2f55cd6d6698c620e2cc6a906b","modified":1583368398580},{"_id":"public/categories/技术/index.html","hash":"4d91371cb94677840a752224441c0d5872f7cc10","modified":1583368398580},{"_id":"public/tags/后端/index.html","hash":"b7aa377397fcb89f6419c0d3b6703cc0f0b00415","modified":1583368398580},{"_id":"public/tags/前端/index.html","hash":"4b0dd1e8cf61d2d4d178836823af360de21d8c5a","modified":1583368398580},{"_id":"public/2020/03/05/spring boot从零搭建登录注册功能并进行所有接口验证/index.html","hash":"5ad8505c00d2b4887ef5b740d2243645047d42a9","modified":1583368398580},{"_id":"public/2020/03/05/spring boot生成动态验证码并验证/index.html","hash":"95ad15f222c131ed7a5687ecff1b548f7e3c5c92","modified":1583368398580},{"_id":"public/2020/03/05/spring boot同时上传多个图片和下载/index.html","hash":"203ee7ebd1f8559438729a07ad91b9bf4dea02e9","modified":1583368398580},{"_id":"public/2020/03/05/前端规范/index.html","hash":"70084c06d50c277d934f8c1e9efaf19b7ad83382","modified":1583368398580},{"_id":"public/2020/03/05/RESETful API 设计规范/index.html","hash":"67b7f4c0ccac5b7486800f2842e1b84770069e95","modified":1583368398580},{"_id":"public/index.html","hash":"f5f867b27b5f31ea249ec30f4d6c51864d1ada41","modified":1583368398580},{"_id":"public/images/image-20190728183409195.png","hash":"cd5d93a5bc6db0ff188036839cc9714c4482fda4","modified":1583368398580},{"_id":"public/images/3.png","hash":"3577bc8b67ef89e5a12af275616d9e5ac99c3af8","modified":1583368398580},{"_id":"public/favicon.ico","hash":"afd24f361abae0529f0117fda9e7d54b855882d8","modified":1583368398580},{"_id":"public/css/main.js.map","hash":"55a8999eb16e8db4264a51b896695f2dc995355d","modified":1583368398580},{"_id":"public/images/ayer-side.svg","hash":"bf0fc3e052e60c2a10d9dffa7b746358c4c33d6a","modified":1583368398580},{"_id":"public/images/ayer.png","hash":"94ede98236a9506e41b39493f72ef2f457858e41","modified":1583368398580},{"_id":"public/images/ayer.svg","hash":"1c87519aec678f95895c8480ddf44b371479f2f5","modified":1583368398580},{"_id":"public/images/forkme.png","hash":"b43e6e18b84edc40636204aa0eb9f266ef54a4e7","modified":1583368398580},{"_id":"public/images/cover7.jpg","hash":"27e67d0ac848efa0f0195352a4b14a2f108565bf","modified":1583368398580},{"_id":"public/images/logo.png","hash":"e510368457aa419a54af6e531b62acda8f2d0418","modified":1583368398580},{"_id":"public/images/image-20190728191505258.png","hash":"7b539b5d352acc8b52d865f348ffa05e751cd4fc","modified":1583368398580},{"_id":"public/images/image-20191207144736880.png","hash":"49bfb69d7ecef5e09744a5e49b0d72e9c496349b","modified":1583368398580},{"_id":"public/images/image-20191207145008765.png","hash":"f460e4765f57ae96f6b22d4f1fa9cb67ee7be767","modified":1583368398580},{"_id":"public/images/image-20191207152244301.png","hash":"5608dcdf71716232f84cb93751422cb8598dea3c","modified":1583368398580},{"_id":"public/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1583368398580},{"_id":"public/images/sponsor.jpg","hash":"d19df6ddd7ca4ce5fe23db4ec2865265efa7ea54","modified":1583368398580},{"_id":"public/css/main.js","hash":"058e23ad72709efbbfb7e0637ff5b0e3a745ba20","modified":1583368398580},{"_id":"public/fancybox/jquery.fancybox.min.css","hash":"2e6a66987dbc7a57bbfd2655bce166739b4ba426","modified":1583368398580},{"_id":"public/js/ayer.js","hash":"691b842cd3cae5fffa6aa56c64a6ba567ff2db96","modified":1583368398580},{"_id":"public/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1583368398580},{"_id":"public/js/pace.min.js","hash":"d32ab818e0f97d3b0c80f5631fc23d8a0cb52795","modified":1583368398580},{"_id":"public/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1583368398580},{"_id":"public/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1583368398580},{"_id":"public/js/share.js","hash":"4e7b425356244bd9c5650ff25c2d4473e448d4c7","modified":1583368398580},{"_id":"public/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1583368398580},{"_id":"public/404.html","hash":"c1bdc5844dc965e6611cca632b64deb3e5b03416","modified":1583368398580},{"_id":"public/js/jquery.justifiedGallery.min.js","hash":"73b9373cd80bdbf77e711818095f3f120a019547","modified":1583368398580},{"_id":"public/fancybox/jquery.fancybox.min.js","hash":"b2b093d8f5ffeee250c8d0d3a2285a213318e4ea","modified":1583368398580},{"_id":"public/css/main.css","hash":"2f743ebf069e0872579042277d97c0194aad8dee","modified":1583368398580},{"_id":"public/js/jquery-2.0.3.min.js","hash":"800edb7787c30f4982bf38f2cb8f4f6fb61340e9","modified":1583368398580},{"_id":"public/images/image-20191207150016196.png","hash":"a3e19dd788c11f5c4e087ca93cd057393a1436b3","modified":1583368398580},{"_id":"public/images/image-20191207150104135.png","hash":"507fe2645141054bafa608831e0ff169b97442db","modified":1583368398580},{"_id":"public/images/image-20191207152343686.png","hash":"f1f10eb7b8b0b0c6a8fadf8bea9b84a21dca10bc","modified":1583368398580},{"_id":"public/images/image-20191207154542523.png","hash":"f92510b2ee87efa0481069dcd044c73e0eb31a3d","modified":1583368398580},{"_id":"public/images/image-20191207154806418.png","hash":"56165176abd80cfe4d82fe3c3d2fdb8141715d18","modified":1583368398580},{"_id":"public/css/main.css.map","hash":"735beac4b0a3930bd7ce9d7c9394409781f80ff4","modified":1583368398580},{"_id":"public/images/cover6.jpg","hash":"46942a4d90cac9ef8f33ae3e83ccf9aa7190bed6","modified":1583368398580},{"_id":"public/images/wechat.jpg","hash":"49fa2b6bcabf4b73299e500be662dae7ecadc5fd","modified":1583368398580},{"_id":"public/images/16ee2c228a6ffd63.png","hash":"90b7831505ab5fb36ffed04ba128510226728254","modified":1583368398580},{"_id":"public/images/image-20190728192227358.png","hash":"7a19b042808737759d8e8d8b32956081b04d1bda","modified":1583368398580},{"_id":"public/images/image-20190728195058507.png","hash":"81236c20de5b266ab47265be4f0aad467bcb8688","modified":1583368398580},{"_id":"public/images/image-20190728195121612.png","hash":"2e75f1e49c076770394ac9271a846a535f218160","modified":1583368398580},{"_id":"public/images/image-20191123234325831.png","hash":"f841325a48a2bb2c7a76bd2ea80fbf5af0413aec","modified":1583368398580},{"_id":"public/images/image-20191207125203878.png","hash":"95ca88fd985dbdacb87ef0ffa4c1f8a3b744f870","modified":1583368398580},{"_id":"public/images/image-20191207154357109.png","hash":"c242fc1b589055594bfde9e209a610f73c749708","modified":1583368398580},{"_id":"public/images/image-20191207154505224.png","hash":"1892a4c51068408ad3684aad8ea5b0e769f7fe2b","modified":1583368398580},{"_id":"public/images/alipay.jpg","hash":"5f4d1cede3c8a7b1e5732168a2a0415d29c825c1","modified":1583368398580},{"_id":"public/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1583368398580},{"_id":"public/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1583368398580},{"_id":"public/images/image-20191123234557023.png","hash":"8b018f7f5d5a32ada7e905ab655f8ca1e6d1425a","modified":1583368398580},{"_id":"public/images/image-20191207150530465.png","hash":"b7d08f3ea30ba66d9b66f7f1e8a14b00f554aad5","modified":1583368398580},{"_id":"public/images/image-20191207152034072.png","hash":"fdbeb9f4b63862e016773f6b39824d2cb4187960","modified":1583368398580},{"_id":"public/images/image-20191207154655011.png","hash":"8cd8a0bea212789767d5508b444c41f5e39d1532","modified":1583368398580},{"_id":"public/images/forrestgump.png","hash":"18ad6a8ba815878e36a0d5562136dc4fb8920c12","modified":1583368398580},{"_id":"public/images/image-20190728192207836.png","hash":"2d542d4fb67bf3ec44db14596ccefdf6f67f3fa9","modified":1583368398580},{"_id":"public/images/image-20191207133620959.png","hash":"540c2fbb977ca49142ef9c5a3d2d5314e02c48f3","modified":1583368398580},{"_id":"public/images/image-20191207154738162.png","hash":"e31e274491b3e1965801fab78891c6623cea0931","modified":1583368398580},{"_id":"public/images/image-20191207133758025.png","hash":"01ed942499a34e8f56abdfda711368fb78fdd256","modified":1583368398580},{"_id":"public/images/16ee2c8c324e66aa.png","hash":"bff9e315b0ec51f3c9eb56aabd702a3bf3dc80f3","modified":1583368398580},{"_id":"public/images/image-20191123234358451.png","hash":"c2e2f450f4b682416a7007c58df3231e2a3b2c15","modified":1583368398580},{"_id":"public/images/image-20191207151955114.png","hash":"b8936190956711497b84738e5e71394b733c51b5","modified":1583368398580},{"_id":"public/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1583368398580},{"_id":"public/images/image-20191207145612200.png","hash":"aae6933c8228554f179874163ea3af755a20e06c","modified":1583368398580},{"_id":"public/images/image-20191207145449056.png","hash":"92c9bdb2a2b4c5c171426352d4bab1078e9bdc08","modified":1583368398580},{"_id":"public/images/image-20191123234150228-4523763.png","hash":"5fcc501ae2a5d8d939ad2c3f37326528d4974190","modified":1583368398580},{"_id":"public/images/image-20191123234150228.png","hash":"5fcc501ae2a5d8d939ad2c3f37326528d4974190","modified":1583368398580},{"_id":"public/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1583368398580},{"_id":"public/images/image-20190728193013770.png","hash":"6d63f67e51d1a5629a7eb8edba3997b35c483d2a","modified":1583368398580},{"_id":"public/images/image-20191207125851843.png","hash":"e770e2a94793426c9bfb9fbd84243fd6cac6c887","modified":1583368398580},{"_id":"public/images/image-20191207125855636.png","hash":"e770e2a94793426c9bfb9fbd84243fd6cac6c887","modified":1583368398580},{"_id":"public/images/image-20190728192558243.png","hash":"33241feb94b9a3f0b61d3007a8e05efa3d384560","modified":1583368398580}],"Category":[{"name":"技术","_id":"ck7e0nvtf0004ntcya5gxfhkl"}],"Data":[],"Page":[{"title":"About me","date":"2020-03-04T23:36:31.000Z","_content":"","source":"about/me.md","raw":"---\ntitle: About me\ndate: 2020-03-05 07:36:31\n---\n","updated":"2020-03-04T23:36:31.898Z","path":"about/me.html","comments":1,"layout":"page","_id":"ck7e0nvtb0001ntcyad59e9el","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2020-03-05T00:15:53.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2020-03-05 08:15:53\ntype: categories\nlayout: \"categories\"\n---\n","updated":"2020-03-05T00:29:44.269Z","path":"categories/index.html","comments":1,"_id":"ck7e0nvtd0003ntcy3an81dim","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2020-03-05T00:20:18.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2020-03-05 08:20:18\ntype: tags\nlayout: \"tags\"\n---\n","updated":"2020-03-05T00:29:55.334Z","path":"tags/index.html","comments":1,"_id":"ck7e0nvu3000ontcy678144a4","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"_content":"### spring boot从零搭建登录注册功能并进行所有接口验证\n\n[TOC]\n\n目前大多项目是前后端分离。在后台接口服务开发过程中，往往我们需要先搭建一个基础服务，比如登录注册功能、自动对所有的接口进行token的安全校验等，这样可以防范安全问题的出现。并且这样后续的同事可以只关注业务代码的开发，不需要关心基础架构服务的实现。\n\n\n这次我准备搭建一个简单的后台服务，用的是`spring boot + mysql + mybatis`。\n\n#### 1、搭建Spring boot项目\n\n首先我们使用IDEA自带的初始化项目功能，创建一个Spring boot项目，如图：\n\n\n![image-20191207125203878](/images/image-20191207125203878.png)\n\n或者在线生成，[点击进入](https://start.spring.io/)\n\n![](/images/16ee2c228a6ffd63.png)\n\n> pom.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.1.6.RELEASE</version>\n    </parent>\n    <groupId>com.zz</groupId>\n    <artifactId>rest-api</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>rest-api</name>\n    <description>Demo project for Spring Boot</description>\n\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.baomidou</groupId>\n            <artifactId>mybatis-plus-boot-starter</artifactId>\n            <version>3.1.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-jpa</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>com.jayway.jsonpath</groupId>\n            <artifactId>json-path</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-autoconfigure</artifactId>\n            <version>2.1.6.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-rest</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-mongodb</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-configuration-processor</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <dependency>\n            <groupId>com.google.code.gson</groupId>\n            <artifactId>gson</artifactId>\n            <version>2.8.5</version>\n            <scope>compile</scope>\n        </dependency>\n\n        <!-- Use MySQL Connector-J -->\n\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n        </dependency>\n\n\n        <!-- image to base64 -->\n\n        <dependency>\n            <groupId>commons-io</groupId>\n            <artifactId>commons-io</artifactId>\n            <version>2.6</version>\n        </dependency>\n\n        <!-- jjwt支持 -->\n\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt</artifactId>\n            <version>0.9.1</version>\n        </dependency>\n\n        <dependency>\n            <groupId>com.auth0</groupId>\n            <artifactId>java-jwt</artifactId>\n            <version>3.4.0</version>\n        </dependency>\n\n        <!--commons-codec -->\n        <dependency>\n            <groupId>commons-codec</groupId>\n            <artifactId>commons-codec</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.github.terran4j</groupId>\n            <artifactId>terran4j-commons-api2doc</artifactId>\n            <version>1.0.2</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-thymeleaf</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.itextpdf.tool</groupId>\n            <artifactId>xmlworker</artifactId>\n            <version>5.5.10</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.poi</groupId>\n            <artifactId>poi-ooxml</artifactId>\n            <version>3.15</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.poi</groupId>\n            <artifactId>poi-scratchpad</artifactId>\n            <version>3.15</version>\n        </dependency>\n\n\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n```\n> maven更改为国内阿里云镜像，这样比较快\n\n![](/images/16ee2c8c324e66aa.png)\n\nsettings.xml:\n\n```xml\n<settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0\n    https://maven.apache.org/xsd/settings-1.0.0.xsd\">\n\n    <mirrors>\n        <mirror>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>http://maven.aliyun.com/nexus/content/groups/public/</url>\n            <mirrorOf>central</mirrorOf>\n        </mirror>\n    </mirrors>\n</settings>\n```\n\n\n\n> Mybatis 推荐插件如下：\n\n![image-20191207125851843](/images/image-20191207125851843.png)\n\n> application.yml\n\n```yaml\n# mysql\nspring:\n  jpa:\n    show-sql: true\n    hibernate:\n      ddl-auto: update\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\n  profiles:\n    active: dev\n  # 静态资源配置\n  mvc:\n    static-path-pattern: /**\n  resources:\n    static-locations: file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/\n\nmybatis-plus:\n  mapper-locations: classpath:/mapper/*.xml\n  type-aliases-package: com.zz.entity\n#自定义\nmy:\n  tokenURL: \"55555\"\n  authURL: \"88888\"\n\n```\n\n> application-dev.yml\n\n```yaml\n# mysql\nspring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8\n    username: root\n    password: ******\nserver:\n  port: 8080\n\n```\n\n> 大概目录结构如下\n\n![image-20191207133758025](/images/image-20191207133758025.png)\n\n搭建细节不再赘述；\n\n#### 2、读取自定义配置文件\n\n> com.zz.config.MyConfiguration\n\n```java\npackage com.zz.config;\n\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@ConfigurationProperties(prefix = \"my\")\npublic class MyConfiguration {\n\n    private String tokenURL;\n\n    private String authURL;\n\n    public String getAuthURL() {\n        return this.authURL;\n    }\n\n    public void setAuthURL(String authURL) {\n        this.authURL = authURL;\n    }\n\n    public String getTokenURL() {\n        return this.tokenURL;\n    }\n\n    public void setTokenURL(String tokenURL) {\n        this.tokenURL = tokenURL;\n    }\n}\n\n```\n\n#### 3、web服务配置\n\n> com.zz.config.MyConfiguration\n\n```java\npackage com.zz.config;\n\nimport com.zz.common.interceptor.AuthenticationInterceptor;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n\n@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // 拦截所有请求，通过判断是否有 @passToken 注解 决定是否需要跳过登录\n        registry.addInterceptor(authenticationInterceptor())\n                .addPathPatterns(\"/**\");\n    }\n\n    @Bean\n    public AuthenticationInterceptor authenticationInterceptor() {\n        return new AuthenticationInterceptor();\n    }\n\n}\n\n```\n\n#### 4、自定义返回统一的实体类Response\n\n> com.zz.model.Response\n\n```java\npackage com.zz.model;\n\n\npublic class Response {\n\n    private int code;\n    private String msg;\n    private Object data;\n\n    public Object getData() {\n        return data;\n    }\n\n    public void setData(Object data) {\n        this.data = data;\n    }\n\n    public int getCode() {\n        return code;\n    }\n\n    public void setCode(int code) {\n        this.code = code;\n    }\n\n    public String getMsg() {\n        return msg;\n    }\n\n    public void setMsg(String msg) {\n        this.msg = msg;\n    }\n}\n\n```\n\n#### 5、Utils公共方法类\n\n> com.zz.utils.HttpUtils\n>\n> 获取Request、 Response、session\n\n```java\npackage com.zz.utils;\n\nimport org.springframework.web.context.request.RequestContextHolder;\nimport org.springframework.web.context.request.ServletRequestAttributes;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\n\n/**\n * 获取 Request 和 Response\n */\npublic class HttpUtils {\n\n    // 获取 request\n    public static HttpServletRequest getRequest() {\n        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();\n        if (requestAttributes == null) return null;\n        return requestAttributes.getRequest();\n    }\n\n    // 获取 response\n    public static HttpServletResponse getResponse() {\n        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();\n        if (requestAttributes == null) return null;\n        return requestAttributes.getResponse();\n    }\n\n    // 获取 session\n    public static HttpSession getSession(){\n        HttpServletRequest request = getRequest();\n        if(request == null) return null;\n        return request.getSession();\n    }\n}\n\n```\n\n> com.zz.utils.JWTUtils\n>\n> JWT 生成token, 验证token\n\n```java\npackage com.zz.utils;\n\nimport com.zz.entity.User;\nimport io.jsonwebtoken.*;\nimport org.apache.commons.codec.binary.Base64;\n\nimport javax.crypto.SecretKey;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.UUID;\n\npublic class JWTUtils {\n\n    // 生成签名的时候使用的秘钥secret\n    private static final String SECRETKEY = \"KJHUhjjJYgYUllVbXhKDHXhkSyHjlNiVkYzWTBac1Yxkjhuad\";\n\n    // expirationDate 生成jwt的有效期，单位秒\n    private static long expirationDate = 2 * 60 * 60;\n\n\n    /**\n     * 由字符串生成加密key\n     *\n     * @return SecretKey\n     */\n    private static SecretKey generalKey(String stringKey) {\n        byte[] encodedKey = Base64.decodeBase64(stringKey);\n        return new SecretKeySpec(encodedKey, 0, encodedKey.length, \"AES\");\n    }\n\n    /**\n     * 创建 jwt\n     *\n     * @param user 登录成功后的用户信息\n     * @return jwt token\n     */\n    public static String createToken(User user) {\n\n        // 指定签名的时候使用的签名算法，也就是header那部分，jwt已经将这部分内容封装好了\n        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;\n\n        // 生成JWT的时间\n        long nowMillis = System.currentTimeMillis();\n        Date now = new Date(nowMillis);\n\n        // 创建payload的私有声明（根据特定的业务需要添加，如果要拿这个做验证，一般是需要和jwt的接收方提前沟通好验证方式的）\n        Map<String, Object> claims = new HashMap<>();\n        claims.put(\"userId\", user.getUserId());\n        claims.put(\"userName\", user.getUserName());\n        claims.put(\"password\", user.getPassword());\n\n        // 生成签名的时候使用的秘钥secret,这个方法本地封装了的，一般可以从本地配置文件中读取，切记这个秘钥不能外露哦。它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了\n        SecretKey key = generalKey(SECRETKEY + user.getPassword());\n\n        // 生成签发人\n        // json形式字符串或字符串，增加用户非敏感信息存储，如用户id或用户账号，与token解析后进行对比，防止乱用\n        HashMap<String, Object> storeInfo = new HashMap<String, Object>();\n        storeInfo.put(\"userId\", user.getUserId());\n        storeInfo.put(\"userName\", user.getUserName());\n        String subject = storeInfo.toString();\n\n        // 下面就是在为payload添加各种标准声明和私有声明了\n        // 这里其实就是new一个JwtBuilder，设置jwt的body\n        JwtBuilder builder = Jwts.builder()\n                // 如果有私有声明，一定要先设置这个自己创建的私有的声明，这个是给builder的claim赋值，一旦写在标准的声明赋值之后，就是覆盖了那些标准的声明的\n                .setClaims(claims)\n                // 唯一随机UUID\n                // 设置JWT ID：是JWT的唯一标识，根据业务需要，这个可以设置为一个不重复的值，主要用来作为一次性token,从而回避重放攻击\n                .setId(UUID.randomUUID().toString())\n                // jwt的签发时间\n                .setIssuedAt(now)\n                // 代表这个JWT的主体，即它的所有人，这个是一个json格式的字符串，可以存放什么userid，roldid之类的，作为什么用户的唯一标志\n                .setSubject(subject)\n                // 设置签名使用的签名算法和签名使用的秘钥\n                .signWith(signatureAlgorithm, key);\n\n        if (expirationDate >= 0) {\n            long expMillis = nowMillis + expirationDate * 1000;\n            Date exp = new Date(expMillis);\n            builder.setExpiration(exp);\n        }\n        return builder.compact();\n    }\n\n    /**\n     * 解密token，获取声明的实体\n     *\n     * @param token 加密后的token\n     * @return claims\n     */\n    public static Claims parseToken(String token, User user) {\n        // 签名秘钥，和生成的签名的秘钥要保持一模一样\n        SecretKey key = generalKey(SECRETKEY + user.getPassword());\n\n        // 获取私有声明\n        Claims claims = Jwts.parser()\n                // 设置签名的秘钥\n                .setSigningKey(key)\n                // 设置需要解析的token\n                .parseClaimsJws(token).getBody();\n\n        return claims;\n    }\n\n\n    /**\n     * 校验token\n     *\n     * @param token 加密后的token\n     * @param user  用户信息\n     * @return true|false\n     */\n    public static Boolean verify(String token, User user) {\n\n        // 获取私有声明的实体\n        Claims claims = parseToken(token, user);\n\n        return claims.get(\"password\").equals(user.getPassword());\n    }\n}\n```\n\n#### 6、查询实体类 query\n\n所有的服务查询都采用统一的各自的实体类\n\n比如：\n\n> com.zz.query.UserQuery\n>\n> 用户查询实体\n\n```java\npackage com.zz.query;\n\npublic class UserQuery {\n\n    private String userName;\n\n    private String password;\n\n    private long userId;\n\n    private boolean showPassword;\n\n    public boolean isShowPassword() {\n        return showPassword;\n    }\n\n    public void setShowPassword(boolean showPassword) {\n        this.showPassword = showPassword;\n    }\n\n    public long getUserId() {\n        return userId;\n    }\n\n    public void setUserId(long userId) {\n        this.userId = userId;\n    }\n\n    public String getUserName() {\n        return userName;\n    }\n\n    public void setUserName(String userName) {\n        this.userName = userName;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n}\n\n```\n\n#### 7、查询后返回实体类\n\n所有的服务查询返回都采用统一的各自的实体类\n\n比如：\n\n> com.zz.entity.User\n>\n> 用户数据返回实体\n\n```java\npackage com.zz.entity;\n\npublic class User {\n\n    private long userId;\n\n    private String userName;\n\n    private String token;\n\n    private String password;\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getToken() {\n        return token;\n    }\n\n    public void setToken(String token) {\n        this.token = token;\n    }\n\n    public long getUserId() {\n        return userId;\n    }\n\n    public void setUserId(long userId) {\n        this.userId = userId;\n    }\n\n    public String getUserName() {\n        return userName;\n    }\n\n    public void setUserName(String userName) {\n        this.userName = userName;\n    }\n\n}\n\n```\n\n#### 8 、接口实现三层架构\n\n我们这采取的是三层架构：controller —> service —> mapper;\n\n如果我们要写一个User类接口，先声明一个UserController路由控制层，然后这个里调用UserService实现类方法，然后再调用mapper持久层去CRUD（mysql增查删改）。\n\n#### 9、开始搭建注册用户功能\n\n基础搭建先暂停，开始实质业务的推演；\n\nmysql的连接就不多说啦；\n\n让我们开始实现之旅吧；\n\n> com.zz.newController.UserController\n>\n> 用户注册\n\n```java\npackage com.zz.newController;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n\n/**\n * 登录\n * author: wz\n */\n@RestController\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    @Autowired\n    private UserService userService;\n\n    /*\n     * @param userName\n     * @param password\n     * @return response\n     */\n    @PostMapping(\"/add\")\n    @PassToken\n    public Response addUser(@RequestParam String userName, @RequestParam String password, Response response) {\n        UserQuery query = new UserQuery();\n        User userData = null;\n\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        int result;\n        String message = \"\";\n\n        // 判断用户是否已经存在\n        UserQuery findUserQuery = new UserQuery();\n        findUserQuery.setUserName(userName);\n        User existUser = this.userService.findUserByName(findUserQuery);\n        if (existUser == null) {\n\n            // 插入用户\n            try {\n                result = this.userService.addUser(query);\n                message = \"success\";\n            } catch (Exception e) {\n                result = 0;\n                message = \"error\";\n                e.printStackTrace();\n            }\n\n            // 插入用户成功后返回用户信息\n            if (result == 1) {\n                userData = this.userService.findUserByName(findUserQuery);\n\n                // 生成token\n                String token = null;\n\n                // 当前用户\n                User currentUser = new User();\n                if (userData != null) {\n                    currentUser.setUserId(userData.getUserId());\n                    currentUser.setUserName(userData.getUserName());\n                    currentUser.setPassword(password);\n                    token = JWTUtils.createToken(currentUser);\n                }\n\n                if (token != null) {\n                    userData.setToken(token);\n\n                    // 获取token用户信息\n                    // Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);\n                }\n            }\n\n        } else {\n            message = \"用户已经存在\";\n        }\n\n        response.setData(userData);\n        response.setMsg(message);\n        return response;\n    }\n\n}\n\n```\n\n> com.zz.service.UserService\n>\n> Interface 用户接口\n\n```java\npackage com.zz.service;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic interface UserService {\n\n    // 添加用户\n    int addUser(UserQuery query);\n\n\n}\n\n```\n\n> com.zz.service.impl.UserServiceImpl\n>\n> 用户接口实现类\n\n```java\npackage com.zz.service.impl;\n\nimport com.zz.entity.User;\nimport com.zz.mapper.UserMapper;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.Map;\n\n@Service\npublic class UserServiceImpl implements UserService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public int addUser(UserQuery query){\n        return this.userMapper.insert(query);\n    }\n\n}\n\n```\n\n> com.zz.mapper.UserMapper\n>\n> mapper\n\n```java\npackage com.zz.mapper;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\n\npublic interface UserMapper {\n\n    int insert(UserQuery query);\n\n}\n\n```\n\n> resources/mapper/UserMapper.xml\n>\n> 前后名字一定对应\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" >\n<mapper namespace=\"com.zz.mapper.UserMapper\">\n\n    <resultMap id=\"BaseResult\" type=\"com.zz.entity.User\">\n        <id column=\"user_id\" property=\"userId\"></id>\n        <id column=\"user_name\" property=\"userName\"></id>\n    </resultMap>\n\n    <sql id=\"base\">\n        user_id,\n        user_name\n        <if test=\"showPassword\">\n            , password\n        </if>\n    </sql>\n\n    <sql id=\"base_condition\">\n        <where>\n            <if test=\"userName!=null and userName!=''\">\n                user_name=#{userName}\n            </if>\n            <if test=\"password!=null and password!=''\">\n                and password=#{password}\n            </if>\n        </where>\n\n    </sql>\n\n    <insert id=\"insert\">\n        INSERT INTO user(\n        user_name,\n        password\n        ) VALUES (\n        #{userName},\n        #{password}\n        )\n    </insert>\n\n\n</mapper>\n\n```\n\n到此，整个接口书写过程已全部完成，这就是在当前架构下写一个接口的全部过程。\n\n#### 10、搭建web实例 ——注册用户\n\n由于我们在配置文件里已经配置静态资源的路径，所以我们可以在resources里面写一个不分离的we b实例进行访问。\n\n> resources/static/regist.html\n>\n> 注册页面\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=0\">\n    <title>注册用户</title>\n    <!-- 引入样式 -->\n    <link rel=\"stylesheet\" href=\"css/regist.css\"/>\n    <link rel=\"stylesheet\" href=\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\">\n\n</head>\n<body>\n<div class=\"container\">\n    <div class=\"page form_page js_show\">\n        <div class=\"weui-form\">\n            <div class=\"weui-form__text-area\">\n                <h2 class=\"weui-form__title\">注册新用户</h2>\n            </div>\n            <div class=\"weui-form__control-area\">\n                <div class=\"weui-cells__group weui-cells__group_form\">\n                    <div class=\"weui-cells weui-cells_form\">\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">用户名</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——user\" class=\"weui-input\" placeholder=\"请输入要设置的用户名\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd\" type=\"password\" class=\"weui-input\" placeholder=\"请输入要设置的密码\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">确认密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd2\" type=\"password\" class=\"weui-input\" placeholder=\"请再次输入设置的密码\" type=\"number\" pattern=\"[0-9]*\">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n<!--            <div class=\"weui-form__tips-area\">-->\n<!--                <p class=\"weui-form__tips\">-->\n<!--                    表单页提示，居中对齐-->\n<!--                </p>-->\n<!--            </div>-->\n            <div class=\"weui-form__opr-area\">\n                <a class=\"weui-btn weui-btn_primary\" href=\"javascript:\" id=\"submit\">确定</a>\n            </div>\n\n            <div class=\"weui-form__extra-area\">\n                <div class=\"weui-footer\">\n<!--                    <p class=\"weui-footer__links\">-->\n<!--                        <a href=\"javascript:void(0);\" class=\"weui-footer__link\">底部链接文本</a>-->\n<!--                    </p>-->\n                    <p class=\"weui-footer__text\">Copyright © 2019 alex wong</p>\n                </div>\n            </div>\n        </div>\n        <div id=\"js_toast\" style=\"display: none;\">\n            <div class=\"weui-mask_transparent\"></div>\n            <div class=\"weui-toast\">\n                <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n                <p class=\"weui-toast__content\">已完成</p>\n            </div>\n        </div>\n    </div>\n</div>\n</body>\n<script src=\"js/md5.js\"></script>\n<script src=\"js/utils.js\"></script>\n<script src=\"js/dataService.js\"></script>\n<script type=\"text/javascript\" src=\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"></script>\n<script src=\"js/regist.js\"></script>\n</html>\n```\n\n> static/js/dataService.js\n\n```javascript\nconst APIURL = '/';\n\nwindow.dataService = {\n\n\t//GET\n\tget: (url, params = {}) => {\n\n\t\tconst searchArr = [];\n\n\t\tObject.keys(params).forEach(n => {\n\t\t\tsearchArr.push(`${n}=${params[n]}`);\n\t\t});\n\n\t\tconst searchStr = searchArr.length ? '?' + searchArr.join('&') : '';\n\t\tconst token = utils.getCookie('token');\n\n\t\treturn fetch(APIURL + url + searchStr, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\ttoken\n\t\t\t}\n\t\t}).then(res => res.json());\n\t},\n\n\t//POST\n\tpost: (url, params = {}) => {\n\n\t\tconst formData = new FormData();\n\n\t\tObject.keys(params).forEach(n => {\n\t\t\tformData.append(n, params[n]);\n\t\t});\n\n\t\tconst token = utils.getCookie('token');\n\n\t\treturn fetch(APIURL + url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\ttoken\n\t\t\t},\n\t\t\tbody: formData\n\t\t}).then(res => res.json());\n\t},\n\n\t// 注册\n\taddUser(params) {\n\t\treturn this.post('user/add', params);\n\t},\n\n\t// 登录\n\tlogin(params) {\n\t\treturn this.post('user/login', params);\n\t},\n\n\t// 用户信息\n\tgetUserInfo(params) {\n\t\treturn this.get('user/info', params);\n\t},\n\n};\n```\n\n> static/js/utils.js\n\n```javascript\nwindow.utils = {\n\n\t// md5\n\tgenerateMd5(userName, password) {\n\t\tconst salt = \"1qaz2wsx3edc4rfv5tgb6yhn7ujm8ik9ol0p@!.\";\n\t\tconst asciStr = userName + salt + password;\n\t\tconst asciArr = asciStr.split('');\n\t\tconst asciResult = [];\n\t\tasciArr.forEach(n => {\n\t\t\tasciResult.push(n.charCodeAt());\n\t\t});\n\t\tconst ascireusltStr = asciResult.join(salt);\n\t\treturn hex_md5(ascireusltStr);\n\t},\n\n\t// setCookie\n\tsetCookie(name, value) {\n\t\tvar time = 2 * 60 * 60 * 1000;\n\t\tvar exp = new Date();\n\t\texp.setTime(exp.getTime() + time);\n\t\tdocument.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\n\t},\n\n\t// getCookie\n\tgetCookie(name) {\n\t\tvar arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n\t\tif (arr = document.cookie.match(reg))\n\t\t\treturn unescape(arr[2]);\n\t\telse\n\t\t\treturn null;\n\t}\n\n};\n```\n\n> static/js/regist.js\n\n```javascript\n// 获取相关用户信息\nconst userNameInput = document.getElementById(\"js_input——user\");\nconst passwordInput = document.getElementById(\"js_input——pwd\");\nconst passwordConfirmInput = document.getElementById(\"js_input——pwd2\");\nconst submitBtn = document.getElementById(\"submit\");\n\n// submit\nsubmitBtn.onclick = () => {\n\n\tconst userName = userNameInput.value;\n\tconst password = passwordInput.value;\n\tconst confirmPassword = passwordConfirmInput.value;\n\n\t// verify\n\tif (!userName) {\n\t\tweui.topTips('用户姓名不能为空');\n\t\treturn;\n\t} else if (!password) {\n\t\tweui.topTips('用户密码不能为空');\n\t\treturn;\n\t} else if (confirmPassword !== password) {\n\t\tweui.topTips('前后密码不一致，请重试');\n\t\treturn;\n\t}\n\n\t// 加密密码\n\tconst newPassword = utils.generateMd5(userName, password);\n\n\t// 注册\n\tdataService.addUser({\n\t\tuserName,\n\t\tpassword: newPassword,\n\t}).then(res => {\n\t\tconst {code, data, msg} = res;\n\t\tif (!data) {\n\t\t\tweui.topTips(msg);\n\t\t} else {\n\t\t\tweui.topTips(`注册成功，欢迎 ${data.userName}`);\n\t\t\twindow.location.href = location.origin + '/login.html';\n\t\t}\n\t})\n};\n```\n\n效果如图：\n\n![](/images/image-20191207144736880.png)\n\n> 增加一些基本的校验\n\n![image-20191207145008765](/images/image-20191207145008765.png)\n\n> 用户密码加密传输，并验证新用户是否已经注册\n\n![image-20191207145612200](/images/image-20191207145612200.png)\n\n\n\n![image-20191207150016196](/images/image-20191207150016196.png)\n\n> mysql 查看下用户表\n\n![image-20191207150530465](/images/image-20191207150530465.png)\n\n#### 11、后端-用户登录功能\n\n按上面第9步骤所述，下面的添加内容，请直接添加到上述服务中，不再全部展示代码。\n\n>com.zz.newController.UserController\n>\n>首先要判断用户是否存在，如果存在，返回基本信息并返回用户凭证token\n\n```java\n/**\n     * 登录\n     *\n     * @param userName 用户名\n     * @param password 密码\n     * @return {}\n     */\n    @PostMapping(\"/login\")\n    @PassToken\n    public Response login(@RequestParam String userName, @RequestParam String password, Response response) {\n\n        UserQuery query = new UserQuery();\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        // 验证用户和密码\n        try {\n            // 判断用户是否已经存在\n            User existUser = this.userService.findUserByName(query);\n\n            // 生成token\n            String token = null;\n\n            // 当前用户\n            User currentUser = new User();\n            if (existUser != null) {\n                currentUser.setUserId(existUser.getUserId());\n                currentUser.setUserName(existUser.getUserName());\n                currentUser.setPassword(password);\n               // 生成用户凭证\n                token = JWTUtils.createToken(currentUser);\n                if (token != null) {\n                    existUser.setToken(token);\n                }\n                response.setMsg(\"success\");\n                response.setData(existUser);\n            } else {\n                // 登录失败\n                response.setMsg(\"登录失败，请检查用户名和密码\");\n                response.setData(null);\n            }\n\n        } catch (Exception e) {\n            response.setMsg(\"login failed\");\n            response.setData(null);\n            e.printStackTrace();\n        }\n        return response;\n    }\n```\n\n> com.zz.service.UserService\n\n```java\npackage com.zz.service;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic interface UserService {\n\n    // 添加用户\n    int addUser(UserQuery query);\n\n    //查找单个用户\n    User findUserById(UserQuery query);\n\n    User findUserByName(UserQuery query);\n\n}\n\n```\n\n> com.zz.service.impl.UserServiceImpl\n\n```java\npackage com.zz.service.impl;\n\nimport com.zz.entity.User;\nimport com.zz.mapper.UserMapper;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.Map;\n\n@Service\npublic class UserServiceImpl implements UserService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public int addUser(UserQuery query){\n        return this.userMapper.insert(query);\n    }\n\n    @Override\n    public User findUserById(UserQuery query) {\n        return this.userMapper.findUserById(query);\n    }\n\n    @Override\n    public User findUserByName(UserQuery query) {\n        return this.userMapper.findUserByName(query);\n    }\n\n    @Override\n    public List<User> findAllUser(UserQuery query) {\n        return this.userMapper.findAllUser(query);\n    }\n}\n\n```\n\n> com.zz.mapper.UserMapper\n\n```java\npackage com.zz.mapper;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\n\npublic interface UserMapper {\n\n    int insert(UserQuery query);\n\n    User findUserById(UserQuery query);\n\n    User findUserByName(UserQuery query);\n\n    List<User> findAllUser(UserQuery query);\n\n}\n\n```\n\n> mapper/UserMapper.xml\n\n```yaml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" >\n<mapper namespace=\"com.zz.mapper.UserMapper\">\n\n    <resultMap id=\"BaseResult\" type=\"com.zz.entity.User\">\n        <id column=\"user_id\" property=\"userId\"></id>\n        <id column=\"user_name\" property=\"userName\"></id>\n    </resultMap>\n\n    <sql id=\"base\">\n        user_id,\n        user_name\n        <if test=\"showPassword\">\n            , password\n        </if>\n    </sql>\n\n    <sql id=\"base_condition\">\n        <where>\n            <if test=\"userName!=null and userName!=''\">\n                user_name=#{userName}\n            </if>\n            <if test=\"password!=null and password!=''\">\n                and password=#{password}\n            </if>\n        </where>\n\n    </sql>\n\n    <!-- 查询所有user -->\n    <select id=\"findAllUser\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n    </select>\n\n    <!-- 查询user -->\n    <select id=\"findUserById\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n        where\n        user_id = #{userId}\n    </select>\n\n    <select id=\"findUserByName\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n        <include refid=\"base_condition\"/>\n    </select>\n\n    <insert id=\"insert\">\n        INSERT INTO user(\n        user_name,\n        password\n        ) VALUES (\n        #{userName},\n        #{password}\n        )\n    </insert>\n\n\n</mapper>\n\n```\n\n#### 12、搭建web实例 ——登录用户\n\n> static/login.html\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=0\">\n    <title>login</title>\n    <!-- 引入样式 -->\n    <link rel=\"stylesheet\" href=\"css/regist.css\"/>\n    <link rel=\"stylesheet\" href=\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\">\n\n</head>\n<body>\n<div class=\"container\">\n    <div class=\"page form_page js_show\">\n        <div class=\"weui-form\">\n            <div class=\"weui-form__text-area\">\n                <h2 class=\"weui-form__title\">登录</h2>\n            </div>\n            <div class=\"weui-form__control-area\">\n                <div class=\"weui-cells__group weui-cells__group_form\">\n                    <div class=\"weui-cells weui-cells_form\">\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">用户名</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——user\" class=\"weui-input\" placeholder=\"请输入用户名\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd\" type=\"password\" class=\"weui-input\" placeholder=\"请输入密码\">\n                            </div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n<!--            <div class=\"weui-form__tips-area\">-->\n<!--                <p class=\"weui-form__tips\">-->\n<!--                    表单页提示，居中对齐-->\n<!--                </p>-->\n<!--            </div>-->\n            <div class=\"weui-form__opr-area\">\n                <a class=\"weui-btn weui-btn_primary\" href=\"javascript:\" id=\"submit\">确定</a>\n            </div>\n\n            <div class=\"weui-form__extra-area\">\n                <div class=\"weui-footer\">\n<!--                    <p class=\"weui-footer__links\">-->\n<!--                        <a href=\"javascript:void(0);\" class=\"weui-footer__link\">底部链接文本</a>-->\n<!--                    </p>-->\n                    <p class=\"weui-footer__text\">Copyright © 2019 alex wong</p>\n                </div>\n            </div>\n        </div>\n        <div id=\"js_toast\" style=\"display: none;\">\n            <div class=\"weui-mask_transparent\"></div>\n            <div class=\"weui-toast\">\n                <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n                <p class=\"weui-toast__content\">已完成</p>\n            </div>\n        </div>\n    </div>\n</div>\n</body>\n<script src=\"js/md5.js\"></script>\n<script src=\"js/utils.js\"></script>\n<script src=\"js/dataService.js\"></script>\n<script type=\"text/javascript\" src=\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"></script>\n<script src=\"js/login.js\"></script>\n</html>\n```\n\n> static/js/login.js\n\n```javascript\n// 获取相关用户信息\nconst userNameInput = document.getElementById(\"js_input——user\");\nconst passwordInput = document.getElementById(\"js_input——pwd\");\nconst submitBtn = document.getElementById(\"submit\");\n\n// submit\nsubmitBtn.onclick = () => {\n\n\tconst userName = userNameInput.value;\n\tconst password = passwordInput.value;\n\n\t// verify\n\tif (!userName) {\n\t\tweui.topTips('用户姓名不能为空');\n\t\treturn;\n\t} else if (!password) {\n\t\tweui.topTips('用户密码不能为空');\n\t\treturn;\n\t}\n\n\t// 加密密码\n\tconst newPassword = utils.generateMd5(userName, password);\n\n\t// 注册\n\tdataService.login({\n\t\tuserName,\n\t\tpassword: newPassword,\n\t}).then(res => {\n\t\tconst {code, data, msg} = res;\n\t\tif (!data) {\n\t\t\tweui.topTips(msg);\n\t\t} else {\n\t\t\tweui.topTips(`登录成功，欢迎 ${data.userName}`);\n\t\t\tutils.setCookie('token', data.token);\n\t\t\tlocation.href = location.origin + '/home.html';\n\t\t}\n\t})\n};\n```\n\n![image-20191207152034072](/images/image-20191207152034072.png)\n\n![image-20191207152244301](/images/image-20191207152244301.png)\n\n![image-20191207152343686](/images/image-20191207152343686.png)\n\n登录接口返回用户凭证token，后续用来校验用户接口，增加安全性。\n\n#### 13、增加自定义注解和拦截器\n\n在常规的业务开发中，切记不可把接口服务暴露给任何人都可以访问，不然别人可以任意查看或者修改你的数据，这是很严重的事情。除了常规从网段IP方面限制固定客户端IP的范围，接口本身也要增加安全验证，这个时候我们就需要用到之前生成的用户凭证token;\n\n\n\n问题是我们如果自定义控制，哪些接口是需要经过验证，哪些接口是不需要通过验证的呢？有人可能会说，直接全部验证不就可以啦，何苦纠结。但是在真实的业务中，有些接口是不能强制校验的，比如一些用户分享到微信的那种接口，是不能增加验证，否则分享的页面无法正常显示。\n\n\n\n所以我们可以自定义注解@PassToken, 添加这个注解的接口，就可以不用进行token验证了。\n\n> com.zz.common.annotation.PassToken\n>\n> PassToken 注解\n\n```java\npackage com.zz.common.annotation;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n// 是否跳过token验证\n@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface PassToken {\n    boolean required() default true;\n}\n\n```\n\n\n\n> 添加拦截器\n>\n> com.zz.common.interceptor.AuthenticationInterceptor\n>\n> 在发送请求的时候，在请求头里面加token, 然后验证的时候token从头部获取\n>\n> 如果没有token, 进行无token提示；\n>\n> 如果存在，就用 JWT 校验 token 是否存在，并且校验用户密码是否正确。\n\n\n\n```java\npackage com.zz.common.interceptor;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.exceptions.JWTDecodeException;\nimport com.mongodb.util.JSON;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.configurationprocessor.json.JSONException;\nimport org.springframework.boot.configurationprocessor.json.JSONObject;\nimport org.springframework.web.method.HandlerMethod;\nimport org.springframework.web.servlet.HandlerInterceptor;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.lang.reflect.Method;\n\n// 拦截器\npublic class AuthenticationInterceptor implements HandlerInterceptor {\n\n    @Autowired\n    private UserService userService;\n\n    /**\n     * response返回信息\n     *\n     * @param code\n     * @param message\n     * @return\n     * @throws JSONException\n     */\n    public JSONObject getJsonObject(int code, String message) throws JSONException {\n        JSONObject jsonObject = new JSONObject();\n        jsonObject.put(\"msg\", message);\n        jsonObject.put(\"code\", code);\n        return jsonObject;\n    }\n\n    @Override\n    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object object) throws Exception {\n\n        // 从 http 请求头中取出 token\n        String token = BaseApplicationController.getToken();\n        // 如果不是映射到方法直接通过\n        if (!(object instanceof HandlerMethod)) {\n            return true;\n        }\n\n        HandlerMethod handlerMethod = (HandlerMethod) object;\n        Method method = handlerMethod.getMethod();\n        //检查是否有PassToken注释，有则跳过认证\n        if (method.isAnnotationPresent(PassToken.class)) {\n            PassToken passToken = method.getAnnotation(PassToken.class);\n            if (passToken.required()) {\n                return true;\n            }\n        }\n\n        // 默认执行认证\n        httpServletResponse.setContentType(\"application/json;charset=UTF-8\");\n        if (token == null || token.equals(\"null\")) {\n            JSONObject jsonObject = getJsonObject(403, \"无token，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"无token，请重新登录\");\n        }\n\n        // 获取 token 中的 user id\n        long userId;\n        try {\n            userId = BaseApplicationController.getCurrentUserId();\n        } catch (JWTDecodeException j) {\n            JSONObject jsonObject = getJsonObject(500, \"访问异常, token不正确，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"访问异常！\");\n        }\n\n        // 验证用户是否存在\n        UserQuery query = new UserQuery();\n        query.setUserId(userId);\n        query.setShowPassword(Boolean.TRUE);\n        User user = userService.findUserById(query);\n\n        if (user == null) {\n            JSONObject jsonObject = getJsonObject(500, \"用户不存在，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"用户不存在，请重新登录\");\n        }\n\n        // 验证token是否有效\n        Boolean verify = JWTUtils.verify(token, user);\n        if (!verify) {\n            JSONObject jsonObject = getJsonObject(500, \"非法访问，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"非法访问！\");\n        }\n\n        return true;\n    }\n}\n\n```\n\n下面让我们实例看下效果：\n\n> com.zz.newController.UserController\n\n```java\npackage com.zz.newController;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n\n/**\n * 登录\n * autho: wangzhao\n */\n@RestController\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    @Autowired\n    private UserService userService;\n\n    /*\n     * @param userName\n     * @param password\n     * @return response\n     */\n    @PostMapping(\"/add\")\n    @PassToken\n    public Response addUser(@RequestParam String userName, @RequestParam String password, Response response) {\n        UserQuery query = new UserQuery();\n        User userData = null;\n\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        int result;\n        String message = \"\";\n\n        // 判断用户是否已经存在\n        UserQuery findUserQuery = new UserQuery();\n        findUserQuery.setUserName(userName);\n        User existUser = this.userService.findUserByName(findUserQuery);\n        if (existUser == null) {\n\n            // 插入用户\n            try {\n                result = this.userService.addUser(query);\n                message = \"success\";\n            } catch (Exception e) {\n                result = 0;\n                message = \"error\";\n                e.printStackTrace();\n            }\n\n            // 插入用户成功后返回用户信息\n            if (result == 1) {\n                userData = this.userService.findUserByName(findUserQuery);\n\n                // 生成token\n                String token = null;\n\n                // 当前用户\n                User currentUser = new User();\n                if (userData != null) {\n                    currentUser.setUserId(userData.getUserId());\n                    currentUser.setUserName(userData.getUserName());\n                    currentUser.setPassword(password);\n                    token = JWTUtils.createToken(currentUser);\n                }\n\n                if (token != null) {\n                    userData.setToken(token);\n\n                    // 获取token用户信息\n                    // Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);\n                }\n            }\n\n        } else {\n            message = \"用户已经存在\";\n        }\n\n        response.setData(userData);\n        response.setMsg(message);\n        return response;\n    }\n\n    /**\n     * 登录\n     *\n     * @param userName 用户名\n     * @param password 密码\n     * @return {}\n     */\n    @PostMapping(\"/login\")\n    @PassToken\n    public Response login(@RequestParam String userName, @RequestParam String password, Response response) {\n\n        UserQuery query = new UserQuery();\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        // 验证用户和密码\n        try {\n            // 判断用户是否已经存在\n            User existUser = this.userService.findUserByName(query);\n\n            // 生成token\n            String token = null;\n\n            // 当前用户\n            User currentUser = new User();\n            if (existUser != null) {\n                currentUser.setUserId(existUser.getUserId());\n                currentUser.setUserName(existUser.getUserName());\n                currentUser.setPassword(password);\n                token = JWTUtils.createToken(currentUser);\n                if (token != null) {\n                    existUser.setToken(token);\n                }\n                response.setMsg(\"success\");\n                response.setData(existUser);\n            } else {\n                // 登录失败\n                response.setMsg(\"登录失败，请检查用户名和密码\");\n                response.setData(null);\n            }\n\n        } catch (Exception e) {\n            response.setMsg(\"login failed\");\n            response.setData(null);\n            e.printStackTrace();\n        }\n        return response;\n    }\n\n    /**\n     * 获取个人信息\n     *\n     * @return {}\n     */\n    @GetMapping(\"/info\")\n    public Response getUserInfo(Response response) {\n        // 获取token\n        String token = BaseApplicationController.getToken();\n        User userData2 = BaseApplicationController.getCurrentUser();\n        Map<String, Object> headerData = BaseApplicationController.getHeader();\n        if (token != null && !token.equals(\"null\")) {\n            User userData = new User();\n            DecodedJWT claims = JWT.decode(token);\n            userData.setUserName(claims.getClaim(\"userName\").asString());\n            userData.setUserId(claims.getClaim(\"userId\").asLong());\n            response.setData(userData);\n            response.setMsg(\"success\");\n        } else {\n            response.setMsg(\"token不存在\");\n        }\n        return response;\n    }\n\n}\n\n```\n\n我们新写了一个接口，获取用户信息，如上，其余代码不再赘述；\n\n> 成功获取用户信息\n\n![image-20191207154357109](/images/image-20191207154357109.png)\n\n> 删除token\n\n![image-20191207154505224](/images/image-20191207154505224.png)\n\n![image-20191207154542523](/images/image-20191207154542523.png)\n\n> Token 故意改错\n\n![image-20191207154655011](/images/image-20191207154655011.png)\n\n\n\n![image-20191207154738162](/images/image-20191207154738162.png)\n\n![image-20191207154806418](/images/image-20191207154806418.png)\n\n到此，验证过程完美成功；\n\n#### 14、总结\n\n以上过程，只是一个简单服务的搭建，真实的服务还需要更多配置，比如XSS配置防止XSS攻击等。好了，本篇文章到此为止，如果有哪里描述得不清楚，请多多包涵。","source":"_posts/spring boot从零搭建登录注册功能并进行所有接口验证.md","raw":"---\ncategories:\n- 技术\ntags:\n- 后端\n---\n### spring boot从零搭建登录注册功能并进行所有接口验证\n\n[TOC]\n\n目前大多项目是前后端分离。在后台接口服务开发过程中，往往我们需要先搭建一个基础服务，比如登录注册功能、自动对所有的接口进行token的安全校验等，这样可以防范安全问题的出现。并且这样后续的同事可以只关注业务代码的开发，不需要关心基础架构服务的实现。\n\n\n这次我准备搭建一个简单的后台服务，用的是`spring boot + mysql + mybatis`。\n\n#### 1、搭建Spring boot项目\n\n首先我们使用IDEA自带的初始化项目功能，创建一个Spring boot项目，如图：\n\n\n![image-20191207125203878](/images/image-20191207125203878.png)\n\n或者在线生成，[点击进入](https://start.spring.io/)\n\n![](/images/16ee2c228a6ffd63.png)\n\n> pom.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.1.6.RELEASE</version>\n    </parent>\n    <groupId>com.zz</groupId>\n    <artifactId>rest-api</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>rest-api</name>\n    <description>Demo project for Spring Boot</description>\n\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.baomidou</groupId>\n            <artifactId>mybatis-plus-boot-starter</artifactId>\n            <version>3.1.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-jpa</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>com.jayway.jsonpath</groupId>\n            <artifactId>json-path</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-autoconfigure</artifactId>\n            <version>2.1.6.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-rest</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-mongodb</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-configuration-processor</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <dependency>\n            <groupId>com.google.code.gson</groupId>\n            <artifactId>gson</artifactId>\n            <version>2.8.5</version>\n            <scope>compile</scope>\n        </dependency>\n\n        <!-- Use MySQL Connector-J -->\n\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n        </dependency>\n\n\n        <!-- image to base64 -->\n\n        <dependency>\n            <groupId>commons-io</groupId>\n            <artifactId>commons-io</artifactId>\n            <version>2.6</version>\n        </dependency>\n\n        <!-- jjwt支持 -->\n\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt</artifactId>\n            <version>0.9.1</version>\n        </dependency>\n\n        <dependency>\n            <groupId>com.auth0</groupId>\n            <artifactId>java-jwt</artifactId>\n            <version>3.4.0</version>\n        </dependency>\n\n        <!--commons-codec -->\n        <dependency>\n            <groupId>commons-codec</groupId>\n            <artifactId>commons-codec</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.github.terran4j</groupId>\n            <artifactId>terran4j-commons-api2doc</artifactId>\n            <version>1.0.2</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-thymeleaf</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.itextpdf.tool</groupId>\n            <artifactId>xmlworker</artifactId>\n            <version>5.5.10</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.poi</groupId>\n            <artifactId>poi-ooxml</artifactId>\n            <version>3.15</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.poi</groupId>\n            <artifactId>poi-scratchpad</artifactId>\n            <version>3.15</version>\n        </dependency>\n\n\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n```\n> maven更改为国内阿里云镜像，这样比较快\n\n![](/images/16ee2c8c324e66aa.png)\n\nsettings.xml:\n\n```xml\n<settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0\n    https://maven.apache.org/xsd/settings-1.0.0.xsd\">\n\n    <mirrors>\n        <mirror>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>http://maven.aliyun.com/nexus/content/groups/public/</url>\n            <mirrorOf>central</mirrorOf>\n        </mirror>\n    </mirrors>\n</settings>\n```\n\n\n\n> Mybatis 推荐插件如下：\n\n![image-20191207125851843](/images/image-20191207125851843.png)\n\n> application.yml\n\n```yaml\n# mysql\nspring:\n  jpa:\n    show-sql: true\n    hibernate:\n      ddl-auto: update\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\n  profiles:\n    active: dev\n  # 静态资源配置\n  mvc:\n    static-path-pattern: /**\n  resources:\n    static-locations: file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/\n\nmybatis-plus:\n  mapper-locations: classpath:/mapper/*.xml\n  type-aliases-package: com.zz.entity\n#自定义\nmy:\n  tokenURL: \"55555\"\n  authURL: \"88888\"\n\n```\n\n> application-dev.yml\n\n```yaml\n# mysql\nspring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8\n    username: root\n    password: ******\nserver:\n  port: 8080\n\n```\n\n> 大概目录结构如下\n\n![image-20191207133758025](/images/image-20191207133758025.png)\n\n搭建细节不再赘述；\n\n#### 2、读取自定义配置文件\n\n> com.zz.config.MyConfiguration\n\n```java\npackage com.zz.config;\n\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@ConfigurationProperties(prefix = \"my\")\npublic class MyConfiguration {\n\n    private String tokenURL;\n\n    private String authURL;\n\n    public String getAuthURL() {\n        return this.authURL;\n    }\n\n    public void setAuthURL(String authURL) {\n        this.authURL = authURL;\n    }\n\n    public String getTokenURL() {\n        return this.tokenURL;\n    }\n\n    public void setTokenURL(String tokenURL) {\n        this.tokenURL = tokenURL;\n    }\n}\n\n```\n\n#### 3、web服务配置\n\n> com.zz.config.MyConfiguration\n\n```java\npackage com.zz.config;\n\nimport com.zz.common.interceptor.AuthenticationInterceptor;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n\n@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // 拦截所有请求，通过判断是否有 @passToken 注解 决定是否需要跳过登录\n        registry.addInterceptor(authenticationInterceptor())\n                .addPathPatterns(\"/**\");\n    }\n\n    @Bean\n    public AuthenticationInterceptor authenticationInterceptor() {\n        return new AuthenticationInterceptor();\n    }\n\n}\n\n```\n\n#### 4、自定义返回统一的实体类Response\n\n> com.zz.model.Response\n\n```java\npackage com.zz.model;\n\n\npublic class Response {\n\n    private int code;\n    private String msg;\n    private Object data;\n\n    public Object getData() {\n        return data;\n    }\n\n    public void setData(Object data) {\n        this.data = data;\n    }\n\n    public int getCode() {\n        return code;\n    }\n\n    public void setCode(int code) {\n        this.code = code;\n    }\n\n    public String getMsg() {\n        return msg;\n    }\n\n    public void setMsg(String msg) {\n        this.msg = msg;\n    }\n}\n\n```\n\n#### 5、Utils公共方法类\n\n> com.zz.utils.HttpUtils\n>\n> 获取Request、 Response、session\n\n```java\npackage com.zz.utils;\n\nimport org.springframework.web.context.request.RequestContextHolder;\nimport org.springframework.web.context.request.ServletRequestAttributes;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\n\n/**\n * 获取 Request 和 Response\n */\npublic class HttpUtils {\n\n    // 获取 request\n    public static HttpServletRequest getRequest() {\n        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();\n        if (requestAttributes == null) return null;\n        return requestAttributes.getRequest();\n    }\n\n    // 获取 response\n    public static HttpServletResponse getResponse() {\n        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();\n        if (requestAttributes == null) return null;\n        return requestAttributes.getResponse();\n    }\n\n    // 获取 session\n    public static HttpSession getSession(){\n        HttpServletRequest request = getRequest();\n        if(request == null) return null;\n        return request.getSession();\n    }\n}\n\n```\n\n> com.zz.utils.JWTUtils\n>\n> JWT 生成token, 验证token\n\n```java\npackage com.zz.utils;\n\nimport com.zz.entity.User;\nimport io.jsonwebtoken.*;\nimport org.apache.commons.codec.binary.Base64;\n\nimport javax.crypto.SecretKey;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.UUID;\n\npublic class JWTUtils {\n\n    // 生成签名的时候使用的秘钥secret\n    private static final String SECRETKEY = \"KJHUhjjJYgYUllVbXhKDHXhkSyHjlNiVkYzWTBac1Yxkjhuad\";\n\n    // expirationDate 生成jwt的有效期，单位秒\n    private static long expirationDate = 2 * 60 * 60;\n\n\n    /**\n     * 由字符串生成加密key\n     *\n     * @return SecretKey\n     */\n    private static SecretKey generalKey(String stringKey) {\n        byte[] encodedKey = Base64.decodeBase64(stringKey);\n        return new SecretKeySpec(encodedKey, 0, encodedKey.length, \"AES\");\n    }\n\n    /**\n     * 创建 jwt\n     *\n     * @param user 登录成功后的用户信息\n     * @return jwt token\n     */\n    public static String createToken(User user) {\n\n        // 指定签名的时候使用的签名算法，也就是header那部分，jwt已经将这部分内容封装好了\n        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;\n\n        // 生成JWT的时间\n        long nowMillis = System.currentTimeMillis();\n        Date now = new Date(nowMillis);\n\n        // 创建payload的私有声明（根据特定的业务需要添加，如果要拿这个做验证，一般是需要和jwt的接收方提前沟通好验证方式的）\n        Map<String, Object> claims = new HashMap<>();\n        claims.put(\"userId\", user.getUserId());\n        claims.put(\"userName\", user.getUserName());\n        claims.put(\"password\", user.getPassword());\n\n        // 生成签名的时候使用的秘钥secret,这个方法本地封装了的，一般可以从本地配置文件中读取，切记这个秘钥不能外露哦。它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了\n        SecretKey key = generalKey(SECRETKEY + user.getPassword());\n\n        // 生成签发人\n        // json形式字符串或字符串，增加用户非敏感信息存储，如用户id或用户账号，与token解析后进行对比，防止乱用\n        HashMap<String, Object> storeInfo = new HashMap<String, Object>();\n        storeInfo.put(\"userId\", user.getUserId());\n        storeInfo.put(\"userName\", user.getUserName());\n        String subject = storeInfo.toString();\n\n        // 下面就是在为payload添加各种标准声明和私有声明了\n        // 这里其实就是new一个JwtBuilder，设置jwt的body\n        JwtBuilder builder = Jwts.builder()\n                // 如果有私有声明，一定要先设置这个自己创建的私有的声明，这个是给builder的claim赋值，一旦写在标准的声明赋值之后，就是覆盖了那些标准的声明的\n                .setClaims(claims)\n                // 唯一随机UUID\n                // 设置JWT ID：是JWT的唯一标识，根据业务需要，这个可以设置为一个不重复的值，主要用来作为一次性token,从而回避重放攻击\n                .setId(UUID.randomUUID().toString())\n                // jwt的签发时间\n                .setIssuedAt(now)\n                // 代表这个JWT的主体，即它的所有人，这个是一个json格式的字符串，可以存放什么userid，roldid之类的，作为什么用户的唯一标志\n                .setSubject(subject)\n                // 设置签名使用的签名算法和签名使用的秘钥\n                .signWith(signatureAlgorithm, key);\n\n        if (expirationDate >= 0) {\n            long expMillis = nowMillis + expirationDate * 1000;\n            Date exp = new Date(expMillis);\n            builder.setExpiration(exp);\n        }\n        return builder.compact();\n    }\n\n    /**\n     * 解密token，获取声明的实体\n     *\n     * @param token 加密后的token\n     * @return claims\n     */\n    public static Claims parseToken(String token, User user) {\n        // 签名秘钥，和生成的签名的秘钥要保持一模一样\n        SecretKey key = generalKey(SECRETKEY + user.getPassword());\n\n        // 获取私有声明\n        Claims claims = Jwts.parser()\n                // 设置签名的秘钥\n                .setSigningKey(key)\n                // 设置需要解析的token\n                .parseClaimsJws(token).getBody();\n\n        return claims;\n    }\n\n\n    /**\n     * 校验token\n     *\n     * @param token 加密后的token\n     * @param user  用户信息\n     * @return true|false\n     */\n    public static Boolean verify(String token, User user) {\n\n        // 获取私有声明的实体\n        Claims claims = parseToken(token, user);\n\n        return claims.get(\"password\").equals(user.getPassword());\n    }\n}\n```\n\n#### 6、查询实体类 query\n\n所有的服务查询都采用统一的各自的实体类\n\n比如：\n\n> com.zz.query.UserQuery\n>\n> 用户查询实体\n\n```java\npackage com.zz.query;\n\npublic class UserQuery {\n\n    private String userName;\n\n    private String password;\n\n    private long userId;\n\n    private boolean showPassword;\n\n    public boolean isShowPassword() {\n        return showPassword;\n    }\n\n    public void setShowPassword(boolean showPassword) {\n        this.showPassword = showPassword;\n    }\n\n    public long getUserId() {\n        return userId;\n    }\n\n    public void setUserId(long userId) {\n        this.userId = userId;\n    }\n\n    public String getUserName() {\n        return userName;\n    }\n\n    public void setUserName(String userName) {\n        this.userName = userName;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n}\n\n```\n\n#### 7、查询后返回实体类\n\n所有的服务查询返回都采用统一的各自的实体类\n\n比如：\n\n> com.zz.entity.User\n>\n> 用户数据返回实体\n\n```java\npackage com.zz.entity;\n\npublic class User {\n\n    private long userId;\n\n    private String userName;\n\n    private String token;\n\n    private String password;\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getToken() {\n        return token;\n    }\n\n    public void setToken(String token) {\n        this.token = token;\n    }\n\n    public long getUserId() {\n        return userId;\n    }\n\n    public void setUserId(long userId) {\n        this.userId = userId;\n    }\n\n    public String getUserName() {\n        return userName;\n    }\n\n    public void setUserName(String userName) {\n        this.userName = userName;\n    }\n\n}\n\n```\n\n#### 8 、接口实现三层架构\n\n我们这采取的是三层架构：controller —> service —> mapper;\n\n如果我们要写一个User类接口，先声明一个UserController路由控制层，然后这个里调用UserService实现类方法，然后再调用mapper持久层去CRUD（mysql增查删改）。\n\n#### 9、开始搭建注册用户功能\n\n基础搭建先暂停，开始实质业务的推演；\n\nmysql的连接就不多说啦；\n\n让我们开始实现之旅吧；\n\n> com.zz.newController.UserController\n>\n> 用户注册\n\n```java\npackage com.zz.newController;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n\n/**\n * 登录\n * author: wz\n */\n@RestController\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    @Autowired\n    private UserService userService;\n\n    /*\n     * @param userName\n     * @param password\n     * @return response\n     */\n    @PostMapping(\"/add\")\n    @PassToken\n    public Response addUser(@RequestParam String userName, @RequestParam String password, Response response) {\n        UserQuery query = new UserQuery();\n        User userData = null;\n\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        int result;\n        String message = \"\";\n\n        // 判断用户是否已经存在\n        UserQuery findUserQuery = new UserQuery();\n        findUserQuery.setUserName(userName);\n        User existUser = this.userService.findUserByName(findUserQuery);\n        if (existUser == null) {\n\n            // 插入用户\n            try {\n                result = this.userService.addUser(query);\n                message = \"success\";\n            } catch (Exception e) {\n                result = 0;\n                message = \"error\";\n                e.printStackTrace();\n            }\n\n            // 插入用户成功后返回用户信息\n            if (result == 1) {\n                userData = this.userService.findUserByName(findUserQuery);\n\n                // 生成token\n                String token = null;\n\n                // 当前用户\n                User currentUser = new User();\n                if (userData != null) {\n                    currentUser.setUserId(userData.getUserId());\n                    currentUser.setUserName(userData.getUserName());\n                    currentUser.setPassword(password);\n                    token = JWTUtils.createToken(currentUser);\n                }\n\n                if (token != null) {\n                    userData.setToken(token);\n\n                    // 获取token用户信息\n                    // Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);\n                }\n            }\n\n        } else {\n            message = \"用户已经存在\";\n        }\n\n        response.setData(userData);\n        response.setMsg(message);\n        return response;\n    }\n\n}\n\n```\n\n> com.zz.service.UserService\n>\n> Interface 用户接口\n\n```java\npackage com.zz.service;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic interface UserService {\n\n    // 添加用户\n    int addUser(UserQuery query);\n\n\n}\n\n```\n\n> com.zz.service.impl.UserServiceImpl\n>\n> 用户接口实现类\n\n```java\npackage com.zz.service.impl;\n\nimport com.zz.entity.User;\nimport com.zz.mapper.UserMapper;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.Map;\n\n@Service\npublic class UserServiceImpl implements UserService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public int addUser(UserQuery query){\n        return this.userMapper.insert(query);\n    }\n\n}\n\n```\n\n> com.zz.mapper.UserMapper\n>\n> mapper\n\n```java\npackage com.zz.mapper;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\n\npublic interface UserMapper {\n\n    int insert(UserQuery query);\n\n}\n\n```\n\n> resources/mapper/UserMapper.xml\n>\n> 前后名字一定对应\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" >\n<mapper namespace=\"com.zz.mapper.UserMapper\">\n\n    <resultMap id=\"BaseResult\" type=\"com.zz.entity.User\">\n        <id column=\"user_id\" property=\"userId\"></id>\n        <id column=\"user_name\" property=\"userName\"></id>\n    </resultMap>\n\n    <sql id=\"base\">\n        user_id,\n        user_name\n        <if test=\"showPassword\">\n            , password\n        </if>\n    </sql>\n\n    <sql id=\"base_condition\">\n        <where>\n            <if test=\"userName!=null and userName!=''\">\n                user_name=#{userName}\n            </if>\n            <if test=\"password!=null and password!=''\">\n                and password=#{password}\n            </if>\n        </where>\n\n    </sql>\n\n    <insert id=\"insert\">\n        INSERT INTO user(\n        user_name,\n        password\n        ) VALUES (\n        #{userName},\n        #{password}\n        )\n    </insert>\n\n\n</mapper>\n\n```\n\n到此，整个接口书写过程已全部完成，这就是在当前架构下写一个接口的全部过程。\n\n#### 10、搭建web实例 ——注册用户\n\n由于我们在配置文件里已经配置静态资源的路径，所以我们可以在resources里面写一个不分离的we b实例进行访问。\n\n> resources/static/regist.html\n>\n> 注册页面\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=0\">\n    <title>注册用户</title>\n    <!-- 引入样式 -->\n    <link rel=\"stylesheet\" href=\"css/regist.css\"/>\n    <link rel=\"stylesheet\" href=\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\">\n\n</head>\n<body>\n<div class=\"container\">\n    <div class=\"page form_page js_show\">\n        <div class=\"weui-form\">\n            <div class=\"weui-form__text-area\">\n                <h2 class=\"weui-form__title\">注册新用户</h2>\n            </div>\n            <div class=\"weui-form__control-area\">\n                <div class=\"weui-cells__group weui-cells__group_form\">\n                    <div class=\"weui-cells weui-cells_form\">\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">用户名</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——user\" class=\"weui-input\" placeholder=\"请输入要设置的用户名\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd\" type=\"password\" class=\"weui-input\" placeholder=\"请输入要设置的密码\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">确认密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd2\" type=\"password\" class=\"weui-input\" placeholder=\"请再次输入设置的密码\" type=\"number\" pattern=\"[0-9]*\">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n<!--            <div class=\"weui-form__tips-area\">-->\n<!--                <p class=\"weui-form__tips\">-->\n<!--                    表单页提示，居中对齐-->\n<!--                </p>-->\n<!--            </div>-->\n            <div class=\"weui-form__opr-area\">\n                <a class=\"weui-btn weui-btn_primary\" href=\"javascript:\" id=\"submit\">确定</a>\n            </div>\n\n            <div class=\"weui-form__extra-area\">\n                <div class=\"weui-footer\">\n<!--                    <p class=\"weui-footer__links\">-->\n<!--                        <a href=\"javascript:void(0);\" class=\"weui-footer__link\">底部链接文本</a>-->\n<!--                    </p>-->\n                    <p class=\"weui-footer__text\">Copyright © 2019 alex wong</p>\n                </div>\n            </div>\n        </div>\n        <div id=\"js_toast\" style=\"display: none;\">\n            <div class=\"weui-mask_transparent\"></div>\n            <div class=\"weui-toast\">\n                <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n                <p class=\"weui-toast__content\">已完成</p>\n            </div>\n        </div>\n    </div>\n</div>\n</body>\n<script src=\"js/md5.js\"></script>\n<script src=\"js/utils.js\"></script>\n<script src=\"js/dataService.js\"></script>\n<script type=\"text/javascript\" src=\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"></script>\n<script src=\"js/regist.js\"></script>\n</html>\n```\n\n> static/js/dataService.js\n\n```javascript\nconst APIURL = '/';\n\nwindow.dataService = {\n\n\t//GET\n\tget: (url, params = {}) => {\n\n\t\tconst searchArr = [];\n\n\t\tObject.keys(params).forEach(n => {\n\t\t\tsearchArr.push(`${n}=${params[n]}`);\n\t\t});\n\n\t\tconst searchStr = searchArr.length ? '?' + searchArr.join('&') : '';\n\t\tconst token = utils.getCookie('token');\n\n\t\treturn fetch(APIURL + url + searchStr, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\ttoken\n\t\t\t}\n\t\t}).then(res => res.json());\n\t},\n\n\t//POST\n\tpost: (url, params = {}) => {\n\n\t\tconst formData = new FormData();\n\n\t\tObject.keys(params).forEach(n => {\n\t\t\tformData.append(n, params[n]);\n\t\t});\n\n\t\tconst token = utils.getCookie('token');\n\n\t\treturn fetch(APIURL + url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\ttoken\n\t\t\t},\n\t\t\tbody: formData\n\t\t}).then(res => res.json());\n\t},\n\n\t// 注册\n\taddUser(params) {\n\t\treturn this.post('user/add', params);\n\t},\n\n\t// 登录\n\tlogin(params) {\n\t\treturn this.post('user/login', params);\n\t},\n\n\t// 用户信息\n\tgetUserInfo(params) {\n\t\treturn this.get('user/info', params);\n\t},\n\n};\n```\n\n> static/js/utils.js\n\n```javascript\nwindow.utils = {\n\n\t// md5\n\tgenerateMd5(userName, password) {\n\t\tconst salt = \"1qaz2wsx3edc4rfv5tgb6yhn7ujm8ik9ol0p@!.\";\n\t\tconst asciStr = userName + salt + password;\n\t\tconst asciArr = asciStr.split('');\n\t\tconst asciResult = [];\n\t\tasciArr.forEach(n => {\n\t\t\tasciResult.push(n.charCodeAt());\n\t\t});\n\t\tconst ascireusltStr = asciResult.join(salt);\n\t\treturn hex_md5(ascireusltStr);\n\t},\n\n\t// setCookie\n\tsetCookie(name, value) {\n\t\tvar time = 2 * 60 * 60 * 1000;\n\t\tvar exp = new Date();\n\t\texp.setTime(exp.getTime() + time);\n\t\tdocument.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\n\t},\n\n\t// getCookie\n\tgetCookie(name) {\n\t\tvar arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n\t\tif (arr = document.cookie.match(reg))\n\t\t\treturn unescape(arr[2]);\n\t\telse\n\t\t\treturn null;\n\t}\n\n};\n```\n\n> static/js/regist.js\n\n```javascript\n// 获取相关用户信息\nconst userNameInput = document.getElementById(\"js_input——user\");\nconst passwordInput = document.getElementById(\"js_input——pwd\");\nconst passwordConfirmInput = document.getElementById(\"js_input——pwd2\");\nconst submitBtn = document.getElementById(\"submit\");\n\n// submit\nsubmitBtn.onclick = () => {\n\n\tconst userName = userNameInput.value;\n\tconst password = passwordInput.value;\n\tconst confirmPassword = passwordConfirmInput.value;\n\n\t// verify\n\tif (!userName) {\n\t\tweui.topTips('用户姓名不能为空');\n\t\treturn;\n\t} else if (!password) {\n\t\tweui.topTips('用户密码不能为空');\n\t\treturn;\n\t} else if (confirmPassword !== password) {\n\t\tweui.topTips('前后密码不一致，请重试');\n\t\treturn;\n\t}\n\n\t// 加密密码\n\tconst newPassword = utils.generateMd5(userName, password);\n\n\t// 注册\n\tdataService.addUser({\n\t\tuserName,\n\t\tpassword: newPassword,\n\t}).then(res => {\n\t\tconst {code, data, msg} = res;\n\t\tif (!data) {\n\t\t\tweui.topTips(msg);\n\t\t} else {\n\t\t\tweui.topTips(`注册成功，欢迎 ${data.userName}`);\n\t\t\twindow.location.href = location.origin + '/login.html';\n\t\t}\n\t})\n};\n```\n\n效果如图：\n\n![](/images/image-20191207144736880.png)\n\n> 增加一些基本的校验\n\n![image-20191207145008765](/images/image-20191207145008765.png)\n\n> 用户密码加密传输，并验证新用户是否已经注册\n\n![image-20191207145612200](/images/image-20191207145612200.png)\n\n\n\n![image-20191207150016196](/images/image-20191207150016196.png)\n\n> mysql 查看下用户表\n\n![image-20191207150530465](/images/image-20191207150530465.png)\n\n#### 11、后端-用户登录功能\n\n按上面第9步骤所述，下面的添加内容，请直接添加到上述服务中，不再全部展示代码。\n\n>com.zz.newController.UserController\n>\n>首先要判断用户是否存在，如果存在，返回基本信息并返回用户凭证token\n\n```java\n/**\n     * 登录\n     *\n     * @param userName 用户名\n     * @param password 密码\n     * @return {}\n     */\n    @PostMapping(\"/login\")\n    @PassToken\n    public Response login(@RequestParam String userName, @RequestParam String password, Response response) {\n\n        UserQuery query = new UserQuery();\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        // 验证用户和密码\n        try {\n            // 判断用户是否已经存在\n            User existUser = this.userService.findUserByName(query);\n\n            // 生成token\n            String token = null;\n\n            // 当前用户\n            User currentUser = new User();\n            if (existUser != null) {\n                currentUser.setUserId(existUser.getUserId());\n                currentUser.setUserName(existUser.getUserName());\n                currentUser.setPassword(password);\n               // 生成用户凭证\n                token = JWTUtils.createToken(currentUser);\n                if (token != null) {\n                    existUser.setToken(token);\n                }\n                response.setMsg(\"success\");\n                response.setData(existUser);\n            } else {\n                // 登录失败\n                response.setMsg(\"登录失败，请检查用户名和密码\");\n                response.setData(null);\n            }\n\n        } catch (Exception e) {\n            response.setMsg(\"login failed\");\n            response.setData(null);\n            e.printStackTrace();\n        }\n        return response;\n    }\n```\n\n> com.zz.service.UserService\n\n```java\npackage com.zz.service;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic interface UserService {\n\n    // 添加用户\n    int addUser(UserQuery query);\n\n    //查找单个用户\n    User findUserById(UserQuery query);\n\n    User findUserByName(UserQuery query);\n\n}\n\n```\n\n> com.zz.service.impl.UserServiceImpl\n\n```java\npackage com.zz.service.impl;\n\nimport com.zz.entity.User;\nimport com.zz.mapper.UserMapper;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.Map;\n\n@Service\npublic class UserServiceImpl implements UserService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public int addUser(UserQuery query){\n        return this.userMapper.insert(query);\n    }\n\n    @Override\n    public User findUserById(UserQuery query) {\n        return this.userMapper.findUserById(query);\n    }\n\n    @Override\n    public User findUserByName(UserQuery query) {\n        return this.userMapper.findUserByName(query);\n    }\n\n    @Override\n    public List<User> findAllUser(UserQuery query) {\n        return this.userMapper.findAllUser(query);\n    }\n}\n\n```\n\n> com.zz.mapper.UserMapper\n\n```java\npackage com.zz.mapper;\n\nimport com.zz.entity.User;\nimport com.zz.query.UserQuery;\n\nimport java.util.List;\n\npublic interface UserMapper {\n\n    int insert(UserQuery query);\n\n    User findUserById(UserQuery query);\n\n    User findUserByName(UserQuery query);\n\n    List<User> findAllUser(UserQuery query);\n\n}\n\n```\n\n> mapper/UserMapper.xml\n\n```yaml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" >\n<mapper namespace=\"com.zz.mapper.UserMapper\">\n\n    <resultMap id=\"BaseResult\" type=\"com.zz.entity.User\">\n        <id column=\"user_id\" property=\"userId\"></id>\n        <id column=\"user_name\" property=\"userName\"></id>\n    </resultMap>\n\n    <sql id=\"base\">\n        user_id,\n        user_name\n        <if test=\"showPassword\">\n            , password\n        </if>\n    </sql>\n\n    <sql id=\"base_condition\">\n        <where>\n            <if test=\"userName!=null and userName!=''\">\n                user_name=#{userName}\n            </if>\n            <if test=\"password!=null and password!=''\">\n                and password=#{password}\n            </if>\n        </where>\n\n    </sql>\n\n    <!-- 查询所有user -->\n    <select id=\"findAllUser\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n    </select>\n\n    <!-- 查询user -->\n    <select id=\"findUserById\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n        where\n        user_id = #{userId}\n    </select>\n\n    <select id=\"findUserByName\" resultMap=\"BaseResult\">\n        select\n        <include refid=\"base\"/>\n        from user\n        <include refid=\"base_condition\"/>\n    </select>\n\n    <insert id=\"insert\">\n        INSERT INTO user(\n        user_name,\n        password\n        ) VALUES (\n        #{userName},\n        #{password}\n        )\n    </insert>\n\n\n</mapper>\n\n```\n\n#### 12、搭建web实例 ——登录用户\n\n> static/login.html\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=0\">\n    <title>login</title>\n    <!-- 引入样式 -->\n    <link rel=\"stylesheet\" href=\"css/regist.css\"/>\n    <link rel=\"stylesheet\" href=\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\">\n\n</head>\n<body>\n<div class=\"container\">\n    <div class=\"page form_page js_show\">\n        <div class=\"weui-form\">\n            <div class=\"weui-form__text-area\">\n                <h2 class=\"weui-form__title\">登录</h2>\n            </div>\n            <div class=\"weui-form__control-area\">\n                <div class=\"weui-cells__group weui-cells__group_form\">\n                    <div class=\"weui-cells weui-cells_form\">\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">用户名</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——user\" class=\"weui-input\" placeholder=\"请输入用户名\">\n                            </div>\n                        </div>\n                        <div class=\"weui-cell\">\n                            <div class=\"weui-cell__hd\"><label class=\"weui-label\">密码</label></div>\n                            <div class=\"weui-cell__bd\">\n                                <input id=\"js_input——pwd\" type=\"password\" class=\"weui-input\" placeholder=\"请输入密码\">\n                            </div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n<!--            <div class=\"weui-form__tips-area\">-->\n<!--                <p class=\"weui-form__tips\">-->\n<!--                    表单页提示，居中对齐-->\n<!--                </p>-->\n<!--            </div>-->\n            <div class=\"weui-form__opr-area\">\n                <a class=\"weui-btn weui-btn_primary\" href=\"javascript:\" id=\"submit\">确定</a>\n            </div>\n\n            <div class=\"weui-form__extra-area\">\n                <div class=\"weui-footer\">\n<!--                    <p class=\"weui-footer__links\">-->\n<!--                        <a href=\"javascript:void(0);\" class=\"weui-footer__link\">底部链接文本</a>-->\n<!--                    </p>-->\n                    <p class=\"weui-footer__text\">Copyright © 2019 alex wong</p>\n                </div>\n            </div>\n        </div>\n        <div id=\"js_toast\" style=\"display: none;\">\n            <div class=\"weui-mask_transparent\"></div>\n            <div class=\"weui-toast\">\n                <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n                <p class=\"weui-toast__content\">已完成</p>\n            </div>\n        </div>\n    </div>\n</div>\n</body>\n<script src=\"js/md5.js\"></script>\n<script src=\"js/utils.js\"></script>\n<script src=\"js/dataService.js\"></script>\n<script type=\"text/javascript\" src=\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"></script>\n<script src=\"js/login.js\"></script>\n</html>\n```\n\n> static/js/login.js\n\n```javascript\n// 获取相关用户信息\nconst userNameInput = document.getElementById(\"js_input——user\");\nconst passwordInput = document.getElementById(\"js_input——pwd\");\nconst submitBtn = document.getElementById(\"submit\");\n\n// submit\nsubmitBtn.onclick = () => {\n\n\tconst userName = userNameInput.value;\n\tconst password = passwordInput.value;\n\n\t// verify\n\tif (!userName) {\n\t\tweui.topTips('用户姓名不能为空');\n\t\treturn;\n\t} else if (!password) {\n\t\tweui.topTips('用户密码不能为空');\n\t\treturn;\n\t}\n\n\t// 加密密码\n\tconst newPassword = utils.generateMd5(userName, password);\n\n\t// 注册\n\tdataService.login({\n\t\tuserName,\n\t\tpassword: newPassword,\n\t}).then(res => {\n\t\tconst {code, data, msg} = res;\n\t\tif (!data) {\n\t\t\tweui.topTips(msg);\n\t\t} else {\n\t\t\tweui.topTips(`登录成功，欢迎 ${data.userName}`);\n\t\t\tutils.setCookie('token', data.token);\n\t\t\tlocation.href = location.origin + '/home.html';\n\t\t}\n\t})\n};\n```\n\n![image-20191207152034072](/images/image-20191207152034072.png)\n\n![image-20191207152244301](/images/image-20191207152244301.png)\n\n![image-20191207152343686](/images/image-20191207152343686.png)\n\n登录接口返回用户凭证token，后续用来校验用户接口，增加安全性。\n\n#### 13、增加自定义注解和拦截器\n\n在常规的业务开发中，切记不可把接口服务暴露给任何人都可以访问，不然别人可以任意查看或者修改你的数据，这是很严重的事情。除了常规从网段IP方面限制固定客户端IP的范围，接口本身也要增加安全验证，这个时候我们就需要用到之前生成的用户凭证token;\n\n\n\n问题是我们如果自定义控制，哪些接口是需要经过验证，哪些接口是不需要通过验证的呢？有人可能会说，直接全部验证不就可以啦，何苦纠结。但是在真实的业务中，有些接口是不能强制校验的，比如一些用户分享到微信的那种接口，是不能增加验证，否则分享的页面无法正常显示。\n\n\n\n所以我们可以自定义注解@PassToken, 添加这个注解的接口，就可以不用进行token验证了。\n\n> com.zz.common.annotation.PassToken\n>\n> PassToken 注解\n\n```java\npackage com.zz.common.annotation;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n// 是否跳过token验证\n@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface PassToken {\n    boolean required() default true;\n}\n\n```\n\n\n\n> 添加拦截器\n>\n> com.zz.common.interceptor.AuthenticationInterceptor\n>\n> 在发送请求的时候，在请求头里面加token, 然后验证的时候token从头部获取\n>\n> 如果没有token, 进行无token提示；\n>\n> 如果存在，就用 JWT 校验 token 是否存在，并且校验用户密码是否正确。\n\n\n\n```java\npackage com.zz.common.interceptor;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.exceptions.JWTDecodeException;\nimport com.mongodb.util.JSON;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.configurationprocessor.json.JSONException;\nimport org.springframework.boot.configurationprocessor.json.JSONObject;\nimport org.springframework.web.method.HandlerMethod;\nimport org.springframework.web.servlet.HandlerInterceptor;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.lang.reflect.Method;\n\n// 拦截器\npublic class AuthenticationInterceptor implements HandlerInterceptor {\n\n    @Autowired\n    private UserService userService;\n\n    /**\n     * response返回信息\n     *\n     * @param code\n     * @param message\n     * @return\n     * @throws JSONException\n     */\n    public JSONObject getJsonObject(int code, String message) throws JSONException {\n        JSONObject jsonObject = new JSONObject();\n        jsonObject.put(\"msg\", message);\n        jsonObject.put(\"code\", code);\n        return jsonObject;\n    }\n\n    @Override\n    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object object) throws Exception {\n\n        // 从 http 请求头中取出 token\n        String token = BaseApplicationController.getToken();\n        // 如果不是映射到方法直接通过\n        if (!(object instanceof HandlerMethod)) {\n            return true;\n        }\n\n        HandlerMethod handlerMethod = (HandlerMethod) object;\n        Method method = handlerMethod.getMethod();\n        //检查是否有PassToken注释，有则跳过认证\n        if (method.isAnnotationPresent(PassToken.class)) {\n            PassToken passToken = method.getAnnotation(PassToken.class);\n            if (passToken.required()) {\n                return true;\n            }\n        }\n\n        // 默认执行认证\n        httpServletResponse.setContentType(\"application/json;charset=UTF-8\");\n        if (token == null || token.equals(\"null\")) {\n            JSONObject jsonObject = getJsonObject(403, \"无token，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"无token，请重新登录\");\n        }\n\n        // 获取 token 中的 user id\n        long userId;\n        try {\n            userId = BaseApplicationController.getCurrentUserId();\n        } catch (JWTDecodeException j) {\n            JSONObject jsonObject = getJsonObject(500, \"访问异常, token不正确，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"访问异常！\");\n        }\n\n        // 验证用户是否存在\n        UserQuery query = new UserQuery();\n        query.setUserId(userId);\n        query.setShowPassword(Boolean.TRUE);\n        User user = userService.findUserById(query);\n\n        if (user == null) {\n            JSONObject jsonObject = getJsonObject(500, \"用户不存在，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"用户不存在，请重新登录\");\n        }\n\n        // 验证token是否有效\n        Boolean verify = JWTUtils.verify(token, user);\n        if (!verify) {\n            JSONObject jsonObject = getJsonObject(500, \"非法访问，请重新登录\");\n            httpServletResponse.getWriter().write(jsonObject.toString());\n            return false;\n            // throw new RuntimeException(\"非法访问！\");\n        }\n\n        return true;\n    }\n}\n\n```\n\n下面让我们实例看下效果：\n\n> com.zz.newController.UserController\n\n```java\npackage com.zz.newController;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport com.zz.common.annotation.PassToken;\nimport com.zz.common.base.BaseApplicationController;\nimport com.zz.entity.User;\nimport com.zz.model.Response;\nimport com.zz.query.UserQuery;\nimport com.zz.service.UserService;\nimport com.zz.utils.JWTUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n\n/**\n * 登录\n * autho: wangzhao\n */\n@RestController\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    @Autowired\n    private UserService userService;\n\n    /*\n     * @param userName\n     * @param password\n     * @return response\n     */\n    @PostMapping(\"/add\")\n    @PassToken\n    public Response addUser(@RequestParam String userName, @RequestParam String password, Response response) {\n        UserQuery query = new UserQuery();\n        User userData = null;\n\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        int result;\n        String message = \"\";\n\n        // 判断用户是否已经存在\n        UserQuery findUserQuery = new UserQuery();\n        findUserQuery.setUserName(userName);\n        User existUser = this.userService.findUserByName(findUserQuery);\n        if (existUser == null) {\n\n            // 插入用户\n            try {\n                result = this.userService.addUser(query);\n                message = \"success\";\n            } catch (Exception e) {\n                result = 0;\n                message = \"error\";\n                e.printStackTrace();\n            }\n\n            // 插入用户成功后返回用户信息\n            if (result == 1) {\n                userData = this.userService.findUserByName(findUserQuery);\n\n                // 生成token\n                String token = null;\n\n                // 当前用户\n                User currentUser = new User();\n                if (userData != null) {\n                    currentUser.setUserId(userData.getUserId());\n                    currentUser.setUserName(userData.getUserName());\n                    currentUser.setPassword(password);\n                    token = JWTUtils.createToken(currentUser);\n                }\n\n                if (token != null) {\n                    userData.setToken(token);\n\n                    // 获取token用户信息\n                    // Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);\n                }\n            }\n\n        } else {\n            message = \"用户已经存在\";\n        }\n\n        response.setData(userData);\n        response.setMsg(message);\n        return response;\n    }\n\n    /**\n     * 登录\n     *\n     * @param userName 用户名\n     * @param password 密码\n     * @return {}\n     */\n    @PostMapping(\"/login\")\n    @PassToken\n    public Response login(@RequestParam String userName, @RequestParam String password, Response response) {\n\n        UserQuery query = new UserQuery();\n        query.setUserName(userName);\n        query.setPassword(password);\n\n        // 验证用户和密码\n        try {\n            // 判断用户是否已经存在\n            User existUser = this.userService.findUserByName(query);\n\n            // 生成token\n            String token = null;\n\n            // 当前用户\n            User currentUser = new User();\n            if (existUser != null) {\n                currentUser.setUserId(existUser.getUserId());\n                currentUser.setUserName(existUser.getUserName());\n                currentUser.setPassword(password);\n                token = JWTUtils.createToken(currentUser);\n                if (token != null) {\n                    existUser.setToken(token);\n                }\n                response.setMsg(\"success\");\n                response.setData(existUser);\n            } else {\n                // 登录失败\n                response.setMsg(\"登录失败，请检查用户名和密码\");\n                response.setData(null);\n            }\n\n        } catch (Exception e) {\n            response.setMsg(\"login failed\");\n            response.setData(null);\n            e.printStackTrace();\n        }\n        return response;\n    }\n\n    /**\n     * 获取个人信息\n     *\n     * @return {}\n     */\n    @GetMapping(\"/info\")\n    public Response getUserInfo(Response response) {\n        // 获取token\n        String token = BaseApplicationController.getToken();\n        User userData2 = BaseApplicationController.getCurrentUser();\n        Map<String, Object> headerData = BaseApplicationController.getHeader();\n        if (token != null && !token.equals(\"null\")) {\n            User userData = new User();\n            DecodedJWT claims = JWT.decode(token);\n            userData.setUserName(claims.getClaim(\"userName\").asString());\n            userData.setUserId(claims.getClaim(\"userId\").asLong());\n            response.setData(userData);\n            response.setMsg(\"success\");\n        } else {\n            response.setMsg(\"token不存在\");\n        }\n        return response;\n    }\n\n}\n\n```\n\n我们新写了一个接口，获取用户信息，如上，其余代码不再赘述；\n\n> 成功获取用户信息\n\n![image-20191207154357109](/images/image-20191207154357109.png)\n\n> 删除token\n\n![image-20191207154505224](/images/image-20191207154505224.png)\n\n![image-20191207154542523](/images/image-20191207154542523.png)\n\n> Token 故意改错\n\n![image-20191207154655011](/images/image-20191207154655011.png)\n\n\n\n![image-20191207154738162](/images/image-20191207154738162.png)\n\n![image-20191207154806418](/images/image-20191207154806418.png)\n\n到此，验证过程完美成功；\n\n#### 14、总结\n\n以上过程，只是一个简单服务的搭建，真实的服务还需要更多配置，比如XSS配置防止XSS攻击等。好了，本篇文章到此为止，如果有哪里描述得不清楚，请多多包涵。","slug":"spring boot从零搭建登录注册功能并进行所有接口验证","published":1,"date":"2020-03-04T23:38:32.733Z","updated":"2020-03-05T00:32:49.829Z","title":"spring boot从零搭建登录注册功能并进行所有接口验证","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7e0nvt50000ntcyhcv0605e","content":"<h3 id=\"spring-boot从零搭建登录注册功能并进行所有接口验证\"><a href=\"#spring-boot从零搭建登录注册功能并进行所有接口验证\" class=\"headerlink\" title=\"spring boot从零搭建登录注册功能并进行所有接口验证\"></a>spring boot从零搭建登录注册功能并进行所有接口验证</h3><p>[TOC]</p>\n<p>目前大多项目是前后端分离。在后台接口服务开发过程中，往往我们需要先搭建一个基础服务，比如登录注册功能、自动对所有的接口进行token的安全校验等，这样可以防范安全问题的出现。并且这样后续的同事可以只关注业务代码的开发，不需要关心基础架构服务的实现。</p>\n<p>这次我准备搭建一个简单的后台服务，用的是<code>spring boot + mysql + mybatis</code>。</p>\n<h4 id=\"1、搭建Spring-boot项目\"><a href=\"#1、搭建Spring-boot项目\" class=\"headerlink\" title=\"1、搭建Spring boot项目\"></a>1、搭建Spring boot项目</h4><p>首先我们使用IDEA自带的初始化项目功能，创建一个Spring boot项目，如图：</p>\n<p><img src=\"/images/image-20191207125203878.png\" alt=\"image-20191207125203878\"></p>\n<p>或者在线生成，<a href=\"https://start.spring.io/\" target=\"_blank\" rel=\"noopener\">点击进入</a></p>\n<p><img src=\"/images/16ee2c228a6ffd63.png\" alt></p>\n<blockquote>\n<p>pom.xml</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.6.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.zz<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rest-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>rest-api<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>Demo project for Spring Boot<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.jayway.jsonpath<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>json-path<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.6.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>gson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.8.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Use MySQL Connector-J --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- image to base64 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- jjwt支持 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.auth0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>java-jwt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--commons-codec --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.terran4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>terran4j-commons-api2doc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-devtools<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.itextpdf.tool<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>xmlworker<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi-ooxml<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.15<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi-scratchpad<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.15<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>maven更改为国内阿里云镜像，这样比较快</p>\n</blockquote>\n<p><img src=\"/images/16ee2c8c324e66aa.png\" alt></p>\n<p>settings.xml:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/SETTINGS/1.0.0\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/SETTINGS/1.0.0</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    https://maven.apache.org/xsd/settings-1.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mirrors</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mirror</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">mirrorOf</span>&gt;</span>central<span class=\"tag\">&lt;/<span class=\"name\">mirrorOf</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">mirror</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mirrors</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>Mybatis 推荐插件如下：</p>\n</blockquote>\n<p><img src=\"/images/image-20191207125851843.png\" alt=\"image-20191207125851843\"></p>\n<blockquote>\n<p>application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysql</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">show-sql:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">      <span class=\"attr\">ddl-auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br><span class=\"line\">  <span class=\"comment\"># 静态资源配置</span></span><br><span class=\"line\">  <span class=\"attr\">mvc:</span></span><br><span class=\"line\">    <span class=\"attr\">static-path-pattern:</span> <span class=\"string\">/**</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">static-locations:</span> <span class=\"string\">file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">mybatis-plus:</span></span><br><span class=\"line\">  <span class=\"attr\">mapper-locations:</span> <span class=\"string\">classpath:/mapper/*.xml</span></span><br><span class=\"line\">  <span class=\"attr\">type-aliases-package:</span> <span class=\"string\">com.zz.entity</span></span><br><span class=\"line\"><span class=\"comment\">#自定义</span></span><br><span class=\"line\"><span class=\"attr\">my:</span></span><br><span class=\"line\">  <span class=\"attr\">tokenURL:</span> <span class=\"string\">\"55555\"</span></span><br><span class=\"line\">  <span class=\"attr\">authURL:</span> <span class=\"string\">\"88888\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>application-dev.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysql</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">******</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>大概目录结构如下</p>\n</blockquote>\n<p><img src=\"/images/image-20191207133758025.png\" alt=\"image-20191207133758025\"></p>\n<p>搭建细节不再赘述；</p>\n<h4 id=\"2、读取自定义配置文件\"><a href=\"#2、读取自定义配置文件\" class=\"headerlink\" title=\"2、读取自定义配置文件\"></a>2、读取自定义配置文件</h4><blockquote>\n<p>com.zz.config.MyConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties</span>(prefix = <span class=\"string\">\"my\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyConfiguration</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String tokenURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String authURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAuthURL</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.authURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAuthURL</span><span class=\"params\">(String authURL)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.authURL = authURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTokenURL</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.tokenURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setTokenURL</span><span class=\"params\">(String tokenURL)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.tokenURL = tokenURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、web服务配置\"><a href=\"#3、web服务配置\" class=\"headerlink\" title=\"3、web服务配置\"></a>3、web服务配置</h4><blockquote>\n<p>com.zz.config.MyConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.interceptor.AuthenticationInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebConfig</span> <span class=\"keyword\">implements</span> <span class=\"title\">WebMvcConfigurer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addInterceptors</span><span class=\"params\">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 拦截所有请求，通过判断是否有 @passToken 注解 决定是否需要跳过登录</span></span><br><span class=\"line\">        registry.addInterceptor(authenticationInterceptor())</span><br><span class=\"line\">                .addPathPatterns(<span class=\"string\">\"/**\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AuthenticationInterceptor <span class=\"title\">authenticationInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> AuthenticationInterceptor();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4、自定义返回统一的实体类Response\"><a href=\"#4、自定义返回统一的实体类Response\" class=\"headerlink\" title=\"4、自定义返回统一的实体类Response\"></a>4、自定义返回统一的实体类Response</h4><blockquote>\n<p>com.zz.model.Response</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.model;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Response</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> code;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object data;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getData</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setData</span><span class=\"params\">(Object data)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.data = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCode</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMsg</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMsg</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.msg = msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5、Utils公共方法类\"><a href=\"#5、Utils公共方法类\" class=\"headerlink\" title=\"5、Utils公共方法类\"></a>5、Utils公共方法类</h4><blockquote>\n<p>com.zz.utils.HttpUtils</p>\n<p>获取Request、 Response、session</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取 Request 和 Response</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HttpUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 request</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpServletRequest <span class=\"title\">getRequest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestAttributes == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> requestAttributes.getRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 response</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpServletResponse <span class=\"title\">getResponse</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestAttributes == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> requestAttributes.getResponse();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 session</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpSession <span class=\"title\">getSession</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        HttpServletRequest request = getRequest();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(request == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request.getSession();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.utils.JWTUtils</p>\n<p>JWT 生成token, 验证token</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.SecretKey;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.UUID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JWTUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成签名的时候使用的秘钥secret</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String SECRETKEY = <span class=\"string\">\"KJHUhjjJYgYUllVbXhKDHXhkSyHjlNiVkYzWTBac1Yxkjhuad\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// expirationDate 生成jwt的有效期，单位秒</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> expirationDate = <span class=\"number\">2</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 由字符串生成加密key</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SecretKey</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SecretKey <span class=\"title\">generalKey</span><span class=\"params\">(String stringKey)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] encodedKey = Base64.decodeBase64(stringKey);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> SecretKeySpec(encodedKey, <span class=\"number\">0</span>, encodedKey.length, <span class=\"string\">\"AES\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建 jwt</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user 登录成功后的用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> jwt token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">createToken</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 指定签名的时候使用的签名算法，也就是header那部分，jwt已经将这部分内容封装好了</span></span><br><span class=\"line\">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成JWT的时间</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> nowMillis = System.currentTimeMillis();</span><br><span class=\"line\">        Date now = <span class=\"keyword\">new</span> Date(nowMillis);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建payload的私有声明（根据特定的业务需要添加，如果要拿这个做验证，一般是需要和jwt的接收方提前沟通好验证方式的）</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; claims = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"userId\"</span>, user.getUserId());</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"userName\"</span>, user.getUserName());</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"password\"</span>, user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成签名的时候使用的秘钥secret,这个方法本地封装了的，一般可以从本地配置文件中读取，切记这个秘钥不能外露哦。它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了</span></span><br><span class=\"line\">        SecretKey key = generalKey(SECRETKEY + user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成签发人</span></span><br><span class=\"line\">        <span class=\"comment\">// json形式字符串或字符串，增加用户非敏感信息存储，如用户id或用户账号，与token解析后进行对比，防止乱用</span></span><br><span class=\"line\">        HashMap&lt;String, Object&gt; storeInfo = <span class=\"keyword\">new</span> HashMap&lt;String, Object&gt;();</span><br><span class=\"line\">        storeInfo.put(<span class=\"string\">\"userId\"</span>, user.getUserId());</span><br><span class=\"line\">        storeInfo.put(<span class=\"string\">\"userName\"</span>, user.getUserName());</span><br><span class=\"line\">        String subject = storeInfo.toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 下面就是在为payload添加各种标准声明和私有声明了</span></span><br><span class=\"line\">        <span class=\"comment\">// 这里其实就是new一个JwtBuilder，设置jwt的body</span></span><br><span class=\"line\">        JwtBuilder builder = Jwts.builder()</span><br><span class=\"line\">                <span class=\"comment\">// 如果有私有声明，一定要先设置这个自己创建的私有的声明，这个是给builder的claim赋值，一旦写在标准的声明赋值之后，就是覆盖了那些标准的声明的</span></span><br><span class=\"line\">                .setClaims(claims)</span><br><span class=\"line\">                <span class=\"comment\">// 唯一随机UUID</span></span><br><span class=\"line\">                <span class=\"comment\">// 设置JWT ID：是JWT的唯一标识，根据业务需要，这个可以设置为一个不重复的值，主要用来作为一次性token,从而回避重放攻击</span></span><br><span class=\"line\">                .setId(UUID.randomUUID().toString())</span><br><span class=\"line\">                <span class=\"comment\">// jwt的签发时间</span></span><br><span class=\"line\">                .setIssuedAt(now)</span><br><span class=\"line\">                <span class=\"comment\">// 代表这个JWT的主体，即它的所有人，这个是一个json格式的字符串，可以存放什么userid，roldid之类的，作为什么用户的唯一标志</span></span><br><span class=\"line\">                .setSubject(subject)</span><br><span class=\"line\">                <span class=\"comment\">// 设置签名使用的签名算法和签名使用的秘钥</span></span><br><span class=\"line\">                .signWith(signatureAlgorithm, key);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (expirationDate &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> expMillis = nowMillis + expirationDate * <span class=\"number\">1000</span>;</span><br><span class=\"line\">            Date exp = <span class=\"keyword\">new</span> Date(expMillis);</span><br><span class=\"line\">            builder.setExpiration(exp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解密token，获取声明的实体</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 加密后的token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> claims</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Claims <span class=\"title\">parseToken</span><span class=\"params\">(String token, User user)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 签名秘钥，和生成的签名的秘钥要保持一模一样</span></span><br><span class=\"line\">        SecretKey key = generalKey(SECRETKEY + user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取私有声明</span></span><br><span class=\"line\">        Claims claims = Jwts.parser()</span><br><span class=\"line\">                <span class=\"comment\">// 设置签名的秘钥</span></span><br><span class=\"line\">                .setSigningKey(key)</span><br><span class=\"line\">                <span class=\"comment\">// 设置需要解析的token</span></span><br><span class=\"line\">                .parseClaimsJws(token).getBody();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> claims;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验token</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 加密后的token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user  用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true|false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Boolean <span class=\"title\">verify</span><span class=\"params\">(String token, User user)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取私有声明的实体</span></span><br><span class=\"line\">        Claims claims = parseToken(token, user);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> claims.get(<span class=\"string\">\"password\"</span>).equals(user.getPassword());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6、查询实体类-query\"><a href=\"#6、查询实体类-query\" class=\"headerlink\" title=\"6、查询实体类 query\"></a>6、查询实体类 query</h4><p>所有的服务查询都采用统一的各自的实体类</p>\n<p>比如：</p>\n<blockquote>\n<p>com.zz.query.UserQuery</p>\n<p>用户查询实体</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.query;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserQuery</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> showPassword;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShowPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> showPassword;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setShowPassword</span><span class=\"params\">(<span class=\"keyword\">boolean</span> showPassword)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.showPassword = showPassword;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getUserId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserId</span><span class=\"params\">(<span class=\"keyword\">long</span> userId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userId = userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUserName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7、查询后返回实体类\"><a href=\"#7、查询后返回实体类\" class=\"headerlink\" title=\"7、查询后返回实体类\"></a>7、查询后返回实体类</h4><p>所有的服务查询返回都采用统一的各自的实体类</p>\n<p>比如：</p>\n<blockquote>\n<p>com.zz.entity.User</p>\n<p>用户数据返回实体</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getToken</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setToken</span><span class=\"params\">(String token)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.token = token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getUserId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserId</span><span class=\"params\">(<span class=\"keyword\">long</span> userId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userId = userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUserName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-、接口实现三层架构\"><a href=\"#8-、接口实现三层架构\" class=\"headerlink\" title=\"8 、接口实现三层架构\"></a>8 、接口实现三层架构</h4><p>我们这采取的是三层架构：controller —&gt; service —&gt; mapper;</p>\n<p>如果我们要写一个User类接口，先声明一个UserController路由控制层，然后这个里调用UserService实现类方法，然后再调用mapper持久层去CRUD（mysql增查删改）。</p>\n<h4 id=\"9、开始搭建注册用户功能\"><a href=\"#9、开始搭建注册用户功能\" class=\"headerlink\" title=\"9、开始搭建注册用户功能\"></a>9、开始搭建注册用户功能</h4><p>基础搭建先暂停，开始实质业务的推演；</p>\n<p>mysql的连接就不多说啦；</p>\n<p>让我们开始实现之旅吧；</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n<p>用户注册</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.newController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 登录</span></span><br><span class=\"line\"><span class=\"comment\"> * author: wz</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * @param userName</span></span><br><span class=\"line\"><span class=\"comment\">     * @param password</span></span><br><span class=\"line\"><span class=\"comment\">     * @return response</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/add\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">addUser</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        User userData = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> result;</span><br><span class=\"line\">        String message = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">        UserQuery findUserQuery = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        findUserQuery.setUserName(userName);</span><br><span class=\"line\">        User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existUser == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                result = <span class=\"keyword\">this</span>.userService.addUser(query);</span><br><span class=\"line\">                message = <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                result = <span class=\"number\">0</span>;</span><br><span class=\"line\">                message = <span class=\"string\">\"error\"</span>;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户成功后返回用户信息</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                userData = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">                String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">                User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (userData != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    currentUser.setUserId(userData.getUserId());</span><br><span class=\"line\">                    currentUser.setUserName(userData.getUserName());</span><br><span class=\"line\">                    currentUser.setPassword(password);</span><br><span class=\"line\">                    token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    userData.setToken(token);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 获取token用户信息</span></span><br><span class=\"line\">                    <span class=\"comment\">// Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            message = <span class=\"string\">\"用户已经存在\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setData(userData);</span><br><span class=\"line\">        response.setMsg(message);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.UserService</p>\n<p>Interface 用户接口</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加用户</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.impl.UserServiceImpl</p>\n<p>用户接口实现类</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.insert(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.mapper.UserMapper</p>\n<p>mapper</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>resources/mapper/UserMapper.xml</p>\n<p>前后名字一定对应</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"com.zz.mapper.UserMapper\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">\"BaseResult\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"com.zz.entity.User\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">\"user_id\"</span> <span class=\"attr\">property</span>=<span class=\"string\">\"userId\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">\"user_name\"</span> <span class=\"attr\">property</span>=<span class=\"string\">\"userName\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"base\"</span>&gt;</span></span><br><span class=\"line\">        user_id,</span><br><span class=\"line\">        user_name</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"showPassword\"</span>&gt;</span></span><br><span class=\"line\">            , password</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"base_condition\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"userName!=null and userName!=''\"</span>&gt;</span></span><br><span class=\"line\">                user_name=#&#123;userName&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"password!=null and password!=''\"</span>&gt;</span></span><br><span class=\"line\">                and password=#&#123;password&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"insert\"</span>&gt;</span></span><br><span class=\"line\">        INSERT INTO user(</span><br><span class=\"line\">        user_name,</span><br><span class=\"line\">        password</span><br><span class=\"line\">        ) VALUES (</span><br><span class=\"line\">        #&#123;userName&#125;,</span><br><span class=\"line\">        #&#123;password&#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>到此，整个接口书写过程已全部完成，这就是在当前架构下写一个接口的全部过程。</p>\n<h4 id=\"10、搭建web实例-——注册用户\"><a href=\"#10、搭建web实例-——注册用户\" class=\"headerlink\" title=\"10、搭建web实例 ——注册用户\"></a>10、搭建web实例 ——注册用户</h4><p>由于我们在配置文件里已经配置静态资源的路径，所以我们可以在resources里面写一个不分离的we b实例进行访问。</p>\n<blockquote>\n<p>resources/static/regist.html</p>\n<p>注册页面</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1,user-scalable=0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>注册用户<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 引入样式 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/regist.css\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"page form_page js_show\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__text-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__title\"</span>&gt;</span>注册新用户<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__control-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells__group weui-cells__group_form\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells weui-cells_form\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>用户名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入要设置的用户名\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入要设置的密码\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>确认密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd2\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请再次输入设置的密码\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"number\"</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"[0-9]*\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;div class=\"weui-form__tips-area\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;p class=\"weui-form__tips\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    表单页提示，居中对齐--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;/p&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;/div&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__opr-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn weui-btn_primary\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"submit\"</span>&gt;</span>确定<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__extra-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;p class=\"weui-footer__links\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                        &lt;a href=\"javascript:void(0);\" class=\"weui-footer__link\"&gt;底部链接文本&lt;/a&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;/p&gt;--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer__text\"</span>&gt;</span>Copyright © 2019 alex wong<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_toast\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: none;\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-mask_transparent\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-icon-success-no-circle weui-icon_toast\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast__content\"</span>&gt;</span>已完成<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/md5.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/utils.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/dataService.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/regist.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/dataService.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> APIURL = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.dataService = &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//GET</span></span><br><span class=\"line\">\t<span class=\"keyword\">get</span>: (url, params = &#123;&#125;) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> searchArr = [];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">Object</span>.keys(params).forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tsearchArr.push(<span class=\"string\">`<span class=\"subst\">$&#123;n&#125;</span>=<span class=\"subst\">$&#123;params[n]&#125;</span>`</span>);</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> searchStr = searchArr.length ? <span class=\"string\">'?'</span> + searchArr.join(<span class=\"string\">'&amp;'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> token = utils.getCookie(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> fetch(APIURL + url + searchStr, &#123;</span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">'GET'</span>,</span><br><span class=\"line\">\t\t\theaders: &#123;</span><br><span class=\"line\">\t\t\t\ttoken</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json());</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//POST</span></span><br><span class=\"line\">\tpost: <span class=\"function\">(<span class=\"params\">url, params = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">Object</span>.keys(params).forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tformData.append(n, params[n]);</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> token = utils.getCookie(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> fetch(APIURL + url, &#123;</span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">\t\t\theaders: &#123;</span><br><span class=\"line\">\t\t\t\ttoken</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\tbody: formData</span><br><span class=\"line\">\t\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json());</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\taddUser(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.post(<span class=\"string\">'user/add'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 登录</span></span><br><span class=\"line\">\tlogin(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.post(<span class=\"string\">'user/login'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 用户信息</span></span><br><span class=\"line\">\tgetUserInfo(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.get(<span class=\"string\">'user/info'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/utils.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.utils = &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// md5</span></span><br><span class=\"line\">\tgenerateMd5(userName, password) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> salt = <span class=\"string\">\"1qaz2wsx3edc4rfv5tgb6yhn7ujm8ik9ol0p@!.\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciStr = userName + salt + password;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciArr = asciStr.split(<span class=\"string\">''</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciResult = [];</span><br><span class=\"line\">\t\tasciArr.forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tasciResult.push(n.charCodeAt());</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> ascireusltStr = asciResult.join(salt);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> hex_md5(ascireusltStr);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// setCookie</span></span><br><span class=\"line\">\tsetCookie(name, value) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> time = <span class=\"number\">2</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">\t\texp.setTime(exp.getTime() + time);</span><br><span class=\"line\">\t\t<span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + <span class=\"string\">\";expires=\"</span> + exp.toGMTString();</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// getCookie</span></span><br><span class=\"line\">\tgetCookie(name) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> arr, reg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(^| )\"</span> + name + <span class=\"string\">\"=([^;]*)(;|$)\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (arr = <span class=\"built_in\">document</span>.cookie.match(reg))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">unescape</span>(arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/regist.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取相关用户信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userNameInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——user\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordConfirmInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd2\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> submitBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"submit\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// submit</span></span><br><span class=\"line\">submitBtn.onclick = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> userName = userNameInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> password = passwordInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> confirmPassword = passwordConfirmInput.value;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// verify</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!userName) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户姓名不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户密码不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (confirmPassword !== password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'前后密码不一致，请重试'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 加密密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> newPassword = utils.generateMd5(userName, password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\tdataService.addUser(&#123;</span><br><span class=\"line\">\t\tuserName,</span><br><span class=\"line\">\t\tpassword: newPassword,</span><br><span class=\"line\">\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123;code, data, msg&#125; = res;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!data) &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(msg);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(<span class=\"string\">`注册成功，欢迎 <span class=\"subst\">$&#123;data.userName&#125;</span>`</span>);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">window</span>.location.href = location.origin + <span class=\"string\">'/login.html'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>效果如图：</p>\n<p><img src=\"/images/image-20191207144736880.png\" alt></p>\n<blockquote>\n<p>增加一些基本的校验</p>\n</blockquote>\n<p><img src=\"/images/image-20191207145008765.png\" alt=\"image-20191207145008765\"></p>\n<blockquote>\n<p>用户密码加密传输，并验证新用户是否已经注册</p>\n</blockquote>\n<p><img src=\"/images/image-20191207145612200.png\" alt=\"image-20191207145612200\"></p>\n<p><img src=\"/images/image-20191207150016196.png\" alt=\"image-20191207150016196\"></p>\n<blockquote>\n<p>mysql 查看下用户表</p>\n</blockquote>\n<p><img src=\"/images/image-20191207150530465.png\" alt=\"image-20191207150530465\"></p>\n<h4 id=\"11、后端-用户登录功能\"><a href=\"#11、后端-用户登录功能\" class=\"headerlink\" title=\"11、后端-用户登录功能\"></a>11、后端-用户登录功能</h4><p>按上面第9步骤所述，下面的添加内容，请直接添加到上述服务中，不再全部展示代码。</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n<p>首先要判断用户是否存在，如果存在，返回基本信息并返回用户凭证token</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 登录</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">login</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户和密码</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">            User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">            String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">            User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (existUser != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                currentUser.setUserId(existUser.getUserId());</span><br><span class=\"line\">                currentUser.setUserName(existUser.getUserName());</span><br><span class=\"line\">                currentUser.setPassword(password);</span><br><span class=\"line\">               <span class=\"comment\">// 生成用户凭证</span></span><br><span class=\"line\">                token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    existUser.setToken(token);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">                response.setData(existUser);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 登录失败</span></span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"登录失败，请检查用户名和密码\"</span>);</span><br><span class=\"line\">                response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"login failed\"</span>);</span><br><span class=\"line\">            response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.UserService</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加用户</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//查找单个用户</span></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.impl.UserServiceImpl</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.insert(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findUserById(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findUserByName(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;User&gt; <span class=\"title\">findAllUser</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findAllUser(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.mapper.UserMapper</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">List&lt;User&gt; <span class=\"title\">findAllUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>mapper/UserMapper.xml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&lt;?xml</span> <span class=\"string\">version=\"1.0\"</span> <span class=\"string\">encoding=\"UTF-8\"</span> <span class=\"string\">?&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;!DOCTYPE</span> <span class=\"string\">mapper</span> <span class=\"string\">PUBLIC</span> <span class=\"string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> <span class=\"string\">&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;mapper</span> <span class=\"string\">namespace=\"com.zz.mapper.UserMapper\"&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;resultMap</span> <span class=\"string\">id=\"BaseResult\"</span> <span class=\"string\">type=\"com.zz.entity.User\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;id</span> <span class=\"string\">column=\"user_id\"</span> <span class=\"string\">property=\"userId\"&gt;&lt;/id&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;id</span> <span class=\"string\">column=\"user_name\"</span> <span class=\"string\">property=\"userName\"&gt;&lt;/id&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/resultMap&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;sql</span> <span class=\"string\">id=\"base\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">user_id,</span></span><br><span class=\"line\">        <span class=\"string\">user_name</span></span><br><span class=\"line\">        <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"showPassword\"&gt;</span></span><br><span class=\"line\">            <span class=\"string\">,</span> <span class=\"string\">password</span></span><br><span class=\"line\">        <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/sql&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;sql</span> <span class=\"string\">id=\"base_condition\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;where&gt;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"userName!=null</span> <span class=\"string\">and</span> <span class=\"string\">userName!=''\"&gt;</span></span><br><span class=\"line\">                <span class=\"string\">user_name=#&#123;userName&#125;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"password!=null</span> <span class=\"string\">and</span> <span class=\"string\">password!=''\"&gt;</span></span><br><span class=\"line\">                <span class=\"string\">and</span> <span class=\"string\">password=#&#123;password&#125;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;/where&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;/sql&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;!--</span> <span class=\"string\">查询所有user</span> <span class=\"string\">--&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findAllUser\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;!--</span> <span class=\"string\">查询user</span> <span class=\"string\">--&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findUserById\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">        <span class=\"string\">where</span></span><br><span class=\"line\">        <span class=\"string\">user_id</span> <span class=\"string\">=</span> <span class=\"comment\">#&#123;userId&#125;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findUserByName\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base_condition\"/&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;insert</span> <span class=\"string\">id=\"insert\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">INSERT</span> <span class=\"string\">INTO</span> <span class=\"string\">user(</span></span><br><span class=\"line\">        <span class=\"string\">user_name,</span></span><br><span class=\"line\">        <span class=\"string\">password</span></span><br><span class=\"line\">        <span class=\"string\">)</span> <span class=\"string\">VALUES</span> <span class=\"string\">(</span></span><br><span class=\"line\">        <span class=\"comment\">#&#123;userName&#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">#&#123;password&#125;</span></span><br><span class=\"line\">        <span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/insert&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&lt;/mapper&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12、搭建web实例-——登录用户\"><a href=\"#12、搭建web实例-——登录用户\" class=\"headerlink\" title=\"12、搭建web实例 ——登录用户\"></a>12、搭建web实例 ——登录用户</h4><blockquote>\n<p>static/login.html</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1,user-scalable=0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 引入样式 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/regist.css\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"page form_page js_show\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__text-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__title\"</span>&gt;</span>登录<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__control-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells__group weui-cells__group_form\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells weui-cells_form\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>用户名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入用户名\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入密码\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;div class=\"weui-form__tips-area\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;p class=\"weui-form__tips\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    表单页提示，居中对齐--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;/p&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;/div&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__opr-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn weui-btn_primary\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"submit\"</span>&gt;</span>确定<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__extra-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;p class=\"weui-footer__links\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                        &lt;a href=\"javascript:void(0);\" class=\"weui-footer__link\"&gt;底部链接文本&lt;/a&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;/p&gt;--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer__text\"</span>&gt;</span>Copyright © 2019 alex wong<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_toast\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: none;\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-mask_transparent\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-icon-success-no-circle weui-icon_toast\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast__content\"</span>&gt;</span>已完成<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/md5.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/utils.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/dataService.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/login.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/login.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取相关用户信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userNameInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——user\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> submitBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"submit\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// submit</span></span><br><span class=\"line\">submitBtn.onclick = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> userName = userNameInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> password = passwordInput.value;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// verify</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!userName) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户姓名不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户密码不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 加密密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> newPassword = utils.generateMd5(userName, password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\tdataService.login(&#123;</span><br><span class=\"line\">\t\tuserName,</span><br><span class=\"line\">\t\tpassword: newPassword,</span><br><span class=\"line\">\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123;code, data, msg&#125; = res;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!data) &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(msg);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(<span class=\"string\">`登录成功，欢迎 <span class=\"subst\">$&#123;data.userName&#125;</span>`</span>);</span><br><span class=\"line\">\t\t\tutils.setCookie(<span class=\"string\">'token'</span>, data.token);</span><br><span class=\"line\">\t\t\tlocation.href = location.origin + <span class=\"string\">'/home.html'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-20191207152034072.png\" alt=\"image-20191207152034072\"></p>\n<p><img src=\"/images/image-20191207152244301.png\" alt=\"image-20191207152244301\"></p>\n<p><img src=\"/images/image-20191207152343686.png\" alt=\"image-20191207152343686\"></p>\n<p>登录接口返回用户凭证token，后续用来校验用户接口，增加安全性。</p>\n<h4 id=\"13、增加自定义注解和拦截器\"><a href=\"#13、增加自定义注解和拦截器\" class=\"headerlink\" title=\"13、增加自定义注解和拦截器\"></a>13、增加自定义注解和拦截器</h4><p>在常规的业务开发中，切记不可把接口服务暴露给任何人都可以访问，不然别人可以任意查看或者修改你的数据，这是很严重的事情。除了常规从网段IP方面限制固定客户端IP的范围，接口本身也要增加安全验证，这个时候我们就需要用到之前生成的用户凭证token;</p>\n<p>问题是我们如果自定义控制，哪些接口是需要经过验证，哪些接口是不需要通过验证的呢？有人可能会说，直接全部验证不就可以啦，何苦纠结。但是在真实的业务中，有些接口是不能强制校验的，比如一些用户分享到微信的那种接口，是不能增加验证，否则分享的页面无法正常显示。</p>\n<p>所以我们可以自定义注解@PassToken, 添加这个注解的接口，就可以不用进行token验证了。</p>\n<blockquote>\n<p>com.zz.common.annotation.PassToken</p>\n<p>PassToken 注解</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.common.annotation;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.ElementType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Retention;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Target;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是否跳过token验证</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> PassToken &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">required</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">true</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>添加拦截器</p>\n<p>com.zz.common.interceptor.AuthenticationInterceptor</p>\n<p>在发送请求的时候，在请求头里面加token, 然后验证的时候token从头部获取</p>\n<p>如果没有token, 进行无token提示；</p>\n<p>如果存在，就用 JWT 校验 token 是否存在，并且校验用户密码是否正确。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.common.interceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.exceptions.JWTDecodeException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.mongodb.util.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.configurationprocessor.json.JSONException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.configurationprocessor.json.JSONObject;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拦截器</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthenticationInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandlerInterceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * response返回信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> code</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> JSONException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> JSONObject <span class=\"title\">getJsonObject</span><span class=\"params\">(<span class=\"keyword\">int</span> code, String message)</span> <span class=\"keyword\">throws</span> JSONException </span>&#123;</span><br><span class=\"line\">        JSONObject jsonObject = <span class=\"keyword\">new</span> JSONObject();</span><br><span class=\"line\">        jsonObject.put(<span class=\"string\">\"msg\"</span>, message);</span><br><span class=\"line\">        jsonObject.put(<span class=\"string\">\"code\"</span>, code);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jsonObject;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">preHandle</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object object)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 从 http 请求头中取出 token</span></span><br><span class=\"line\">        String token = BaseApplicationController.getToken();</span><br><span class=\"line\">        <span class=\"comment\">// 如果不是映射到方法直接通过</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(object <span class=\"keyword\">instanceof</span> HandlerMethod)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        HandlerMethod handlerMethod = (HandlerMethod) object;</span><br><span class=\"line\">        Method method = handlerMethod.getMethod();</span><br><span class=\"line\">        <span class=\"comment\">//检查是否有PassToken注释，有则跳过认证</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (method.isAnnotationPresent(PassToken<span class=\"class\">.<span class=\"keyword\">class</span>)) </span>&#123;</span><br><span class=\"line\">            PassToken passToken = method.getAnnotation(PassToken<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (passToken.required()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 默认执行认证</span></span><br><span class=\"line\">        httpServletResponse.setContentType(<span class=\"string\">\"application/json;charset=UTF-8\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"keyword\">null</span> || token.equals(<span class=\"string\">\"null\"</span>)) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">403</span>, <span class=\"string\">\"无token，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"无token，请重新登录\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取 token 中的 user id</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            userId = BaseApplicationController.getCurrentUserId();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JWTDecodeException j) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"访问异常, token不正确，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"访问异常！\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户是否存在</span></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserId(userId);</span><br><span class=\"line\">        query.setShowPassword(Boolean.TRUE);</span><br><span class=\"line\">        User user = userService.findUserById(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"用户不存在，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"用户不存在，请重新登录\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证token是否有效</span></span><br><span class=\"line\">        Boolean verify = JWTUtils.verify(token, user);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!verify) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"非法访问，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"非法访问！\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面让我们实例看下效果：</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.newController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 登录</span></span><br><span class=\"line\"><span class=\"comment\"> * autho: wangzhao</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * @param userName</span></span><br><span class=\"line\"><span class=\"comment\">     * @param password</span></span><br><span class=\"line\"><span class=\"comment\">     * @return response</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/add\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">addUser</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        User userData = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> result;</span><br><span class=\"line\">        String message = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">        UserQuery findUserQuery = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        findUserQuery.setUserName(userName);</span><br><span class=\"line\">        User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existUser == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                result = <span class=\"keyword\">this</span>.userService.addUser(query);</span><br><span class=\"line\">                message = <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                result = <span class=\"number\">0</span>;</span><br><span class=\"line\">                message = <span class=\"string\">\"error\"</span>;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户成功后返回用户信息</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                userData = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">                String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">                User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (userData != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    currentUser.setUserId(userData.getUserId());</span><br><span class=\"line\">                    currentUser.setUserName(userData.getUserName());</span><br><span class=\"line\">                    currentUser.setPassword(password);</span><br><span class=\"line\">                    token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    userData.setToken(token);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 获取token用户信息</span></span><br><span class=\"line\">                    <span class=\"comment\">// Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            message = <span class=\"string\">\"用户已经存在\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setData(userData);</span><br><span class=\"line\">        response.setMsg(message);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 登录</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">login</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户和密码</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">            User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">            String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">            User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (existUser != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                currentUser.setUserId(existUser.getUserId());</span><br><span class=\"line\">                currentUser.setUserName(existUser.getUserName());</span><br><span class=\"line\">                currentUser.setPassword(password);</span><br><span class=\"line\">                token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    existUser.setToken(token);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">                response.setData(existUser);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 登录失败</span></span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"登录失败，请检查用户名和密码\"</span>);</span><br><span class=\"line\">                response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"login failed\"</span>);</span><br><span class=\"line\">            response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取个人信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/info\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">getUserInfo</span><span class=\"params\">(Response response)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取token</span></span><br><span class=\"line\">        String token = BaseApplicationController.getToken();</span><br><span class=\"line\">        User userData2 = BaseApplicationController.getCurrentUser();</span><br><span class=\"line\">        Map&lt;String, Object&gt; headerData = BaseApplicationController.getHeader();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span> &amp;&amp; !token.equals(<span class=\"string\">\"null\"</span>)) &#123;</span><br><span class=\"line\">            User userData = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            DecodedJWT claims = JWT.decode(token);</span><br><span class=\"line\">            userData.setUserName(claims.getClaim(<span class=\"string\">\"userName\"</span>).asString());</span><br><span class=\"line\">            userData.setUserId(claims.getClaim(<span class=\"string\">\"userId\"</span>).asLong());</span><br><span class=\"line\">            response.setData(userData);</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"token不存在\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们新写了一个接口，获取用户信息，如上，其余代码不再赘述；</p>\n<blockquote>\n<p>成功获取用户信息</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154357109.png\" alt=\"image-20191207154357109\"></p>\n<blockquote>\n<p>删除token</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154505224.png\" alt=\"image-20191207154505224\"></p>\n<p><img src=\"/images/image-20191207154542523.png\" alt=\"image-20191207154542523\"></p>\n<blockquote>\n<p>Token 故意改错</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154655011.png\" alt=\"image-20191207154655011\"></p>\n<p><img src=\"/images/image-20191207154738162.png\" alt=\"image-20191207154738162\"></p>\n<p><img src=\"/images/image-20191207154806418.png\" alt=\"image-20191207154806418\"></p>\n<p>到此，验证过程完美成功；</p>\n<h4 id=\"14、总结\"><a href=\"#14、总结\" class=\"headerlink\" title=\"14、总结\"></a>14、总结</h4><p>以上过程，只是一个简单服务的搭建，真实的服务还需要更多配置，比如XSS配置防止XSS攻击等。好了，本篇文章到此为止，如果有哪里描述得不清楚，请多多包涵。</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"spring-boot从零搭建登录注册功能并进行所有接口验证\"><a href=\"#spring-boot从零搭建登录注册功能并进行所有接口验证\" class=\"headerlink\" title=\"spring boot从零搭建登录注册功能并进行所有接口验证\"></a>spring boot从零搭建登录注册功能并进行所有接口验证</h3><p>[TOC]</p>\n<p>目前大多项目是前后端分离。在后台接口服务开发过程中，往往我们需要先搭建一个基础服务，比如登录注册功能、自动对所有的接口进行token的安全校验等，这样可以防范安全问题的出现。并且这样后续的同事可以只关注业务代码的开发，不需要关心基础架构服务的实现。</p>\n<p>这次我准备搭建一个简单的后台服务，用的是<code>spring boot + mysql + mybatis</code>。</p>\n<h4 id=\"1、搭建Spring-boot项目\"><a href=\"#1、搭建Spring-boot项目\" class=\"headerlink\" title=\"1、搭建Spring boot项目\"></a>1、搭建Spring boot项目</h4><p>首先我们使用IDEA自带的初始化项目功能，创建一个Spring boot项目，如图：</p>\n<p><img src=\"/images/image-20191207125203878.png\" alt=\"image-20191207125203878\"></p>\n<p>或者在线生成，<a href=\"https://start.spring.io/\" target=\"_blank\" rel=\"noopener\">点击进入</a></p>\n<p><img src=\"/images/16ee2c228a6ffd63.png\" alt></p>\n<blockquote>\n<p>pom.xml</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.6.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.zz<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rest-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>rest-api<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>Demo project for Spring Boot<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.jayway.jsonpath<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>json-path<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.6.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>gson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.8.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Use MySQL Connector-J --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- image to base64 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- jjwt支持 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.auth0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>java-jwt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--commons-codec --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.terran4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>terran4j-commons-api2doc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-devtools<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.itextpdf.tool<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>xmlworker<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi-ooxml<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.15<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi-scratchpad<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.15<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>maven更改为国内阿里云镜像，这样比较快</p>\n</blockquote>\n<p><img src=\"/images/16ee2c8c324e66aa.png\" alt></p>\n<p>settings.xml:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">settings</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/SETTINGS/1.0.0\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/SETTINGS/1.0.0</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    https://maven.apache.org/xsd/settings-1.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mirrors</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mirror</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">mirrorOf</span>&gt;</span>central<span class=\"tag\">&lt;/<span class=\"name\">mirrorOf</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">mirror</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mirrors</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>Mybatis 推荐插件如下：</p>\n</blockquote>\n<p><img src=\"/images/image-20191207125851843.png\" alt=\"image-20191207125851843\"></p>\n<blockquote>\n<p>application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysql</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">show-sql:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">      <span class=\"attr\">ddl-auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br><span class=\"line\">  <span class=\"comment\"># 静态资源配置</span></span><br><span class=\"line\">  <span class=\"attr\">mvc:</span></span><br><span class=\"line\">    <span class=\"attr\">static-path-pattern:</span> <span class=\"string\">/**</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">static-locations:</span> <span class=\"string\">file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">mybatis-plus:</span></span><br><span class=\"line\">  <span class=\"attr\">mapper-locations:</span> <span class=\"string\">classpath:/mapper/*.xml</span></span><br><span class=\"line\">  <span class=\"attr\">type-aliases-package:</span> <span class=\"string\">com.zz.entity</span></span><br><span class=\"line\"><span class=\"comment\">#自定义</span></span><br><span class=\"line\"><span class=\"attr\">my:</span></span><br><span class=\"line\">  <span class=\"attr\">tokenURL:</span> <span class=\"string\">\"55555\"</span></span><br><span class=\"line\">  <span class=\"attr\">authURL:</span> <span class=\"string\">\"88888\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>application-dev.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysql</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">******</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>大概目录结构如下</p>\n</blockquote>\n<p><img src=\"/images/image-20191207133758025.png\" alt=\"image-20191207133758025\"></p>\n<p>搭建细节不再赘述；</p>\n<h4 id=\"2、读取自定义配置文件\"><a href=\"#2、读取自定义配置文件\" class=\"headerlink\" title=\"2、读取自定义配置文件\"></a>2、读取自定义配置文件</h4><blockquote>\n<p>com.zz.config.MyConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties</span>(prefix = <span class=\"string\">\"my\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyConfiguration</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String tokenURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String authURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAuthURL</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.authURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAuthURL</span><span class=\"params\">(String authURL)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.authURL = authURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTokenURL</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.tokenURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setTokenURL</span><span class=\"params\">(String tokenURL)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.tokenURL = tokenURL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、web服务配置\"><a href=\"#3、web服务配置\" class=\"headerlink\" title=\"3、web服务配置\"></a>3、web服务配置</h4><blockquote>\n<p>com.zz.config.MyConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.interceptor.AuthenticationInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebConfig</span> <span class=\"keyword\">implements</span> <span class=\"title\">WebMvcConfigurer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addInterceptors</span><span class=\"params\">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 拦截所有请求，通过判断是否有 @passToken 注解 决定是否需要跳过登录</span></span><br><span class=\"line\">        registry.addInterceptor(authenticationInterceptor())</span><br><span class=\"line\">                .addPathPatterns(<span class=\"string\">\"/**\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AuthenticationInterceptor <span class=\"title\">authenticationInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> AuthenticationInterceptor();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4、自定义返回统一的实体类Response\"><a href=\"#4、自定义返回统一的实体类Response\" class=\"headerlink\" title=\"4、自定义返回统一的实体类Response\"></a>4、自定义返回统一的实体类Response</h4><blockquote>\n<p>com.zz.model.Response</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.model;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Response</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> code;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object data;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getData</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setData</span><span class=\"params\">(Object data)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.data = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCode</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMsg</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMsg</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.msg = msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5、Utils公共方法类\"><a href=\"#5、Utils公共方法类\" class=\"headerlink\" title=\"5、Utils公共方法类\"></a>5、Utils公共方法类</h4><blockquote>\n<p>com.zz.utils.HttpUtils</p>\n<p>获取Request、 Response、session</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取 Request 和 Response</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HttpUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 request</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpServletRequest <span class=\"title\">getRequest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestAttributes == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> requestAttributes.getRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 response</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpServletResponse <span class=\"title\">getResponse</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestAttributes == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> requestAttributes.getResponse();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 session</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HttpSession <span class=\"title\">getSession</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        HttpServletRequest request = getRequest();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(request == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request.getSession();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.utils.JWTUtils</p>\n<p>JWT 生成token, 验证token</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.SecretKey;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.UUID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JWTUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成签名的时候使用的秘钥secret</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String SECRETKEY = <span class=\"string\">\"KJHUhjjJYgYUllVbXhKDHXhkSyHjlNiVkYzWTBac1Yxkjhuad\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// expirationDate 生成jwt的有效期，单位秒</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> expirationDate = <span class=\"number\">2</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 由字符串生成加密key</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SecretKey</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SecretKey <span class=\"title\">generalKey</span><span class=\"params\">(String stringKey)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] encodedKey = Base64.decodeBase64(stringKey);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> SecretKeySpec(encodedKey, <span class=\"number\">0</span>, encodedKey.length, <span class=\"string\">\"AES\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建 jwt</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user 登录成功后的用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> jwt token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">createToken</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 指定签名的时候使用的签名算法，也就是header那部分，jwt已经将这部分内容封装好了</span></span><br><span class=\"line\">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成JWT的时间</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> nowMillis = System.currentTimeMillis();</span><br><span class=\"line\">        Date now = <span class=\"keyword\">new</span> Date(nowMillis);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建payload的私有声明（根据特定的业务需要添加，如果要拿这个做验证，一般是需要和jwt的接收方提前沟通好验证方式的）</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; claims = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"userId\"</span>, user.getUserId());</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"userName\"</span>, user.getUserName());</span><br><span class=\"line\">        claims.put(<span class=\"string\">\"password\"</span>, user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成签名的时候使用的秘钥secret,这个方法本地封装了的，一般可以从本地配置文件中读取，切记这个秘钥不能外露哦。它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了</span></span><br><span class=\"line\">        SecretKey key = generalKey(SECRETKEY + user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 生成签发人</span></span><br><span class=\"line\">        <span class=\"comment\">// json形式字符串或字符串，增加用户非敏感信息存储，如用户id或用户账号，与token解析后进行对比，防止乱用</span></span><br><span class=\"line\">        HashMap&lt;String, Object&gt; storeInfo = <span class=\"keyword\">new</span> HashMap&lt;String, Object&gt;();</span><br><span class=\"line\">        storeInfo.put(<span class=\"string\">\"userId\"</span>, user.getUserId());</span><br><span class=\"line\">        storeInfo.put(<span class=\"string\">\"userName\"</span>, user.getUserName());</span><br><span class=\"line\">        String subject = storeInfo.toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 下面就是在为payload添加各种标准声明和私有声明了</span></span><br><span class=\"line\">        <span class=\"comment\">// 这里其实就是new一个JwtBuilder，设置jwt的body</span></span><br><span class=\"line\">        JwtBuilder builder = Jwts.builder()</span><br><span class=\"line\">                <span class=\"comment\">// 如果有私有声明，一定要先设置这个自己创建的私有的声明，这个是给builder的claim赋值，一旦写在标准的声明赋值之后，就是覆盖了那些标准的声明的</span></span><br><span class=\"line\">                .setClaims(claims)</span><br><span class=\"line\">                <span class=\"comment\">// 唯一随机UUID</span></span><br><span class=\"line\">                <span class=\"comment\">// 设置JWT ID：是JWT的唯一标识，根据业务需要，这个可以设置为一个不重复的值，主要用来作为一次性token,从而回避重放攻击</span></span><br><span class=\"line\">                .setId(UUID.randomUUID().toString())</span><br><span class=\"line\">                <span class=\"comment\">// jwt的签发时间</span></span><br><span class=\"line\">                .setIssuedAt(now)</span><br><span class=\"line\">                <span class=\"comment\">// 代表这个JWT的主体，即它的所有人，这个是一个json格式的字符串，可以存放什么userid，roldid之类的，作为什么用户的唯一标志</span></span><br><span class=\"line\">                .setSubject(subject)</span><br><span class=\"line\">                <span class=\"comment\">// 设置签名使用的签名算法和签名使用的秘钥</span></span><br><span class=\"line\">                .signWith(signatureAlgorithm, key);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (expirationDate &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> expMillis = nowMillis + expirationDate * <span class=\"number\">1000</span>;</span><br><span class=\"line\">            Date exp = <span class=\"keyword\">new</span> Date(expMillis);</span><br><span class=\"line\">            builder.setExpiration(exp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解密token，获取声明的实体</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 加密后的token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> claims</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Claims <span class=\"title\">parseToken</span><span class=\"params\">(String token, User user)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 签名秘钥，和生成的签名的秘钥要保持一模一样</span></span><br><span class=\"line\">        SecretKey key = generalKey(SECRETKEY + user.getPassword());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取私有声明</span></span><br><span class=\"line\">        Claims claims = Jwts.parser()</span><br><span class=\"line\">                <span class=\"comment\">// 设置签名的秘钥</span></span><br><span class=\"line\">                .setSigningKey(key)</span><br><span class=\"line\">                <span class=\"comment\">// 设置需要解析的token</span></span><br><span class=\"line\">                .parseClaimsJws(token).getBody();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> claims;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验token</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 加密后的token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user  用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true|false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Boolean <span class=\"title\">verify</span><span class=\"params\">(String token, User user)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取私有声明的实体</span></span><br><span class=\"line\">        Claims claims = parseToken(token, user);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> claims.get(<span class=\"string\">\"password\"</span>).equals(user.getPassword());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6、查询实体类-query\"><a href=\"#6、查询实体类-query\" class=\"headerlink\" title=\"6、查询实体类 query\"></a>6、查询实体类 query</h4><p>所有的服务查询都采用统一的各自的实体类</p>\n<p>比如：</p>\n<blockquote>\n<p>com.zz.query.UserQuery</p>\n<p>用户查询实体</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.query;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserQuery</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> showPassword;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShowPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> showPassword;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setShowPassword</span><span class=\"params\">(<span class=\"keyword\">boolean</span> showPassword)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.showPassword = showPassword;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getUserId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserId</span><span class=\"params\">(<span class=\"keyword\">long</span> userId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userId = userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUserName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7、查询后返回实体类\"><a href=\"#7、查询后返回实体类\" class=\"headerlink\" title=\"7、查询后返回实体类\"></a>7、查询后返回实体类</h4><p>所有的服务查询返回都采用统一的各自的实体类</p>\n<p>比如：</p>\n<blockquote>\n<p>com.zz.entity.User</p>\n<p>用户数据返回实体</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getToken</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setToken</span><span class=\"params\">(String token)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.token = token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getUserId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserId</span><span class=\"params\">(<span class=\"keyword\">long</span> userId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userId = userId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUserName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-、接口实现三层架构\"><a href=\"#8-、接口实现三层架构\" class=\"headerlink\" title=\"8 、接口实现三层架构\"></a>8 、接口实现三层架构</h4><p>我们这采取的是三层架构：controller —&gt; service —&gt; mapper;</p>\n<p>如果我们要写一个User类接口，先声明一个UserController路由控制层，然后这个里调用UserService实现类方法，然后再调用mapper持久层去CRUD（mysql增查删改）。</p>\n<h4 id=\"9、开始搭建注册用户功能\"><a href=\"#9、开始搭建注册用户功能\" class=\"headerlink\" title=\"9、开始搭建注册用户功能\"></a>9、开始搭建注册用户功能</h4><p>基础搭建先暂停，开始实质业务的推演；</p>\n<p>mysql的连接就不多说啦；</p>\n<p>让我们开始实现之旅吧；</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n<p>用户注册</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.newController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 登录</span></span><br><span class=\"line\"><span class=\"comment\"> * author: wz</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * @param userName</span></span><br><span class=\"line\"><span class=\"comment\">     * @param password</span></span><br><span class=\"line\"><span class=\"comment\">     * @return response</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/add\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">addUser</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        User userData = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> result;</span><br><span class=\"line\">        String message = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">        UserQuery findUserQuery = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        findUserQuery.setUserName(userName);</span><br><span class=\"line\">        User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existUser == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                result = <span class=\"keyword\">this</span>.userService.addUser(query);</span><br><span class=\"line\">                message = <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                result = <span class=\"number\">0</span>;</span><br><span class=\"line\">                message = <span class=\"string\">\"error\"</span>;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户成功后返回用户信息</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                userData = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">                String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">                User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (userData != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    currentUser.setUserId(userData.getUserId());</span><br><span class=\"line\">                    currentUser.setUserName(userData.getUserName());</span><br><span class=\"line\">                    currentUser.setPassword(password);</span><br><span class=\"line\">                    token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    userData.setToken(token);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 获取token用户信息</span></span><br><span class=\"line\">                    <span class=\"comment\">// Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            message = <span class=\"string\">\"用户已经存在\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setData(userData);</span><br><span class=\"line\">        response.setMsg(message);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.UserService</p>\n<p>Interface 用户接口</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加用户</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.impl.UserServiceImpl</p>\n<p>用户接口实现类</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.insert(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.mapper.UserMapper</p>\n<p>mapper</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>resources/mapper/UserMapper.xml</p>\n<p>前后名字一定对应</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"com.zz.mapper.UserMapper\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">\"BaseResult\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"com.zz.entity.User\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">\"user_id\"</span> <span class=\"attr\">property</span>=<span class=\"string\">\"userId\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">\"user_name\"</span> <span class=\"attr\">property</span>=<span class=\"string\">\"userName\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"base\"</span>&gt;</span></span><br><span class=\"line\">        user_id,</span><br><span class=\"line\">        user_name</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"showPassword\"</span>&gt;</span></span><br><span class=\"line\">            , password</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"base_condition\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"userName!=null and userName!=''\"</span>&gt;</span></span><br><span class=\"line\">                user_name=#&#123;userName&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"password!=null and password!=''\"</span>&gt;</span></span><br><span class=\"line\">                and password=#&#123;password&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"insert\"</span>&gt;</span></span><br><span class=\"line\">        INSERT INTO user(</span><br><span class=\"line\">        user_name,</span><br><span class=\"line\">        password</span><br><span class=\"line\">        ) VALUES (</span><br><span class=\"line\">        #&#123;userName&#125;,</span><br><span class=\"line\">        #&#123;password&#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>到此，整个接口书写过程已全部完成，这就是在当前架构下写一个接口的全部过程。</p>\n<h4 id=\"10、搭建web实例-——注册用户\"><a href=\"#10、搭建web实例-——注册用户\" class=\"headerlink\" title=\"10、搭建web实例 ——注册用户\"></a>10、搭建web实例 ——注册用户</h4><p>由于我们在配置文件里已经配置静态资源的路径，所以我们可以在resources里面写一个不分离的we b实例进行访问。</p>\n<blockquote>\n<p>resources/static/regist.html</p>\n<p>注册页面</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1,user-scalable=0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>注册用户<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 引入样式 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/regist.css\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"page form_page js_show\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__text-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__title\"</span>&gt;</span>注册新用户<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__control-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells__group weui-cells__group_form\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells weui-cells_form\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>用户名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入要设置的用户名\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入要设置的密码\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>确认密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd2\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请再次输入设置的密码\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"number\"</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"[0-9]*\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;div class=\"weui-form__tips-area\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;p class=\"weui-form__tips\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    表单页提示，居中对齐--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;/p&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;/div&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__opr-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn weui-btn_primary\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"submit\"</span>&gt;</span>确定<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__extra-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;p class=\"weui-footer__links\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                        &lt;a href=\"javascript:void(0);\" class=\"weui-footer__link\"&gt;底部链接文本&lt;/a&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;/p&gt;--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer__text\"</span>&gt;</span>Copyright © 2019 alex wong<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_toast\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: none;\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-mask_transparent\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-icon-success-no-circle weui-icon_toast\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast__content\"</span>&gt;</span>已完成<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/md5.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/utils.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/dataService.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/regist.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/dataService.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> APIURL = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.dataService = &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//GET</span></span><br><span class=\"line\">\t<span class=\"keyword\">get</span>: (url, params = &#123;&#125;) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> searchArr = [];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">Object</span>.keys(params).forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tsearchArr.push(<span class=\"string\">`<span class=\"subst\">$&#123;n&#125;</span>=<span class=\"subst\">$&#123;params[n]&#125;</span>`</span>);</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> searchStr = searchArr.length ? <span class=\"string\">'?'</span> + searchArr.join(<span class=\"string\">'&amp;'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> token = utils.getCookie(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> fetch(APIURL + url + searchStr, &#123;</span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">'GET'</span>,</span><br><span class=\"line\">\t\t\theaders: &#123;</span><br><span class=\"line\">\t\t\t\ttoken</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json());</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//POST</span></span><br><span class=\"line\">\tpost: <span class=\"function\">(<span class=\"params\">url, params = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">Object</span>.keys(params).forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tformData.append(n, params[n]);</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> token = utils.getCookie(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> fetch(APIURL + url, &#123;</span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">\t\t\theaders: &#123;</span><br><span class=\"line\">\t\t\t\ttoken</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\tbody: formData</span><br><span class=\"line\">\t\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json());</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\taddUser(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.post(<span class=\"string\">'user/add'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 登录</span></span><br><span class=\"line\">\tlogin(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.post(<span class=\"string\">'user/login'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 用户信息</span></span><br><span class=\"line\">\tgetUserInfo(params) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.get(<span class=\"string\">'user/info'</span>, params);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/utils.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.utils = &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// md5</span></span><br><span class=\"line\">\tgenerateMd5(userName, password) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> salt = <span class=\"string\">\"1qaz2wsx3edc4rfv5tgb6yhn7ujm8ik9ol0p@!.\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciStr = userName + salt + password;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciArr = asciStr.split(<span class=\"string\">''</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> asciResult = [];</span><br><span class=\"line\">\t\tasciArr.forEach(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tasciResult.push(n.charCodeAt());</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> ascireusltStr = asciResult.join(salt);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> hex_md5(ascireusltStr);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// setCookie</span></span><br><span class=\"line\">\tsetCookie(name, value) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> time = <span class=\"number\">2</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">\t\texp.setTime(exp.getTime() + time);</span><br><span class=\"line\">\t\t<span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + <span class=\"string\">\";expires=\"</span> + exp.toGMTString();</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// getCookie</span></span><br><span class=\"line\">\tgetCookie(name) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> arr, reg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(^| )\"</span> + name + <span class=\"string\">\"=([^;]*)(;|$)\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (arr = <span class=\"built_in\">document</span>.cookie.match(reg))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">unescape</span>(arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/regist.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取相关用户信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userNameInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——user\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordConfirmInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd2\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> submitBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"submit\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// submit</span></span><br><span class=\"line\">submitBtn.onclick = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> userName = userNameInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> password = passwordInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> confirmPassword = passwordConfirmInput.value;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// verify</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!userName) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户姓名不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户密码不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (confirmPassword !== password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'前后密码不一致，请重试'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 加密密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> newPassword = utils.generateMd5(userName, password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\tdataService.addUser(&#123;</span><br><span class=\"line\">\t\tuserName,</span><br><span class=\"line\">\t\tpassword: newPassword,</span><br><span class=\"line\">\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123;code, data, msg&#125; = res;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!data) &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(msg);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(<span class=\"string\">`注册成功，欢迎 <span class=\"subst\">$&#123;data.userName&#125;</span>`</span>);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">window</span>.location.href = location.origin + <span class=\"string\">'/login.html'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>效果如图：</p>\n<p><img src=\"/images/image-20191207144736880.png\" alt></p>\n<blockquote>\n<p>增加一些基本的校验</p>\n</blockquote>\n<p><img src=\"/images/image-20191207145008765.png\" alt=\"image-20191207145008765\"></p>\n<blockquote>\n<p>用户密码加密传输，并验证新用户是否已经注册</p>\n</blockquote>\n<p><img src=\"/images/image-20191207145612200.png\" alt=\"image-20191207145612200\"></p>\n<p><img src=\"/images/image-20191207150016196.png\" alt=\"image-20191207150016196\"></p>\n<blockquote>\n<p>mysql 查看下用户表</p>\n</blockquote>\n<p><img src=\"/images/image-20191207150530465.png\" alt=\"image-20191207150530465\"></p>\n<h4 id=\"11、后端-用户登录功能\"><a href=\"#11、后端-用户登录功能\" class=\"headerlink\" title=\"11、后端-用户登录功能\"></a>11、后端-用户登录功能</h4><p>按上面第9步骤所述，下面的添加内容，请直接添加到上述服务中，不再全部展示代码。</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n<p>首先要判断用户是否存在，如果存在，返回基本信息并返回用户凭证token</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 登录</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">login</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户和密码</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">            User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">            String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">            User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (existUser != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                currentUser.setUserId(existUser.getUserId());</span><br><span class=\"line\">                currentUser.setUserName(existUser.getUserName());</span><br><span class=\"line\">                currentUser.setPassword(password);</span><br><span class=\"line\">               <span class=\"comment\">// 生成用户凭证</span></span><br><span class=\"line\">                token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    existUser.setToken(token);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">                response.setData(existUser);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 登录失败</span></span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"登录失败，请检查用户名和密码\"</span>);</span><br><span class=\"line\">                response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"login failed\"</span>);</span><br><span class=\"line\">            response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.UserService</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加用户</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//查找单个用户</span></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.service.impl.UserServiceImpl</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">addUser</span><span class=\"params\">(UserQuery query)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.insert(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findUserById(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findUserByName(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;User&gt; <span class=\"title\">findAllUser</span><span class=\"params\">(UserQuery query)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.userMapper.findAllUser(query);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>com.zz.mapper.UserMapper</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserById</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">findUserByName</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">List&lt;User&gt; <span class=\"title\">findAllUser</span><span class=\"params\">(UserQuery query)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>mapper/UserMapper.xml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&lt;?xml</span> <span class=\"string\">version=\"1.0\"</span> <span class=\"string\">encoding=\"UTF-8\"</span> <span class=\"string\">?&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;!DOCTYPE</span> <span class=\"string\">mapper</span> <span class=\"string\">PUBLIC</span> <span class=\"string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> <span class=\"string\">&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;mapper</span> <span class=\"string\">namespace=\"com.zz.mapper.UserMapper\"&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;resultMap</span> <span class=\"string\">id=\"BaseResult\"</span> <span class=\"string\">type=\"com.zz.entity.User\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;id</span> <span class=\"string\">column=\"user_id\"</span> <span class=\"string\">property=\"userId\"&gt;&lt;/id&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;id</span> <span class=\"string\">column=\"user_name\"</span> <span class=\"string\">property=\"userName\"&gt;&lt;/id&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/resultMap&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;sql</span> <span class=\"string\">id=\"base\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">user_id,</span></span><br><span class=\"line\">        <span class=\"string\">user_name</span></span><br><span class=\"line\">        <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"showPassword\"&gt;</span></span><br><span class=\"line\">            <span class=\"string\">,</span> <span class=\"string\">password</span></span><br><span class=\"line\">        <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/sql&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;sql</span> <span class=\"string\">id=\"base_condition\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;where&gt;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"userName!=null</span> <span class=\"string\">and</span> <span class=\"string\">userName!=''\"&gt;</span></span><br><span class=\"line\">                <span class=\"string\">user_name=#&#123;userName&#125;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;if</span> <span class=\"string\">test=\"password!=null</span> <span class=\"string\">and</span> <span class=\"string\">password!=''\"&gt;</span></span><br><span class=\"line\">                <span class=\"string\">and</span> <span class=\"string\">password=#&#123;password&#125;</span></span><br><span class=\"line\">            <span class=\"string\">&lt;/if&gt;</span></span><br><span class=\"line\">        <span class=\"string\">&lt;/where&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;/sql&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;!--</span> <span class=\"string\">查询所有user</span> <span class=\"string\">--&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findAllUser\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;!--</span> <span class=\"string\">查询user</span> <span class=\"string\">--&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findUserById\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">        <span class=\"string\">where</span></span><br><span class=\"line\">        <span class=\"string\">user_id</span> <span class=\"string\">=</span> <span class=\"comment\">#&#123;userId&#125;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;select</span> <span class=\"string\">id=\"findUserByName\"</span> <span class=\"string\">resultMap=\"BaseResult\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">select</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base\"/&gt;</span></span><br><span class=\"line\">        <span class=\"string\">from</span> <span class=\"string\">user</span></span><br><span class=\"line\">        <span class=\"string\">&lt;include</span> <span class=\"string\">refid=\"base_condition\"/&gt;</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/select&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&lt;insert</span> <span class=\"string\">id=\"insert\"&gt;</span></span><br><span class=\"line\">        <span class=\"string\">INSERT</span> <span class=\"string\">INTO</span> <span class=\"string\">user(</span></span><br><span class=\"line\">        <span class=\"string\">user_name,</span></span><br><span class=\"line\">        <span class=\"string\">password</span></span><br><span class=\"line\">        <span class=\"string\">)</span> <span class=\"string\">VALUES</span> <span class=\"string\">(</span></span><br><span class=\"line\">        <span class=\"comment\">#&#123;userName&#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">#&#123;password&#125;</span></span><br><span class=\"line\">        <span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"string\">&lt;/insert&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&lt;/mapper&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12、搭建web实例-——登录用户\"><a href=\"#12、搭建web实例-——登录用户\" class=\"headerlink\" title=\"12、搭建web实例 ——登录用户\"></a>12、搭建web实例 ——登录用户</h4><blockquote>\n<p>static/login.html</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1,user-scalable=0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 引入样式 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/regist.css\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weui/2.1.3/weui.min.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"page form_page js_show\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__text-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__title\"</span>&gt;</span>登录<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__control-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells__group weui-cells__group_form\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cells weui-cells_form\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>用户名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入用户名\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__hd\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-label\"</span>&gt;</span>密码<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-cell__bd\"</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_input——pwd\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入密码\"</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;div class=\"weui-form__tips-area\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;p class=\"weui-form__tips\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    表单页提示，居中对齐--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                &lt;/p&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;/div&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__opr-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-btn weui-btn_primary\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"submit\"</span>&gt;</span>确定<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-form__extra-area\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;p class=\"weui-footer__links\"&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                        &lt;a href=\"javascript:void(0);\" class=\"weui-footer__link\"&gt;底部链接文本&lt;/a&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--                    &lt;/p&gt;--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-footer__text\"</span>&gt;</span>Copyright © 2019 alex wong<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"js_toast\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: none;\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-mask_transparent\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-icon-success-no-circle weui-icon_toast\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"weui-toast__content\"</span>&gt;</span>已完成<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/md5.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/utils.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/dataService.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/login.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>static/js/login.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取相关用户信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userNameInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——user\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> passwordInput = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"js_input——pwd\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> submitBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"submit\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// submit</span></span><br><span class=\"line\">submitBtn.onclick = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> userName = userNameInput.value;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> password = passwordInput.value;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// verify</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!userName) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户姓名不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!password) &#123;</span><br><span class=\"line\">\t\tweui.topTips(<span class=\"string\">'用户密码不能为空'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 加密密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> newPassword = utils.generateMd5(userName, password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 注册</span></span><br><span class=\"line\">\tdataService.login(&#123;</span><br><span class=\"line\">\t\tuserName,</span><br><span class=\"line\">\t\tpassword: newPassword,</span><br><span class=\"line\">\t&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123;code, data, msg&#125; = res;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!data) &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(msg);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tweui.topTips(<span class=\"string\">`登录成功，欢迎 <span class=\"subst\">$&#123;data.userName&#125;</span>`</span>);</span><br><span class=\"line\">\t\t\tutils.setCookie(<span class=\"string\">'token'</span>, data.token);</span><br><span class=\"line\">\t\t\tlocation.href = location.origin + <span class=\"string\">'/home.html'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-20191207152034072.png\" alt=\"image-20191207152034072\"></p>\n<p><img src=\"/images/image-20191207152244301.png\" alt=\"image-20191207152244301\"></p>\n<p><img src=\"/images/image-20191207152343686.png\" alt=\"image-20191207152343686\"></p>\n<p>登录接口返回用户凭证token，后续用来校验用户接口，增加安全性。</p>\n<h4 id=\"13、增加自定义注解和拦截器\"><a href=\"#13、增加自定义注解和拦截器\" class=\"headerlink\" title=\"13、增加自定义注解和拦截器\"></a>13、增加自定义注解和拦截器</h4><p>在常规的业务开发中，切记不可把接口服务暴露给任何人都可以访问，不然别人可以任意查看或者修改你的数据，这是很严重的事情。除了常规从网段IP方面限制固定客户端IP的范围，接口本身也要增加安全验证，这个时候我们就需要用到之前生成的用户凭证token;</p>\n<p>问题是我们如果自定义控制，哪些接口是需要经过验证，哪些接口是不需要通过验证的呢？有人可能会说，直接全部验证不就可以啦，何苦纠结。但是在真实的业务中，有些接口是不能强制校验的，比如一些用户分享到微信的那种接口，是不能增加验证，否则分享的页面无法正常显示。</p>\n<p>所以我们可以自定义注解@PassToken, 添加这个注解的接口，就可以不用进行token验证了。</p>\n<blockquote>\n<p>com.zz.common.annotation.PassToken</p>\n<p>PassToken 注解</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.common.annotation;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.ElementType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Retention;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Target;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是否跳过token验证</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> PassToken &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">required</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">true</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>添加拦截器</p>\n<p>com.zz.common.interceptor.AuthenticationInterceptor</p>\n<p>在发送请求的时候，在请求头里面加token, 然后验证的时候token从头部获取</p>\n<p>如果没有token, 进行无token提示；</p>\n<p>如果存在，就用 JWT 校验 token 是否存在，并且校验用户密码是否正确。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.common.interceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.exceptions.JWTDecodeException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.mongodb.util.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.configurationprocessor.json.JSONException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.configurationprocessor.json.JSONObject;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拦截器</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthenticationInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandlerInterceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * response返回信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> code</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> JSONException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> JSONObject <span class=\"title\">getJsonObject</span><span class=\"params\">(<span class=\"keyword\">int</span> code, String message)</span> <span class=\"keyword\">throws</span> JSONException </span>&#123;</span><br><span class=\"line\">        JSONObject jsonObject = <span class=\"keyword\">new</span> JSONObject();</span><br><span class=\"line\">        jsonObject.put(<span class=\"string\">\"msg\"</span>, message);</span><br><span class=\"line\">        jsonObject.put(<span class=\"string\">\"code\"</span>, code);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jsonObject;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">preHandle</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object object)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 从 http 请求头中取出 token</span></span><br><span class=\"line\">        String token = BaseApplicationController.getToken();</span><br><span class=\"line\">        <span class=\"comment\">// 如果不是映射到方法直接通过</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(object <span class=\"keyword\">instanceof</span> HandlerMethod)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        HandlerMethod handlerMethod = (HandlerMethod) object;</span><br><span class=\"line\">        Method method = handlerMethod.getMethod();</span><br><span class=\"line\">        <span class=\"comment\">//检查是否有PassToken注释，有则跳过认证</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (method.isAnnotationPresent(PassToken<span class=\"class\">.<span class=\"keyword\">class</span>)) </span>&#123;</span><br><span class=\"line\">            PassToken passToken = method.getAnnotation(PassToken<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (passToken.required()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 默认执行认证</span></span><br><span class=\"line\">        httpServletResponse.setContentType(<span class=\"string\">\"application/json;charset=UTF-8\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"keyword\">null</span> || token.equals(<span class=\"string\">\"null\"</span>)) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">403</span>, <span class=\"string\">\"无token，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"无token，请重新登录\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取 token 中的 user id</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> userId;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            userId = BaseApplicationController.getCurrentUserId();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JWTDecodeException j) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"访问异常, token不正确，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"访问异常！\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户是否存在</span></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserId(userId);</span><br><span class=\"line\">        query.setShowPassword(Boolean.TRUE);</span><br><span class=\"line\">        User user = userService.findUserById(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"用户不存在，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"用户不存在，请重新登录\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证token是否有效</span></span><br><span class=\"line\">        Boolean verify = JWTUtils.verify(token, user);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!verify) &#123;</span><br><span class=\"line\">            JSONObject jsonObject = getJsonObject(<span class=\"number\">500</span>, <span class=\"string\">\"非法访问，请重新登录\"</span>);</span><br><span class=\"line\">            httpServletResponse.getWriter().write(jsonObject.toString());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// throw new RuntimeException(\"非法访问！\");</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面让我们实例看下效果：</p>\n<blockquote>\n<p>com.zz.newController.UserController</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.newController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.JWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.annotation.PassToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.common.base.BaseApplicationController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.query.UserQuery;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.utils.JWTUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 登录</span></span><br><span class=\"line\"><span class=\"comment\"> * autho: wangzhao</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * @param userName</span></span><br><span class=\"line\"><span class=\"comment\">     * @param password</span></span><br><span class=\"line\"><span class=\"comment\">     * @return response</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/add\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">addUser</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        User userData = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> result;</span><br><span class=\"line\">        String message = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">        UserQuery findUserQuery = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        findUserQuery.setUserName(userName);</span><br><span class=\"line\">        User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existUser == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                result = <span class=\"keyword\">this</span>.userService.addUser(query);</span><br><span class=\"line\">                message = <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                result = <span class=\"number\">0</span>;</span><br><span class=\"line\">                message = <span class=\"string\">\"error\"</span>;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 插入用户成功后返回用户信息</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                userData = <span class=\"keyword\">this</span>.userService.findUserByName(findUserQuery);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">                String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">                User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (userData != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    currentUser.setUserId(userData.getUserId());</span><br><span class=\"line\">                    currentUser.setUserName(userData.getUserName());</span><br><span class=\"line\">                    currentUser.setPassword(password);</span><br><span class=\"line\">                    token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    userData.setToken(token);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 获取token用户信息</span></span><br><span class=\"line\">                    <span class=\"comment\">// Claims userDataFromToken = JWTUtils.parseToken(token, currentUser);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            message = <span class=\"string\">\"用户已经存在\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        response.setData(userData);</span><br><span class=\"line\">        response.setMsg(message);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 登录</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@PassToken</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">login</span><span class=\"params\">(@RequestParam String userName, @RequestParam String password, Response response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        UserQuery query = <span class=\"keyword\">new</span> UserQuery();</span><br><span class=\"line\">        query.setUserName(userName);</span><br><span class=\"line\">        query.setPassword(password);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证用户和密码</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断用户是否已经存在</span></span><br><span class=\"line\">            User existUser = <span class=\"keyword\">this</span>.userService.findUserByName(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 生成token</span></span><br><span class=\"line\">            String token = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 当前用户</span></span><br><span class=\"line\">            User currentUser = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (existUser != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                currentUser.setUserId(existUser.getUserId());</span><br><span class=\"line\">                currentUser.setUserName(existUser.getUserName());</span><br><span class=\"line\">                currentUser.setPassword(password);</span><br><span class=\"line\">                token = JWTUtils.createToken(currentUser);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    existUser.setToken(token);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">                response.setData(existUser);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 登录失败</span></span><br><span class=\"line\">                response.setMsg(<span class=\"string\">\"登录失败，请检查用户名和密码\"</span>);</span><br><span class=\"line\">                response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"login failed\"</span>);</span><br><span class=\"line\">            response.setData(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取个人信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/info\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">getUserInfo</span><span class=\"params\">(Response response)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取token</span></span><br><span class=\"line\">        String token = BaseApplicationController.getToken();</span><br><span class=\"line\">        User userData2 = BaseApplicationController.getCurrentUser();</span><br><span class=\"line\">        Map&lt;String, Object&gt; headerData = BaseApplicationController.getHeader();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token != <span class=\"keyword\">null</span> &amp;&amp; !token.equals(<span class=\"string\">\"null\"</span>)) &#123;</span><br><span class=\"line\">            User userData = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">            DecodedJWT claims = JWT.decode(token);</span><br><span class=\"line\">            userData.setUserName(claims.getClaim(<span class=\"string\">\"userName\"</span>).asString());</span><br><span class=\"line\">            userData.setUserId(claims.getClaim(<span class=\"string\">\"userId\"</span>).asLong());</span><br><span class=\"line\">            response.setData(userData);</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            response.setMsg(<span class=\"string\">\"token不存在\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们新写了一个接口，获取用户信息，如上，其余代码不再赘述；</p>\n<blockquote>\n<p>成功获取用户信息</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154357109.png\" alt=\"image-20191207154357109\"></p>\n<blockquote>\n<p>删除token</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154505224.png\" alt=\"image-20191207154505224\"></p>\n<p><img src=\"/images/image-20191207154542523.png\" alt=\"image-20191207154542523\"></p>\n<blockquote>\n<p>Token 故意改错</p>\n</blockquote>\n<p><img src=\"/images/image-20191207154655011.png\" alt=\"image-20191207154655011\"></p>\n<p><img src=\"/images/image-20191207154738162.png\" alt=\"image-20191207154738162\"></p>\n<p><img src=\"/images/image-20191207154806418.png\" alt=\"image-20191207154806418\"></p>\n<p>到此，验证过程完美成功；</p>\n<h4 id=\"14、总结\"><a href=\"#14、总结\" class=\"headerlink\" title=\"14、总结\"></a>14、总结</h4><p>以上过程，只是一个简单服务的搭建，真实的服务还需要更多配置，比如XSS配置防止XSS攻击等。好了，本篇文章到此为止，如果有哪里描述得不清楚，请多多包涵。</p>\n"},{"_content":"\n## Spring boot 生成动态验证码并前后端校验\n\n[TOC]\n\n最近需要生成一个动态的验证码，在登录页面使用，并在前后端进行校验；\n\n![image-20190728183409195](/images/image-20190728183409195.png)\n\n[1]:\n实现原理：\n\n> 后端生成动态二维码，存储在 session 里面；\n>\n> 前端调取接口，展示在登录页面；\n>\n> 前端登录时候，把验证码传给后端，后端和 session 里面的值进行对比。\n\n### 1 生成动态验证码图片\n\n新建一个 `class`类 `ValidateCode`:\n\n```java\npackage hello;\n\nimport org.apache.commons.io.FileUtils;\n\nimport javax.imageio.ImageIO;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.awt.*;\nimport java.awt.image.BufferedImage;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.util.Base64;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Random;\n\n//  生成随机验证码\npublic class ValidateCode {\n\n    private static Random random = new Random();\n    private int width = 160;// 宽\n    private int height = 40;// 高\n    private int lineSize = 30;// 干扰线数量\n    private int stringNum = 4;//随机产生字符的个数\n\n    private String randomString = \"0123456789abcdefghijklmnopqrstuvwxyz\";\n\n    private final String sessionKey = \"RANDOMKEY\";\n\n\n    /*\n     *  获取字体\n     */\n    private Font getFont() {\n        return new Font(\"Times New Roman\", Font.ROMAN_BASELINE, 40);\n    }\n\n    /*\n     *  获取颜色\n     */\n    private static Color getRandomColor(int fc, int bc) {\n\n        fc = Math.min(fc, 255);\n        bc = Math.min(bc, 255);\n\n        int r = fc + random.nextInt(bc - fc - 16);\n        int g = fc + random.nextInt(bc - fc - 14);\n        int b = fc + random.nextInt(bc - fc - 12);\n\n        return new Color(r, g, b);\n    }\n\n    /*\n     *  绘制干扰线\n     */\n    private void drawLine(Graphics g) {\n        int x = random.nextInt(width);\n        int y = random.nextInt(height);\n        int xl = random.nextInt(20);\n        int yl = random.nextInt(10);\n        g.drawLine(x, y, x + xl, y + yl);\n    }\n\n    /*\n     *  获取随机字符\n     */\n    private String getRandomString(int num) {\n        num = num > 0 ? num : randomString.length();\n        return String.valueOf(randomString.charAt(random.nextInt(num)));\n    }\n\n    /*\n     *  绘制字符串\n     */\n    private String drawString(Graphics g, String randomStr, int i) {\n        g.setFont(getFont());\n        g.setColor(getRandomColor(108, 190));\n        System.out.println(random.nextInt(randomString.length()));\n        String rand = getRandomString(random.nextInt(randomString.length()));\n        randomStr += rand;\n        g.translate(random.nextInt(3), random.nextInt(6));\n        g.drawString(rand, 40 * i + 10, 25);\n        return randomStr;\n    }\n\n    /*\n     *  生成随机图片\n     */\n     public void getRandomCodeImage(HttpServletRequest request, HttpServletResponse response) {\n        HttpSession session = request.getSession();\n        // BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类\n        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);\n        Graphics g = image.getGraphics();\n        g.fillRect(0, 0, width, height);\n        g.setColor(getRandomColor(105, 189));\n        g.setFont(getFont());\n\n        // 绘制干扰线\n        for (int i = 0; i < lineSize; i++) {\n            drawLine(g);\n        }\n\n        // 绘制随机字符\n        String random_string = \"\";\n        for (int i = 0; i < stringNum; i++) {\n            random_string = drawString(g, random_string, i);\n        }\n\n        System.out.println(random_string);\n\n        g.dispose();\n\n        session.removeAttribute(sessionKey);\n        session.setAttribute(sessionKey, random_string);\n\n        String base64String = \"\";\n        try {\n            //  直接返回图片\n           ImageIO.write(image, \"PNG\", response.getOutputStream());\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n```\n\n接下来写个 `Controller` ,\t提供个接口给前端：\n\n```java\npackage hello;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.ResponseBody;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.util.HashMap;\nimport java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/v1/user\")\npublic class ValidateCodeController {\n\n\n    // 生成验证码图片\n    @RequestMapping(\"/getCaptchaImage\")\n    @ResponseBody\n    public void getCaptcha(HttpServletRequest request, HttpServletResponse response) {\n\n        try {\n\n            response.setContentType(\"image/png\");\n            response.setHeader(\"Cache-Control\", \"no-cache\");\n            response.setHeader(\"Expire\", \"0\");\n            response.setHeader(\"Pragma\", \"no-cache\");\n\n            ValidateCode validateCode = new ValidateCode();\n\n            // 直接返回图片\n            validateCode.getRandomCodeImage(request, response);\n\n        } catch (Exception e) {\n            System.out.println(e);\n        }\n\n    }\n\n}\n\n```\n\n### 2 前端调取接口\n\n![image-20190728191505258](/images/image-20190728191505258.png)\n\n结果如图：\n\n![image-20190728192207836](/images/image-20190728192207836.png)\n\n![image-20190728192227358](/images/image-20190728192227358.png)\n\n### 3 返回 base64 字符串\n\n有时候我们不能直接返回图片，需要返回一个 json 的数据比如：\n\n![image-20190728192558243](/images/image-20190728192558243.png)\n\n\n\n这时候我们就需要把 `image` 转化为 `base64`；\n\n具体代码如下：\n\n在之前的 `ValidateCode`\t类中添加一个方法：\n\n```java\n\t\t/*\n     *  生成随机图片，返回 base64 字符串\n     */\n    public String getRandomCodeBase64(HttpServletRequest request, HttpServletResponse response) {\n        HttpSession session = request.getSession();\n        // BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类\n        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);\n        Graphics g = image.getGraphics();\n        g.fillRect(0, 0, width, height);\n        g.setColor(getRandomColor(105, 189));\n        g.setFont(getFont());\n\n        // 绘制干扰线\n        for (int i = 0; i < lineSize; i++) {\n            drawLine(g);\n        }\n\n        // 绘制随机字符\n        String random_string = \"\";\n        for (int i = 0; i < stringNum; i++) {\n            random_string = drawString(g, random_string, i);\n        }\n\n        System.out.println(random_string);\n\n        g.dispose();\n\n        session.removeAttribute(sessionKey);\n        session.setAttribute(sessionKey, random_string);\n\n        String base64String = \"\";\n        try {\n            //  直接返回图片\n            //  ImageIO.write(image, \"PNG\", response.getOutputStream());\n            //返回 base64\n            ByteArrayOutputStream bos = new ByteArrayOutputStream();\n            ImageIO.write(image, \"PNG\", bos);\n\n            byte[] bytes = bos.toByteArray();\n            Base64.Encoder encoder = Base64.getEncoder();\n            base64String = encoder.encodeToString(bytes);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return base64String;\n    }\n```\n\n在 Controller 添加另外一个路由接口：\n\n```java\n// 生成验证码,返回的是 base64\n    @RequestMapping(\"/getCaptchaBase64\")\n    @ResponseBody\n    public Object getCaptchaBase64(HttpServletRequest request, HttpServletResponse response) {\n\n        Map result = new HashMap();\n        Response response1 = new Response();\n\n        try {\n\n            response.setContentType(\"image/png\");\n            response.setHeader(\"Cache-Control\", \"no-cache\");\n            response.setHeader(\"Expire\", \"0\");\n            response.setHeader(\"Pragma\", \"no-cache\");\n\n            ValidateCode validateCode = new ValidateCode();\n\n            // 直接返回图片\n            // validateCode.getRandomCode(request, response);\n\n            // 返回base64\n            String base64String = validateCode.getRandomCodeBase64(request, response);\n            result.put(\"url\", \"data:image/png;base64,\" + base64String);\n            result.put(\"message\", \"created successfull\");\n            System.out.println(\"test=\" + result.get(\"url\"));\n            response1.setData(0, result);\n\n        } catch (Exception e) {\n            System.out.println(e);\n        }\n\n        return response1.getResult();\n    }\n```\n\n调用结果：\n\n![image-20190728192558243](/images/image-20190728192558243.png)\n\n![image-20190728193013770](/images/image-20190728193013770.png)\n\n在前端页面中，只要把 `URL` 放到 `image` 的 `URL` 中，即可显示，这里不再演示。\n\n### 3 验证验证码\n\n![image-20190728195121612](/images/image-20190728195121612.png)\n\n![image-20190728195058507](/images/image-20190728195058507.png)\n","source":"_posts/spring boot生成动态验证码并验证.md","raw":"---\ncategories:\n- 技术\ntags:\n- 后端\n---\n\n## Spring boot 生成动态验证码并前后端校验\n\n[TOC]\n\n最近需要生成一个动态的验证码，在登录页面使用，并在前后端进行校验；\n\n![image-20190728183409195](/images/image-20190728183409195.png)\n\n[1]:\n实现原理：\n\n> 后端生成动态二维码，存储在 session 里面；\n>\n> 前端调取接口，展示在登录页面；\n>\n> 前端登录时候，把验证码传给后端，后端和 session 里面的值进行对比。\n\n### 1 生成动态验证码图片\n\n新建一个 `class`类 `ValidateCode`:\n\n```java\npackage hello;\n\nimport org.apache.commons.io.FileUtils;\n\nimport javax.imageio.ImageIO;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.awt.*;\nimport java.awt.image.BufferedImage;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.util.Base64;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Random;\n\n//  生成随机验证码\npublic class ValidateCode {\n\n    private static Random random = new Random();\n    private int width = 160;// 宽\n    private int height = 40;// 高\n    private int lineSize = 30;// 干扰线数量\n    private int stringNum = 4;//随机产生字符的个数\n\n    private String randomString = \"0123456789abcdefghijklmnopqrstuvwxyz\";\n\n    private final String sessionKey = \"RANDOMKEY\";\n\n\n    /*\n     *  获取字体\n     */\n    private Font getFont() {\n        return new Font(\"Times New Roman\", Font.ROMAN_BASELINE, 40);\n    }\n\n    /*\n     *  获取颜色\n     */\n    private static Color getRandomColor(int fc, int bc) {\n\n        fc = Math.min(fc, 255);\n        bc = Math.min(bc, 255);\n\n        int r = fc + random.nextInt(bc - fc - 16);\n        int g = fc + random.nextInt(bc - fc - 14);\n        int b = fc + random.nextInt(bc - fc - 12);\n\n        return new Color(r, g, b);\n    }\n\n    /*\n     *  绘制干扰线\n     */\n    private void drawLine(Graphics g) {\n        int x = random.nextInt(width);\n        int y = random.nextInt(height);\n        int xl = random.nextInt(20);\n        int yl = random.nextInt(10);\n        g.drawLine(x, y, x + xl, y + yl);\n    }\n\n    /*\n     *  获取随机字符\n     */\n    private String getRandomString(int num) {\n        num = num > 0 ? num : randomString.length();\n        return String.valueOf(randomString.charAt(random.nextInt(num)));\n    }\n\n    /*\n     *  绘制字符串\n     */\n    private String drawString(Graphics g, String randomStr, int i) {\n        g.setFont(getFont());\n        g.setColor(getRandomColor(108, 190));\n        System.out.println(random.nextInt(randomString.length()));\n        String rand = getRandomString(random.nextInt(randomString.length()));\n        randomStr += rand;\n        g.translate(random.nextInt(3), random.nextInt(6));\n        g.drawString(rand, 40 * i + 10, 25);\n        return randomStr;\n    }\n\n    /*\n     *  生成随机图片\n     */\n     public void getRandomCodeImage(HttpServletRequest request, HttpServletResponse response) {\n        HttpSession session = request.getSession();\n        // BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类\n        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);\n        Graphics g = image.getGraphics();\n        g.fillRect(0, 0, width, height);\n        g.setColor(getRandomColor(105, 189));\n        g.setFont(getFont());\n\n        // 绘制干扰线\n        for (int i = 0; i < lineSize; i++) {\n            drawLine(g);\n        }\n\n        // 绘制随机字符\n        String random_string = \"\";\n        for (int i = 0; i < stringNum; i++) {\n            random_string = drawString(g, random_string, i);\n        }\n\n        System.out.println(random_string);\n\n        g.dispose();\n\n        session.removeAttribute(sessionKey);\n        session.setAttribute(sessionKey, random_string);\n\n        String base64String = \"\";\n        try {\n            //  直接返回图片\n           ImageIO.write(image, \"PNG\", response.getOutputStream());\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n```\n\n接下来写个 `Controller` ,\t提供个接口给前端：\n\n```java\npackage hello;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.ResponseBody;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.util.HashMap;\nimport java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/v1/user\")\npublic class ValidateCodeController {\n\n\n    // 生成验证码图片\n    @RequestMapping(\"/getCaptchaImage\")\n    @ResponseBody\n    public void getCaptcha(HttpServletRequest request, HttpServletResponse response) {\n\n        try {\n\n            response.setContentType(\"image/png\");\n            response.setHeader(\"Cache-Control\", \"no-cache\");\n            response.setHeader(\"Expire\", \"0\");\n            response.setHeader(\"Pragma\", \"no-cache\");\n\n            ValidateCode validateCode = new ValidateCode();\n\n            // 直接返回图片\n            validateCode.getRandomCodeImage(request, response);\n\n        } catch (Exception e) {\n            System.out.println(e);\n        }\n\n    }\n\n}\n\n```\n\n### 2 前端调取接口\n\n![image-20190728191505258](/images/image-20190728191505258.png)\n\n结果如图：\n\n![image-20190728192207836](/images/image-20190728192207836.png)\n\n![image-20190728192227358](/images/image-20190728192227358.png)\n\n### 3 返回 base64 字符串\n\n有时候我们不能直接返回图片，需要返回一个 json 的数据比如：\n\n![image-20190728192558243](/images/image-20190728192558243.png)\n\n\n\n这时候我们就需要把 `image` 转化为 `base64`；\n\n具体代码如下：\n\n在之前的 `ValidateCode`\t类中添加一个方法：\n\n```java\n\t\t/*\n     *  生成随机图片，返回 base64 字符串\n     */\n    public String getRandomCodeBase64(HttpServletRequest request, HttpServletResponse response) {\n        HttpSession session = request.getSession();\n        // BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类\n        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);\n        Graphics g = image.getGraphics();\n        g.fillRect(0, 0, width, height);\n        g.setColor(getRandomColor(105, 189));\n        g.setFont(getFont());\n\n        // 绘制干扰线\n        for (int i = 0; i < lineSize; i++) {\n            drawLine(g);\n        }\n\n        // 绘制随机字符\n        String random_string = \"\";\n        for (int i = 0; i < stringNum; i++) {\n            random_string = drawString(g, random_string, i);\n        }\n\n        System.out.println(random_string);\n\n        g.dispose();\n\n        session.removeAttribute(sessionKey);\n        session.setAttribute(sessionKey, random_string);\n\n        String base64String = \"\";\n        try {\n            //  直接返回图片\n            //  ImageIO.write(image, \"PNG\", response.getOutputStream());\n            //返回 base64\n            ByteArrayOutputStream bos = new ByteArrayOutputStream();\n            ImageIO.write(image, \"PNG\", bos);\n\n            byte[] bytes = bos.toByteArray();\n            Base64.Encoder encoder = Base64.getEncoder();\n            base64String = encoder.encodeToString(bytes);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return base64String;\n    }\n```\n\n在 Controller 添加另外一个路由接口：\n\n```java\n// 生成验证码,返回的是 base64\n    @RequestMapping(\"/getCaptchaBase64\")\n    @ResponseBody\n    public Object getCaptchaBase64(HttpServletRequest request, HttpServletResponse response) {\n\n        Map result = new HashMap();\n        Response response1 = new Response();\n\n        try {\n\n            response.setContentType(\"image/png\");\n            response.setHeader(\"Cache-Control\", \"no-cache\");\n            response.setHeader(\"Expire\", \"0\");\n            response.setHeader(\"Pragma\", \"no-cache\");\n\n            ValidateCode validateCode = new ValidateCode();\n\n            // 直接返回图片\n            // validateCode.getRandomCode(request, response);\n\n            // 返回base64\n            String base64String = validateCode.getRandomCodeBase64(request, response);\n            result.put(\"url\", \"data:image/png;base64,\" + base64String);\n            result.put(\"message\", \"created successfull\");\n            System.out.println(\"test=\" + result.get(\"url\"));\n            response1.setData(0, result);\n\n        } catch (Exception e) {\n            System.out.println(e);\n        }\n\n        return response1.getResult();\n    }\n```\n\n调用结果：\n\n![image-20190728192558243](/images/image-20190728192558243.png)\n\n![image-20190728193013770](/images/image-20190728193013770.png)\n\n在前端页面中，只要把 `URL` 放到 `image` 的 `URL` 中，即可显示，这里不再演示。\n\n### 3 验证验证码\n\n![image-20190728195121612](/images/image-20190728195121612.png)\n\n![image-20190728195058507](/images/image-20190728195058507.png)\n","slug":"spring boot生成动态验证码并验证","published":1,"date":"2020-03-04T23:38:32.733Z","updated":"2020-03-05T00:32:56.720Z","title":"spring boot生成动态验证码并验证","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7e0nvtc0002ntcycsfi9sqm","content":"<h2 id=\"Spring-boot-生成动态验证码并前后端校验\"><a href=\"#Spring-boot-生成动态验证码并前后端校验\" class=\"headerlink\" title=\"Spring boot 生成动态验证码并前后端校验\"></a>Spring boot 生成动态验证码并前后端校验</h2><p>[TOC]</p>\n<p>最近需要生成一个动态的验证码，在登录页面使用，并在前后端进行校验；</p>\n<p><img src=\"/images/image-20190728183409195.png\" alt=\"image-20190728183409195\"></p>\n<blockquote>\n<p>后端生成动态二维码，存储在 session 里面；</p>\n<p>前端调取接口，展示在登录页面；</p>\n<p>前端登录时候，把验证码传给后端，后端和 session 里面的值进行对比。</p>\n</blockquote>\n<h3 id=\"1-生成动态验证码图片\"><a href=\"#1-生成动态验证码图片\" class=\"headerlink\" title=\"1 生成动态验证码图片\"></a>1 生成动态验证码图片</h3><p>新建一个 <code>class</code>类 <code>ValidateCode</code>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> hello;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.io.FileUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.imageio.ImageIO;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.awt.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.awt.image.BufferedImage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.ByteArrayOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Base64;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  生成随机验证码</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidateCode</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> width = <span class=\"number\">160</span>;<span class=\"comment\">// 宽</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> height = <span class=\"number\">40</span>;<span class=\"comment\">// 高</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> lineSize = <span class=\"number\">30</span>;<span class=\"comment\">// 干扰线数量</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> stringNum = <span class=\"number\">4</span>;<span class=\"comment\">//随机产生字符的个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String randomString = <span class=\"string\">\"0123456789abcdefghijklmnopqrstuvwxyz\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String sessionKey = <span class=\"string\">\"RANDOMKEY\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取字体</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Font <span class=\"title\">getFont</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Font(<span class=\"string\">\"Times New Roman\"</span>, Font.ROMAN_BASELINE, <span class=\"number\">40</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取颜色</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Color <span class=\"title\">getRandomColor</span><span class=\"params\">(<span class=\"keyword\">int</span> fc, <span class=\"keyword\">int</span> bc)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        fc = Math.min(fc, <span class=\"number\">255</span>);</span><br><span class=\"line\">        bc = Math.min(bc, <span class=\"number\">255</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> r = fc + random.nextInt(bc - fc - <span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> g = fc + random.nextInt(bc - fc - <span class=\"number\">14</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> b = fc + random.nextInt(bc - fc - <span class=\"number\">12</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Color(r, g, b);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  绘制干扰线</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">drawLine</span><span class=\"params\">(Graphics g)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> x = random.nextInt(width);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> y = random.nextInt(height);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> xl = random.nextInt(<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> yl = random.nextInt(<span class=\"number\">10</span>);</span><br><span class=\"line\">        g.drawLine(x, y, x + xl, y + yl);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取随机字符</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">getRandomString</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</span><br><span class=\"line\">        num = num &gt; <span class=\"number\">0</span> ? num : randomString.length();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.valueOf(randomString.charAt(random.nextInt(num)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  绘制字符串</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">drawString</span><span class=\"params\">(Graphics g, String randomStr, <span class=\"keyword\">int</span> i)</span> </span>&#123;</span><br><span class=\"line\">        g.setFont(getFont());</span><br><span class=\"line\">        g.setColor(getRandomColor(<span class=\"number\">108</span>, <span class=\"number\">190</span>));</span><br><span class=\"line\">        System.out.println(random.nextInt(randomString.length()));</span><br><span class=\"line\">        String rand = getRandomString(random.nextInt(randomString.length()));</span><br><span class=\"line\">        randomStr += rand;</span><br><span class=\"line\">        g.translate(random.nextInt(<span class=\"number\">3</span>), random.nextInt(<span class=\"number\">6</span>));</span><br><span class=\"line\">        g.drawString(rand, <span class=\"number\">40</span> * i + <span class=\"number\">10</span>, <span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> randomStr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  生成随机图片</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getRandomCodeImage</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\">        HttpSession session = request.getSession();</span><br><span class=\"line\">        <span class=\"comment\">// BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类</span></span><br><span class=\"line\">        BufferedImage image = <span class=\"keyword\">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);</span><br><span class=\"line\">        Graphics g = image.getGraphics();</span><br><span class=\"line\">        g.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height);</span><br><span class=\"line\">        g.setColor(getRandomColor(<span class=\"number\">105</span>, <span class=\"number\">189</span>));</span><br><span class=\"line\">        g.setFont(getFont());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制干扰线</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineSize; i++) &#123;</span><br><span class=\"line\">            drawLine(g);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制随机字符</span></span><br><span class=\"line\">        String random_string = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; stringNum; i++) &#123;</span><br><span class=\"line\">            random_string = drawString(g, random_string, i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">        g.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\">        session.removeAttribute(sessionKey);</span><br><span class=\"line\">        session.setAttribute(sessionKey, random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">        String base64String = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//  直接返回图片</span></span><br><span class=\"line\">           ImageIO.write(image, <span class=\"string\">\"PNG\"</span>, response.getOutputStream());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来写个 <code>Controller</code> ,    提供个接口给前端：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> hello;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/api/v1/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidateCodeController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成验证码图片</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/getCaptchaImage\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getCaptcha</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            response.setContentType(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Cache-Control\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Expire\"</span>, <span class=\"string\">\"0\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Pragma\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ValidateCode validateCode = <span class=\"keyword\">new</span> ValidateCode();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 直接返回图片</span></span><br><span class=\"line\">            validateCode.getRandomCodeImage(request, response);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-前端调取接口\"><a href=\"#2-前端调取接口\" class=\"headerlink\" title=\"2 前端调取接口\"></a>2 前端调取接口</h3><p><img src=\"/images/image-20190728191505258.png\" alt=\"image-20190728191505258\"></p>\n<p>结果如图：</p>\n<p><img src=\"/images/image-20190728192207836.png\" alt=\"image-20190728192207836\"></p>\n<p><img src=\"/images/image-20190728192227358.png\" alt=\"image-20190728192227358\"></p>\n<h3 id=\"3-返回-base64-字符串\"><a href=\"#3-返回-base64-字符串\" class=\"headerlink\" title=\"3 返回 base64 字符串\"></a>3 返回 base64 字符串</h3><p>有时候我们不能直接返回图片，需要返回一个 json 的数据比如：</p>\n<p><img src=\"/images/image-20190728192558243.png\" alt=\"image-20190728192558243\"></p>\n<p>这时候我们就需要把 <code>image</code> 转化为 <code>base64</code>；</p>\n<p>具体代码如下：</p>\n<p>在之前的 <code>ValidateCode</code>    类中添加一个方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">   *  生成随机图片，返回 base64 字符串</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getRandomCodeBase64</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\">      HttpSession session = request.getSession();</span><br><span class=\"line\">      <span class=\"comment\">// BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类</span></span><br><span class=\"line\">      BufferedImage image = <span class=\"keyword\">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);</span><br><span class=\"line\">      Graphics g = image.getGraphics();</span><br><span class=\"line\">      g.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height);</span><br><span class=\"line\">      g.setColor(getRandomColor(<span class=\"number\">105</span>, <span class=\"number\">189</span>));</span><br><span class=\"line\">      g.setFont(getFont());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 绘制干扰线</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineSize; i++) &#123;</span><br><span class=\"line\">          drawLine(g);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 绘制随机字符</span></span><br><span class=\"line\">      String random_string = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; stringNum; i++) &#123;</span><br><span class=\"line\">          random_string = drawString(g, random_string, i);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">      g.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\">      session.removeAttribute(sessionKey);</span><br><span class=\"line\">      session.setAttribute(sessionKey, random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">      String base64String = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//  直接返回图片</span></span><br><span class=\"line\">          <span class=\"comment\">//  ImageIO.write(image, \"PNG\", response.getOutputStream());</span></span><br><span class=\"line\">          <span class=\"comment\">//返回 base64</span></span><br><span class=\"line\">          ByteArrayOutputStream bos = <span class=\"keyword\">new</span> ByteArrayOutputStream();</span><br><span class=\"line\">          ImageIO.write(image, <span class=\"string\">\"PNG\"</span>, bos);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">byte</span>[] bytes = bos.toByteArray();</span><br><span class=\"line\">          Base64.Encoder encoder = Base64.getEncoder();</span><br><span class=\"line\">          base64String = encoder.encodeToString(bytes);</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">          e.printStackTrace();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> base64String;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 Controller 添加另外一个路由接口：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 生成验证码,返回的是 base64</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/getCaptchaBase64\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getCaptchaBase64</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        Response response1 = <span class=\"keyword\">new</span> Response();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            response.setContentType(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Cache-Control\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Expire\"</span>, <span class=\"string\">\"0\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Pragma\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ValidateCode validateCode = <span class=\"keyword\">new</span> ValidateCode();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 直接返回图片</span></span><br><span class=\"line\">            <span class=\"comment\">// validateCode.getRandomCode(request, response);</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 返回base64</span></span><br><span class=\"line\">            String base64String = validateCode.getRandomCodeBase64(request, response);</span><br><span class=\"line\">            result.put(<span class=\"string\">\"url\"</span>, <span class=\"string\">\"data:image/png;base64,\"</span> + base64String);</span><br><span class=\"line\">            result.put(<span class=\"string\">\"message\"</span>, <span class=\"string\">\"created successfull\"</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"test=\"</span> + result.get(<span class=\"string\">\"url\"</span>));</span><br><span class=\"line\">            response1.setData(<span class=\"number\">0</span>, result);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> response1.getResult();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>调用结果：</p>\n<p><img src=\"/images/image-20190728192558243.png\" alt=\"image-20190728192558243\"></p>\n<p><img src=\"/images/image-20190728193013770.png\" alt=\"image-20190728193013770\"></p>\n<p>在前端页面中，只要把 <code>URL</code> 放到 <code>image</code> 的 <code>URL</code> 中，即可显示，这里不再演示。</p>\n<h3 id=\"3-验证验证码\"><a href=\"#3-验证验证码\" class=\"headerlink\" title=\"3 验证验证码\"></a>3 验证验证码</h3><p><img src=\"/images/image-20190728195121612.png\" alt=\"image-20190728195121612\"></p>\n<p><img src=\"/images/image-20190728195058507.png\" alt=\"image-20190728195058507\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Spring-boot-生成动态验证码并前后端校验\"><a href=\"#Spring-boot-生成动态验证码并前后端校验\" class=\"headerlink\" title=\"Spring boot 生成动态验证码并前后端校验\"></a>Spring boot 生成动态验证码并前后端校验</h2><p>[TOC]</p>\n<p>最近需要生成一个动态的验证码，在登录页面使用，并在前后端进行校验；</p>\n<p><img src=\"/images/image-20190728183409195.png\" alt=\"image-20190728183409195\"></p>\n<blockquote>\n<p>后端生成动态二维码，存储在 session 里面；</p>\n<p>前端调取接口，展示在登录页面；</p>\n<p>前端登录时候，把验证码传给后端，后端和 session 里面的值进行对比。</p>\n</blockquote>\n<h3 id=\"1-生成动态验证码图片\"><a href=\"#1-生成动态验证码图片\" class=\"headerlink\" title=\"1 生成动态验证码图片\"></a>1 生成动态验证码图片</h3><p>新建一个 <code>class</code>类 <code>ValidateCode</code>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> hello;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.io.FileUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.imageio.ImageIO;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.awt.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.awt.image.BufferedImage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.ByteArrayOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Base64;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  生成随机验证码</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidateCode</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> width = <span class=\"number\">160</span>;<span class=\"comment\">// 宽</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> height = <span class=\"number\">40</span>;<span class=\"comment\">// 高</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> lineSize = <span class=\"number\">30</span>;<span class=\"comment\">// 干扰线数量</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> stringNum = <span class=\"number\">4</span>;<span class=\"comment\">//随机产生字符的个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String randomString = <span class=\"string\">\"0123456789abcdefghijklmnopqrstuvwxyz\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String sessionKey = <span class=\"string\">\"RANDOMKEY\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取字体</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Font <span class=\"title\">getFont</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Font(<span class=\"string\">\"Times New Roman\"</span>, Font.ROMAN_BASELINE, <span class=\"number\">40</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取颜色</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Color <span class=\"title\">getRandomColor</span><span class=\"params\">(<span class=\"keyword\">int</span> fc, <span class=\"keyword\">int</span> bc)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        fc = Math.min(fc, <span class=\"number\">255</span>);</span><br><span class=\"line\">        bc = Math.min(bc, <span class=\"number\">255</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> r = fc + random.nextInt(bc - fc - <span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> g = fc + random.nextInt(bc - fc - <span class=\"number\">14</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> b = fc + random.nextInt(bc - fc - <span class=\"number\">12</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Color(r, g, b);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  绘制干扰线</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">drawLine</span><span class=\"params\">(Graphics g)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> x = random.nextInt(width);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> y = random.nextInt(height);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> xl = random.nextInt(<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> yl = random.nextInt(<span class=\"number\">10</span>);</span><br><span class=\"line\">        g.drawLine(x, y, x + xl, y + yl);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取随机字符</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">getRandomString</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</span><br><span class=\"line\">        num = num &gt; <span class=\"number\">0</span> ? num : randomString.length();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.valueOf(randomString.charAt(random.nextInt(num)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  绘制字符串</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">drawString</span><span class=\"params\">(Graphics g, String randomStr, <span class=\"keyword\">int</span> i)</span> </span>&#123;</span><br><span class=\"line\">        g.setFont(getFont());</span><br><span class=\"line\">        g.setColor(getRandomColor(<span class=\"number\">108</span>, <span class=\"number\">190</span>));</span><br><span class=\"line\">        System.out.println(random.nextInt(randomString.length()));</span><br><span class=\"line\">        String rand = getRandomString(random.nextInt(randomString.length()));</span><br><span class=\"line\">        randomStr += rand;</span><br><span class=\"line\">        g.translate(random.nextInt(<span class=\"number\">3</span>), random.nextInt(<span class=\"number\">6</span>));</span><br><span class=\"line\">        g.drawString(rand, <span class=\"number\">40</span> * i + <span class=\"number\">10</span>, <span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> randomStr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     *  生成随机图片</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getRandomCodeImage</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\">        HttpSession session = request.getSession();</span><br><span class=\"line\">        <span class=\"comment\">// BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类</span></span><br><span class=\"line\">        BufferedImage image = <span class=\"keyword\">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);</span><br><span class=\"line\">        Graphics g = image.getGraphics();</span><br><span class=\"line\">        g.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height);</span><br><span class=\"line\">        g.setColor(getRandomColor(<span class=\"number\">105</span>, <span class=\"number\">189</span>));</span><br><span class=\"line\">        g.setFont(getFont());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制干扰线</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineSize; i++) &#123;</span><br><span class=\"line\">            drawLine(g);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制随机字符</span></span><br><span class=\"line\">        String random_string = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; stringNum; i++) &#123;</span><br><span class=\"line\">            random_string = drawString(g, random_string, i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">        g.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\">        session.removeAttribute(sessionKey);</span><br><span class=\"line\">        session.setAttribute(sessionKey, random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">        String base64String = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//  直接返回图片</span></span><br><span class=\"line\">           ImageIO.write(image, <span class=\"string\">\"PNG\"</span>, response.getOutputStream());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来写个 <code>Controller</code> ,    提供个接口给前端：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> hello;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/api/v1/user\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidateCodeController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成验证码图片</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/getCaptchaImage\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getCaptcha</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            response.setContentType(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Cache-Control\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Expire\"</span>, <span class=\"string\">\"0\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Pragma\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ValidateCode validateCode = <span class=\"keyword\">new</span> ValidateCode();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 直接返回图片</span></span><br><span class=\"line\">            validateCode.getRandomCodeImage(request, response);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-前端调取接口\"><a href=\"#2-前端调取接口\" class=\"headerlink\" title=\"2 前端调取接口\"></a>2 前端调取接口</h3><p><img src=\"/images/image-20190728191505258.png\" alt=\"image-20190728191505258\"></p>\n<p>结果如图：</p>\n<p><img src=\"/images/image-20190728192207836.png\" alt=\"image-20190728192207836\"></p>\n<p><img src=\"/images/image-20190728192227358.png\" alt=\"image-20190728192227358\"></p>\n<h3 id=\"3-返回-base64-字符串\"><a href=\"#3-返回-base64-字符串\" class=\"headerlink\" title=\"3 返回 base64 字符串\"></a>3 返回 base64 字符串</h3><p>有时候我们不能直接返回图片，需要返回一个 json 的数据比如：</p>\n<p><img src=\"/images/image-20190728192558243.png\" alt=\"image-20190728192558243\"></p>\n<p>这时候我们就需要把 <code>image</code> 转化为 <code>base64</code>；</p>\n<p>具体代码如下：</p>\n<p>在之前的 <code>ValidateCode</code>    类中添加一个方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">   *  生成随机图片，返回 base64 字符串</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getRandomCodeBase64</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\">      HttpSession session = request.getSession();</span><br><span class=\"line\">      <span class=\"comment\">// BufferedImage类是具有缓冲区的Image类,Image类是用于描述图像信息的类</span></span><br><span class=\"line\">      BufferedImage image = <span class=\"keyword\">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_BGR);</span><br><span class=\"line\">      Graphics g = image.getGraphics();</span><br><span class=\"line\">      g.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height);</span><br><span class=\"line\">      g.setColor(getRandomColor(<span class=\"number\">105</span>, <span class=\"number\">189</span>));</span><br><span class=\"line\">      g.setFont(getFont());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 绘制干扰线</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineSize; i++) &#123;</span><br><span class=\"line\">          drawLine(g);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 绘制随机字符</span></span><br><span class=\"line\">      String random_string = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; stringNum; i++) &#123;</span><br><span class=\"line\">          random_string = drawString(g, random_string, i);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">      g.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\">      session.removeAttribute(sessionKey);</span><br><span class=\"line\">      session.setAttribute(sessionKey, random_string);</span><br><span class=\"line\"></span><br><span class=\"line\">      String base64String = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//  直接返回图片</span></span><br><span class=\"line\">          <span class=\"comment\">//  ImageIO.write(image, \"PNG\", response.getOutputStream());</span></span><br><span class=\"line\">          <span class=\"comment\">//返回 base64</span></span><br><span class=\"line\">          ByteArrayOutputStream bos = <span class=\"keyword\">new</span> ByteArrayOutputStream();</span><br><span class=\"line\">          ImageIO.write(image, <span class=\"string\">\"PNG\"</span>, bos);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">byte</span>[] bytes = bos.toByteArray();</span><br><span class=\"line\">          Base64.Encoder encoder = Base64.getEncoder();</span><br><span class=\"line\">          base64String = encoder.encodeToString(bytes);</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">          e.printStackTrace();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> base64String;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 Controller 添加另外一个路由接口：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 生成验证码,返回的是 base64</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/getCaptchaBase64\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getCaptchaBase64</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        Response response1 = <span class=\"keyword\">new</span> Response();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            response.setContentType(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Cache-Control\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Expire\"</span>, <span class=\"string\">\"0\"</span>);</span><br><span class=\"line\">            response.setHeader(<span class=\"string\">\"Pragma\"</span>, <span class=\"string\">\"no-cache\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ValidateCode validateCode = <span class=\"keyword\">new</span> ValidateCode();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 直接返回图片</span></span><br><span class=\"line\">            <span class=\"comment\">// validateCode.getRandomCode(request, response);</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 返回base64</span></span><br><span class=\"line\">            String base64String = validateCode.getRandomCodeBase64(request, response);</span><br><span class=\"line\">            result.put(<span class=\"string\">\"url\"</span>, <span class=\"string\">\"data:image/png;base64,\"</span> + base64String);</span><br><span class=\"line\">            result.put(<span class=\"string\">\"message\"</span>, <span class=\"string\">\"created successfull\"</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"test=\"</span> + result.get(<span class=\"string\">\"url\"</span>));</span><br><span class=\"line\">            response1.setData(<span class=\"number\">0</span>, result);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> response1.getResult();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>调用结果：</p>\n<p><img src=\"/images/image-20190728192558243.png\" alt=\"image-20190728192558243\"></p>\n<p><img src=\"/images/image-20190728193013770.png\" alt=\"image-20190728193013770\"></p>\n<p>在前端页面中，只要把 <code>URL</code> 放到 <code>image</code> 的 <code>URL</code> 中，即可显示，这里不再演示。</p>\n<h3 id=\"3-验证验证码\"><a href=\"#3-验证验证码\" class=\"headerlink\" title=\"3 验证验证码\"></a>3 验证验证码</h3><p><img src=\"/images/image-20190728195121612.png\" alt=\"image-20190728195121612\"></p>\n<p><img src=\"/images/image-20190728195058507.png\" alt=\"image-20190728195058507\"></p>\n"},{"_content":"\n## spring boot解决如何同时上传多个图片和下载的问题\n\n[TOC]\n\n在平时的业务场景中，避免不了，要搭建文件上传服务器，作为公共服务。一般情况，只做了单个文件的上传，实际业务场景中，却发现单个文件上传，并不能满足一些业务需求，因此我们需要解决如何写一个同时上传多个文件的借口，并返回可下载的文件地址；\n\n\n\n废话不多讲，不再从头建立一个`Spring boot`项目，如果不知道的话，请直接前往官网查看实例。\n\n\n\n下面我们以上传图片为例，示例相对简单，仅供参考：\n\n### 1 后端上传图片接口逻辑\n\n> UploadController.java\n\n```java\npackage com.zz.controllers.fileUpload;\n\nimport com.zz.Application;\nimport com.zz.model.Response;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.web.server.LocalServerPort;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.multipart.MultipartFile;\n\nimport java.io.*;\nimport java.net.Inet4Address;\nimport java.net.InetAddress;\nimport java.nio.file.Path;\nimport java.util.ArrayList;\nimport java.util.UUID;\n\nimport static com.zz.config.ConfigConstants.getFileDir;\n\n@RestController\n@Configuration\npublic class UploadController {\n\n    private static final Logger log = LoggerFactory.getLogger(Application.class);\n\n    @Value(\"${server.port}\")\n    private String port;\n\n  \t//获取当前IP地址\n    public String getIp() {\n        InetAddress localhost = null;\n        try {\n            localhost = Inet4Address.getLocalHost();\n        } catch (Exception e) {\n            log.error(e.getMessage());\n            e.printStackTrace();\n        }\n        return localhost.getHostAddress();\n    }\n\n    @PostMapping(value = \"/upload\", consumes = {\"multipart/form-data\"})\n    public Response upload(@RequestParam(\"file\") MultipartFile[] files, Response response) {\n        log.info(\"上传多个文件\");\n        StringBuilder builder = new StringBuilder();\n        // file address\n        String fileAddress =\"http://\"+ getIp()+ \":\" + port + File.separator;\n\n        ArrayList<String> imgUrls = new ArrayList<String>();\n        try {\n            for (int i = 0; i < files.length; i++) {\n                // old file name\n                String fileName = files[i].getOriginalFilename();\n                // new filename\n                String generateFileName = UUID.randomUUID().toString().replaceAll(\"-\", \"\") + fileName.substring(fileName.lastIndexOf(\".\"));\n                // store filename\n                String distFileAddress = fileAddress + generateFileName;\n                builder.append(distFileAddress+\",\");\n                imgUrls.add(distFileAddress);\n                // generate file to disk\n                files[i].transferTo(new File(getFileDir() + generateFileName));\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        response.setMsg(\"success\");\n        log.info(builder.toString());\n        response.setData(imgUrls);\n        return response;\n    }\n}\n\n```\n\n相对于单个文件的接收，我们这里直接接受多个`file`对象，然后遍历生成每个对应的地址。\n\n其中：\n\n> getFileDir 设置存放图片的地址，我选择存在项目外的其他地方\n>\n> com.zz.config.ConfigConstants.getFileDir\n\n```\npackage com.zz.config;\n\npublic class ConfigConstants {\n\n    public static String fileDir;\n\n    public static String getFileDir() {\n        fileDir = \"/Users/wz/projects/blog/uploadFile/\";\n        return fileDir;\n    }\n}\n\n```\n\n> 当我们把文件生成到指定的文件夹后，我们如何配置在当前server下访问项目外的静态文件图片资源呢？\n\n这个我们就要利用`spring boot配置文件 application.yml,` 当前还有其他方法比如 `WebMvcConfigurer`   这里不再赘述。\n\n> application.yml\n\n```yaml\npring:\n  jpa:\n    show-sql: true\n    hibernate:\n      ddl-auto: update\n\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\n\n  profiles:\n    active: dev\n\n  # 静态资源配置\n  mvc:\n    static-path-pattern: /**\n  resources:\n    static-locations: file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/\n\nserver:\n  use-forward-headers: true\n  tomcat:\n    remote-ip-header: X-Real-IP\n    protocol-header: X-Forwarded-Proto\n\n#自定义\nmy:\n  tokenURL: \"55555\"\n  authURL: \"88888\"\n\n\n```\n\n\n\n这样之后我们在生成的结果中的 `http://192.168.31.77:8080/a7ef32e3922b46aea256a93dd53de288.png`,这样的地址就可以把文件实质性的指向了`file:/Users/wz/projects/blog/uploadFile/`,这样大致就是一个简单文件服务器的配置了，当然远不及此，还有压缩一类的功能，后续再聊。\n\n\n\n后端逻辑已经很清晰；\n\n那前端如何向后端同时发送多个`file`对象呢？\n\n### 2 前端多个文件上传如何传参\n\n> html\n\n```html\n<input type=\"file\" multiple class=\"el-upload\" accept=\"image/*\" name=\"file\">\n```\n\n> js\n\n```javascript\n//upload\nvar uploadBtn = document.querySelector('.el-upload');\n\nuploadBtn.onchange = function (e) {\n    let files = this.files;\n    console.log(this.files);\n\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"post\", \"/upload\", true);\n    // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    xhr.onreadystatechange = function () {\n        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {\n            console.log(JSON.parse(this.responseText));\n            const {data} = JSON.parse(this.responseText);\n            if(!data) return;\n            const imageList = data.slice(0);\n            let imageStr = '';\n            imageList.forEach(img=>{\n                imageStr += `<img src=\"${img}\" />`;\n            });\n            document.getElementById(\"result\").innerHTML = imageStr;\n        }\n    };\n\n    const formData = new FormData();\n\n    // 多个file 同时上传\n    if(files && files.length){\n        for (let i=0;i<files.length;i++) {\n            formData.append(\"file\", files[i])\n        }\n    }\n\n    console.log(formData);\n\n    xhr.send(formData);\n};\n```\n\n前端通过`FormData`传参数发送POST请求；\n\n区别于之前的单个`formData.append();` 这里我们可以同时`append`多个相同名字的文件二进制文件流；\n\n\n![image-20191123234150228](/images/image-20191123234150228-4523763.png)\n\n![image-20191123234325831](/images/image-20191123234325831.png)\n\n![image-20191123234358451](/images/image-20191123234358451.png)\n\n![image-20191123234557023](/images/image-20191123234557023.png)\n\n如图结果正常显示，当我们部署到服务器的时候，这个就可以当作一个web服务器供大家使用。","source":"_posts/spring boot同时上传多个图片和下载.md","raw":"---\ncategories:\n- 技术\ntags:\n- 后端\n---\n\n## spring boot解决如何同时上传多个图片和下载的问题\n\n[TOC]\n\n在平时的业务场景中，避免不了，要搭建文件上传服务器，作为公共服务。一般情况，只做了单个文件的上传，实际业务场景中，却发现单个文件上传，并不能满足一些业务需求，因此我们需要解决如何写一个同时上传多个文件的借口，并返回可下载的文件地址；\n\n\n\n废话不多讲，不再从头建立一个`Spring boot`项目，如果不知道的话，请直接前往官网查看实例。\n\n\n\n下面我们以上传图片为例，示例相对简单，仅供参考：\n\n### 1 后端上传图片接口逻辑\n\n> UploadController.java\n\n```java\npackage com.zz.controllers.fileUpload;\n\nimport com.zz.Application;\nimport com.zz.model.Response;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.web.server.LocalServerPort;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.multipart.MultipartFile;\n\nimport java.io.*;\nimport java.net.Inet4Address;\nimport java.net.InetAddress;\nimport java.nio.file.Path;\nimport java.util.ArrayList;\nimport java.util.UUID;\n\nimport static com.zz.config.ConfigConstants.getFileDir;\n\n@RestController\n@Configuration\npublic class UploadController {\n\n    private static final Logger log = LoggerFactory.getLogger(Application.class);\n\n    @Value(\"${server.port}\")\n    private String port;\n\n  \t//获取当前IP地址\n    public String getIp() {\n        InetAddress localhost = null;\n        try {\n            localhost = Inet4Address.getLocalHost();\n        } catch (Exception e) {\n            log.error(e.getMessage());\n            e.printStackTrace();\n        }\n        return localhost.getHostAddress();\n    }\n\n    @PostMapping(value = \"/upload\", consumes = {\"multipart/form-data\"})\n    public Response upload(@RequestParam(\"file\") MultipartFile[] files, Response response) {\n        log.info(\"上传多个文件\");\n        StringBuilder builder = new StringBuilder();\n        // file address\n        String fileAddress =\"http://\"+ getIp()+ \":\" + port + File.separator;\n\n        ArrayList<String> imgUrls = new ArrayList<String>();\n        try {\n            for (int i = 0; i < files.length; i++) {\n                // old file name\n                String fileName = files[i].getOriginalFilename();\n                // new filename\n                String generateFileName = UUID.randomUUID().toString().replaceAll(\"-\", \"\") + fileName.substring(fileName.lastIndexOf(\".\"));\n                // store filename\n                String distFileAddress = fileAddress + generateFileName;\n                builder.append(distFileAddress+\",\");\n                imgUrls.add(distFileAddress);\n                // generate file to disk\n                files[i].transferTo(new File(getFileDir() + generateFileName));\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        response.setMsg(\"success\");\n        log.info(builder.toString());\n        response.setData(imgUrls);\n        return response;\n    }\n}\n\n```\n\n相对于单个文件的接收，我们这里直接接受多个`file`对象，然后遍历生成每个对应的地址。\n\n其中：\n\n> getFileDir 设置存放图片的地址，我选择存在项目外的其他地方\n>\n> com.zz.config.ConfigConstants.getFileDir\n\n```\npackage com.zz.config;\n\npublic class ConfigConstants {\n\n    public static String fileDir;\n\n    public static String getFileDir() {\n        fileDir = \"/Users/wz/projects/blog/uploadFile/\";\n        return fileDir;\n    }\n}\n\n```\n\n> 当我们把文件生成到指定的文件夹后，我们如何配置在当前server下访问项目外的静态文件图片资源呢？\n\n这个我们就要利用`spring boot配置文件 application.yml,` 当前还有其他方法比如 `WebMvcConfigurer`   这里不再赘述。\n\n> application.yml\n\n```yaml\npring:\n  jpa:\n    show-sql: true\n    hibernate:\n      ddl-auto: update\n\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\n\n  profiles:\n    active: dev\n\n  # 静态资源配置\n  mvc:\n    static-path-pattern: /**\n  resources:\n    static-locations: file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/\n\nserver:\n  use-forward-headers: true\n  tomcat:\n    remote-ip-header: X-Real-IP\n    protocol-header: X-Forwarded-Proto\n\n#自定义\nmy:\n  tokenURL: \"55555\"\n  authURL: \"88888\"\n\n\n```\n\n\n\n这样之后我们在生成的结果中的 `http://192.168.31.77:8080/a7ef32e3922b46aea256a93dd53de288.png`,这样的地址就可以把文件实质性的指向了`file:/Users/wz/projects/blog/uploadFile/`,这样大致就是一个简单文件服务器的配置了，当然远不及此，还有压缩一类的功能，后续再聊。\n\n\n\n后端逻辑已经很清晰；\n\n那前端如何向后端同时发送多个`file`对象呢？\n\n### 2 前端多个文件上传如何传参\n\n> html\n\n```html\n<input type=\"file\" multiple class=\"el-upload\" accept=\"image/*\" name=\"file\">\n```\n\n> js\n\n```javascript\n//upload\nvar uploadBtn = document.querySelector('.el-upload');\n\nuploadBtn.onchange = function (e) {\n    let files = this.files;\n    console.log(this.files);\n\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"post\", \"/upload\", true);\n    // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    xhr.onreadystatechange = function () {\n        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {\n            console.log(JSON.parse(this.responseText));\n            const {data} = JSON.parse(this.responseText);\n            if(!data) return;\n            const imageList = data.slice(0);\n            let imageStr = '';\n            imageList.forEach(img=>{\n                imageStr += `<img src=\"${img}\" />`;\n            });\n            document.getElementById(\"result\").innerHTML = imageStr;\n        }\n    };\n\n    const formData = new FormData();\n\n    // 多个file 同时上传\n    if(files && files.length){\n        for (let i=0;i<files.length;i++) {\n            formData.append(\"file\", files[i])\n        }\n    }\n\n    console.log(formData);\n\n    xhr.send(formData);\n};\n```\n\n前端通过`FormData`传参数发送POST请求；\n\n区别于之前的单个`formData.append();` 这里我们可以同时`append`多个相同名字的文件二进制文件流；\n\n\n![image-20191123234150228](/images/image-20191123234150228-4523763.png)\n\n![image-20191123234325831](/images/image-20191123234325831.png)\n\n![image-20191123234358451](/images/image-20191123234358451.png)\n\n![image-20191123234557023](/images/image-20191123234557023.png)\n\n如图结果正常显示，当我们部署到服务器的时候，这个就可以当作一个web服务器供大家使用。","slug":"spring boot同时上传多个图片和下载","published":1,"date":"2020-03-04T23:38:32.733Z","updated":"2020-03-05T00:33:04.278Z","title":"spring boot同时上传多个图片和下载","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7e0nvth0006ntcy4i50dfsm","content":"<h2 id=\"spring-boot解决如何同时上传多个图片和下载的问题\"><a href=\"#spring-boot解决如何同时上传多个图片和下载的问题\" class=\"headerlink\" title=\"spring boot解决如何同时上传多个图片和下载的问题\"></a>spring boot解决如何同时上传多个图片和下载的问题</h2><p>[TOC]</p>\n<p>在平时的业务场景中，避免不了，要搭建文件上传服务器，作为公共服务。一般情况，只做了单个文件的上传，实际业务场景中，却发现单个文件上传，并不能满足一些业务需求，因此我们需要解决如何写一个同时上传多个文件的借口，并返回可下载的文件地址；</p>\n<p>废话不多讲，不再从头建立一个<code>Spring boot</code>项目，如果不知道的话，请直接前往官网查看实例。</p>\n<p>下面我们以上传图片为例，示例相对简单，仅供参考：</p>\n<h3 id=\"1-后端上传图片接口逻辑\"><a href=\"#1-后端上传图片接口逻辑\" class=\"headerlink\" title=\"1 后端上传图片接口逻辑\"></a>1 后端上传图片接口逻辑</h3><blockquote>\n<p>UploadController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.controllers.fileUpload;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.Application;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.web.server.LocalServerPort;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.Inet4Address;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Path;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.UUID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> com.zz.config.ConfigConstants.getFileDir;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UploadController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(Application<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;server.port&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String port;</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">//获取当前IP地址</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getIp</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        InetAddress localhost = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            localhost = Inet4Address.getLocalHost();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(e.getMessage());</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> localhost.getHostAddress();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(value = <span class=\"string\">\"/upload\"</span>, consumes = &#123;<span class=\"string\">\"multipart/form-data\"</span>&#125;)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">upload</span><span class=\"params\">(@RequestParam(<span class=\"string\">\"file\"</span>)</span> MultipartFile[] files, Response response) </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"上传多个文件\"</span>);</span><br><span class=\"line\">        StringBuilder builder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        <span class=\"comment\">// file address</span></span><br><span class=\"line\">        String fileAddress =<span class=\"string\">\"http://\"</span>+ getIp()+ <span class=\"string\">\":\"</span> + port + File.separator;</span><br><span class=\"line\"></span><br><span class=\"line\">        ArrayList&lt;String&gt; imgUrls = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; files.length; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// old file name</span></span><br><span class=\"line\">                String fileName = files[i].getOriginalFilename();</span><br><span class=\"line\">                <span class=\"comment\">// new filename</span></span><br><span class=\"line\">                String generateFileName = UUID.randomUUID().toString().replaceAll(<span class=\"string\">\"-\"</span>, <span class=\"string\">\"\"</span>) + fileName.substring(fileName.lastIndexOf(<span class=\"string\">\".\"</span>));</span><br><span class=\"line\">                <span class=\"comment\">// store filename</span></span><br><span class=\"line\">                String distFileAddress = fileAddress + generateFileName;</span><br><span class=\"line\">                builder.append(distFileAddress+<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">                imgUrls.add(distFileAddress);</span><br><span class=\"line\">                <span class=\"comment\">// generate file to disk</span></span><br><span class=\"line\">                files[i].transferTo(<span class=\"keyword\">new</span> File(getFileDir() + generateFileName));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">        log.info(builder.toString());</span><br><span class=\"line\">        response.setData(imgUrls);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>相对于单个文件的接收，我们这里直接接受多个<code>file</code>对象，然后遍历生成每个对应的地址。</p>\n<p>其中：</p>\n<blockquote>\n<p>getFileDir 设置存放图片的地址，我选择存在项目外的其他地方</p>\n<p>com.zz.config.ConfigConstants.getFileDir</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\">public class ConfigConstants &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static String fileDir;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static String getFileDir() &#123;</span><br><span class=\"line\">        fileDir &#x3D; &quot;&#x2F;Users&#x2F;wz&#x2F;projects&#x2F;blog&#x2F;uploadFile&#x2F;&quot;;</span><br><span class=\"line\">        return fileDir;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当我们把文件生成到指定的文件夹后，我们如何配置在当前server下访问项目外的静态文件图片资源呢？</p>\n</blockquote>\n<p>这个我们就要利用<code>spring boot配置文件 application.yml,</code> 当前还有其他方法比如 <code>WebMvcConfigurer</code>   这里不再赘述。</p>\n<blockquote>\n<p>application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">pring:</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">show-sql:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">      <span class=\"attr\">ddl-auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 静态资源配置</span></span><br><span class=\"line\">  <span class=\"attr\">mvc:</span></span><br><span class=\"line\">    <span class=\"attr\">static-path-pattern:</span> <span class=\"string\">/**</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">static-locations:</span> <span class=\"string\">file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">use-forward-headers:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">tomcat:</span></span><br><span class=\"line\">    <span class=\"attr\">remote-ip-header:</span> <span class=\"string\">X-Real-IP</span></span><br><span class=\"line\">    <span class=\"attr\">protocol-header:</span> <span class=\"string\">X-Forwarded-Proto</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#自定义</span></span><br><span class=\"line\"><span class=\"attr\">my:</span></span><br><span class=\"line\">  <span class=\"attr\">tokenURL:</span> <span class=\"string\">\"55555\"</span></span><br><span class=\"line\">  <span class=\"attr\">authURL:</span> <span class=\"string\">\"88888\"</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>这样之后我们在生成的结果中的 <code>http://192.168.31.77:8080/a7ef32e3922b46aea256a93dd53de288.png</code>,这样的地址就可以把文件实质性的指向了<code>file:/Users/wz/projects/blog/uploadFile/</code>,这样大致就是一个简单文件服务器的配置了，当然远不及此，还有压缩一类的功能，后续再聊。</p>\n<p>后端逻辑已经很清晰；</p>\n<p>那前端如何向后端同时发送多个<code>file</code>对象呢？</p>\n<h3 id=\"2-前端多个文件上传如何传参\"><a href=\"#2-前端多个文件上传如何传参\" class=\"headerlink\" title=\"2 前端多个文件上传如何传参\"></a>2 前端多个文件上传如何传参</h3><blockquote>\n<p>html</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">multiple</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-upload\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"file\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//upload</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uploadBtn = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.el-upload'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">uploadBtn.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> files = <span class=\"keyword\">this</span>.files;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.files);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">    xhr.open(<span class=\"string\">\"post\"</span>, <span class=\"string\">\"/upload\"</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");</span></span><br><span class=\"line\">    xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.readyState === XMLHttpRequest.DONE &amp;&amp; <span class=\"keyword\">this</span>.status === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">this</span>.responseText));</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123;data&#125; = <span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">this</span>.responseText);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!data) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> imageList = data.slice(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> imageStr = <span class=\"string\">''</span>;</span><br><span class=\"line\">            imageList.forEach(<span class=\"function\"><span class=\"params\">img</span>=&gt;</span>&#123;</span><br><span class=\"line\">                imageStr += <span class=\"string\">`&lt;img src=\"<span class=\"subst\">$&#123;img&#125;</span>\" /&gt;`</span>;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerHTML = imageStr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 多个file 同时上传</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(files &amp;&amp; files.length)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>;i&lt;files.length;i++) &#123;</span><br><span class=\"line\">            formData.append(<span class=\"string\">\"file\"</span>, files[i])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(formData);</span><br><span class=\"line\"></span><br><span class=\"line\">    xhr.send(formData);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>前端通过<code>FormData</code>传参数发送POST请求；</p>\n<p>区别于之前的单个<code>formData.append();</code> 这里我们可以同时<code>append</code>多个相同名字的文件二进制文件流；</p>\n<p><img src=\"/images/image-20191123234150228-4523763.png\" alt=\"image-20191123234150228\"></p>\n<p><img src=\"/images/image-20191123234325831.png\" alt=\"image-20191123234325831\"></p>\n<p><img src=\"/images/image-20191123234358451.png\" alt=\"image-20191123234358451\"></p>\n<p><img src=\"/images/image-20191123234557023.png\" alt=\"image-20191123234557023\"></p>\n<p>如图结果正常显示，当我们部署到服务器的时候，这个就可以当作一个web服务器供大家使用。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"spring-boot解决如何同时上传多个图片和下载的问题\"><a href=\"#spring-boot解决如何同时上传多个图片和下载的问题\" class=\"headerlink\" title=\"spring boot解决如何同时上传多个图片和下载的问题\"></a>spring boot解决如何同时上传多个图片和下载的问题</h2><p>[TOC]</p>\n<p>在平时的业务场景中，避免不了，要搭建文件上传服务器，作为公共服务。一般情况，只做了单个文件的上传，实际业务场景中，却发现单个文件上传，并不能满足一些业务需求，因此我们需要解决如何写一个同时上传多个文件的借口，并返回可下载的文件地址；</p>\n<p>废话不多讲，不再从头建立一个<code>Spring boot</code>项目，如果不知道的话，请直接前往官网查看实例。</p>\n<p>下面我们以上传图片为例，示例相对简单，仅供参考：</p>\n<h3 id=\"1-后端上传图片接口逻辑\"><a href=\"#1-后端上传图片接口逻辑\" class=\"headerlink\" title=\"1 后端上传图片接口逻辑\"></a>1 后端上传图片接口逻辑</h3><blockquote>\n<p>UploadController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.zz.controllers.fileUpload;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.Application;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.zz.model.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.web.server.LocalServerPort;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.Inet4Address;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.file.Path;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.UUID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> com.zz.config.ConfigConstants.getFileDir;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UploadController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(Application<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;server.port&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String port;</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">//获取当前IP地址</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getIp</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        InetAddress localhost = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            localhost = Inet4Address.getLocalHost();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(e.getMessage());</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> localhost.getHostAddress();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(value = <span class=\"string\">\"/upload\"</span>, consumes = &#123;<span class=\"string\">\"multipart/form-data\"</span>&#125;)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">upload</span><span class=\"params\">(@RequestParam(<span class=\"string\">\"file\"</span>)</span> MultipartFile[] files, Response response) </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"上传多个文件\"</span>);</span><br><span class=\"line\">        StringBuilder builder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        <span class=\"comment\">// file address</span></span><br><span class=\"line\">        String fileAddress =<span class=\"string\">\"http://\"</span>+ getIp()+ <span class=\"string\">\":\"</span> + port + File.separator;</span><br><span class=\"line\"></span><br><span class=\"line\">        ArrayList&lt;String&gt; imgUrls = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; files.length; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// old file name</span></span><br><span class=\"line\">                String fileName = files[i].getOriginalFilename();</span><br><span class=\"line\">                <span class=\"comment\">// new filename</span></span><br><span class=\"line\">                String generateFileName = UUID.randomUUID().toString().replaceAll(<span class=\"string\">\"-\"</span>, <span class=\"string\">\"\"</span>) + fileName.substring(fileName.lastIndexOf(<span class=\"string\">\".\"</span>));</span><br><span class=\"line\">                <span class=\"comment\">// store filename</span></span><br><span class=\"line\">                String distFileAddress = fileAddress + generateFileName;</span><br><span class=\"line\">                builder.append(distFileAddress+<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">                imgUrls.add(distFileAddress);</span><br><span class=\"line\">                <span class=\"comment\">// generate file to disk</span></span><br><span class=\"line\">                files[i].transferTo(<span class=\"keyword\">new</span> File(getFileDir() + generateFileName));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response.setMsg(<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">        log.info(builder.toString());</span><br><span class=\"line\">        response.setData(imgUrls);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>相对于单个文件的接收，我们这里直接接受多个<code>file</code>对象，然后遍历生成每个对应的地址。</p>\n<p>其中：</p>\n<blockquote>\n<p>getFileDir 设置存放图片的地址，我选择存在项目外的其他地方</p>\n<p>com.zz.config.ConfigConstants.getFileDir</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.zz.config;</span><br><span class=\"line\"></span><br><span class=\"line\">public class ConfigConstants &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static String fileDir;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static String getFileDir() &#123;</span><br><span class=\"line\">        fileDir &#x3D; &quot;&#x2F;Users&#x2F;wz&#x2F;projects&#x2F;blog&#x2F;uploadFile&#x2F;&quot;;</span><br><span class=\"line\">        return fileDir;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当我们把文件生成到指定的文件夹后，我们如何配置在当前server下访问项目外的静态文件图片资源呢？</p>\n</blockquote>\n<p>这个我们就要利用<code>spring boot配置文件 application.yml,</code> 当前还有其他方法比如 <code>WebMvcConfigurer</code>   这里不再赘述。</p>\n<blockquote>\n<p>application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">pring:</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">show-sql:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">      <span class=\"attr\">ddl-auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 静态资源配置</span></span><br><span class=\"line\">  <span class=\"attr\">mvc:</span></span><br><span class=\"line\">    <span class=\"attr\">static-path-pattern:</span> <span class=\"string\">/**</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">static-locations:</span> <span class=\"string\">file:/Users/wz/projects/blog/uploadFile/,classpath:/static/,classpath:/resources/,classpath:/file/,classpath:/templates/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">use-forward-headers:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">tomcat:</span></span><br><span class=\"line\">    <span class=\"attr\">remote-ip-header:</span> <span class=\"string\">X-Real-IP</span></span><br><span class=\"line\">    <span class=\"attr\">protocol-header:</span> <span class=\"string\">X-Forwarded-Proto</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#自定义</span></span><br><span class=\"line\"><span class=\"attr\">my:</span></span><br><span class=\"line\">  <span class=\"attr\">tokenURL:</span> <span class=\"string\">\"55555\"</span></span><br><span class=\"line\">  <span class=\"attr\">authURL:</span> <span class=\"string\">\"88888\"</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>这样之后我们在生成的结果中的 <code>http://192.168.31.77:8080/a7ef32e3922b46aea256a93dd53de288.png</code>,这样的地址就可以把文件实质性的指向了<code>file:/Users/wz/projects/blog/uploadFile/</code>,这样大致就是一个简单文件服务器的配置了，当然远不及此，还有压缩一类的功能，后续再聊。</p>\n<p>后端逻辑已经很清晰；</p>\n<p>那前端如何向后端同时发送多个<code>file</code>对象呢？</p>\n<h3 id=\"2-前端多个文件上传如何传参\"><a href=\"#2-前端多个文件上传如何传参\" class=\"headerlink\" title=\"2 前端多个文件上传如何传参\"></a>2 前端多个文件上传如何传参</h3><blockquote>\n<p>html</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">multiple</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-upload\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"file\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//upload</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uploadBtn = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.el-upload'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">uploadBtn.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> files = <span class=\"keyword\">this</span>.files;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.files);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">    xhr.open(<span class=\"string\">\"post\"</span>, <span class=\"string\">\"/upload\"</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");</span></span><br><span class=\"line\">    xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.readyState === XMLHttpRequest.DONE &amp;&amp; <span class=\"keyword\">this</span>.status === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">this</span>.responseText));</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123;data&#125; = <span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">this</span>.responseText);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!data) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> imageList = data.slice(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> imageStr = <span class=\"string\">''</span>;</span><br><span class=\"line\">            imageList.forEach(<span class=\"function\"><span class=\"params\">img</span>=&gt;</span>&#123;</span><br><span class=\"line\">                imageStr += <span class=\"string\">`&lt;img src=\"<span class=\"subst\">$&#123;img&#125;</span>\" /&gt;`</span>;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerHTML = imageStr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 多个file 同时上传</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(files &amp;&amp; files.length)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>;i&lt;files.length;i++) &#123;</span><br><span class=\"line\">            formData.append(<span class=\"string\">\"file\"</span>, files[i])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(formData);</span><br><span class=\"line\"></span><br><span class=\"line\">    xhr.send(formData);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>前端通过<code>FormData</code>传参数发送POST请求；</p>\n<p>区别于之前的单个<code>formData.append();</code> 这里我们可以同时<code>append</code>多个相同名字的文件二进制文件流；</p>\n<p><img src=\"/images/image-20191123234150228-4523763.png\" alt=\"image-20191123234150228\"></p>\n<p><img src=\"/images/image-20191123234325831.png\" alt=\"image-20191123234325831\"></p>\n<p><img src=\"/images/image-20191123234358451.png\" alt=\"image-20191123234358451\"></p>\n<p><img src=\"/images/image-20191123234557023.png\" alt=\"image-20191123234557023\"></p>\n<p>如图结果正常显示，当我们部署到服务器的时候，这个就可以当作一个web服务器供大家使用。</p>\n"},{"_content":"\n# RESETful API 设计规范\n\n[TOC]\n\n\n>文章参考了目前比较常见的 `RESETful API` 设计，文档不一定十分完善，如果遗漏或者不准确，请包涵和提出意见。\n\n## 关于「能愿动词」的使用\n\n为了避免歧义，文档大量使用了「能愿动词」，对应的解释如下：\n\n- `必须 (MUST)`：绝对，严格遵循，请照做，无条件遵守；\n- `一定不可 (MUST NOT)`：禁令，严令禁止；\n- `应该 (SHOULD)` ：强烈建议这样做，但是不强求；\n- `不该 (SHOULD NOT)`：强烈不建议这样做，但是不强求；\n- `可以 (MAY)` 和 `可选 (OPTIONAL)` ：选择性高一点，在这个文档内，此词语使用较少；\n\n参考 [RFC](https://www.ietf.org/rfc/rfc2119.txt) 文档\n\n> ```\n> Status of this Memo\n>\n>    This document specifies an Internet Best Current Practices for the\n>    Internet Community, and requests discussion and suggestions for\n>    improvements.  Distribution of this memo is unlimited.\n>\n> Abstract\n>\n>    In many standards track documents several words are used to signify\n>    the requirements in the specification.  These words are often\n>    capitalized.  This document defines these words as they should be\n>    interpreted in IETF documents.  Authors who follow these guidelines\n>    should incorporate this phrase near the beginning of their document:\n>\n>       The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL\n>       NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\",  \"MAY\", and\n>       \"OPTIONAL\" in this document are to be interpreted as described in\n>       RFC 2119.\n>\n>    Note that the force of these words is modified by the requirement\n>    level of the document in which they are used.\n>\n> 1. MUST   This word, or the terms \"REQUIRED\" or \"SHALL\", mean that the\n>    definition is an absolute requirement of the specification.\n>\n> 2. MUST NOT   This phrase, or the phrase \"SHALL NOT\", mean that the\n>    definition is an absolute prohibition of the specification.\n>\n> 3. SHOULD   This word, or the adjective \"RECOMMENDED\", mean that there\n>    may exist valid reasons in particular circumstances to ignore a\n>    particular item, but the full implications must be understood and\n>    carefully weighed before choosing a different course.\n>\n> 4. SHOULD NOT   This phrase, or the phrase \"NOT RECOMMENDED\" mean that\n>    there may exist valid reasons in particular circumstances when the\n>    particular behavior is acceptable or even useful, but the full\n>    implications should be understood and the case carefully weighed\n>    before implementing any behavior described with this label.\n> ```\n\n## Protocol\n\n客户端在通过 `API` 与后端服务通信的过程中，`应该` 使用 `HTTPS` 协议。\n\n## API Root URL\n\n`API` 的根入口点应尽可能保持足够简单，这里有两个常见的 `URL` 根例子：\n\n- api.example.com/*\n- example.com/api/*\n\n> 如果你的应用很庞大或者你预计它将会变的很庞大，那 `应该` 将 `API` 放到子域下（`api.example.com`）。这种做法可以保持某些规模化上的灵活性。\n\n## Versioning\n\n所有的 `API` 必须保持向后兼容，你 `必须` 在引入新版本 `API` 的同时确保旧版本 `API` 仍然可用。所以 `应该` 为其提供版本支持。\n\n目前比较常见的两种版本号形式：\n\n### 在 URL 中嵌入版本编号\n\n```\napi.example.com/v1/*\n```\n\n这种做法是版本号直观、易于调试；另一种做法是，将版本号放在 `HTTP Header` 头中：\n\n### 通过媒体类型来指定版本信息\n\n```\nAccept: application/vnd.example.com.v1+json\n```\n\n其中 `vnd` 表示 `Standards Tree` 标准树类型，有三个不同的树: `x`，`prs` 和 `vnd`。你使用的标准树需要取决于你开发的项目\n\n- 未注册的树（`x`）主要表示本地和私有环境\n- 私有树（`prs`）主要表示没有商业发布的项目\n- 供应商树（`vnd`）主要表示公开发布的项目\n\n> 后面几个参数依次为应用名称（一般为应用域名）、版本号、期望的返回格式。\n\n至于具体把版本号放在什么地方，这个问题一直存在很大的争议，但由于我们大多数时间都在使用 `Laravel` 开发，`应该` 使用 [dingo/api](https://github.com/dingo/api) 来快速构建应用，它采用第二种方式来管理 `API` 版本，并且已集成了标准的 `HTTP Response`。\n\n## Endpoints\n\n端点就是指向特定资源或资源集合的 `URL`。在端点的设计中，你 `必须` 遵守下列约定：\n\n- URL 的命名 `必须` 全部小写\n- URL 中资源（`resource`）的命名 `必须` 是名词，并且 `必须` 是复数形式\n- `必须` 优先使用 `Restful` 类型的 URL\n- URL `必须` 是易读的\n- URL `一定不可` 暴露服务器架构\n\n> 至于 URL 是否必须使用连字符（`-`） 或下划线（`_`），不做硬性规定，但 `必须` 根据团队情况统一一种风格。\n\n来看一个反例\n\n- https://api.example.com/getUserInfo?userid=1\n- https://api.example.com/getusers\n- https://api.example.com/sv/u\n- https://api.example.com/cgi-bin/users/get_user.php?userid=1\n\n再来看一个正列\n\n- https://api.example.com/zoos\n\n- https://api.example.com/animals\n\n- https://api.example.com/zoos/{zoo}/animals\n\n- https://api.example.com/animal_types\n\n- https://api.example.com/employees\n\n## HTTP 动词\n\n对于资源的具体操作类型，由 `HTTP` 动词表示。常用的 `HTTP` 动词有下面五个（括号里是对应的 `SQL` 命令）。\n\n- GET（SELECT）：从服务器取出资源（一项或多项）。\n- POST（CREATE）：在服务器新建一个资源。\n- PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。\n- PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。\n- DELETE（DELETE）：从服务器删除资源。\n\n其中\n\n1 删除资源 `必须` 用 `DELETE` 方法 2 创建新的资源 `必须` 使用 `POST` 方法 3 更新资源 `应该` 使用 `PUT` 方法 4 获取资源信息 `必须` 使用 `GET` 方法\n\n针对每一个端点来说，下面列出所有可行的 `HTTP` 动词和端点的组合\n\n| 请求方法 | URL                              | 描述                                             |\n| -------- | -------------------------------- | ------------------------------------------------ |\n| GET      | /zoos/list                       | 列出所有的动物园(ID和名称，不要太详细)           |\n| POST     | /zoos/update                     | 新增一个新的动物园                               |\n| GET      | /zoos/detail?id=1                | 获取指定动物园详情                               |\n| PUT      | /zoos/{zoo}                      | 更新指定动物园(整个对象)                         |\n| PATCH    | /zoos/{zoo}                      | 更新动物园(部分对象)                             |\n| DELETE   | /zoos/{zoo}                      | 删除指定动物园                                   |\n| GET      | /zoos/{zoo}/animals              | 检索指定动物园下的动物列表(ID和名称，不要太详细) |\n| GET      | /animals                         | 列出所有动物(ID和名称)。                         |\n| POST     | /animals                         | 新增新的动物                                     |\n| GET      | /animals/detail                  | 获取指定的动物详情                               |\n| PUT      | /animals/{animal}                | 更新指定的动物(整个对象)                         |\n| PATCH    | /animals/{animal}                | 更新指定的动物(部分对象)                         |\n| GET      | /animal_types                    | 获取所有动物类型(ID和名称，不要太详细)           |\n| GET      | /animal_types/{type}             | 获取指定的动物类型详情                           |\n| GET      | /employees                       | 检索整个雇员列表                                 |\n| GET      | /employees/{employee}            | 检索指定特定的员工                               |\n| GET      | /zoos/employees/list             | 检索在这个动物园工作的雇员的名单(身份证和姓名)   |\n| POST     | /employees                       | 新增指定新员工                                   |\n| POST     | /zoos/{zoo}/employees            | 在特定的动物园雇佣一名员工                       |\n| DELETE   | /zoos/{zoo}/employees/{employee} | 从某个动物园解雇一名员工                         |\n\n> 超出 `Restful` 端点的，`应该` 模仿上表的方式来定义端点。\n\n## Filtering\n\n> 如果记录数量很多，服务器不可能都将它们返回给用户。API `应该` 提供参数，过滤返回结果。下面是一些常见的参数。\n\n- ?limit=10：指定返回记录的数量\n- ?offset=10：指定返回记录的开始位置。\n- ?page=2&rows0：指定第几页，以及每页的记录数。\n- ?order_by=me&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。\n- ?animal_type_id=1：指定筛选条件\n\n所有 `URL` 参数 `必须` 是全小写，`必须` 使用下划线类型的参数形式。\n\n> 分页参数 `必须` 固定为 `page`、`rows`\n\n经常使用的、复杂的查询 `应该` 标签化，降低维护成本。如\n\n```http\nGET /trades?status=closed&order_by=name&order=asc\n\n# 可为其定制快捷方式\nGET /trades/recently_closed\n```\n\n## Authentication\n\n`应该` 使用 `OAuth2.0` 的方式为 API 调用者提供登录认证。`必须` 先通过登录接口获取 `Access Token` 后再通过该 `token` 调用需要身份认证的 `API`。\n\nOauth 的端点设计示列\n\n- RFC 6749 /token\n- Twitter /oauth2/token\n- Fackbook /oauth/access_token\n- Google /o/oauth2/token\n- Github /login/oauth/access_token\n- Instagram /oauth/authorize\n\n客户端在获得 `access token` 的同时 `必须` 在响应中包含一个名为 `expires_in` 的数据，它表示当前获得的 `token` 会在多少 `秒` 后失效。\n\n```json\n{\n    \"access_token\": \"token....\",\n    \"token_type\": \"Bearer\",\n    \"expires_in\": 3600\n}\n```\n\n客户端在请求需要认证的 `API` 时，`必须` 在请求头 `Authorization` 中带上 `access_token`。\n\n```\nAuthorization: Bearer token...\n```\n\n当超过指定的秒数后，`access token` 就会过期，再次用过期/或无效的 `token` 访问时，服务端 `应该` 返回 `invalid_token` 的错误或 `401` 错误码。\n\n```http\nHTTP/1.1 401 Unauthorized\nContent-Type: application/json\nCache-Control: no-store\nPragma: no-cache\n\n{\n    \"error\": \"invalid_token\"\n}\n```\n\n>  开发中，`应该` 使用 [JWT](https://github.com/tymondesigns/jwt-auth) 来为管理你的 Token，并且 `一定不可` 在 `api` 中间件中开启请求 `session`。\n\n## Response\n\n所有的 `API` 响应，`必须` 遵守 `HTTP` 设计规范，`必须` 选择合适的 `HTTP` 状态码。`一定不可` 所有接口都返回状态码为 `200` 的 `HTTP` 响应，如：\n\n```\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"code\": 0,\n    \"msg\": \"success\",\n    \"data\": {\n        \"username\": \"username\"\n    }\n}\n```\n\n或\n\n```http\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"code\": -1,\n    \"msg\": \"该活动不存在\",\n}\n```\n\n下表列举了常见的 `HTTP` 状态码\n\n| 状态码 | 描述                                                 |\n| ------ | ---------------------------------------------------- |\n| 1xx    | 代表请求已被接受，需要继续处理                       |\n| 2xx    | 请求已成功，请求所希望的响应头或数据体将随此响应返回 |\n| 3xx    | 重定向                                               |\n| 4xx    | 客户端原因引起的错误                                 |\n| 5xx    | 服务端原因引起的错误                                 |\n\n> 只有来自客户端的请求被正确的处理后才能返回 `2xx` 的响应，所以当 API 返回 `2xx` 类型的状态码时，前端 `必须` 认定该请求已处理成功\n\n必须强调的是，所有 `API` `一定不可` 返回 `1xx` 类型的状态码。当 `API` 发生错误时，`必须` 返回出错时的详细信息。目前常见返回错误信息的方法有两种：\n\n1、将错误详细放入 `HTTP` 响应首部；\n\n```http\nX-MYNAME-ERROR-CODE: 4001\nX-MYNAME-ERROR-MESSAGE: Bad authentication token\nX-MYNAME-ERROR-INFO: http://docs.example.com/api/v1/authentication\n```\n\n2、直接放入响应实体中；\n\n```\nHTTP/1.1 401 Unauthorized\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:02:59 GMT\nConnection: keep-alive\n\n{\"error_code\":40100,\"message\":\"Unauthorized\"}\n```\n\n考虑到易读性和客户端的易处理性，我们 `必须` 把错误信息直接放到响应实体中，并且错误格式 `应该` 满足如下格式：\n\n```json\n{\n    \"message\": \"您查找的资源不存在\",\n    \"error_code\": 404001\n}\n```\n\n其中错误码（`error_code`）`必须` 和 `HTTP` 状态码对应，也方便错误码归类，如：\n\n```http\nHTTP/1.1 429 Too Many Requests\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:15:52 GMT\nConnection: keep-alive\n\n{\"error_code\":429001,\"message\":\"你操作太频繁了\"}\n```\n\n`应该` 在返回的错误信息中，同时包含面向开发者和面向用户的提示信息，前者可方便开发人员调试，后者可直接展示给终端用户查看如：\n\n```\n{\n    \"message\": \"直接展示给终端用户的错误信息\",\n    \"error_code\": \"业务错误码\",\n    \"error\": \"供开发者查看的错误信息\",\n    \"debug\": [\n        \"错误堆栈，必须开启 debug 才存在\"\n    ]\n}\n```\n\n下面详细列举了各种情况 API 的返回说明。\n\n### 200 ok\n\n`200` 状态码是最常见的 `HTTP` 状态码，在所有 **成功** 的 `GET` 请求中，`必须` 返回此状态码。`HTTP` 响应实体部分 `必须` 直接就是数据，不要做多余的包装。\n\n错误示例：\n\n```http\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"user\": {\n        \"id\":1,\n        \"nickname\":\"fwest\",\n        \"username\": \"example\"\n    }\n}\n```\n\n正确示例：\n\n1、获取单个资源详情\n\n```json\n{\n    \"id\": 1,\n    \"username\": \"godruoyi\",\n    \"age\": 88,\n}\n```\n\n2、获取资源集合\n\n```json\n[\n    {\n        \"id\": 1,\n        \"username\": \"godruoyi\",\n        \"age\": 88,\n    },\n    {\n        \"id\": 2,\n        \"username\": \"foo\",\n        \"age\": 88,\n    }\n]\n```\n\n3、额外的媒体信息\n\n```json\n{\n    \"data\": [\n        {\n            \"id\": 1,\n            \"avatar\": \"https://lorempixel.com/640/480/?32556\",\n            \"nickname\": \"fwest\",\n            \"last_logined_time\": \"2018-05-29 04:56:43\",\n            \"has_registed\": true\n        },\n        {\n            \"id\": 2,\n            \"avatar\": \"https://lorempixel.com/640/480/?86144\",\n            \"nickname\": \"zschowalter\",\n            \"last_logined_time\": \"2018-06-16 15:18:34\",\n            \"has_registed\": true\n        }\n    ],\n    \"meta\": {\n        \"pagination\": {\n            \"total\": 101,\n            \"count\": 2,\n            \"per_page\": 2,\n            \"current_page\": 1,\n            \"total_pages\": 51,\n            \"links\": {\n                \"next\": \"http://api.example.com?page=2\"\n            }\n        }\n    }\n}\n```\n\n> 其中，分页和其他额外的媒体信息，必须放到 `meta` 字段中。\n\n### 201 Created\n\n当服务器创建数据成功时，`应该` 返回此状态码。常见的应用场景是使用 `POST` 提交用户信息，如：\n\n- 添加了新用户\n- 上传了图片\n- 创建了新活动\n\n等，都可以返回 `201` 状态码。需要注意的是，你可以选择在用户创建成功后返回新用户的数据\n\n```http\nHTTP/1.1 201 Created\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:13:40 GMT\nConnection: keep-alive\n\n{\n    \"id\": 1,\n    \"avatar\": \"https:\\/\\/lorempixel.com\\/640\\/480\\/?32556\",\n    \"nickname\": \"fwest\",\n    \"last_logined_time\": \"2018-05-29 04:56:43\",\n    \"created_at\": \"2018-06-16 17:55:55\",\n    \"updated_at\": \"2018-06-16 17:55:55\"\n}\n```\n\n也可以返回一个响应实体为空的 `HTTP Response` 如：\n\n```http\nHTTP/1.1 201 Created\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:12:20 GMT\nConnection: keep-alive\n```\n\n> 这里我们 `应该` 采用第二种方式，因为大多数情况下，客户端只需要知道该请求操作成功与否，并不需要返回新资源的信息。\n\n### 202 Accepted\n\n该状态码表示服务器已经接受到了来自客户端的请求，但还未开始处理。常用短信发送、邮件通知、模板消息推送等这类很耗时需要队列支持的场景中；\n\n> 返回该状态码时，响应实体 `必须` 为空。\n\n```http\nHTTP/1.1 202 Accepted\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:25:15 GMT\nConnection: keep-alive\n```\n\n### 204 No Content\n\n该状态码表示响应实体不包含任何数据，其中：\n\n- 在使用 `DELETE` 方法删除资源 **成功** 时，`必须` 返回该状态码\n- 使用 `PUT`、`PATCH` 方法更新数据 **成功** 时，也 `应该` 返回此状态码\n\n```http\nHTTP/1.1 204 No Content\nServer: nginx/1.11.9\nDate: Sun, 24 Jun 2018 09:29:12 GMT\nConnection: keep-alive\n```\n\n### 3xx 重定向\n\n所有 `API` `不该` 返回 `3xx` 类型的状态码。因为 `3xx` 类型的响应格式一般为下列格式：\n\n```http\nHTTP/1.1 302 Found\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 09:41:50 GMT\nLocation: https://example.com\nConnection: keep-alive\n\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\" />\n        <meta http-equiv=\"refresh\" content=\"0;url=https://example.com\" />\n\n        <title>Redirecting to https://example.com</title>\n    </head>\n    <body>\n        Redirecting to <a href=\"https://example.com\">https://example.com</a>.\n    </body>\n</html>\n```\n\n所有 `API` `一定不可` 返回纯 `HTML` 结构的响应；若一定要使用重定向功能，`可以` 返回一个响应实体为空的 `3xx` 响应，并在响应头中加上 `Location` 字段:\n\n```http\nHTTP/1.1 302 Found\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:52:50 GMT\nLocation: https://godruoyi.com\nConnection: keep-alive\n```\n\n### 400 Bad Request\n\n由于明显的客户端错误（例如，请求语法格式错误、无效的请求、无效的签名等），服务器 `应该` 放弃该请求。\n\n> 当服务器无法从其他 4xx 类型的状态码中找出合适的来表示错误类型时，都 `必须` 返回该状态码。\n\n```http\nHTTP/1.1 400 Bad Request\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:22:36 GMT\nConnection: keep-alive\n\n{\"error_code\":40000,\"message\":\"无效的签名\"}\n```\n\n### 401 Unauthorized\n\n该状态码表示当前请求需要身份认证，以下情况都 `必须` 返回该状态码。\n\n- 未认证用户访问需要认证的 API\n- access_token 无效/过期\n\n> 客户端在收到 `401` 响应后，都 `应该` 提示用户进行下一步的登录操作。\n\n```http\nHTTP/1.1 401 Unauthorized\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nWWW-Authenticate: JWTAuth\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:17:02 GMT\nConnection: keep-alive\n\n{\"message\":\"Token Signature could not be verified.\",\"error_code\": \"40100\"}\n```\n\n### 403 Forbidden\n\n该状态码可以简单的理解为没有权限访问该请求，服务器收到请求但拒绝提供服务。\n\n如当普通用户请求操作管理员用户时，`必须` 返回该状态码。\n\n```http\nHTTP/1.1 403 Forbidden\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:05:34 GMT\nConnection: keep-alive\n\n{\"error_code\":40301,\"message\":\"权限不足\"}\n```\n\n### 404 Not Found\n\n该状态码表示用户请求的资源不存在，如\n\n- 获取不存在的用户信息 （get /users/9999999）\n- 访问不存在的端点\n\n都 `必须` 返回该状态码，若该资源已永久不存在，则 `应该` 返回 `410` 响应。\n\n### 405 Method Not Allowed\n\n当客户端使用的 `HTTP` 请求方法不被服务器允许时，`必须` 返回该状态码。\n\n> 如客户端调用了 `POST` 方法来访问只支持 GET 方法的 API\n\n该响应 `必须` 返回一个 `Allow` 头信息用以表示出当前资源能够接受的请求方法的列表。\n\n```http\nHTTP/1.1 405 Method Not Allowed\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nAllow: GET, HEAD\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:30:57 GMT\nConnection: keep-alive\n\n{\"message\":\"405 Method Not Allowed\",\"error_code\": 40500}\n```\n\n### 406 Not Acceptable\n\n`API` 在不支持客户端指定的数据格式时，应该返回此状态码。如支持 `JSON` 和 `XML` 输出的 `API` 被指定返回 `YAML` 格式的数据时。\n\n> Http 协议一般通过请求首部的 Accept 来指定数据格式\n\n### 408 Request Timeout\n\n客户端请求超时时 `必须` 返回该状态码，需要注意的时，该状态码表示 **客户端请求超时**，在涉及第三方 `API` 调用超时时，`一定不可` 返回该状态码。\n\n### 409 Confilct\n\n该状态码表示因为请求存在冲突无法处理。如通过手机号码提供注册功能的 `API`，当用户提交的手机号已存在时，`必须` 返回此状态码。\n\n```http\nHTTP/1.1 409 Conflict\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:19:04 GMT\nConnection: keep-alive\n\n{\"error_code\":40900,\"message\":\"手机号已存在\"}\n```\n\n### 410 Gone\n\n和 `404` 类似，该状态码也表示请求的资源不存在，只是 `410` 状态码进一步表示所请求的资源已不存在，并且未来也不会存在。在收到 `410` 状态码后，客户端 `应该` 停止再次请求该资源。\n\n### 413 Request Entity Too Large\n\n该状态码表示服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。\n\n> 此种情况下，服务器可以关闭连接以免客户端继续发送此请求。\n\n如果这个状况是临时的，服务器 `应该` 返回一个 `Retry-After` 的响应头，以告知客户端可以在多少时间以后重新尝试。\n\n### 414 Request-URI Too Long\n\n该状态码表示请求的 `URI` 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。\n\n### 415 Unsupported Media Type\n\n通常表示服务器不支持客户端请求首部 `Content-Type` 指定的数据格式。如在只接受 `JSON` 格式的 `API` 中放入 `XML` 类型的数据并向服务器发送，都 `应该` 返回该状态码。\n\n该状态码也可用于如：只允许上传图片格式的文件，但是客户端提交媒体文件非法或不是图片类型，这时 `应该` 返回该状态码：\n\n```http\nHTTP/1.1 415 Unsupported Media Type\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:09:40 GMT\nConnection: keep-alive\n\n{\"error_code\":41500,\"message\":\"不允许上传的图片格式\"}\n```\n\n### 429 Too Many Requests\n\n该状态码表示用户请求次数超过允许范围。如 `API` 设定为 `60次/分钟`，当用户在一分钟内请求次数超过 60 次后，都 `应该` 返回该状态码。并且也 `应该` 在响应首部中加上下列头部：\n\n```http\nX-RateLimit-Limit: 10 请求速率（由应用设定，其单位一般为小时/分钟等，这里是 10次/5分钟）\nX-RateLimit-Remaining: 0 当前剩余的请求数量\nX-RateLimit-Reset: 1529839462 重置时间\nRetry-After: 120 下一次访问应该等待的时间（秒）\n```\n\n列子\n\n```http\nHTTP/1.1 429 Too Many Requests\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nX-RateLimit-Limit: 10\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1529839462\nRetry-After: 290\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 11:19:32 GMT\nConnection: keep-alive\n\n{\"message\":\"You have exceeded your rate limit.\",\"error_code\":42900}\n```\n\n`必须` 为所有的 API 设置 Rate Limit 支持。\n\n### 500 Internal Server Error\n\n该状态码 `必须` 在服务器出错时抛出，对于所有的 `500` 错误，都 `应该` 提供完整的错误信息支持，也方便跟踪调试。\n\n### 503 Service Unavailable\n\n该状态码表示服务器暂时处理不可用状态，当服务器需要维护或第三方 `API` 请求超时/不可达时，都 `应该` 返回该状态码，其中若是主动关闭 API 服务，`应该 `在返回的响应首部加上 `Retry-After` 头部，表示多少秒后可以再次访问。\n\n```http\nHTTP/1.1 503 Service Unavailable\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:56:20 GMT\nRetry-After: 60\nConnection: keep-alive\n\n{\"error_code\":50300,\"message\":\"服务维护中\"}\n```\n\n其他 `HTTP` 状态码请参考 [HTTP 状态码- 维基百科](https://zh.wikipedia.org/zh-hans/HTTP状态码)。\n","source":"_posts/RESETful API 设计规范.md","raw":"---\ncategories:\n- 技术\ntags:\n- 后端\n---\n\n# RESETful API 设计规范\n\n[TOC]\n\n\n>文章参考了目前比较常见的 `RESETful API` 设计，文档不一定十分完善，如果遗漏或者不准确，请包涵和提出意见。\n\n## 关于「能愿动词」的使用\n\n为了避免歧义，文档大量使用了「能愿动词」，对应的解释如下：\n\n- `必须 (MUST)`：绝对，严格遵循，请照做，无条件遵守；\n- `一定不可 (MUST NOT)`：禁令，严令禁止；\n- `应该 (SHOULD)` ：强烈建议这样做，但是不强求；\n- `不该 (SHOULD NOT)`：强烈不建议这样做，但是不强求；\n- `可以 (MAY)` 和 `可选 (OPTIONAL)` ：选择性高一点，在这个文档内，此词语使用较少；\n\n参考 [RFC](https://www.ietf.org/rfc/rfc2119.txt) 文档\n\n> ```\n> Status of this Memo\n>\n>    This document specifies an Internet Best Current Practices for the\n>    Internet Community, and requests discussion and suggestions for\n>    improvements.  Distribution of this memo is unlimited.\n>\n> Abstract\n>\n>    In many standards track documents several words are used to signify\n>    the requirements in the specification.  These words are often\n>    capitalized.  This document defines these words as they should be\n>    interpreted in IETF documents.  Authors who follow these guidelines\n>    should incorporate this phrase near the beginning of their document:\n>\n>       The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL\n>       NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\",  \"MAY\", and\n>       \"OPTIONAL\" in this document are to be interpreted as described in\n>       RFC 2119.\n>\n>    Note that the force of these words is modified by the requirement\n>    level of the document in which they are used.\n>\n> 1. MUST   This word, or the terms \"REQUIRED\" or \"SHALL\", mean that the\n>    definition is an absolute requirement of the specification.\n>\n> 2. MUST NOT   This phrase, or the phrase \"SHALL NOT\", mean that the\n>    definition is an absolute prohibition of the specification.\n>\n> 3. SHOULD   This word, or the adjective \"RECOMMENDED\", mean that there\n>    may exist valid reasons in particular circumstances to ignore a\n>    particular item, but the full implications must be understood and\n>    carefully weighed before choosing a different course.\n>\n> 4. SHOULD NOT   This phrase, or the phrase \"NOT RECOMMENDED\" mean that\n>    there may exist valid reasons in particular circumstances when the\n>    particular behavior is acceptable or even useful, but the full\n>    implications should be understood and the case carefully weighed\n>    before implementing any behavior described with this label.\n> ```\n\n## Protocol\n\n客户端在通过 `API` 与后端服务通信的过程中，`应该` 使用 `HTTPS` 协议。\n\n## API Root URL\n\n`API` 的根入口点应尽可能保持足够简单，这里有两个常见的 `URL` 根例子：\n\n- api.example.com/*\n- example.com/api/*\n\n> 如果你的应用很庞大或者你预计它将会变的很庞大，那 `应该` 将 `API` 放到子域下（`api.example.com`）。这种做法可以保持某些规模化上的灵活性。\n\n## Versioning\n\n所有的 `API` 必须保持向后兼容，你 `必须` 在引入新版本 `API` 的同时确保旧版本 `API` 仍然可用。所以 `应该` 为其提供版本支持。\n\n目前比较常见的两种版本号形式：\n\n### 在 URL 中嵌入版本编号\n\n```\napi.example.com/v1/*\n```\n\n这种做法是版本号直观、易于调试；另一种做法是，将版本号放在 `HTTP Header` 头中：\n\n### 通过媒体类型来指定版本信息\n\n```\nAccept: application/vnd.example.com.v1+json\n```\n\n其中 `vnd` 表示 `Standards Tree` 标准树类型，有三个不同的树: `x`，`prs` 和 `vnd`。你使用的标准树需要取决于你开发的项目\n\n- 未注册的树（`x`）主要表示本地和私有环境\n- 私有树（`prs`）主要表示没有商业发布的项目\n- 供应商树（`vnd`）主要表示公开发布的项目\n\n> 后面几个参数依次为应用名称（一般为应用域名）、版本号、期望的返回格式。\n\n至于具体把版本号放在什么地方，这个问题一直存在很大的争议，但由于我们大多数时间都在使用 `Laravel` 开发，`应该` 使用 [dingo/api](https://github.com/dingo/api) 来快速构建应用，它采用第二种方式来管理 `API` 版本，并且已集成了标准的 `HTTP Response`。\n\n## Endpoints\n\n端点就是指向特定资源或资源集合的 `URL`。在端点的设计中，你 `必须` 遵守下列约定：\n\n- URL 的命名 `必须` 全部小写\n- URL 中资源（`resource`）的命名 `必须` 是名词，并且 `必须` 是复数形式\n- `必须` 优先使用 `Restful` 类型的 URL\n- URL `必须` 是易读的\n- URL `一定不可` 暴露服务器架构\n\n> 至于 URL 是否必须使用连字符（`-`） 或下划线（`_`），不做硬性规定，但 `必须` 根据团队情况统一一种风格。\n\n来看一个反例\n\n- https://api.example.com/getUserInfo?userid=1\n- https://api.example.com/getusers\n- https://api.example.com/sv/u\n- https://api.example.com/cgi-bin/users/get_user.php?userid=1\n\n再来看一个正列\n\n- https://api.example.com/zoos\n\n- https://api.example.com/animals\n\n- https://api.example.com/zoos/{zoo}/animals\n\n- https://api.example.com/animal_types\n\n- https://api.example.com/employees\n\n## HTTP 动词\n\n对于资源的具体操作类型，由 `HTTP` 动词表示。常用的 `HTTP` 动词有下面五个（括号里是对应的 `SQL` 命令）。\n\n- GET（SELECT）：从服务器取出资源（一项或多项）。\n- POST（CREATE）：在服务器新建一个资源。\n- PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。\n- PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。\n- DELETE（DELETE）：从服务器删除资源。\n\n其中\n\n1 删除资源 `必须` 用 `DELETE` 方法 2 创建新的资源 `必须` 使用 `POST` 方法 3 更新资源 `应该` 使用 `PUT` 方法 4 获取资源信息 `必须` 使用 `GET` 方法\n\n针对每一个端点来说，下面列出所有可行的 `HTTP` 动词和端点的组合\n\n| 请求方法 | URL                              | 描述                                             |\n| -------- | -------------------------------- | ------------------------------------------------ |\n| GET      | /zoos/list                       | 列出所有的动物园(ID和名称，不要太详细)           |\n| POST     | /zoos/update                     | 新增一个新的动物园                               |\n| GET      | /zoos/detail?id=1                | 获取指定动物园详情                               |\n| PUT      | /zoos/{zoo}                      | 更新指定动物园(整个对象)                         |\n| PATCH    | /zoos/{zoo}                      | 更新动物园(部分对象)                             |\n| DELETE   | /zoos/{zoo}                      | 删除指定动物园                                   |\n| GET      | /zoos/{zoo}/animals              | 检索指定动物园下的动物列表(ID和名称，不要太详细) |\n| GET      | /animals                         | 列出所有动物(ID和名称)。                         |\n| POST     | /animals                         | 新增新的动物                                     |\n| GET      | /animals/detail                  | 获取指定的动物详情                               |\n| PUT      | /animals/{animal}                | 更新指定的动物(整个对象)                         |\n| PATCH    | /animals/{animal}                | 更新指定的动物(部分对象)                         |\n| GET      | /animal_types                    | 获取所有动物类型(ID和名称，不要太详细)           |\n| GET      | /animal_types/{type}             | 获取指定的动物类型详情                           |\n| GET      | /employees                       | 检索整个雇员列表                                 |\n| GET      | /employees/{employee}            | 检索指定特定的员工                               |\n| GET      | /zoos/employees/list             | 检索在这个动物园工作的雇员的名单(身份证和姓名)   |\n| POST     | /employees                       | 新增指定新员工                                   |\n| POST     | /zoos/{zoo}/employees            | 在特定的动物园雇佣一名员工                       |\n| DELETE   | /zoos/{zoo}/employees/{employee} | 从某个动物园解雇一名员工                         |\n\n> 超出 `Restful` 端点的，`应该` 模仿上表的方式来定义端点。\n\n## Filtering\n\n> 如果记录数量很多，服务器不可能都将它们返回给用户。API `应该` 提供参数，过滤返回结果。下面是一些常见的参数。\n\n- ?limit=10：指定返回记录的数量\n- ?offset=10：指定返回记录的开始位置。\n- ?page=2&rows0：指定第几页，以及每页的记录数。\n- ?order_by=me&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。\n- ?animal_type_id=1：指定筛选条件\n\n所有 `URL` 参数 `必须` 是全小写，`必须` 使用下划线类型的参数形式。\n\n> 分页参数 `必须` 固定为 `page`、`rows`\n\n经常使用的、复杂的查询 `应该` 标签化，降低维护成本。如\n\n```http\nGET /trades?status=closed&order_by=name&order=asc\n\n# 可为其定制快捷方式\nGET /trades/recently_closed\n```\n\n## Authentication\n\n`应该` 使用 `OAuth2.0` 的方式为 API 调用者提供登录认证。`必须` 先通过登录接口获取 `Access Token` 后再通过该 `token` 调用需要身份认证的 `API`。\n\nOauth 的端点设计示列\n\n- RFC 6749 /token\n- Twitter /oauth2/token\n- Fackbook /oauth/access_token\n- Google /o/oauth2/token\n- Github /login/oauth/access_token\n- Instagram /oauth/authorize\n\n客户端在获得 `access token` 的同时 `必须` 在响应中包含一个名为 `expires_in` 的数据，它表示当前获得的 `token` 会在多少 `秒` 后失效。\n\n```json\n{\n    \"access_token\": \"token....\",\n    \"token_type\": \"Bearer\",\n    \"expires_in\": 3600\n}\n```\n\n客户端在请求需要认证的 `API` 时，`必须` 在请求头 `Authorization` 中带上 `access_token`。\n\n```\nAuthorization: Bearer token...\n```\n\n当超过指定的秒数后，`access token` 就会过期，再次用过期/或无效的 `token` 访问时，服务端 `应该` 返回 `invalid_token` 的错误或 `401` 错误码。\n\n```http\nHTTP/1.1 401 Unauthorized\nContent-Type: application/json\nCache-Control: no-store\nPragma: no-cache\n\n{\n    \"error\": \"invalid_token\"\n}\n```\n\n>  开发中，`应该` 使用 [JWT](https://github.com/tymondesigns/jwt-auth) 来为管理你的 Token，并且 `一定不可` 在 `api` 中间件中开启请求 `session`。\n\n## Response\n\n所有的 `API` 响应，`必须` 遵守 `HTTP` 设计规范，`必须` 选择合适的 `HTTP` 状态码。`一定不可` 所有接口都返回状态码为 `200` 的 `HTTP` 响应，如：\n\n```\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"code\": 0,\n    \"msg\": \"success\",\n    \"data\": {\n        \"username\": \"username\"\n    }\n}\n```\n\n或\n\n```http\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"code\": -1,\n    \"msg\": \"该活动不存在\",\n}\n```\n\n下表列举了常见的 `HTTP` 状态码\n\n| 状态码 | 描述                                                 |\n| ------ | ---------------------------------------------------- |\n| 1xx    | 代表请求已被接受，需要继续处理                       |\n| 2xx    | 请求已成功，请求所希望的响应头或数据体将随此响应返回 |\n| 3xx    | 重定向                                               |\n| 4xx    | 客户端原因引起的错误                                 |\n| 5xx    | 服务端原因引起的错误                                 |\n\n> 只有来自客户端的请求被正确的处理后才能返回 `2xx` 的响应，所以当 API 返回 `2xx` 类型的状态码时，前端 `必须` 认定该请求已处理成功\n\n必须强调的是，所有 `API` `一定不可` 返回 `1xx` 类型的状态码。当 `API` 发生错误时，`必须` 返回出错时的详细信息。目前常见返回错误信息的方法有两种：\n\n1、将错误详细放入 `HTTP` 响应首部；\n\n```http\nX-MYNAME-ERROR-CODE: 4001\nX-MYNAME-ERROR-MESSAGE: Bad authentication token\nX-MYNAME-ERROR-INFO: http://docs.example.com/api/v1/authentication\n```\n\n2、直接放入响应实体中；\n\n```\nHTTP/1.1 401 Unauthorized\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:02:59 GMT\nConnection: keep-alive\n\n{\"error_code\":40100,\"message\":\"Unauthorized\"}\n```\n\n考虑到易读性和客户端的易处理性，我们 `必须` 把错误信息直接放到响应实体中，并且错误格式 `应该` 满足如下格式：\n\n```json\n{\n    \"message\": \"您查找的资源不存在\",\n    \"error_code\": 404001\n}\n```\n\n其中错误码（`error_code`）`必须` 和 `HTTP` 状态码对应，也方便错误码归类，如：\n\n```http\nHTTP/1.1 429 Too Many Requests\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:15:52 GMT\nConnection: keep-alive\n\n{\"error_code\":429001,\"message\":\"你操作太频繁了\"}\n```\n\n`应该` 在返回的错误信息中，同时包含面向开发者和面向用户的提示信息，前者可方便开发人员调试，后者可直接展示给终端用户查看如：\n\n```\n{\n    \"message\": \"直接展示给终端用户的错误信息\",\n    \"error_code\": \"业务错误码\",\n    \"error\": \"供开发者查看的错误信息\",\n    \"debug\": [\n        \"错误堆栈，必须开启 debug 才存在\"\n    ]\n}\n```\n\n下面详细列举了各种情况 API 的返回说明。\n\n### 200 ok\n\n`200` 状态码是最常见的 `HTTP` 状态码，在所有 **成功** 的 `GET` 请求中，`必须` 返回此状态码。`HTTP` 响应实体部分 `必须` 直接就是数据，不要做多余的包装。\n\n错误示例：\n\n```http\nHTTP/1.1 200 ok\nContent-Type: application/json\nServer: example.com\n\n{\n    \"user\": {\n        \"id\":1,\n        \"nickname\":\"fwest\",\n        \"username\": \"example\"\n    }\n}\n```\n\n正确示例：\n\n1、获取单个资源详情\n\n```json\n{\n    \"id\": 1,\n    \"username\": \"godruoyi\",\n    \"age\": 88,\n}\n```\n\n2、获取资源集合\n\n```json\n[\n    {\n        \"id\": 1,\n        \"username\": \"godruoyi\",\n        \"age\": 88,\n    },\n    {\n        \"id\": 2,\n        \"username\": \"foo\",\n        \"age\": 88,\n    }\n]\n```\n\n3、额外的媒体信息\n\n```json\n{\n    \"data\": [\n        {\n            \"id\": 1,\n            \"avatar\": \"https://lorempixel.com/640/480/?32556\",\n            \"nickname\": \"fwest\",\n            \"last_logined_time\": \"2018-05-29 04:56:43\",\n            \"has_registed\": true\n        },\n        {\n            \"id\": 2,\n            \"avatar\": \"https://lorempixel.com/640/480/?86144\",\n            \"nickname\": \"zschowalter\",\n            \"last_logined_time\": \"2018-06-16 15:18:34\",\n            \"has_registed\": true\n        }\n    ],\n    \"meta\": {\n        \"pagination\": {\n            \"total\": 101,\n            \"count\": 2,\n            \"per_page\": 2,\n            \"current_page\": 1,\n            \"total_pages\": 51,\n            \"links\": {\n                \"next\": \"http://api.example.com?page=2\"\n            }\n        }\n    }\n}\n```\n\n> 其中，分页和其他额外的媒体信息，必须放到 `meta` 字段中。\n\n### 201 Created\n\n当服务器创建数据成功时，`应该` 返回此状态码。常见的应用场景是使用 `POST` 提交用户信息，如：\n\n- 添加了新用户\n- 上传了图片\n- 创建了新活动\n\n等，都可以返回 `201` 状态码。需要注意的是，你可以选择在用户创建成功后返回新用户的数据\n\n```http\nHTTP/1.1 201 Created\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:13:40 GMT\nConnection: keep-alive\n\n{\n    \"id\": 1,\n    \"avatar\": \"https:\\/\\/lorempixel.com\\/640\\/480\\/?32556\",\n    \"nickname\": \"fwest\",\n    \"last_logined_time\": \"2018-05-29 04:56:43\",\n    \"created_at\": \"2018-06-16 17:55:55\",\n    \"updated_at\": \"2018-06-16 17:55:55\"\n}\n```\n\n也可以返回一个响应实体为空的 `HTTP Response` 如：\n\n```http\nHTTP/1.1 201 Created\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:12:20 GMT\nConnection: keep-alive\n```\n\n> 这里我们 `应该` 采用第二种方式，因为大多数情况下，客户端只需要知道该请求操作成功与否，并不需要返回新资源的信息。\n\n### 202 Accepted\n\n该状态码表示服务器已经接受到了来自客户端的请求，但还未开始处理。常用短信发送、邮件通知、模板消息推送等这类很耗时需要队列支持的场景中；\n\n> 返回该状态码时，响应实体 `必须` 为空。\n\n```http\nHTTP/1.1 202 Accepted\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:25:15 GMT\nConnection: keep-alive\n```\n\n### 204 No Content\n\n该状态码表示响应实体不包含任何数据，其中：\n\n- 在使用 `DELETE` 方法删除资源 **成功** 时，`必须` 返回该状态码\n- 使用 `PUT`、`PATCH` 方法更新数据 **成功** 时，也 `应该` 返回此状态码\n\n```http\nHTTP/1.1 204 No Content\nServer: nginx/1.11.9\nDate: Sun, 24 Jun 2018 09:29:12 GMT\nConnection: keep-alive\n```\n\n### 3xx 重定向\n\n所有 `API` `不该` 返回 `3xx` 类型的状态码。因为 `3xx` 类型的响应格式一般为下列格式：\n\n```http\nHTTP/1.1 302 Found\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 09:41:50 GMT\nLocation: https://example.com\nConnection: keep-alive\n\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\" />\n        <meta http-equiv=\"refresh\" content=\"0;url=https://example.com\" />\n\n        <title>Redirecting to https://example.com</title>\n    </head>\n    <body>\n        Redirecting to <a href=\"https://example.com\">https://example.com</a>.\n    </body>\n</html>\n```\n\n所有 `API` `一定不可` 返回纯 `HTML` 结构的响应；若一定要使用重定向功能，`可以` 返回一个响应实体为空的 `3xx` 响应，并在响应头中加上 `Location` 字段:\n\n```http\nHTTP/1.1 302 Found\nServer: nginx/1.11.9\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nDate: Sun, 24 Jun 2018 09:52:50 GMT\nLocation: https://godruoyi.com\nConnection: keep-alive\n```\n\n### 400 Bad Request\n\n由于明显的客户端错误（例如，请求语法格式错误、无效的请求、无效的签名等），服务器 `应该` 放弃该请求。\n\n> 当服务器无法从其他 4xx 类型的状态码中找出合适的来表示错误类型时，都 `必须` 返回该状态码。\n\n```http\nHTTP/1.1 400 Bad Request\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:22:36 GMT\nConnection: keep-alive\n\n{\"error_code\":40000,\"message\":\"无效的签名\"}\n```\n\n### 401 Unauthorized\n\n该状态码表示当前请求需要身份认证，以下情况都 `必须` 返回该状态码。\n\n- 未认证用户访问需要认证的 API\n- access_token 无效/过期\n\n> 客户端在收到 `401` 响应后，都 `应该` 提示用户进行下一步的登录操作。\n\n```http\nHTTP/1.1 401 Unauthorized\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nWWW-Authenticate: JWTAuth\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:17:02 GMT\nConnection: keep-alive\n\n{\"message\":\"Token Signature could not be verified.\",\"error_code\": \"40100\"}\n```\n\n### 403 Forbidden\n\n该状态码可以简单的理解为没有权限访问该请求，服务器收到请求但拒绝提供服务。\n\n如当普通用户请求操作管理员用户时，`必须` 返回该状态码。\n\n```http\nHTTP/1.1 403 Forbidden\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 13:05:34 GMT\nConnection: keep-alive\n\n{\"error_code\":40301,\"message\":\"权限不足\"}\n```\n\n### 404 Not Found\n\n该状态码表示用户请求的资源不存在，如\n\n- 获取不存在的用户信息 （get /users/9999999）\n- 访问不存在的端点\n\n都 `必须` 返回该状态码，若该资源已永久不存在，则 `应该` 返回 `410` 响应。\n\n### 405 Method Not Allowed\n\n当客户端使用的 `HTTP` 请求方法不被服务器允许时，`必须` 返回该状态码。\n\n> 如客户端调用了 `POST` 方法来访问只支持 GET 方法的 API\n\n该响应 `必须` 返回一个 `Allow` 头信息用以表示出当前资源能够接受的请求方法的列表。\n\n```http\nHTTP/1.1 405 Method Not Allowed\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nAllow: GET, HEAD\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:30:57 GMT\nConnection: keep-alive\n\n{\"message\":\"405 Method Not Allowed\",\"error_code\": 40500}\n```\n\n### 406 Not Acceptable\n\n`API` 在不支持客户端指定的数据格式时，应该返回此状态码。如支持 `JSON` 和 `XML` 输出的 `API` 被指定返回 `YAML` 格式的数据时。\n\n> Http 协议一般通过请求首部的 Accept 来指定数据格式\n\n### 408 Request Timeout\n\n客户端请求超时时 `必须` 返回该状态码，需要注意的时，该状态码表示 **客户端请求超时**，在涉及第三方 `API` 调用超时时，`一定不可` 返回该状态码。\n\n### 409 Confilct\n\n该状态码表示因为请求存在冲突无法处理。如通过手机号码提供注册功能的 `API`，当用户提交的手机号已存在时，`必须` 返回此状态码。\n\n```http\nHTTP/1.1 409 Conflict\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:19:04 GMT\nConnection: keep-alive\n\n{\"error_code\":40900,\"message\":\"手机号已存在\"}\n```\n\n### 410 Gone\n\n和 `404` 类似，该状态码也表示请求的资源不存在，只是 `410` 状态码进一步表示所请求的资源已不存在，并且未来也不会存在。在收到 `410` 状态码后，客户端 `应该` 停止再次请求该资源。\n\n### 413 Request Entity Too Large\n\n该状态码表示服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。\n\n> 此种情况下，服务器可以关闭连接以免客户端继续发送此请求。\n\n如果这个状况是临时的，服务器 `应该` 返回一个 `Retry-After` 的响应头，以告知客户端可以在多少时间以后重新尝试。\n\n### 414 Request-URI Too Long\n\n该状态码表示请求的 `URI` 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。\n\n### 415 Unsupported Media Type\n\n通常表示服务器不支持客户端请求首部 `Content-Type` 指定的数据格式。如在只接受 `JSON` 格式的 `API` 中放入 `XML` 类型的数据并向服务器发送，都 `应该` 返回该状态码。\n\n该状态码也可用于如：只允许上传图片格式的文件，但是客户端提交媒体文件非法或不是图片类型，这时 `应该` 返回该状态码：\n\n```http\nHTTP/1.1 415 Unsupported Media Type\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 12:09:40 GMT\nConnection: keep-alive\n\n{\"error_code\":41500,\"message\":\"不允许上传的图片格式\"}\n```\n\n### 429 Too Many Requests\n\n该状态码表示用户请求次数超过允许范围。如 `API` 设定为 `60次/分钟`，当用户在一分钟内请求次数超过 60 次后，都 `应该` 返回该状态码。并且也 `应该` 在响应首部中加上下列头部：\n\n```http\nX-RateLimit-Limit: 10 请求速率（由应用设定，其单位一般为小时/分钟等，这里是 10次/5分钟）\nX-RateLimit-Remaining: 0 当前剩余的请求数量\nX-RateLimit-Reset: 1529839462 重置时间\nRetry-After: 120 下一次访问应该等待的时间（秒）\n```\n\n列子\n\n```http\nHTTP/1.1 429 Too Many Requests\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nX-RateLimit-Limit: 10\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1529839462\nRetry-After: 290\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 11:19:32 GMT\nConnection: keep-alive\n\n{\"message\":\"You have exceeded your rate limit.\",\"error_code\":42900}\n```\n\n`必须` 为所有的 API 设置 Rate Limit 支持。\n\n### 500 Internal Server Error\n\n该状态码 `必须` 在服务器出错时抛出，对于所有的 `500` 错误，都 `应该` 提供完整的错误信息支持，也方便跟踪调试。\n\n### 503 Service Unavailable\n\n该状态码表示服务器暂时处理不可用状态，当服务器需要维护或第三方 `API` 请求超时/不可达时，都 `应该` 返回该状态码，其中若是主动关闭 API 服务，`应该 `在返回的响应首部加上 `Retry-After` 头部，表示多少秒后可以再次访问。\n\n```http\nHTTP/1.1 503 Service Unavailable\nServer: nginx/1.11.9\nContent-Type: application/json\nTransfer-Encoding: chunked\nCache-Control: no-cache, private\nDate: Sun, 24 Jun 2018 10:56:20 GMT\nRetry-After: 60\nConnection: keep-alive\n\n{\"error_code\":50300,\"message\":\"服务维护中\"}\n```\n\n其他 `HTTP` 状态码请参考 [HTTP 状态码- 维基百科](https://zh.wikipedia.org/zh-hans/HTTP状态码)。\n","slug":"RESETful API 设计规范","published":1,"date":"2020-03-04T23:38:32.732Z","updated":"2020-03-05T00:31:53.064Z","title":"RESETful API 设计规范","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7e0nvti0007ntcy72nvfbxg","content":"<h1 id=\"RESETful-API-设计规范\"><a href=\"#RESETful-API-设计规范\" class=\"headerlink\" title=\"RESETful API 设计规范\"></a>RESETful API 设计规范</h1><p>[TOC]</p>\n<blockquote>\n<p>文章参考了目前比较常见的 <code>RESETful API</code> 设计，文档不一定十分完善，如果遗漏或者不准确，请包涵和提出意见。</p>\n</blockquote>\n<h2 id=\"关于「能愿动词」的使用\"><a href=\"#关于「能愿动词」的使用\" class=\"headerlink\" title=\"关于「能愿动词」的使用\"></a>关于「能愿动词」的使用</h2><p>为了避免歧义，文档大量使用了「能愿动词」，对应的解释如下：</p>\n<ul>\n<li><code>必须 (MUST)</code>：绝对，严格遵循，请照做，无条件遵守；</li>\n<li><code>一定不可 (MUST NOT)</code>：禁令，严令禁止；</li>\n<li><code>应该 (SHOULD)</code> ：强烈建议这样做，但是不强求；</li>\n<li><code>不该 (SHOULD NOT)</code>：强烈不建议这样做，但是不强求；</li>\n<li><code>可以 (MAY)</code> 和 <code>可选 (OPTIONAL)</code> ：选择性高一点，在这个文档内，此词语使用较少；</li>\n</ul>\n<p>参考 <a href=\"https://www.ietf.org/rfc/rfc2119.txt\" target=\"_blank\" rel=\"noopener\">RFC</a> 文档</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Status of this Memo</span><br><span class=\"line\"></span><br><span class=\"line\">   This document specifies an Internet Best Current Practices for the</span><br><span class=\"line\">   Internet Community, and requests discussion and suggestions for</span><br><span class=\"line\">   improvements.  Distribution of this memo is unlimited.</span><br><span class=\"line\"></span><br><span class=\"line\">Abstract</span><br><span class=\"line\"></span><br><span class=\"line\">   In many standards track documents several words are used to signify</span><br><span class=\"line\">   the requirements in the specification.  These words are often</span><br><span class=\"line\">   capitalized.  This document defines these words as they should be</span><br><span class=\"line\">   interpreted in IETF documents.  Authors who follow these guidelines</span><br><span class=\"line\">   should incorporate this phrase near the beginning of their document:</span><br><span class=\"line\"></span><br><span class=\"line\">      The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL</span><br><span class=\"line\">      NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,  &quot;MAY&quot;, and</span><br><span class=\"line\">      &quot;OPTIONAL&quot; in this document are to be interpreted as described in</span><br><span class=\"line\">      RFC 2119.</span><br><span class=\"line\"></span><br><span class=\"line\">   Note that the force of these words is modified by the requirement</span><br><span class=\"line\">   level of the document in which they are used.</span><br><span class=\"line\"></span><br><span class=\"line\">1. MUST   This word, or the terms &quot;REQUIRED&quot; or &quot;SHALL&quot;, mean that the</span><br><span class=\"line\">   definition is an absolute requirement of the specification.</span><br><span class=\"line\"></span><br><span class=\"line\">2. MUST NOT   This phrase, or the phrase &quot;SHALL NOT&quot;, mean that the</span><br><span class=\"line\">   definition is an absolute prohibition of the specification.</span><br><span class=\"line\"></span><br><span class=\"line\">3. SHOULD   This word, or the adjective &quot;RECOMMENDED&quot;, mean that there</span><br><span class=\"line\">   may exist valid reasons in particular circumstances to ignore a</span><br><span class=\"line\">   particular item, but the full implications must be understood and</span><br><span class=\"line\">   carefully weighed before choosing a different course.</span><br><span class=\"line\"></span><br><span class=\"line\">4. SHOULD NOT   This phrase, or the phrase &quot;NOT RECOMMENDED&quot; mean that</span><br><span class=\"line\">   there may exist valid reasons in particular circumstances when the</span><br><span class=\"line\">   particular behavior is acceptable or even useful, but the full</span><br><span class=\"line\">   implications should be understood and the case carefully weighed</span><br><span class=\"line\">   before implementing any behavior described with this label.</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h2 id=\"Protocol\"><a href=\"#Protocol\" class=\"headerlink\" title=\"Protocol\"></a>Protocol</h2><p>客户端在通过 <code>API</code> 与后端服务通信的过程中，<code>应该</code> 使用 <code>HTTPS</code> 协议。</p>\n<h2 id=\"API-Root-URL\"><a href=\"#API-Root-URL\" class=\"headerlink\" title=\"API Root URL\"></a>API Root URL</h2><p><code>API</code> 的根入口点应尽可能保持足够简单，这里有两个常见的 <code>URL</code> 根例子：</p>\n<ul>\n<li>api.example.com/*</li>\n<li>example.com/api/*</li>\n</ul>\n<blockquote>\n<p>如果你的应用很庞大或者你预计它将会变的很庞大，那 <code>应该</code> 将 <code>API</code> 放到子域下（<code>api.example.com</code>）。这种做法可以保持某些规模化上的灵活性。</p>\n</blockquote>\n<h2 id=\"Versioning\"><a href=\"#Versioning\" class=\"headerlink\" title=\"Versioning\"></a>Versioning</h2><p>所有的 <code>API</code> 必须保持向后兼容，你 <code>必须</code> 在引入新版本 <code>API</code> 的同时确保旧版本 <code>API</code> 仍然可用。所以 <code>应该</code> 为其提供版本支持。</p>\n<p>目前比较常见的两种版本号形式：</p>\n<h3 id=\"在-URL-中嵌入版本编号\"><a href=\"#在-URL-中嵌入版本编号\" class=\"headerlink\" title=\"在 URL 中嵌入版本编号\"></a>在 URL 中嵌入版本编号</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api.example.com&#x2F;v1&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>这种做法是版本号直观、易于调试；另一种做法是，将版本号放在 <code>HTTP Header</code> 头中：</p>\n<h3 id=\"通过媒体类型来指定版本信息\"><a href=\"#通过媒体类型来指定版本信息\" class=\"headerlink\" title=\"通过媒体类型来指定版本信息\"></a>通过媒体类型来指定版本信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Accept: application&#x2F;vnd.example.com.v1+json</span><br></pre></td></tr></table></figure>\n\n<p>其中 <code>vnd</code> 表示 <code>Standards Tree</code> 标准树类型，有三个不同的树: <code>x</code>，<code>prs</code> 和 <code>vnd</code>。你使用的标准树需要取决于你开发的项目</p>\n<ul>\n<li>未注册的树（<code>x</code>）主要表示本地和私有环境</li>\n<li>私有树（<code>prs</code>）主要表示没有商业发布的项目</li>\n<li>供应商树（<code>vnd</code>）主要表示公开发布的项目</li>\n</ul>\n<blockquote>\n<p>后面几个参数依次为应用名称（一般为应用域名）、版本号、期望的返回格式。</p>\n</blockquote>\n<p>至于具体把版本号放在什么地方，这个问题一直存在很大的争议，但由于我们大多数时间都在使用 <code>Laravel</code> 开发，<code>应该</code> 使用 <a href=\"https://github.com/dingo/api\" target=\"_blank\" rel=\"noopener\">dingo/api</a> 来快速构建应用，它采用第二种方式来管理 <code>API</code> 版本，并且已集成了标准的 <code>HTTP Response</code>。</p>\n<h2 id=\"Endpoints\"><a href=\"#Endpoints\" class=\"headerlink\" title=\"Endpoints\"></a>Endpoints</h2><p>端点就是指向特定资源或资源集合的 <code>URL</code>。在端点的设计中，你 <code>必须</code> 遵守下列约定：</p>\n<ul>\n<li>URL 的命名 <code>必须</code> 全部小写</li>\n<li>URL 中资源（<code>resource</code>）的命名 <code>必须</code> 是名词，并且 <code>必须</code> 是复数形式</li>\n<li><code>必须</code> 优先使用 <code>Restful</code> 类型的 URL</li>\n<li>URL <code>必须</code> 是易读的</li>\n<li>URL <code>一定不可</code> 暴露服务器架构</li>\n</ul>\n<blockquote>\n<p>至于 URL 是否必须使用连字符（<code>-</code>） 或下划线（<code>_</code>），不做硬性规定，但 <code>必须</code> 根据团队情况统一一种风格。</p>\n</blockquote>\n<p>来看一个反例</p>\n<ul>\n<li><a href=\"https://api.example.com/getUserInfo?userid=1\" target=\"_blank\" rel=\"noopener\">https://api.example.com/getUserInfo?userid=1</a></li>\n<li><a href=\"https://api.example.com/getusers\" target=\"_blank\" rel=\"noopener\">https://api.example.com/getusers</a></li>\n<li><a href=\"https://api.example.com/sv/u\" target=\"_blank\" rel=\"noopener\">https://api.example.com/sv/u</a></li>\n<li><a href=\"https://api.example.com/cgi-bin/users/get_user.php?userid=1\" target=\"_blank\" rel=\"noopener\">https://api.example.com/cgi-bin/users/get_user.php?userid=1</a></li>\n</ul>\n<p>再来看一个正列</p>\n<ul>\n<li><p><a href=\"https://api.example.com/zoos\" target=\"_blank\" rel=\"noopener\">https://api.example.com/zoos</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/animals\" target=\"_blank\" rel=\"noopener\">https://api.example.com/animals</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/zoos/{zoo}/animals\" target=\"_blank\" rel=\"noopener\">https://api.example.com/zoos/{zoo}/animals</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/animal_types\" target=\"_blank\" rel=\"noopener\">https://api.example.com/animal_types</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/employees\" target=\"_blank\" rel=\"noopener\">https://api.example.com/employees</a></p>\n</li>\n</ul>\n<h2 id=\"HTTP-动词\"><a href=\"#HTTP-动词\" class=\"headerlink\" title=\"HTTP 动词\"></a>HTTP 动词</h2><p>对于资源的具体操作类型，由 <code>HTTP</code> 动词表示。常用的 <code>HTTP</code> 动词有下面五个（括号里是对应的 <code>SQL</code> 命令）。</p>\n<ul>\n<li>GET（SELECT）：从服务器取出资源（一项或多项）。</li>\n<li>POST（CREATE）：在服务器新建一个资源。</li>\n<li>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</li>\n<li>PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</li>\n<li>DELETE（DELETE）：从服务器删除资源。</li>\n</ul>\n<p>其中</p>\n<p>1 删除资源 <code>必须</code> 用 <code>DELETE</code> 方法 2 创建新的资源 <code>必须</code> 使用 <code>POST</code> 方法 3 更新资源 <code>应该</code> 使用 <code>PUT</code> 方法 4 获取资源信息 <code>必须</code> 使用 <code>GET</code> 方法</p>\n<p>针对每一个端点来说，下面列出所有可行的 <code>HTTP</code> 动词和端点的组合</p>\n<table>\n<thead>\n<tr>\n<th>请求方法</th>\n<th>URL</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>/zoos/list</td>\n<td>列出所有的动物园(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/zoos/update</td>\n<td>新增一个新的动物园</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/detail?id=1</td>\n<td>获取指定动物园详情</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/zoos/{zoo}</td>\n<td>更新指定动物园(整个对象)</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/zoos/{zoo}</td>\n<td>更新动物园(部分对象)</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/zoos/{zoo}</td>\n<td>删除指定动物园</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/{zoo}/animals</td>\n<td>检索指定动物园下的动物列表(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animals</td>\n<td>列出所有动物(ID和名称)。</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/animals</td>\n<td>新增新的动物</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animals/detail</td>\n<td>获取指定的动物详情</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/animals/{animal}</td>\n<td>更新指定的动物(整个对象)</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/animals/{animal}</td>\n<td>更新指定的动物(部分对象)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animal_types</td>\n<td>获取所有动物类型(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animal_types/{type}</td>\n<td>获取指定的动物类型详情</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/employees</td>\n<td>检索整个雇员列表</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/employees/{employee}</td>\n<td>检索指定特定的员工</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/employees/list</td>\n<td>检索在这个动物园工作的雇员的名单(身份证和姓名)</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/employees</td>\n<td>新增指定新员工</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/zoos/{zoo}/employees</td>\n<td>在特定的动物园雇佣一名员工</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/zoos/{zoo}/employees/{employee}</td>\n<td>从某个动物园解雇一名员工</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>超出 <code>Restful</code> 端点的，<code>应该</code> 模仿上表的方式来定义端点。</p>\n</blockquote>\n<h2 id=\"Filtering\"><a href=\"#Filtering\" class=\"headerlink\" title=\"Filtering\"></a>Filtering</h2><blockquote>\n<p>如果记录数量很多，服务器不可能都将它们返回给用户。API <code>应该</code> 提供参数，过滤返回结果。下面是一些常见的参数。</p>\n</blockquote>\n<ul>\n<li>?limit=10：指定返回记录的数量</li>\n<li>?offset=10：指定返回记录的开始位置。</li>\n<li>?page=2&amp;rows0：指定第几页，以及每页的记录数。</li>\n<li>?order_by=me&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。</li>\n<li>?animal_type_id=1：指定筛选条件</li>\n</ul>\n<p>所有 <code>URL</code> 参数 <code>必须</code> 是全小写，<code>必须</code> 使用下划线类型的参数形式。</p>\n<blockquote>\n<p>分页参数 <code>必须</code> 固定为 <code>page</code>、<code>rows</code></p>\n</blockquote>\n<p>经常使用的、复杂的查询 <code>应该</code> 标签化，降低维护成本。如</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /trades?status=closed&amp;order_by=name&amp;order=asc</span><br><span class=\"line\"></span><br><span class=\"line\"># 可为其定制快捷方式</span><br><span class=\"line\">GET /trades/recently_closed</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Authentication\"><a href=\"#Authentication\" class=\"headerlink\" title=\"Authentication\"></a>Authentication</h2><p><code>应该</code> 使用 <code>OAuth2.0</code> 的方式为 API 调用者提供登录认证。<code>必须</code> 先通过登录接口获取 <code>Access Token</code> 后再通过该 <code>token</code> 调用需要身份认证的 <code>API</code>。</p>\n<p>Oauth 的端点设计示列</p>\n<ul>\n<li>RFC 6749 /token</li>\n<li>Twitter /oauth2/token</li>\n<li>Fackbook /oauth/access_token</li>\n<li>Google /o/oauth2/token</li>\n<li>Github /login/oauth/access_token</li>\n<li>Instagram /oauth/authorize</li>\n</ul>\n<p>客户端在获得 <code>access token</code> 的同时 <code>必须</code> 在响应中包含一个名为 <code>expires_in</code> 的数据，它表示当前获得的 <code>token</code> 会在多少 <code>秒</code> 后失效。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"access_token\"</span>: <span class=\"string\">\"token....\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"token_type\"</span>: <span class=\"string\">\"Bearer\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"expires_in\"</span>: <span class=\"number\">3600</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>客户端在请求需要认证的 <code>API</code> 时，<code>必须</code> 在请求头 <code>Authorization</code> 中带上 <code>access_token</code>。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Authorization: Bearer token...</span><br></pre></td></tr></table></figure>\n\n<p>当超过指定的秒数后，<code>access token</code> 就会过期，再次用过期/或无效的 <code>token</code> 访问时，服务端 <code>应该</code> 返回 <code>invalid_token</code> 的错误或 <code>401</code> 错误码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">401</span> Unauthorized</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-store</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"error\": \"invalid_token\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> 开发中，<code>应该</code> 使用 <a href=\"https://github.com/tymondesigns/jwt-auth\" target=\"_blank\" rel=\"noopener\">JWT</a> 来为管理你的 Token，并且 <code>一定不可</code> 在 <code>api</code> 中间件中开启请求 <code>session</code>。</p>\n</blockquote>\n<h2 id=\"Response\"><a href=\"#Response\" class=\"headerlink\" title=\"Response\"></a>Response</h2><p>所有的 <code>API</code> 响应，<code>必须</code> 遵守 <code>HTTP</code> 设计规范，<code>必须</code> 选择合适的 <code>HTTP</code> 状态码。<code>一定不可</code> 所有接口都返回状态码为 <code>200</code> 的 <code>HTTP</code> 响应，如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP&#x2F;1.1 200 ok</span><br><span class=\"line\">Content-Type: application&#x2F;json</span><br><span class=\"line\">Server: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;code&quot;: 0,</span><br><span class=\"line\">    &quot;msg&quot;: &quot;success&quot;,</span><br><span class=\"line\">    &quot;data&quot;: &#123;</span><br><span class=\"line\">        &quot;username&quot;: &quot;username&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>或</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> ok</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": -1,</span><br><span class=\"line\">    \"msg\": \"该活动不存在\",</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下表列举了常见的 <code>HTTP</code> 状态码</p>\n<table>\n<thead>\n<tr>\n<th>状态码</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1xx</td>\n<td>代表请求已被接受，需要继续处理</td>\n</tr>\n<tr>\n<td>2xx</td>\n<td>请求已成功，请求所希望的响应头或数据体将随此响应返回</td>\n</tr>\n<tr>\n<td>3xx</td>\n<td>重定向</td>\n</tr>\n<tr>\n<td>4xx</td>\n<td>客户端原因引起的错误</td>\n</tr>\n<tr>\n<td>5xx</td>\n<td>服务端原因引起的错误</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>只有来自客户端的请求被正确的处理后才能返回 <code>2xx</code> 的响应，所以当 API 返回 <code>2xx</code> 类型的状态码时，前端 <code>必须</code> 认定该请求已处理成功</p>\n</blockquote>\n<p>必须强调的是，所有 <code>API</code> <code>一定不可</code> 返回 <code>1xx</code> 类型的状态码。当 <code>API</code> 发生错误时，<code>必须</code> 返回出错时的详细信息。目前常见返回错误信息的方法有两种：</p>\n<p>1、将错误详细放入 <code>HTTP</code> 响应首部；</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-CODE</span>: 4001</span><br><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-MESSAGE</span>: Bad authentication token</span><br><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-INFO</span>: http://docs.example.com/api/v1/authentication</span><br></pre></td></tr></table></figure>\n\n<p>2、直接放入响应实体中；</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP&#x2F;1.1 401 Unauthorized</span><br><span class=\"line\">Server: nginx&#x2F;1.11.9</span><br><span class=\"line\">Content-Type: application&#x2F;json</span><br><span class=\"line\">Transfer-Encoding: chunked</span><br><span class=\"line\">Cache-Control: no-cache, private</span><br><span class=\"line\">Date: Sun, 24 Jun 2018 10:02:59 GMT</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;error_code&quot;:40100,&quot;message&quot;:&quot;Unauthorized&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>考虑到易读性和客户端的易处理性，我们 <code>必须</code> 把错误信息直接放到响应实体中，并且错误格式 <code>应该</code> 满足如下格式：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"您查找的资源不存在\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"error_code\"</span>: <span class=\"number\">404001</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其中错误码（<code>error_code</code>）<code>必须</code> 和 <code>HTTP</code> 状态码对应，也方便错误码归类，如：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">429</span> Too Many Requests</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 10:15:52 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":429001,\"message\":\"你操作太频繁了\"&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>应该</code> 在返回的错误信息中，同时包含面向开发者和面向用户的提示信息，前者可方便开发人员调试，后者可直接展示给终端用户查看如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;message&quot;: &quot;直接展示给终端用户的错误信息&quot;,</span><br><span class=\"line\">    &quot;error_code&quot;: &quot;业务错误码&quot;,</span><br><span class=\"line\">    &quot;error&quot;: &quot;供开发者查看的错误信息&quot;,</span><br><span class=\"line\">    &quot;debug&quot;: [</span><br><span class=\"line\">        &quot;错误堆栈，必须开启 debug 才存在&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面详细列举了各种情况 API 的返回说明。</p>\n<h3 id=\"200-ok\"><a href=\"#200-ok\" class=\"headerlink\" title=\"200 ok\"></a>200 ok</h3><p><code>200</code> 状态码是最常见的 <code>HTTP</code> 状态码，在所有 <strong>成功</strong> 的 <code>GET</code> 请求中，<code>必须</code> 返回此状态码。<code>HTTP</code> 响应实体部分 <code>必须</code> 直接就是数据，不要做多余的包装。</p>\n<p>错误示例：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> ok</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"user\": &#123;</span><br><span class=\"line\">        \"id\":1,</span><br><span class=\"line\">        \"nickname\":\"fwest\",</span><br><span class=\"line\">        \"username\": \"example\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>正确示例：</p>\n<p>1、获取单个资源详情</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"godruoyi\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、获取资源集合</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"godruoyi\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"foo\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>3、额外的媒体信息</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"data\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"avatar\"</span>: <span class=\"string\">\"https://lorempixel.com/640/480/?32556\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"nickname\"</span>: <span class=\"string\">\"fwest\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"last_logined_time\"</span>: <span class=\"string\">\"2018-05-29 04:56:43\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"has_registed\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"avatar\"</span>: <span class=\"string\">\"https://lorempixel.com/640/480/?86144\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"nickname\"</span>: <span class=\"string\">\"zschowalter\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"last_logined_time\"</span>: <span class=\"string\">\"2018-06-16 15:18:34\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"has_registed\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"meta\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"pagination\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"total\"</span>: <span class=\"number\">101</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"count\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"per_page\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"current_page\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"total_pages\"</span>: <span class=\"number\">51</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"links\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"next\"</span>: <span class=\"string\">\"http://api.example.com?page=2\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>其中，分页和其他额外的媒体信息，必须放到 <code>meta</code> 字段中。</p>\n</blockquote>\n<h3 id=\"201-Created\"><a href=\"#201-Created\" class=\"headerlink\" title=\"201 Created\"></a>201 Created</h3><p>当服务器创建数据成功时，<code>应该</code> 返回此状态码。常见的应用场景是使用 <code>POST</code> 提交用户信息，如：</p>\n<ul>\n<li>添加了新用户</li>\n<li>上传了图片</li>\n<li>创建了新活动</li>\n</ul>\n<p>等，都可以返回 <code>201</code> 状态码。需要注意的是，你可以选择在用户创建成功后返回新用户的数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">201</span> Created</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:13:40 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"id\": 1,</span><br><span class=\"line\">    \"avatar\": \"https:\\/\\/lorempixel.com\\/640\\/480\\/?32556\",</span><br><span class=\"line\">    \"nickname\": \"fwest\",</span><br><span class=\"line\">    \"last_logined_time\": \"2018-05-29 04:56:43\",</span><br><span class=\"line\">    \"created_at\": \"2018-06-16 17:55:55\",</span><br><span class=\"line\">    \"updated_at\": \"2018-06-16 17:55:55\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>也可以返回一个响应实体为空的 <code>HTTP Response</code> 如：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">201</span> Created</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:12:20 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里我们 <code>应该</code> 采用第二种方式，因为大多数情况下，客户端只需要知道该请求操作成功与否，并不需要返回新资源的信息。</p>\n</blockquote>\n<h3 id=\"202-Accepted\"><a href=\"#202-Accepted\" class=\"headerlink\" title=\"202 Accepted\"></a>202 Accepted</h3><p>该状态码表示服务器已经接受到了来自客户端的请求，但还未开始处理。常用短信发送、邮件通知、模板消息推送等这类很耗时需要队列支持的场景中；</p>\n<blockquote>\n<p>返回该状态码时，响应实体 <code>必须</code> 为空。</p>\n</blockquote>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">202</span> Accepted</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:25:15 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"204-No-Content\"><a href=\"#204-No-Content\" class=\"headerlink\" title=\"204 No Content\"></a>204 No Content</h3><p>该状态码表示响应实体不包含任何数据，其中：</p>\n<ul>\n<li>在使用 <code>DELETE</code> 方法删除资源 <strong>成功</strong> 时，<code>必须</code> 返回该状态码</li>\n<li>使用 <code>PUT</code>、<code>PATCH</code> 方法更新数据 <strong>成功</strong> 时，也 <code>应该</code> 返回此状态码</li>\n</ul>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">204</span> No Content</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:29:12 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3xx-重定向\"><a href=\"#3xx-重定向\" class=\"headerlink\" title=\"3xx 重定向\"></a>3xx 重定向</h3><p>所有 <code>API</code> <code>不该</code> 返回 <code>3xx</code> 类型的状态码。因为 <code>3xx</code> 类型的响应格式一般为下列格式：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">302</span> Found</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:41:50 GMT</span><br><span class=\"line\"><span class=\"attribute\">Location</span>: https://example.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset=\"UTF-8\" /&gt;</span><br><span class=\"line\">        &lt;meta http-equiv=\"refresh\" content=\"0;url=https://example.com\" /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;title&gt;Redirecting to https://example.com&lt;/title&gt;</span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">    &lt;body&gt;</span><br><span class=\"line\">        Redirecting to &lt;a href=\"https://example.com\"&gt;https://example.com&lt;/a&gt;.</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>所有 <code>API</code> <code>一定不可</code> 返回纯 <code>HTML</code> 结构的响应；若一定要使用重定向功能，<code>可以</code> 返回一个响应实体为空的 <code>3xx</code> 响应，并在响应头中加上 <code>Location</code> 字段:</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">302</span> Found</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:52:50 GMT</span><br><span class=\"line\"><span class=\"attribute\">Location</span>: https://godruoyi.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"400-Bad-Request\"><a href=\"#400-Bad-Request\" class=\"headerlink\" title=\"400 Bad Request\"></a>400 Bad Request</h3><p>由于明显的客户端错误（例如，请求语法格式错误、无效的请求、无效的签名等），服务器 <code>应该</code> 放弃该请求。</p>\n<blockquote>\n<p>当服务器无法从其他 4xx 类型的状态码中找出合适的来表示错误类型时，都 <code>必须</code> 返回该状态码。</p>\n</blockquote>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">400</span> Bad Request</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:22:36 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40000,\"message\":\"无效的签名\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"401-Unauthorized\"><a href=\"#401-Unauthorized\" class=\"headerlink\" title=\"401 Unauthorized\"></a>401 Unauthorized</h3><p>该状态码表示当前请求需要身份认证，以下情况都 <code>必须</code> 返回该状态码。</p>\n<ul>\n<li>未认证用户访问需要认证的 API</li>\n<li>access_token 无效/过期</li>\n</ul>\n<blockquote>\n<p>客户端在收到 <code>401</code> 响应后，都 <code>应该</code> 提示用户进行下一步的登录操作。</p>\n</blockquote>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">401</span> Unauthorized</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">WWW-Authenticate</span>: JWTAuth</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:17:02 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"Token Signature could not be verified.\",\"error_code\": \"40100\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"403-Forbidden\"><a href=\"#403-Forbidden\" class=\"headerlink\" title=\"403 Forbidden\"></a>403 Forbidden</h3><p>该状态码可以简单的理解为没有权限访问该请求，服务器收到请求但拒绝提供服务。</p>\n<p>如当普通用户请求操作管理员用户时，<code>必须</code> 返回该状态码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">403</span> Forbidden</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:05:34 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40301,\"message\":\"权限不足\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"404-Not-Found\"><a href=\"#404-Not-Found\" class=\"headerlink\" title=\"404 Not Found\"></a>404 Not Found</h3><p>该状态码表示用户请求的资源不存在，如</p>\n<ul>\n<li>获取不存在的用户信息 （get /users/9999999）</li>\n<li>访问不存在的端点</li>\n</ul>\n<p>都 <code>必须</code> 返回该状态码，若该资源已永久不存在，则 <code>应该</code> 返回 <code>410</code> 响应。</p>\n<h3 id=\"405-Method-Not-Allowed\"><a href=\"#405-Method-Not-Allowed\" class=\"headerlink\" title=\"405 Method Not Allowed\"></a>405 Method Not Allowed</h3><p>当客户端使用的 <code>HTTP</code> 请求方法不被服务器允许时，<code>必须</code> 返回该状态码。</p>\n<blockquote>\n<p>如客户端调用了 <code>POST</code> 方法来访问只支持 GET 方法的 API</p>\n</blockquote>\n<p>该响应 <code>必须</code> 返回一个 <code>Allow</code> 头信息用以表示出当前资源能够接受的请求方法的列表。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">405</span> Method Not Allowed</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Allow</span>: GET, HEAD</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:30:57 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"405 Method Not Allowed\",\"error_code\": 40500&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"406-Not-Acceptable\"><a href=\"#406-Not-Acceptable\" class=\"headerlink\" title=\"406 Not Acceptable\"></a>406 Not Acceptable</h3><p><code>API</code> 在不支持客户端指定的数据格式时，应该返回此状态码。如支持 <code>JSON</code> 和 <code>XML</code> 输出的 <code>API</code> 被指定返回 <code>YAML</code> 格式的数据时。</p>\n<blockquote>\n<p>Http 协议一般通过请求首部的 Accept 来指定数据格式</p>\n</blockquote>\n<h3 id=\"408-Request-Timeout\"><a href=\"#408-Request-Timeout\" class=\"headerlink\" title=\"408 Request Timeout\"></a>408 Request Timeout</h3><p>客户端请求超时时 <code>必须</code> 返回该状态码，需要注意的时，该状态码表示 <strong>客户端请求超时</strong>，在涉及第三方 <code>API</code> 调用超时时，<code>一定不可</code> 返回该状态码。</p>\n<h3 id=\"409-Confilct\"><a href=\"#409-Confilct\" class=\"headerlink\" title=\"409 Confilct\"></a>409 Confilct</h3><p>该状态码表示因为请求存在冲突无法处理。如通过手机号码提供注册功能的 <code>API</code>，当用户提交的手机号已存在时，<code>必须</code> 返回此状态码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">409</span> Conflict</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:19:04 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40900,\"message\":\"手机号已存在\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"410-Gone\"><a href=\"#410-Gone\" class=\"headerlink\" title=\"410 Gone\"></a>410 Gone</h3><p>和 <code>404</code> 类似，该状态码也表示请求的资源不存在，只是 <code>410</code> 状态码进一步表示所请求的资源已不存在，并且未来也不会存在。在收到 <code>410</code> 状态码后，客户端 <code>应该</code> 停止再次请求该资源。</p>\n<h3 id=\"413-Request-Entity-Too-Large\"><a href=\"#413-Request-Entity-Too-Large\" class=\"headerlink\" title=\"413 Request Entity Too Large\"></a>413 Request Entity Too Large</h3><p>该状态码表示服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。</p>\n<blockquote>\n<p>此种情况下，服务器可以关闭连接以免客户端继续发送此请求。</p>\n</blockquote>\n<p>如果这个状况是临时的，服务器 <code>应该</code> 返回一个 <code>Retry-After</code> 的响应头，以告知客户端可以在多少时间以后重新尝试。</p>\n<h3 id=\"414-Request-URI-Too-Long\"><a href=\"#414-Request-URI-Too-Long\" class=\"headerlink\" title=\"414 Request-URI Too Long\"></a>414 Request-URI Too Long</h3><p>该状态码表示请求的 <code>URI</code> 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。</p>\n<h3 id=\"415-Unsupported-Media-Type\"><a href=\"#415-Unsupported-Media-Type\" class=\"headerlink\" title=\"415 Unsupported Media Type\"></a>415 Unsupported Media Type</h3><p>通常表示服务器不支持客户端请求首部 <code>Content-Type</code> 指定的数据格式。如在只接受 <code>JSON</code> 格式的 <code>API</code> 中放入 <code>XML</code> 类型的数据并向服务器发送，都 <code>应该</code> 返回该状态码。</p>\n<p>该状态码也可用于如：只允许上传图片格式的文件，但是客户端提交媒体文件非法或不是图片类型，这时 <code>应该</code> 返回该状态码：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">415</span> Unsupported Media Type</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:09:40 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":41500,\"message\":\"不允许上传的图片格式\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"429-Too-Many-Requests\"><a href=\"#429-Too-Many-Requests\" class=\"headerlink\" title=\"429 Too Many Requests\"></a>429 Too Many Requests</h3><p>该状态码表示用户请求次数超过允许范围。如 <code>API</code> 设定为 <code>60次/分钟</code>，当用户在一分钟内请求次数超过 60 次后，都 <code>应该</code> 返回该状态码。并且也 <code>应该</code> 在响应首部中加上下列头部：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">X-RateLimit-Limit</span>: 10 请求速率（由应用设定，其单位一般为小时/分钟等，这里是 10次/5分钟）</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Remaining</span>: 0 当前剩余的请求数量</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Reset</span>: 1529839462 重置时间</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 120 下一次访问应该等待的时间（秒）</span><br></pre></td></tr></table></figure>\n\n<p>列子</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">429</span> Too Many Requests</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Limit</span>: 10</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Remaining</span>: 0</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Reset</span>: 1529839462</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 290</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 11:19:32 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"You have exceeded your rate limit.\",\"error_code\":42900&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>必须</code> 为所有的 API 设置 Rate Limit 支持。</p>\n<h3 id=\"500-Internal-Server-Error\"><a href=\"#500-Internal-Server-Error\" class=\"headerlink\" title=\"500 Internal Server Error\"></a>500 Internal Server Error</h3><p>该状态码 <code>必须</code> 在服务器出错时抛出，对于所有的 <code>500</code> 错误，都 <code>应该</code> 提供完整的错误信息支持，也方便跟踪调试。</p>\n<h3 id=\"503-Service-Unavailable\"><a href=\"#503-Service-Unavailable\" class=\"headerlink\" title=\"503 Service Unavailable\"></a>503 Service Unavailable</h3><p>该状态码表示服务器暂时处理不可用状态，当服务器需要维护或第三方 <code>API</code> 请求超时/不可达时，都 <code>应该</code> 返回该状态码，其中若是主动关闭 API 服务，<code>应该</code>在返回的响应首部加上 <code>Retry-After</code> 头部，表示多少秒后可以再次访问。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">503</span> Service Unavailable</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 10:56:20 GMT</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 60</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":50300,\"message\":\"服务维护中\"&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其他 <code>HTTP</code> 状态码请参考 <a href=\"https://zh.wikipedia.org/zh-hans/HTTP状态码\" target=\"_blank\" rel=\"noopener\">HTTP 状态码- 维基百科</a>。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"RESETful-API-设计规范\"><a href=\"#RESETful-API-设计规范\" class=\"headerlink\" title=\"RESETful API 设计规范\"></a>RESETful API 设计规范</h1><p>[TOC]</p>\n<blockquote>\n<p>文章参考了目前比较常见的 <code>RESETful API</code> 设计，文档不一定十分完善，如果遗漏或者不准确，请包涵和提出意见。</p>\n</blockquote>\n<h2 id=\"关于「能愿动词」的使用\"><a href=\"#关于「能愿动词」的使用\" class=\"headerlink\" title=\"关于「能愿动词」的使用\"></a>关于「能愿动词」的使用</h2><p>为了避免歧义，文档大量使用了「能愿动词」，对应的解释如下：</p>\n<ul>\n<li><code>必须 (MUST)</code>：绝对，严格遵循，请照做，无条件遵守；</li>\n<li><code>一定不可 (MUST NOT)</code>：禁令，严令禁止；</li>\n<li><code>应该 (SHOULD)</code> ：强烈建议这样做，但是不强求；</li>\n<li><code>不该 (SHOULD NOT)</code>：强烈不建议这样做，但是不强求；</li>\n<li><code>可以 (MAY)</code> 和 <code>可选 (OPTIONAL)</code> ：选择性高一点，在这个文档内，此词语使用较少；</li>\n</ul>\n<p>参考 <a href=\"https://www.ietf.org/rfc/rfc2119.txt\" target=\"_blank\" rel=\"noopener\">RFC</a> 文档</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Status of this Memo</span><br><span class=\"line\"></span><br><span class=\"line\">   This document specifies an Internet Best Current Practices for the</span><br><span class=\"line\">   Internet Community, and requests discussion and suggestions for</span><br><span class=\"line\">   improvements.  Distribution of this memo is unlimited.</span><br><span class=\"line\"></span><br><span class=\"line\">Abstract</span><br><span class=\"line\"></span><br><span class=\"line\">   In many standards track documents several words are used to signify</span><br><span class=\"line\">   the requirements in the specification.  These words are often</span><br><span class=\"line\">   capitalized.  This document defines these words as they should be</span><br><span class=\"line\">   interpreted in IETF documents.  Authors who follow these guidelines</span><br><span class=\"line\">   should incorporate this phrase near the beginning of their document:</span><br><span class=\"line\"></span><br><span class=\"line\">      The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL</span><br><span class=\"line\">      NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,  &quot;MAY&quot;, and</span><br><span class=\"line\">      &quot;OPTIONAL&quot; in this document are to be interpreted as described in</span><br><span class=\"line\">      RFC 2119.</span><br><span class=\"line\"></span><br><span class=\"line\">   Note that the force of these words is modified by the requirement</span><br><span class=\"line\">   level of the document in which they are used.</span><br><span class=\"line\"></span><br><span class=\"line\">1. MUST   This word, or the terms &quot;REQUIRED&quot; or &quot;SHALL&quot;, mean that the</span><br><span class=\"line\">   definition is an absolute requirement of the specification.</span><br><span class=\"line\"></span><br><span class=\"line\">2. MUST NOT   This phrase, or the phrase &quot;SHALL NOT&quot;, mean that the</span><br><span class=\"line\">   definition is an absolute prohibition of the specification.</span><br><span class=\"line\"></span><br><span class=\"line\">3. SHOULD   This word, or the adjective &quot;RECOMMENDED&quot;, mean that there</span><br><span class=\"line\">   may exist valid reasons in particular circumstances to ignore a</span><br><span class=\"line\">   particular item, but the full implications must be understood and</span><br><span class=\"line\">   carefully weighed before choosing a different course.</span><br><span class=\"line\"></span><br><span class=\"line\">4. SHOULD NOT   This phrase, or the phrase &quot;NOT RECOMMENDED&quot; mean that</span><br><span class=\"line\">   there may exist valid reasons in particular circumstances when the</span><br><span class=\"line\">   particular behavior is acceptable or even useful, but the full</span><br><span class=\"line\">   implications should be understood and the case carefully weighed</span><br><span class=\"line\">   before implementing any behavior described with this label.</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h2 id=\"Protocol\"><a href=\"#Protocol\" class=\"headerlink\" title=\"Protocol\"></a>Protocol</h2><p>客户端在通过 <code>API</code> 与后端服务通信的过程中，<code>应该</code> 使用 <code>HTTPS</code> 协议。</p>\n<h2 id=\"API-Root-URL\"><a href=\"#API-Root-URL\" class=\"headerlink\" title=\"API Root URL\"></a>API Root URL</h2><p><code>API</code> 的根入口点应尽可能保持足够简单，这里有两个常见的 <code>URL</code> 根例子：</p>\n<ul>\n<li>api.example.com/*</li>\n<li>example.com/api/*</li>\n</ul>\n<blockquote>\n<p>如果你的应用很庞大或者你预计它将会变的很庞大，那 <code>应该</code> 将 <code>API</code> 放到子域下（<code>api.example.com</code>）。这种做法可以保持某些规模化上的灵活性。</p>\n</blockquote>\n<h2 id=\"Versioning\"><a href=\"#Versioning\" class=\"headerlink\" title=\"Versioning\"></a>Versioning</h2><p>所有的 <code>API</code> 必须保持向后兼容，你 <code>必须</code> 在引入新版本 <code>API</code> 的同时确保旧版本 <code>API</code> 仍然可用。所以 <code>应该</code> 为其提供版本支持。</p>\n<p>目前比较常见的两种版本号形式：</p>\n<h3 id=\"在-URL-中嵌入版本编号\"><a href=\"#在-URL-中嵌入版本编号\" class=\"headerlink\" title=\"在 URL 中嵌入版本编号\"></a>在 URL 中嵌入版本编号</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api.example.com&#x2F;v1&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>这种做法是版本号直观、易于调试；另一种做法是，将版本号放在 <code>HTTP Header</code> 头中：</p>\n<h3 id=\"通过媒体类型来指定版本信息\"><a href=\"#通过媒体类型来指定版本信息\" class=\"headerlink\" title=\"通过媒体类型来指定版本信息\"></a>通过媒体类型来指定版本信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Accept: application&#x2F;vnd.example.com.v1+json</span><br></pre></td></tr></table></figure>\n\n<p>其中 <code>vnd</code> 表示 <code>Standards Tree</code> 标准树类型，有三个不同的树: <code>x</code>，<code>prs</code> 和 <code>vnd</code>。你使用的标准树需要取决于你开发的项目</p>\n<ul>\n<li>未注册的树（<code>x</code>）主要表示本地和私有环境</li>\n<li>私有树（<code>prs</code>）主要表示没有商业发布的项目</li>\n<li>供应商树（<code>vnd</code>）主要表示公开发布的项目</li>\n</ul>\n<blockquote>\n<p>后面几个参数依次为应用名称（一般为应用域名）、版本号、期望的返回格式。</p>\n</blockquote>\n<p>至于具体把版本号放在什么地方，这个问题一直存在很大的争议，但由于我们大多数时间都在使用 <code>Laravel</code> 开发，<code>应该</code> 使用 <a href=\"https://github.com/dingo/api\" target=\"_blank\" rel=\"noopener\">dingo/api</a> 来快速构建应用，它采用第二种方式来管理 <code>API</code> 版本，并且已集成了标准的 <code>HTTP Response</code>。</p>\n<h2 id=\"Endpoints\"><a href=\"#Endpoints\" class=\"headerlink\" title=\"Endpoints\"></a>Endpoints</h2><p>端点就是指向特定资源或资源集合的 <code>URL</code>。在端点的设计中，你 <code>必须</code> 遵守下列约定：</p>\n<ul>\n<li>URL 的命名 <code>必须</code> 全部小写</li>\n<li>URL 中资源（<code>resource</code>）的命名 <code>必须</code> 是名词，并且 <code>必须</code> 是复数形式</li>\n<li><code>必须</code> 优先使用 <code>Restful</code> 类型的 URL</li>\n<li>URL <code>必须</code> 是易读的</li>\n<li>URL <code>一定不可</code> 暴露服务器架构</li>\n</ul>\n<blockquote>\n<p>至于 URL 是否必须使用连字符（<code>-</code>） 或下划线（<code>_</code>），不做硬性规定，但 <code>必须</code> 根据团队情况统一一种风格。</p>\n</blockquote>\n<p>来看一个反例</p>\n<ul>\n<li><a href=\"https://api.example.com/getUserInfo?userid=1\" target=\"_blank\" rel=\"noopener\">https://api.example.com/getUserInfo?userid=1</a></li>\n<li><a href=\"https://api.example.com/getusers\" target=\"_blank\" rel=\"noopener\">https://api.example.com/getusers</a></li>\n<li><a href=\"https://api.example.com/sv/u\" target=\"_blank\" rel=\"noopener\">https://api.example.com/sv/u</a></li>\n<li><a href=\"https://api.example.com/cgi-bin/users/get_user.php?userid=1\" target=\"_blank\" rel=\"noopener\">https://api.example.com/cgi-bin/users/get_user.php?userid=1</a></li>\n</ul>\n<p>再来看一个正列</p>\n<ul>\n<li><p><a href=\"https://api.example.com/zoos\" target=\"_blank\" rel=\"noopener\">https://api.example.com/zoos</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/animals\" target=\"_blank\" rel=\"noopener\">https://api.example.com/animals</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/zoos/{zoo}/animals\" target=\"_blank\" rel=\"noopener\">https://api.example.com/zoos/{zoo}/animals</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/animal_types\" target=\"_blank\" rel=\"noopener\">https://api.example.com/animal_types</a></p>\n</li>\n<li><p><a href=\"https://api.example.com/employees\" target=\"_blank\" rel=\"noopener\">https://api.example.com/employees</a></p>\n</li>\n</ul>\n<h2 id=\"HTTP-动词\"><a href=\"#HTTP-动词\" class=\"headerlink\" title=\"HTTP 动词\"></a>HTTP 动词</h2><p>对于资源的具体操作类型，由 <code>HTTP</code> 动词表示。常用的 <code>HTTP</code> 动词有下面五个（括号里是对应的 <code>SQL</code> 命令）。</p>\n<ul>\n<li>GET（SELECT）：从服务器取出资源（一项或多项）。</li>\n<li>POST（CREATE）：在服务器新建一个资源。</li>\n<li>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</li>\n<li>PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</li>\n<li>DELETE（DELETE）：从服务器删除资源。</li>\n</ul>\n<p>其中</p>\n<p>1 删除资源 <code>必须</code> 用 <code>DELETE</code> 方法 2 创建新的资源 <code>必须</code> 使用 <code>POST</code> 方法 3 更新资源 <code>应该</code> 使用 <code>PUT</code> 方法 4 获取资源信息 <code>必须</code> 使用 <code>GET</code> 方法</p>\n<p>针对每一个端点来说，下面列出所有可行的 <code>HTTP</code> 动词和端点的组合</p>\n<table>\n<thead>\n<tr>\n<th>请求方法</th>\n<th>URL</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>/zoos/list</td>\n<td>列出所有的动物园(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/zoos/update</td>\n<td>新增一个新的动物园</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/detail?id=1</td>\n<td>获取指定动物园详情</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/zoos/{zoo}</td>\n<td>更新指定动物园(整个对象)</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/zoos/{zoo}</td>\n<td>更新动物园(部分对象)</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/zoos/{zoo}</td>\n<td>删除指定动物园</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/{zoo}/animals</td>\n<td>检索指定动物园下的动物列表(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animals</td>\n<td>列出所有动物(ID和名称)。</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/animals</td>\n<td>新增新的动物</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animals/detail</td>\n<td>获取指定的动物详情</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/animals/{animal}</td>\n<td>更新指定的动物(整个对象)</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/animals/{animal}</td>\n<td>更新指定的动物(部分对象)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animal_types</td>\n<td>获取所有动物类型(ID和名称，不要太详细)</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/animal_types/{type}</td>\n<td>获取指定的动物类型详情</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/employees</td>\n<td>检索整个雇员列表</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/employees/{employee}</td>\n<td>检索指定特定的员工</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/zoos/employees/list</td>\n<td>检索在这个动物园工作的雇员的名单(身份证和姓名)</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/employees</td>\n<td>新增指定新员工</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/zoos/{zoo}/employees</td>\n<td>在特定的动物园雇佣一名员工</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/zoos/{zoo}/employees/{employee}</td>\n<td>从某个动物园解雇一名员工</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>超出 <code>Restful</code> 端点的，<code>应该</code> 模仿上表的方式来定义端点。</p>\n</blockquote>\n<h2 id=\"Filtering\"><a href=\"#Filtering\" class=\"headerlink\" title=\"Filtering\"></a>Filtering</h2><blockquote>\n<p>如果记录数量很多，服务器不可能都将它们返回给用户。API <code>应该</code> 提供参数，过滤返回结果。下面是一些常见的参数。</p>\n</blockquote>\n<ul>\n<li>?limit=10：指定返回记录的数量</li>\n<li>?offset=10：指定返回记录的开始位置。</li>\n<li>?page=2&amp;rows0：指定第几页，以及每页的记录数。</li>\n<li>?order_by=me&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。</li>\n<li>?animal_type_id=1：指定筛选条件</li>\n</ul>\n<p>所有 <code>URL</code> 参数 <code>必须</code> 是全小写，<code>必须</code> 使用下划线类型的参数形式。</p>\n<blockquote>\n<p>分页参数 <code>必须</code> 固定为 <code>page</code>、<code>rows</code></p>\n</blockquote>\n<p>经常使用的、复杂的查询 <code>应该</code> 标签化，降低维护成本。如</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /trades?status=closed&amp;order_by=name&amp;order=asc</span><br><span class=\"line\"></span><br><span class=\"line\"># 可为其定制快捷方式</span><br><span class=\"line\">GET /trades/recently_closed</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Authentication\"><a href=\"#Authentication\" class=\"headerlink\" title=\"Authentication\"></a>Authentication</h2><p><code>应该</code> 使用 <code>OAuth2.0</code> 的方式为 API 调用者提供登录认证。<code>必须</code> 先通过登录接口获取 <code>Access Token</code> 后再通过该 <code>token</code> 调用需要身份认证的 <code>API</code>。</p>\n<p>Oauth 的端点设计示列</p>\n<ul>\n<li>RFC 6749 /token</li>\n<li>Twitter /oauth2/token</li>\n<li>Fackbook /oauth/access_token</li>\n<li>Google /o/oauth2/token</li>\n<li>Github /login/oauth/access_token</li>\n<li>Instagram /oauth/authorize</li>\n</ul>\n<p>客户端在获得 <code>access token</code> 的同时 <code>必须</code> 在响应中包含一个名为 <code>expires_in</code> 的数据，它表示当前获得的 <code>token</code> 会在多少 <code>秒</code> 后失效。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"access_token\"</span>: <span class=\"string\">\"token....\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"token_type\"</span>: <span class=\"string\">\"Bearer\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"expires_in\"</span>: <span class=\"number\">3600</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>客户端在请求需要认证的 <code>API</code> 时，<code>必须</code> 在请求头 <code>Authorization</code> 中带上 <code>access_token</code>。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Authorization: Bearer token...</span><br></pre></td></tr></table></figure>\n\n<p>当超过指定的秒数后，<code>access token</code> 就会过期，再次用过期/或无效的 <code>token</code> 访问时，服务端 <code>应该</code> 返回 <code>invalid_token</code> 的错误或 <code>401</code> 错误码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">401</span> Unauthorized</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-store</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"error\": \"invalid_token\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> 开发中，<code>应该</code> 使用 <a href=\"https://github.com/tymondesigns/jwt-auth\" target=\"_blank\" rel=\"noopener\">JWT</a> 来为管理你的 Token，并且 <code>一定不可</code> 在 <code>api</code> 中间件中开启请求 <code>session</code>。</p>\n</blockquote>\n<h2 id=\"Response\"><a href=\"#Response\" class=\"headerlink\" title=\"Response\"></a>Response</h2><p>所有的 <code>API</code> 响应，<code>必须</code> 遵守 <code>HTTP</code> 设计规范，<code>必须</code> 选择合适的 <code>HTTP</code> 状态码。<code>一定不可</code> 所有接口都返回状态码为 <code>200</code> 的 <code>HTTP</code> 响应，如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP&#x2F;1.1 200 ok</span><br><span class=\"line\">Content-Type: application&#x2F;json</span><br><span class=\"line\">Server: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;code&quot;: 0,</span><br><span class=\"line\">    &quot;msg&quot;: &quot;success&quot;,</span><br><span class=\"line\">    &quot;data&quot;: &#123;</span><br><span class=\"line\">        &quot;username&quot;: &quot;username&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>或</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> ok</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"code\": -1,</span><br><span class=\"line\">    \"msg\": \"该活动不存在\",</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下表列举了常见的 <code>HTTP</code> 状态码</p>\n<table>\n<thead>\n<tr>\n<th>状态码</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1xx</td>\n<td>代表请求已被接受，需要继续处理</td>\n</tr>\n<tr>\n<td>2xx</td>\n<td>请求已成功，请求所希望的响应头或数据体将随此响应返回</td>\n</tr>\n<tr>\n<td>3xx</td>\n<td>重定向</td>\n</tr>\n<tr>\n<td>4xx</td>\n<td>客户端原因引起的错误</td>\n</tr>\n<tr>\n<td>5xx</td>\n<td>服务端原因引起的错误</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>只有来自客户端的请求被正确的处理后才能返回 <code>2xx</code> 的响应，所以当 API 返回 <code>2xx</code> 类型的状态码时，前端 <code>必须</code> 认定该请求已处理成功</p>\n</blockquote>\n<p>必须强调的是，所有 <code>API</code> <code>一定不可</code> 返回 <code>1xx</code> 类型的状态码。当 <code>API</code> 发生错误时，<code>必须</code> 返回出错时的详细信息。目前常见返回错误信息的方法有两种：</p>\n<p>1、将错误详细放入 <code>HTTP</code> 响应首部；</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-CODE</span>: 4001</span><br><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-MESSAGE</span>: Bad authentication token</span><br><span class=\"line\"><span class=\"attribute\">X-MYNAME-ERROR-INFO</span>: http://docs.example.com/api/v1/authentication</span><br></pre></td></tr></table></figure>\n\n<p>2、直接放入响应实体中；</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP&#x2F;1.1 401 Unauthorized</span><br><span class=\"line\">Server: nginx&#x2F;1.11.9</span><br><span class=\"line\">Content-Type: application&#x2F;json</span><br><span class=\"line\">Transfer-Encoding: chunked</span><br><span class=\"line\">Cache-Control: no-cache, private</span><br><span class=\"line\">Date: Sun, 24 Jun 2018 10:02:59 GMT</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;error_code&quot;:40100,&quot;message&quot;:&quot;Unauthorized&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>考虑到易读性和客户端的易处理性，我们 <code>必须</code> 把错误信息直接放到响应实体中，并且错误格式 <code>应该</code> 满足如下格式：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"您查找的资源不存在\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"error_code\"</span>: <span class=\"number\">404001</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其中错误码（<code>error_code</code>）<code>必须</code> 和 <code>HTTP</code> 状态码对应，也方便错误码归类，如：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">429</span> Too Many Requests</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 10:15:52 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":429001,\"message\":\"你操作太频繁了\"&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>应该</code> 在返回的错误信息中，同时包含面向开发者和面向用户的提示信息，前者可方便开发人员调试，后者可直接展示给终端用户查看如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;message&quot;: &quot;直接展示给终端用户的错误信息&quot;,</span><br><span class=\"line\">    &quot;error_code&quot;: &quot;业务错误码&quot;,</span><br><span class=\"line\">    &quot;error&quot;: &quot;供开发者查看的错误信息&quot;,</span><br><span class=\"line\">    &quot;debug&quot;: [</span><br><span class=\"line\">        &quot;错误堆栈，必须开启 debug 才存在&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面详细列举了各种情况 API 的返回说明。</p>\n<h3 id=\"200-ok\"><a href=\"#200-ok\" class=\"headerlink\" title=\"200 ok\"></a>200 ok</h3><p><code>200</code> 状态码是最常见的 <code>HTTP</code> 状态码，在所有 <strong>成功</strong> 的 <code>GET</code> 请求中，<code>必须</code> 返回此状态码。<code>HTTP</code> 响应实体部分 <code>必须</code> 直接就是数据，不要做多余的包装。</p>\n<p>错误示例：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">200</span> ok</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: example.com</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"user\": &#123;</span><br><span class=\"line\">        \"id\":1,</span><br><span class=\"line\">        \"nickname\":\"fwest\",</span><br><span class=\"line\">        \"username\": \"example\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>正确示例：</p>\n<p>1、获取单个资源详情</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"godruoyi\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、获取资源集合</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"godruoyi\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"username\"</span>: <span class=\"string\">\"foo\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"age\"</span>: <span class=\"number\">88</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>3、额外的媒体信息</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"data\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"avatar\"</span>: <span class=\"string\">\"https://lorempixel.com/640/480/?32556\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"nickname\"</span>: <span class=\"string\">\"fwest\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"last_logined_time\"</span>: <span class=\"string\">\"2018-05-29 04:56:43\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"has_registed\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"id\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"avatar\"</span>: <span class=\"string\">\"https://lorempixel.com/640/480/?86144\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"nickname\"</span>: <span class=\"string\">\"zschowalter\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"last_logined_time\"</span>: <span class=\"string\">\"2018-06-16 15:18:34\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"has_registed\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">\"meta\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"pagination\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"total\"</span>: <span class=\"number\">101</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"count\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"per_page\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"current_page\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"total_pages\"</span>: <span class=\"number\">51</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"links\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"next\"</span>: <span class=\"string\">\"http://api.example.com?page=2\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>其中，分页和其他额外的媒体信息，必须放到 <code>meta</code> 字段中。</p>\n</blockquote>\n<h3 id=\"201-Created\"><a href=\"#201-Created\" class=\"headerlink\" title=\"201 Created\"></a>201 Created</h3><p>当服务器创建数据成功时，<code>应该</code> 返回此状态码。常见的应用场景是使用 <code>POST</code> 提交用户信息，如：</p>\n<ul>\n<li>添加了新用户</li>\n<li>上传了图片</li>\n<li>创建了新活动</li>\n</ul>\n<p>等，都可以返回 <code>201</code> 状态码。需要注意的是，你可以选择在用户创建成功后返回新用户的数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">201</span> Created</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:13:40 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"id\": 1,</span><br><span class=\"line\">    \"avatar\": \"https:\\/\\/lorempixel.com\\/640\\/480\\/?32556\",</span><br><span class=\"line\">    \"nickname\": \"fwest\",</span><br><span class=\"line\">    \"last_logined_time\": \"2018-05-29 04:56:43\",</span><br><span class=\"line\">    \"created_at\": \"2018-06-16 17:55:55\",</span><br><span class=\"line\">    \"updated_at\": \"2018-06-16 17:55:55\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>也可以返回一个响应实体为空的 <code>HTTP Response</code> 如：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">201</span> Created</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:12:20 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里我们 <code>应该</code> 采用第二种方式，因为大多数情况下，客户端只需要知道该请求操作成功与否，并不需要返回新资源的信息。</p>\n</blockquote>\n<h3 id=\"202-Accepted\"><a href=\"#202-Accepted\" class=\"headerlink\" title=\"202 Accepted\"></a>202 Accepted</h3><p>该状态码表示服务器已经接受到了来自客户端的请求，但还未开始处理。常用短信发送、邮件通知、模板消息推送等这类很耗时需要队列支持的场景中；</p>\n<blockquote>\n<p>返回该状态码时，响应实体 <code>必须</code> 为空。</p>\n</blockquote>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">202</span> Accepted</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:25:15 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"204-No-Content\"><a href=\"#204-No-Content\" class=\"headerlink\" title=\"204 No Content\"></a>204 No Content</h3><p>该状态码表示响应实体不包含任何数据，其中：</p>\n<ul>\n<li>在使用 <code>DELETE</code> 方法删除资源 <strong>成功</strong> 时，<code>必须</code> 返回该状态码</li>\n<li>使用 <code>PUT</code>、<code>PATCH</code> 方法更新数据 <strong>成功</strong> 时，也 <code>应该</code> 返回此状态码</li>\n</ul>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">204</span> No Content</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:29:12 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3xx-重定向\"><a href=\"#3xx-重定向\" class=\"headerlink\" title=\"3xx 重定向\"></a>3xx 重定向</h3><p>所有 <code>API</code> <code>不该</code> 返回 <code>3xx</code> 类型的状态码。因为 <code>3xx</code> 类型的响应格式一般为下列格式：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">302</span> Found</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:41:50 GMT</span><br><span class=\"line\"><span class=\"attribute\">Location</span>: https://example.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset=\"UTF-8\" /&gt;</span><br><span class=\"line\">        &lt;meta http-equiv=\"refresh\" content=\"0;url=https://example.com\" /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;title&gt;Redirecting to https://example.com&lt;/title&gt;</span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">    &lt;body&gt;</span><br><span class=\"line\">        Redirecting to &lt;a href=\"https://example.com\"&gt;https://example.com&lt;/a&gt;.</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>所有 <code>API</code> <code>一定不可</code> 返回纯 <code>HTML</code> 结构的响应；若一定要使用重定向功能，<code>可以</code> 返回一个响应实体为空的 <code>3xx</code> 响应，并在响应头中加上 <code>Location</code> 字段:</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">302</span> Found</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: text/html; charset=UTF-8</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 09:52:50 GMT</span><br><span class=\"line\"><span class=\"attribute\">Location</span>: https://godruoyi.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"400-Bad-Request\"><a href=\"#400-Bad-Request\" class=\"headerlink\" title=\"400 Bad Request\"></a>400 Bad Request</h3><p>由于明显的客户端错误（例如，请求语法格式错误、无效的请求、无效的签名等），服务器 <code>应该</code> 放弃该请求。</p>\n<blockquote>\n<p>当服务器无法从其他 4xx 类型的状态码中找出合适的来表示错误类型时，都 <code>必须</code> 返回该状态码。</p>\n</blockquote>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">400</span> Bad Request</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:22:36 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40000,\"message\":\"无效的签名\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"401-Unauthorized\"><a href=\"#401-Unauthorized\" class=\"headerlink\" title=\"401 Unauthorized\"></a>401 Unauthorized</h3><p>该状态码表示当前请求需要身份认证，以下情况都 <code>必须</code> 返回该状态码。</p>\n<ul>\n<li>未认证用户访问需要认证的 API</li>\n<li>access_token 无效/过期</li>\n</ul>\n<blockquote>\n<p>客户端在收到 <code>401</code> 响应后，都 <code>应该</code> 提示用户进行下一步的登录操作。</p>\n</blockquote>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">401</span> Unauthorized</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">WWW-Authenticate</span>: JWTAuth</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:17:02 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"Token Signature could not be verified.\",\"error_code\": \"40100\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"403-Forbidden\"><a href=\"#403-Forbidden\" class=\"headerlink\" title=\"403 Forbidden\"></a>403 Forbidden</h3><p>该状态码可以简单的理解为没有权限访问该请求，服务器收到请求但拒绝提供服务。</p>\n<p>如当普通用户请求操作管理员用户时，<code>必须</code> 返回该状态码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">403</span> Forbidden</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 13:05:34 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40301,\"message\":\"权限不足\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"404-Not-Found\"><a href=\"#404-Not-Found\" class=\"headerlink\" title=\"404 Not Found\"></a>404 Not Found</h3><p>该状态码表示用户请求的资源不存在，如</p>\n<ul>\n<li>获取不存在的用户信息 （get /users/9999999）</li>\n<li>访问不存在的端点</li>\n</ul>\n<p>都 <code>必须</code> 返回该状态码，若该资源已永久不存在，则 <code>应该</code> 返回 <code>410</code> 响应。</p>\n<h3 id=\"405-Method-Not-Allowed\"><a href=\"#405-Method-Not-Allowed\" class=\"headerlink\" title=\"405 Method Not Allowed\"></a>405 Method Not Allowed</h3><p>当客户端使用的 <code>HTTP</code> 请求方法不被服务器允许时，<code>必须</code> 返回该状态码。</p>\n<blockquote>\n<p>如客户端调用了 <code>POST</code> 方法来访问只支持 GET 方法的 API</p>\n</blockquote>\n<p>该响应 <code>必须</code> 返回一个 <code>Allow</code> 头信息用以表示出当前资源能够接受的请求方法的列表。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">405</span> Method Not Allowed</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Allow</span>: GET, HEAD</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:30:57 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"405 Method Not Allowed\",\"error_code\": 40500&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"406-Not-Acceptable\"><a href=\"#406-Not-Acceptable\" class=\"headerlink\" title=\"406 Not Acceptable\"></a>406 Not Acceptable</h3><p><code>API</code> 在不支持客户端指定的数据格式时，应该返回此状态码。如支持 <code>JSON</code> 和 <code>XML</code> 输出的 <code>API</code> 被指定返回 <code>YAML</code> 格式的数据时。</p>\n<blockquote>\n<p>Http 协议一般通过请求首部的 Accept 来指定数据格式</p>\n</blockquote>\n<h3 id=\"408-Request-Timeout\"><a href=\"#408-Request-Timeout\" class=\"headerlink\" title=\"408 Request Timeout\"></a>408 Request Timeout</h3><p>客户端请求超时时 <code>必须</code> 返回该状态码，需要注意的时，该状态码表示 <strong>客户端请求超时</strong>，在涉及第三方 <code>API</code> 调用超时时，<code>一定不可</code> 返回该状态码。</p>\n<h3 id=\"409-Confilct\"><a href=\"#409-Confilct\" class=\"headerlink\" title=\"409 Confilct\"></a>409 Confilct</h3><p>该状态码表示因为请求存在冲突无法处理。如通过手机号码提供注册功能的 <code>API</code>，当用户提交的手机号已存在时，<code>必须</code> 返回此状态码。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">409</span> Conflict</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:19:04 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":40900,\"message\":\"手机号已存在\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"410-Gone\"><a href=\"#410-Gone\" class=\"headerlink\" title=\"410 Gone\"></a>410 Gone</h3><p>和 <code>404</code> 类似，该状态码也表示请求的资源不存在，只是 <code>410</code> 状态码进一步表示所请求的资源已不存在，并且未来也不会存在。在收到 <code>410</code> 状态码后，客户端 <code>应该</code> 停止再次请求该资源。</p>\n<h3 id=\"413-Request-Entity-Too-Large\"><a href=\"#413-Request-Entity-Too-Large\" class=\"headerlink\" title=\"413 Request Entity Too Large\"></a>413 Request Entity Too Large</h3><p>该状态码表示服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。</p>\n<blockquote>\n<p>此种情况下，服务器可以关闭连接以免客户端继续发送此请求。</p>\n</blockquote>\n<p>如果这个状况是临时的，服务器 <code>应该</code> 返回一个 <code>Retry-After</code> 的响应头，以告知客户端可以在多少时间以后重新尝试。</p>\n<h3 id=\"414-Request-URI-Too-Long\"><a href=\"#414-Request-URI-Too-Long\" class=\"headerlink\" title=\"414 Request-URI Too Long\"></a>414 Request-URI Too Long</h3><p>该状态码表示请求的 <code>URI</code> 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。</p>\n<h3 id=\"415-Unsupported-Media-Type\"><a href=\"#415-Unsupported-Media-Type\" class=\"headerlink\" title=\"415 Unsupported Media Type\"></a>415 Unsupported Media Type</h3><p>通常表示服务器不支持客户端请求首部 <code>Content-Type</code> 指定的数据格式。如在只接受 <code>JSON</code> 格式的 <code>API</code> 中放入 <code>XML</code> 类型的数据并向服务器发送，都 <code>应该</code> 返回该状态码。</p>\n<p>该状态码也可用于如：只允许上传图片格式的文件，但是客户端提交媒体文件非法或不是图片类型，这时 <code>应该</code> 返回该状态码：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">415</span> Unsupported Media Type</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 12:09:40 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":41500,\"message\":\"不允许上传的图片格式\"&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"429-Too-Many-Requests\"><a href=\"#429-Too-Many-Requests\" class=\"headerlink\" title=\"429 Too Many Requests\"></a>429 Too Many Requests</h3><p>该状态码表示用户请求次数超过允许范围。如 <code>API</code> 设定为 <code>60次/分钟</code>，当用户在一分钟内请求次数超过 60 次后，都 <code>应该</code> 返回该状态码。并且也 <code>应该</code> 在响应首部中加上下列头部：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">X-RateLimit-Limit</span>: 10 请求速率（由应用设定，其单位一般为小时/分钟等，这里是 10次/5分钟）</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Remaining</span>: 0 当前剩余的请求数量</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Reset</span>: 1529839462 重置时间</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 120 下一次访问应该等待的时间（秒）</span><br></pre></td></tr></table></figure>\n\n<p>列子</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">429</span> Too Many Requests</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Limit</span>: 10</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Remaining</span>: 0</span><br><span class=\"line\"><span class=\"attribute\">X-RateLimit-Reset</span>: 1529839462</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 290</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 11:19:32 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"message\":\"You have exceeded your rate limit.\",\"error_code\":42900&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>必须</code> 为所有的 API 设置 Rate Limit 支持。</p>\n<h3 id=\"500-Internal-Server-Error\"><a href=\"#500-Internal-Server-Error\" class=\"headerlink\" title=\"500 Internal Server Error\"></a>500 Internal Server Error</h3><p>该状态码 <code>必须</code> 在服务器出错时抛出，对于所有的 <code>500</code> 错误，都 <code>应该</code> 提供完整的错误信息支持，也方便跟踪调试。</p>\n<h3 id=\"503-Service-Unavailable\"><a href=\"#503-Service-Unavailable\" class=\"headerlink\" title=\"503 Service Unavailable\"></a>503 Service Unavailable</h3><p>该状态码表示服务器暂时处理不可用状态，当服务器需要维护或第三方 <code>API</code> 请求超时/不可达时，都 <code>应该</code> 返回该状态码，其中若是主动关闭 API 服务，<code>应该</code>在返回的响应首部加上 <code>Retry-After</code> 头部，表示多少秒后可以再次访问。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 <span class=\"number\">503</span> Service Unavailable</span><br><span class=\"line\"><span class=\"attribute\">Server</span>: nginx/1.11.9</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Transfer-Encoding</span>: chunked</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache, private</span><br><span class=\"line\"><span class=\"attribute\">Date</span>: Sun, 24 Jun 2018 10:56:20 GMT</span><br><span class=\"line\"><span class=\"attribute\">Retry-After</span>: 60</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;\"error_code\":50300,\"message\":\"服务维护中\"&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其他 <code>HTTP</code> 状态码请参考 <a href=\"https://zh.wikipedia.org/zh-hans/HTTP状态码\" target=\"_blank\" rel=\"noopener\">HTTP 状态码- 维基百科</a>。</p>\n"},{"_content":"## 前端代码规范\n\n[TOC]\n\n### 1 前言\n\n随着团队人数的增加，每个人的代码编写喜好不同，代码风格也迥然不同。如果有一个大家的统一的愿意遵守的代码规范，肯定事半功倍，提高效率，避免代码`Review`和`重构`。\n\n目前这只是一个基础的版本，如果有哪些规则不太好，大家可以提出` issues` 然后一起沟通协商规则。\n\n其中一部分规则参考了 腾讯`alloyteam`团队的代码规范，如有错误，请指出，将会非常感谢。\n\n坚持好的代码风格规范，从你我做起。\n\n\n\n### 2 命名规范\n\n#### 1) 项目命名\n\n全部采用小写方式， 以下划线分隔。\n\n例：`my_project_name`\n\n#### 2 )目录命名\n\n参照项目命名规则；\n\n有复数结构时，要采用复数命名法。\n\n例：`pages`, `assets`, `directives`, `components`, `mixins`, `utils`\n\n#### 3)`javaScript` 文件命名\n\n参照项目命名规则。\n\n例：`account_model.js`\n\n#### 4)`CSS`,`less`文件命名\n\n参照项目命名规则。\n\n例：`retina_sprites.less`\n\n#### 5)HTML文件命名\n\n参照项目命名规则。\n\n例：`error_report.html`\n\n#### 6) 如果使用`Vue`或者`React`技术栈，组件`Component`命名\n\n所有组件名字需要首字母大写，然后驼峰格式\n\n例：`CalendarList.vue`\n\n### 3 HTML\n\n#### 1) 语法\n\n- 缩进使用soft tab（4个空格）；\n- 嵌套的节点应该缩进；\n- 在属性上，使用双引号，不要使用单引号；\n- 属性名全小写，用中划线做分隔符；\n- 不要在自动闭合标签结尾处使用斜线（[HTML5 规范](http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag) 指出他们是可选的）；\n- 不要忽略可选的关闭标签;\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Page title</title>\n    </head>\n    <body>\n        <img src=\"images/company_logo.png\" alt=\"Company\" />\n\n        <h1 class=\"hello-world\">Hello, world!</h1>\n    </body>\n</html>\n```\n\n#### 2) HTML5 doctype\n\n在页面开头使用这个简单地doctype来启用标准模式，使其在每个浏览器中尽可能一致的展现；\n\n虽然doctype不区分大小写，但是按照惯例，doctype大写 （[关于html属性，大写还是小写](http://stackoverflow.com/questions/15594877/is-there-any-benefits-to-use-uppercase-or-lowercase-letters-with-html5-tagname)）。\n\n```html\n<!DOCTYPE html>\n<html>\n\t...\n</html>\n```\n\n#### 3) lang属性\n\n根据HTML5规范：\n\n> 应在html标签上加上lang属性。这会给语音工具和翻译工具帮助，告诉它们应当怎么去发音和翻译。\n\n更多关于 `lang` 属性的说明[在这里](http://www.w3.org/html/wg/drafts/html/master/semantics.html#the-html-element)；\n\n在sitepoint上可以查到[语言列表](http://reference.sitepoint.com/html/lang-codes)；\n\n但sitepoint只是给出了语言的大类，例如中文只给出了zh，但是没有区分香港，台湾，大陆。而微软给出了一份更加[详细的语言列表](http://msdn.microsoft.com/en-us/library/ms533052(v=vs.85).aspx)，其中细分了zh-cn, zh-hk, zh-tw。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en-us\">\n    ...\n</html>\n```\n\n#### 4) 字符编码\n\n通过声明一个明确的字符编码，让浏览器轻松、快速的确定适合网页内容的渲染方式，通常指定为'UTF-8'。\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n    </head>\n    ...\n</html>\n```\n\n#### 5) IE兼容模式\n\n用 `` 标签可以指定页面应该用什么版本的IE来渲染；\n\n如果你想要了解更多，请点击[这里](http://stackoverflow.com/questions/6771258/whats-the-difference-if-meta-http-equiv-x-ua-compatible-content-ie-edge-e)；\n\n不同doctype在不同浏览器下会触发不同的渲染模式（[这篇文章](https://hsivonen.fi/doctype/)总结的很到位）。\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">\n    </head>\n    ...\n</html>\n```\n\n#### 6) 引入CSS, JS\n\n根据HTML5规范, 通常在引入CSS和JS时不需要指明 `type`，因为 `text/css`和 `text/javascript` 分别是他们的默认值。\n\n**HTML5 规范链接**\n\n- [使用link](http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-link-element)\n- [使用style](http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-style-element)\n- [使用script](http://www.w3.org/TR/2011/WD-html5-20110525/scripting-1.html#the-script-element)\n\n```html\n<!-- External CSS -->\n<link rel=\"stylesheet\" href=\"code_guide.css\">\n\n<!-- In-document CSS -->\n<style>\n    ...\n</style>\n\n<!-- External JS -->\n<script src=\"code_guide.js\"></script>\n\n<!-- In-document JS -->\n<script>\n    ...\n</script>\n```\n\n#### 7) 属性顺序\n\n属性应该按照特定的顺序出现以保证易读性；\n\n- `class`\n- `id`\n- `name`\n- `data-*`\n- `src`, `for`, `type`, `href`, `value` , `max-length`, `max`, `min`, `pattern`\n- `placeholder`, `title`, `alt`\n- `aria-*`, `role`\n- `required`, `readonly`, `disabled`\n\n`class`是为高可复用组件设计的，所以应处在第一位；\n\n`id` 具体且应该尽量少使用，所以将它放在第二位。\n\n```html\n<a class=\"...\" id=\"...\" data-modal=\"toggle\" href=\"#\">Example link</a>\n\n<input class=\"form-control\" type=\"text\">\n\n<img src=\"...\" alt=\"...\">\n```\n\n#### 8) boolean属性\n\nboolean属性指不需要声明取值的属性，XHTML需要每个属性声明取值，但是HTML5并不需要；\n\n更多内容可以参考 [WhatWG section on boolean attributes](http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#boolean-attributes)：\n\n> boolean属性的存在表示取值为true，不存在则表示取值为false。\n\n```html\n<input type=\"text\" disabled>\n\n<input type=\"checkbox\" value=\"1\" checked>\n\n<select>\n    <option value=\"1\" selected>1</option>\n</select>\n```\n\n#### 9) JS生成标签\n\n在JS文件中生成标签让内容变得更难查找，更难编辑，性能更差。应该尽量避免这种情况的出现。\n\n#### 10) 减少标签数量\n\n在编写HTML代码时，需要尽量避免多余的父节点；\n\n很多时候，需要通过迭代和重构来使HTML变得更少。\n\n```html\n<!-- 不建议这么做 -->\n<span class=\"avatar\">\n    <img src=\"...\">\n</span>\n\n<!-- 建议这么做 -->\n<img class=\"avatar\" src=\"...\">\n```\n\n#### 11) 实用高于完美\n\n尽量遵循HTML标准和语义，但是不应该以浪费实用性作为代价；\n\n任何时候都要用尽量小的复杂度和尽量少的标签来解决问题。\n\n### 4 css、less\n\n#### 1) 缩进\n\n使用soft tab（4个空格）\n\n```less\n.element {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n\n    border-radius: 10px;\n    width: 50px;\n    height: 50px;\n}\n```\n\n#### 2)分号\n\n每个属性声明末尾都要加分号。\n\n```less\n.element {\n    width: 20px;\n    height: 20px;\n\n    background-color: red;\n}\n```\n\n#### 3)空格\n\n以下几种情况不需要空格：\n\n- 属性名后\n- 多个规则的分隔符','前\n- `!important` '!'后\n- 属性值中'('后和')'前\n- 行末不要有多余的空格\n\n以下几种情况需要空格：\n\n- 属性值前\n- 选择器'>', '+', '~'前后\n- '{'前\n- `!important` '!'前\n- `@else` 前后\n- 属性值中的','后\n- 注释'/*'后和'*/'前\n\n```less\n/* not good */\n.element {\n    color :red! important;\n    background-color: rgba(0,0,0,.5);\n}\n\n/* good */\n.element {\n    color: red !important;\n    background-color: rgba(0, 0, 0, .5);\n}\n\n/* not good */\n.element ,\n.dialog{\n    ...\n}\n\n/* good */\n.element,\n.dialog {\n\n}\n\n/* not good */\n.element>.dialog{\n    ...\n}\n\n/* good */\n.element > .dialog{\n    ...\n}\n\n/* not good */\n.element{\n    ...\n}\n\n/* good */\n.element {\n    ...\n}\n\n/* not good */\n@debug: true;\n\nheader {\n  background-color: (yellow)when(@debug = true);\n}\n\n\n/* good */\nheader {\n  background-color: (yellow) when (@debug = true);\n}\n```\n\n#### 4) 空行\n\n以下几种情况需要空行：\n\n- 文件最后保留一个空行\n- '}'后最好跟一个空行，包括scss中嵌套的规则\n- 属性之间需要适当的空行，具体见[属性声明顺序](http://alloyteam.github.io/CodeGuide/#css-declaration-order)\n\n```less\n/* not good */\n.element {\n    ...\n}\n.dialog {\n    color: red;\n    &:after {\n        ...\n    }\n}\n\n/* good */\n.element {\n    ...\n}\n\n.dialog {\n    color: red;\n\n    &:after {\n        ...\n    }\n}\n```\n\n#### 5) 注释\n\n注释统一用'/* */'（scss中也不要用'//'），具体参照右边的写法；\n\n缩进与下一行代码保持一致；\n\n可位于一个代码行的末尾，与代码间隔一个空格。\n\n```less\n/* Modal header */\n.modal-header {\n    ...\n}\n\n/*\n * Modal header\n */\n.modal-header {\n    ...\n}\n\n.modal-header {\n    /* 50px */\n    width: 50px;\n\n    color: red; /* color red */\n}\n```\n\n#### 6) 引号\n\n最外层统一使用双引号；\n\nurl的内容要用引号；\n\n属性选择器中的属性值需要引号。\n\n```less\n.element:after {\n    content: \"\";\n    background-image: url(\"logo.png\");\n}\n\nli[data-type=\"single\"] {\n    ...\n}\n```\n\n#### 7)`命名`\n\n- 类名使用`小写字母`，以`中划线`分隔\n- id采用`驼峰式`命名\n- `less`中的变量、函数以`中划线`分隔命名\n\n```less\n/* class */\n.element-content {\n    ...\n}\n\n/* id */\n#myDialog {\n    ...\n}\n\n/* 变量 */\n@color-black: #000;\n\n/* mixins */\n.my-mixin() {\n  color: black;\n}\n\n```\n\n#### 8)`属性声明顺序`\n\n相关的属性声明按右边的顺序做分组处理，组之间需要有一个空行。\n\n```less\n.declaration-order {\n    display: block;\n    float: right;\n\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    z-index: 100;\n\n    border: 1px solid #e5e5e5;\n    border-radius: 3px;\n    width: 100px;\n    height: 100px;\n\n    font: normal 13px \"Helvetica Neue\", sans-serif;\n    line-height: 1.5;\n    text-align: center;\n\n    color: #333;\n    background-color: #f5f5f5;\n\n    opacity: 1;\n}\n```\n\n`书写顺序前后`为：\n\n（1）`定位属性`：position  display  float  left  top  right  bottom   overflow  clear   z-index\n\n（2）`自身属性`：width  height  padding  border  margin   background\n\n（3）`文字样式`：font-family   font-size   font-style   font-weight   font-varient   color\n\n（4）`文本属性`text-align   vertical-align   text-wrap   text-transform   text-indent    text-decoration   letter-spacing    word-spacing    white-space   text-overflow\n\n**目的**：减少浏览器reflow（回流），提升浏览器渲染dom的性能\n\n`原理：浏览器的渲染流程为：`\n\n1、解析html构建dom树，解析css构建css树：将html解析成树形的数据结构，将css解析成树形的数据结构\n\n2、构建render树：DOM树和CSS树合并之后形成的render树。\n\n3、布局render树：有了render树，浏览器已经知道那些网页中有哪些节点，各个节点的css定义和以及它们的从属关系，从而计算出每个节点在屏幕中的位置。\n\n4、绘制render树：按照计算出来的规则，通过显卡把内容画在屏幕上。\n\ncss样式解析到显示至浏览器屏幕上就发生在234步骤，可见浏览器并不是一获取到css样式就立马开始解析而是根据css样式的书写顺序将之按照dom树的结构分布render样式，完成第2步，然后开始遍历每个树结点的css样式进行解析，此时的css样式的遍历顺序完全是按照之前的书写顺序。在解析过程中，一旦浏览器发现某个元素的定位变化影响布局，则需要倒回去重新渲染正如按照这样的书写书序：\n\n```less\n.demo{\n    width: 100px;\n\theight: 100px;\n\tbackground-color: red ;\n\n\tposition: absolute;\n}\n```\n\n当浏览器解析到position的时候突然发现该元素是绝对定位元素需要脱离文档流，而之前却是按照普通元素进行解析的，所以不得不重新渲染，解除该元素在文档中所占位置，然而由于该元素的占位发生变化，其他元素也可能会受到它回流的影响而重新排位。最终导致③步骤花费的时间太久而影响到④步骤的显示，影响了用户体验。\n\n```less\n// 下面是推荐的属性的顺序\n[\n    [\n        \"display\",\n        \"visibility\",\n        \"float\",\n        \"clear\",\n        \"overflow\",\n        \"overflow-x\",\n        \"overflow-y\",\n        \"clip\",\n        \"zoom\"\n    ],\n    [\n        \"table-layout\",\n        \"empty-cells\",\n        \"caption-side\",\n        \"border-spacing\",\n        \"border-collapse\",\n        \"list-style\",\n        \"list-style-position\",\n        \"list-style-type\",\n        \"list-style-image\"\n    ],\n    [\n        \"-webkit-box-orient\",\n        \"-webkit-box-direction\",\n        \"-webkit-box-decoration-break\",\n        \"-webkit-box-pack\",\n        \"-webkit-box-align\",\n        \"-webkit-box-flex\"\n    ],\n    [\n        \"position\",\n        \"top\",\n        \"right\",\n        \"bottom\",\n        \"left\",\n        \"z-index\"\n    ],\n    [\n        \"margin\",\n        \"margin-top\",\n        \"margin-right\",\n        \"margin-bottom\",\n        \"margin-left\",\n        \"-webkit-box-sizing\",\n        \"-moz-box-sizing\",\n        \"box-sizing\",\n        \"border\",\n        \"border-width\",\n        \"border-style\",\n        \"border-color\",\n        \"border-top\",\n        \"border-top-width\",\n        \"border-top-style\",\n        \"border-top-color\",\n        \"border-right\",\n        \"border-right-width\",\n        \"border-right-style\",\n        \"border-right-color\",\n        \"border-bottom\",\n        \"border-bottom-width\",\n        \"border-bottom-style\",\n        \"border-bottom-color\",\n        \"border-left\",\n        \"border-left-width\",\n        \"border-left-style\",\n        \"border-left-color\",\n        \"-webkit-border-radius\",\n        \"-moz-border-radius\",\n        \"border-radius\",\n        \"-webkit-border-top-left-radius\",\n        \"-moz-border-radius-topleft\",\n        \"border-top-left-radius\",\n        \"-webkit-border-top-right-radius\",\n        \"-moz-border-radius-topright\",\n        \"border-top-right-radius\",\n        \"-webkit-border-bottom-right-radius\",\n        \"-moz-border-radius-bottomright\",\n        \"border-bottom-right-radius\",\n        \"-webkit-border-bottom-left-radius\",\n        \"-moz-border-radius-bottomleft\",\n        \"border-bottom-left-radius\",\n        \"-webkit-border-image\",\n        \"-moz-border-image\",\n        \"-o-border-image\",\n        \"border-image\",\n        \"-webkit-border-image-source\",\n        \"-moz-border-image-source\",\n        \"-o-border-image-source\",\n        \"border-image-source\",\n        \"-webkit-border-image-slice\",\n        \"-moz-border-image-slice\",\n        \"-o-border-image-slice\",\n        \"border-image-slice\",\n        \"-webkit-border-image-width\",\n        \"-moz-border-image-width\",\n        \"-o-border-image-width\",\n        \"border-image-width\",\n        \"-webkit-border-image-outset\",\n        \"-moz-border-image-outset\",\n        \"-o-border-image-outset\",\n        \"border-image-outset\",\n        \"-webkit-border-image-repeat\",\n        \"-moz-border-image-repeat\",\n        \"-o-border-image-repeat\",\n        \"border-image-repeat\",\n        \"padding\",\n        \"padding-top\",\n        \"padding-right\",\n        \"padding-bottom\",\n        \"padding-left\",\n        \"width\",\n        \"min-width\",\n        \"max-width\",\n        \"height\",\n        \"min-height\",\n        \"max-height\"\n    ],\n    [\n        \"font\",\n        \"font-family\",\n        \"font-size\",\n        \"font-weight\",\n        \"font-style\",\n        \"font-variant\",\n        \"font-size-adjust\",\n        \"font-stretch\",\n        \"font-effect\",\n        \"font-emphasize\",\n        \"font-emphasize-position\",\n        \"font-emphasize-style\",\n        \"font-smooth\",\n        \"line-height\",\n        \"text-align\",\n        \"-webkit-text-align-last\",\n        \"-moz-text-align-last\",\n        \"-ms-text-align-last\",\n        \"text-align-last\",\n        \"vertical-align\",\n        \"white-space\",\n        \"text-decoration\",\n        \"text-emphasis\",\n        \"text-emphasis-color\",\n        \"text-emphasis-style\",\n        \"text-emphasis-position\",\n        \"text-indent\",\n        \"-ms-text-justify\",\n        \"text-justify\",\n        \"letter-spacing\",\n        \"word-spacing\",\n        \"-ms-writing-mode\",\n        \"text-outline\",\n        \"text-transform\",\n        \"text-wrap\",\n        \"-ms-text-overflow\",\n        \"text-overflow\",\n        \"text-overflow-ellipsis\",\n        \"text-overflow-mode\",\n        \"-ms-word-wrap\",\n        \"word-wrap\",\n        \"-ms-word-break\",\n        \"word-break\"\n    ],\n    [\n        \"color\",\n        \"background\",\n        \"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader\",\n        \"background-color\",\n        \"background-image\",\n        \"background-repeat\",\n        \"background-attachment\",\n        \"background-position\",\n        \"-ms-background-position-x\",\n        \"background-position-x\",\n        \"-ms-background-position-y\",\n        \"background-position-y\",\n        \"-webkit-background-clip\",\n        \"-moz-background-clip\",\n        \"background-clip\",\n        \"background-origin\",\n        \"-webkit-background-size\",\n        \"-moz-background-size\",\n        \"-o-background-size\",\n        \"background-size\"\n    ],\n    [\n        \"outline\",\n        \"outline-width\",\n        \"outline-style\",\n        \"outline-color\",\n        \"outline-offset\",\n        \"opacity\",\n        \"filter:progid:DXImageTransform.Microsoft.Alpha(Opacity\",\n        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.Alpha\",\n        \"-ms-interpolation-mode\",\n        \"-webkit-box-shadow\",\n        \"-moz-box-shadow\",\n        \"box-shadow\",\n        \"filter:progid:DXImageTransform.Microsoft.gradient\",\n        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.gradient\",\n        \"text-shadow\"\n    ],\n    [\n        \"-webkit-transition\",\n        \"-moz-transition\",\n        \"-ms-transition\",\n        \"-o-transition\",\n        \"transition\",\n        \"-webkit-transition-delay\",\n        \"-moz-transition-delay\",\n        \"-ms-transition-delay\",\n        \"-o-transition-delay\",\n        \"transition-delay\",\n        \"-webkit-transition-timing-function\",\n        \"-moz-transition-timing-function\",\n        \"-ms-transition-timing-function\",\n        \"-o-transition-timing-function\",\n        \"transition-timing-function\",\n        \"-webkit-transition-duration\",\n        \"-moz-transition-duration\",\n        \"-ms-transition-duration\",\n        \"-o-transition-duration\",\n        \"transition-duration\",\n        \"-webkit-transition-property\",\n        \"-moz-transition-property\",\n        \"-ms-transition-property\",\n        \"-o-transition-property\",\n        \"transition-property\",\n        \"-webkit-transform\",\n        \"-moz-transform\",\n        \"-ms-transform\",\n        \"-o-transform\",\n        \"transform\",\n        \"-webkit-transform-origin\",\n        \"-moz-transform-origin\",\n        \"-ms-transform-origin\",\n        \"-o-transform-origin\",\n        \"transform-origin\",\n        \"-webkit-animation\",\n        \"-moz-animation\",\n        \"-ms-animation\",\n        \"-o-animation\",\n        \"animation\",\n        \"-webkit-animation-name\",\n        \"-moz-animation-name\",\n        \"-ms-animation-name\",\n        \"-o-animation-name\",\n        \"animation-name\",\n        \"-webkit-animation-duration\",\n        \"-moz-animation-duration\",\n        \"-ms-animation-duration\",\n        \"-o-animation-duration\",\n        \"animation-duration\",\n        \"-webkit-animation-play-state\",\n        \"-moz-animation-play-state\",\n        \"-ms-animation-play-state\",\n        \"-o-animation-play-state\",\n        \"animation-play-state\",\n        \"-webkit-animation-timing-function\",\n        \"-moz-animation-timing-function\",\n        \"-ms-animation-timing-function\",\n        \"-o-animation-timing-function\",\n        \"animation-timing-function\",\n        \"-webkit-animation-delay\",\n        \"-moz-animation-delay\",\n        \"-ms-animation-delay\",\n        \"-o-animation-delay\",\n        \"animation-delay\",\n        \"-webkit-animation-iteration-count\",\n        \"-moz-animation-iteration-count\",\n        \"-ms-animation-iteration-count\",\n        \"-o-animation-iteration-count\",\n        \"animation-iteration-count\",\n        \"-webkit-animation-direction\",\n        \"-moz-animation-direction\",\n        \"-ms-animation-direction\",\n        \"-o-animation-direction\",\n        \"animation-direction\"\n    ],\n    [\n        \"content\",\n        \"quotes\",\n        \"counter-reset\",\n        \"counter-increment\",\n        \"resize\",\n        \"cursor\",\n        \"-webkit-user-select\",\n        \"-moz-user-select\",\n        \"-ms-user-select\",\n        \"user-select\",\n        \"nav-index\",\n        \"nav-up\",\n        \"nav-right\",\n        \"nav-down\",\n        \"nav-left\",\n        \"-moz-tab-size\",\n        \"-o-tab-size\",\n        \"tab-size\",\n        \"-webkit-hyphens\",\n        \"-moz-hyphens\",\n        \"hyphens\",\n        \"pointer-events\"\n    ]\n]\n```\n\n#### 9)颜色\n\n颜色16进制用小写字母；\n\n颜色16进制尽量用简写。\n\n```less\n/* not good */\n.element {\n    color: #ABCDEF;\n    background-color: #001122;\n}\n\n/* good */\n.element {\n    color: #abcdef;\n    background-color: #012;\n}\n```\n\n#### 10)属性简写\n\n属性简写需要你非常清楚属性值的正确顺序，而且在大多数情况下并不需要设置属性简写中包含的所有值，所以建议尽量分开声明会更加清晰；\n\n`margin` 和 `padding` 相反，需要使用简写；\n\n常见的属性简写包括：\n\n- `font`\n- `background`\n- `transition`\n- `animation`\n\n```less\n/* not good */\n.element {\n    transition: opacity 1s linear 2s;\n}\n\n/* good */\n.element {\n    transition-delay: 2s;\n    transition-timing-function: linear;\n    transition-duration: 1s;\n    transition-property: opacity;\n}\n```\n\n#### 11)`媒体查询`\n\n尽量将媒体查询的规则靠近与他们相关的规则，不要将他们一起放到一个独立的样式文件中，或者丢在文档的最底部，这样做只会让大家以后更容易忘记他们。\n\n```less\n.element {\n    ...\n}\n\n.element-avatar{\n    ...\n}\n\n@media (min-width: 480px) {\n    .element {\n        ...\n    }\n\n    .element-avatar {\n        ...\n    }\n}\n```\n\n#### 12)`Less相关`\n\n每个模块应该有一个单独的less, 然后每个最外层的父类 className 应该写在第一位，所有子Node的样式都写在里面，这样是为了避免命名冲突。比如\n\n```less\n//out: false\n.parent-name{\n\n    .child-name{\n        ...\n    }\n\n    ...\n}\n```\n\n`@import` 引入的文件不需要结尾的'.less'\n\n`LESS嵌套最多不能超过5层`；\n\n不允许有空的规则；\n\n元素选择器用小写字母；\n\n去掉小数点前面的0；\n\n去掉数字中不必要的小数点和末尾的0；\n\n属性值'0'后面不要加单位；\n\n同个属性不同前缀的写法需要在垂直方向保持对齐，具体参照右边的写法；\n\n无前缀的标准属性应该写在有前缀的属性后面；\n\n不要在同个规则里出现重复的属性，如果重复的属性是连续的则没关系；\n\n不要在一个文件里出现两个相同的规则；\n\n用 `border: 0;` 代替 `border: none;`；\n\n`CSS选择器不要超过3层`；\n\n尽量少用`'*'`选择器。\n\n```less\n/* not good */\n.element {\n}\n\n/* not good */\nLI {\n    ...\n}\n\n/* good */\nli {\n    ...\n}\n\n/* not good */\n.element {\n    color: rgba(0, 0, 0, 0.5);\n}\n\n/* good */\n.element {\n    color: rgba(0, 0, 0, .5);\n}\n\n/* not good */\n.element {\n    width: 50.0px;\n}\n\n/* good */\n.element {\n    width: 50px;\n}\n\n/* not good */\n.element {\n    width: 0px;\n}\n\n/* good */\n.element {\n    width: 0;\n}\n\n/* not good */\n.element {\n    border-radius: 3px;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n\n    background: linear-gradient(to bottom, #fff 0, #eee 100%);\n    background: -webkit-linear-gradient(top, #fff 0, #eee 100%);\n    background: -moz-linear-gradient(top, #fff 0, #eee 100%);\n}\n\n/* good */\n.element {\n    -webkit-border-radius: 3px;\n       -moz-border-radius: 3px;\n            border-radius: 3px;\n\n    background: -webkit-linear-gradient(top, #fff 0, #eee 100%);\n    background:    -moz-linear-gradient(top, #fff 0, #eee 100%);\n    background:         linear-gradient(to bottom, #fff 0, #eee 100%);\n}\n\n/* not good */\n.element {\n    color: rgb(0, 0, 0);\n    width: 50px;\n    color: rgba(0, 0, 0, .5);\n}\n\n/* good */\n.element {\n    color: rgb(0, 0, 0);\n    color: rgba(0, 0, 0, .5);\n}\n```\n\n### 5 JavaScript\n\n#### 1)缩进\n\n使用soft tab（4个空格）。\n\n```javascript\nvar x = 1,\n    y = 1;\n\nif (x < y) {\n    x += 10;\n} else {\n    x += 1;\n}\n```\n\n#### 2)分号\n\n以下几种情况后需加分号：\n\n- 变量声明\n- 表达式\n- return\n- throw\n- break\n- continue\n- do-while\n\n```javascript\n/* var declaration */\nvar x = 1;\n\n/* expression statement */\nx++;\n\n/* do-while */\ndo {\n    x++;\n} while (x < 10);\n```\n\n#### 3)空格\n\n以下几种情况不需要空格：\n\n- 对象的属性名后\n- 前缀一元运算符后\n- 后缀一元运算符前\n- 函数调用括号前\n- 无论是函数声明还是函数表达式，'('前不要空格\n- 数组的'['后和']'前\n- 对象的'{'后和'}'前\n- 运算符'('后和')'前\n\n以下几种情况需要空格：\n\n- 二元运算符前后\n- 三元运算符'?:'前后\n- 代码块'{'前\n- 下列关键字前：`else`, `while`, `catch`, `finally`\n- 下列关键字后：`if`, `else`, `for`, `while`, `do`, `switch`, `case`, `try`,`catch`, `finally`, `with`, `return`, `typeof`\n- 单行注释'//'后（若单行注释和代码同行，则'//'前也需要），多行注释'*'后\n- 对象的属性值前\n- for循环，分号后留有一个空格，前置条件如果有多个，逗号后留一个空格\n- 无论是函数声明还是函数表达式，'{'前一定要有空格\n- 函数的参数之间\n\n```javascript\n// not good\nvar a = {\n    b :1\n};\n\n// good\nvar a = {\n    b: 1\n};\n\n// not good\n++ x;\ny ++;\nz = x?1:2;\n\n// good\n++x;\ny++;\nz = x ? 1 : 2;\n\n// not good\nvar a = [ 1, 2 ];\n\n// good\nvar a = [1, 2];\n\n// not good\nvar a = ( 1+2 )*3;\n\n// good\nvar a = (1 + 2) * 3;\n\n// no space before '(', one space before '{', one space between function parameters\nvar doSomething = function(a, b, c) {\n    // do something\n};\n\n// no space before '('\ndoSomething(item);\n\n// not good\nfor(i=0;i<6;i++){\n    x++;\n}\n\n// good\nfor (i = 0; i < 6; i++) {\n    x++;\n}\n```\n\n#### 4)空行\n\n以下几种情况需要空行：\n\n- 变量声明后（当变量声明在代码块的最后一行时，则无需空行）\n- 注释前（当注释在代码块的第一行时，则无需空行）\n- 代码块后（在函数调用、数组、对象中则无需空行）\n- 文件最后保留一个空行\n\n```javascript\n// need blank line after variable declaration\nvar x = 1;\n\n// not need blank line when variable declaration is last expression in the current block\nif (x >= 1) {\n    var y = x + 1;\n}\n\nvar a = 2;\n\n// need blank line before line comment\na++;\n\nfunction b() {\n    // not need blank line when comment is first line of block\n    return a;\n}\n\n// need blank line after blocks\nfor (var i = 0; i < 2; i++) {\n    if (true) {\n        return false;\n    }\n\n    continue;\n}\n\nvar obj = {\n    foo: function() {\n        return 1;\n    },\n\n    bar: function() {\n        return 2;\n    }\n};\n\n// not need blank line when in argument list, array, object\nfunc(\n    2,\n    function() {\n        a++;\n    },\n    3\n);\n\nvar foo = [\n    2,\n    function() {\n        a++;\n    },\n    3\n];\n\nvar foo = {\n    a: 2,\n    b: function() {\n        a++;\n    },\n    c: 3\n};\n```\n\n#### 5)换行\n\n换行的地方，行末必须有','或者运算符；\n\n以下几种情况不需要换行：\n\n- 下列关键字后：`else`, `catch`, `finally`\n- 代码块'{'前\n\n以下几种情况需要换行：\n\n- 代码块'{'后和'}'前\n- 变量赋值后\n\n```javascript\n// not good\nvar a = {\n    b: 1\n    , c: 2\n};\n\nx = y\n    ? 1 : 2;\n\n// good\nvar a = {\n    b: 1,\n    c: 2\n};\n\nx = y ? 1 : 2;\nx = y ?\n    1 : 2;\n\n// no need line break with 'else', 'catch', 'finally'\nif (condition) {\n    ...\n} else {\n    ...\n}\n\ntry {\n    ...\n} catch (e) {\n    ...\n} finally {\n    ...\n}\n\n// not good\nfunction test()\n{\n    ...\n}\n\n// good\nfunction test() {\n    ...\n}\n\n// not good\nvar a, foo = 7, b,\n    c, bar = 8;\n\n// good\nvar a,\n    foo = 7,\n    b, c, bar = 8;\n```\n\n#### 6)单行注释\n\n双斜线后，必须跟一个空格；\n\n缩进与下一行代码保持一致；\n\n可位于一个代码行的末尾，与代码间隔一个空格。\n\n```javascript\nif (condition) {\n    // if you made it here, then all security checks passed\n    allowed();\n}\n\nvar zhangsan = 'zhangsan'; // one space after code\n```\n\n#### 7)多行注释\n\n最少三行, '*'后跟一个空格，具体参照右边的写法；\n\n建议在以下情况下使用：\n\n- 难于理解的代码段\n- 可能存在错误的代码段\n- 浏览器特殊的HACK代码\n- 业务逻辑强相关的代码\n\n```javascript\n/*\n * one space after '*'\n */\nvar x = 1;\n```\n\n#### 8)`文档注释`\n\n各类标签@param, @method等请参考[usejsdoc](http://usejsdoc.org/)和[JSDoc Guide](http://yuri4ever.github.io/jsdoc/)；\n\n建议在以下情况下使用：\n\n- 所有常量\n- 所有函数\n- 所有类\n\n```\n/**\n * @func\n * @desc 一个带参数的函数\n * @param {string} a - 参数a\n * @param {number} b=1 - 参数b默认值为1\n * @param {string} c=1 - 参数c有两种支持的取值</br>1—表示x</br>2—表示xx\n * @param {object} d - 参数d为一个对象\n * @param {string} d.e - 参数d的e属性\n * @param {string} d.f - 参数d的f属性\n * @param {object[]} g - 参数g为一个对象数组\n * @param {string} g.h - 参数g数组中一项的h属性\n * @param {string} g.i - 参数g数组中一项的i属性\n * @param {string} [j] - 参数j是一个可选参数\n */\nfunction foo(a, b, c, d, g, j) {\n    ...\n}\n```\n\n#### 9)引号\n\n最外层统一使用单引号。\n\n```javascript\n// not good\nvar x = \"test\";\n\n// good\nvar y = 'foo',\n    z = '<div id=\"test\"></div>';\n```\n\n#### 10)变量命名\n\n- 标准变量采用驼峰式命名（除了对象的属性外，主要是考虑到cgi返回的数据）\n- 'ID'在变量名中全大写\n- 'URL'在变量名中全大写\n- 'Android'在变量名中大写第一个字母\n- 'iOS'在变量名中小写第一个，大写后两个字母\n- 常量全大写，用下划线连接\n- 构造函数，大写第一个字母\n- jquery对象必须以'$'开头命名\n\n```javascript\nvar thisIsMyName;\n\nvar goodID;\n\nvar reportURL;\n\nvar AndroidVersion;\n\nvar iOSVersion;\n\nvar MAX_COUNT = 10;\n\nfunction Person(name) {\n    this.name = name;\n}\n\n// not good\nvar body = $('body');\n\n// good\nvar $body = $('body');\n```\n\n#### 11)变量声明\n\n一个函数作用域中所有的变量声明尽量提到函数首部，用一个var 声明，不允许出现两个连续的var声明。\n\n```javascript\nfunction doSomethingWithItems(items) {\n    // use one var\n    var value = 10,\n        result = value + 10,\n        i,\n        len;\n\n    for (i = 0, len = items.length; i < len; i++) {\n        result += 10;\n    }\n}\n```\n\n#### 12)函数\n\n无论是函数声明还是函数表达式，'('前不要空格，但'{'前一定要有空格；\n\n函数调用括号前不需要空格；\n\n立即执行函数外必须包一层括号；\n\n不要给inline function命名；\n\n参数之间用', '分隔，注意逗号后有一个空格。\n\n```javascript\n// no space before '(', but one space before'{'\nvar doSomething = function(item) {\n    // do something\n};\n\nfunction doSomething(item) {\n    // do something\n}\n\n// not good\ndoSomething (item);\n\n// good\ndoSomething(item);\n\n// requires parentheses around immediately invoked function expressions\n(function() {\n    return 1;\n})();\n\n// not good\n[1, 2].forEach(function x() {\n    ...\n});\n\n// good\n[1, 2].forEach(function() {\n    ...\n});\n\n// not good\nvar a = [1, 2, function a() {\n    ...\n}];\n\n// good\nvar a = [1, 2, function() {\n    ...\n}];\n\n// use ', ' between function parameters\nvar doSomething = function(a, b, c) {\n    // do something\n};\n```\n\n#### 13)数组、对象\n\n对象属性名不需要加引号；\n\n对象以缩进的形式书写，不要写在一行；\n\n数组、对象最后不要有逗号。\n\n```javascript\n// not good\nvar a = {\n    'b': 1\n};\n\nvar a = {b: 1};\n\nvar a = {\n    b: 1,\n    c: 2,\n};\n\n// good\nvar a = {\n    b: 1,\n    c: 2\n};\n```\n\n#### 14)括号\n\n下列关键字后必须有大括号（即使代码块的内容只有一行）：`if`, `else`,`for`, `while`, `do`, `switch`, `try`, `catch`, `finally`, `with`。\n\n```javascript\n// not good\nif (condition)\n    doSomething();\n\n// good\nif (condition) {\n    doSomething();\n}\n```\n\n#### 15)null\n\n适用场景：\n\n- 初始化一个将来可能被赋值为对象的变量\n- 与已经初始化的变量做比较\n- 作为一个参数为对象的函数的调用传参\n- 作为一个返回对象的函数的返回值\n\n不适用场景：\n\n- 不要用null来判断函数调用时有无传参\n- 不要与未初始化的变量做比较\n\n```javascript\n// not good\nfunction test(a, b) {\n    if (b `= null) {\n        // not mean b is not supply\n        ...\n    }\n}\n\nvar a;\n\nif (a `= null) {\n    ...\n}\n\n// good\nvar a = null;\n\nif (a `= null) {\n    ...\n}\n```\n\n#### 16)undefined\n\n永远不要直接使用undefined进行变量判断；\n\n使用typeof和字符串'undefined'对变量进行判断。\n\n```javascript\n// not good\nif (person `= undefined) {\n    ...\n}\n\n// good\nif (typeof person `= 'undefined') {\n    ...\n}\n```\n\n#### 17)jshint\n\n用'`=', '!`'代替'`', '!='；\n\nfor-in里一定要有hasOwnProperty的判断；\n\n不要在内置对象的原型上添加方法，如Array, Date；\n\n不要在内层作用域的代码里声明了变量，之后却访问到了外层作用域的同名变量；\n\n变量不要先使用后声明；\n\n不要在一句代码中单单使用构造函数，记得将其赋值给某个变量；\n\n不要在同个作用域下声明同名变量；\n\n不要在一些不需要的地方加括号，例：delete(a.b)；\n\n不要使用未声明的变量（全局变量需要加到.jshintrc文件的globals属性里面）；\n\n不要声明了变量却不使用；\n\n不要在应该做比较的地方做赋值；\n\ndebugger不要出现在提交的代码里；\n\n数组中不要存在空元素；\n\n不要在循环内部声明函数；\n\n不要像这样使用构造函数，例：`new function () { ... }`, `new Object`；\n\n```javascript\n// not good\nif (a ` 1) {\n    a++;\n}\n\n// good\nif (a `= 1) {\n    a++;\n}\n\n// good\nfor (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n        // be sure that obj[key] belongs to the object and was not inherited\n        console.log(obj[key]);\n    }\n}\n\n// not good\nArray.prototype.count = function(value) {\n    return 4;\n};\n\n// not good\nvar x = 1;\n\nfunction test() {\n    if (true) {\n        var x = 0;\n    }\n\n    x += 1;\n}\n\n// not good\nfunction test() {\n    console.log(x);\n\n    var x = 1;\n}\n\n// not good\nnew Person();\n\n// good\nvar person = new Person();\n\n// not good\ndelete(obj.attr);\n\n// good\ndelete obj.attr;\n\n// not good\nif (a = 10) {\n    a++;\n}\n\n// not good\nvar a = [1, , , 2, 3];\n\n// not good\nvar nums = [];\n\nfor (var i = 0; i < 10; i++) {\n    (function(i) {\n        nums[i] = function(j) {\n            return i + j;\n        };\n    }(i));\n}\n\n// not good\nvar singleton = new function() {\n    var privateVar;\n\n    this.publicMethod = function() {\n        privateVar = 1;\n    };\n\n    this.publicMethod2 = function() {\n        privateVar = 2;\n    };\n};\n```\n\n#### 18)杂项\n\n不要混用tab和space；\n\n不要在一处使用多个tab或space；\n\n换行符统一用'LF'；\n\n对上下文this的引用只能使用'_this', 'that', 'self'其中一个来命名；\n\n行尾不要有空白字符；\n\nswitch的falling through和no default的情况一定要有注释特别说明；\n\n不允许有空的代码块。\n\n```javascript\n// not good\nvar a   = 1;\n\nfunction Person() {\n    // not good\n    var me = this;\n\n    // good\n    var _this = this;\n\n    // good\n    var that = this;\n\n    // good\n    var self = this;\n}\n\n// good\nswitch (condition) {\n    case 1:\n    case 2:\n        ...\n        break;\n    case 3:\n        ...\n    // why fall through\n    case 4\n        ...\n        break;\n    // why no default\n}\n\n// not good with empty block\nif (condition) {\n\n}\n```\n","source":"_posts/前端规范.md","raw":"---\ncategories:\n- 技术\ntags:\n- 前端\n---\n## 前端代码规范\n\n[TOC]\n\n### 1 前言\n\n随着团队人数的增加，每个人的代码编写喜好不同，代码风格也迥然不同。如果有一个大家的统一的愿意遵守的代码规范，肯定事半功倍，提高效率，避免代码`Review`和`重构`。\n\n目前这只是一个基础的版本，如果有哪些规则不太好，大家可以提出` issues` 然后一起沟通协商规则。\n\n其中一部分规则参考了 腾讯`alloyteam`团队的代码规范，如有错误，请指出，将会非常感谢。\n\n坚持好的代码风格规范，从你我做起。\n\n\n\n### 2 命名规范\n\n#### 1) 项目命名\n\n全部采用小写方式， 以下划线分隔。\n\n例：`my_project_name`\n\n#### 2 )目录命名\n\n参照项目命名规则；\n\n有复数结构时，要采用复数命名法。\n\n例：`pages`, `assets`, `directives`, `components`, `mixins`, `utils`\n\n#### 3)`javaScript` 文件命名\n\n参照项目命名规则。\n\n例：`account_model.js`\n\n#### 4)`CSS`,`less`文件命名\n\n参照项目命名规则。\n\n例：`retina_sprites.less`\n\n#### 5)HTML文件命名\n\n参照项目命名规则。\n\n例：`error_report.html`\n\n#### 6) 如果使用`Vue`或者`React`技术栈，组件`Component`命名\n\n所有组件名字需要首字母大写，然后驼峰格式\n\n例：`CalendarList.vue`\n\n### 3 HTML\n\n#### 1) 语法\n\n- 缩进使用soft tab（4个空格）；\n- 嵌套的节点应该缩进；\n- 在属性上，使用双引号，不要使用单引号；\n- 属性名全小写，用中划线做分隔符；\n- 不要在自动闭合标签结尾处使用斜线（[HTML5 规范](http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag) 指出他们是可选的）；\n- 不要忽略可选的关闭标签;\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Page title</title>\n    </head>\n    <body>\n        <img src=\"images/company_logo.png\" alt=\"Company\" />\n\n        <h1 class=\"hello-world\">Hello, world!</h1>\n    </body>\n</html>\n```\n\n#### 2) HTML5 doctype\n\n在页面开头使用这个简单地doctype来启用标准模式，使其在每个浏览器中尽可能一致的展现；\n\n虽然doctype不区分大小写，但是按照惯例，doctype大写 （[关于html属性，大写还是小写](http://stackoverflow.com/questions/15594877/is-there-any-benefits-to-use-uppercase-or-lowercase-letters-with-html5-tagname)）。\n\n```html\n<!DOCTYPE html>\n<html>\n\t...\n</html>\n```\n\n#### 3) lang属性\n\n根据HTML5规范：\n\n> 应在html标签上加上lang属性。这会给语音工具和翻译工具帮助，告诉它们应当怎么去发音和翻译。\n\n更多关于 `lang` 属性的说明[在这里](http://www.w3.org/html/wg/drafts/html/master/semantics.html#the-html-element)；\n\n在sitepoint上可以查到[语言列表](http://reference.sitepoint.com/html/lang-codes)；\n\n但sitepoint只是给出了语言的大类，例如中文只给出了zh，但是没有区分香港，台湾，大陆。而微软给出了一份更加[详细的语言列表](http://msdn.microsoft.com/en-us/library/ms533052(v=vs.85).aspx)，其中细分了zh-cn, zh-hk, zh-tw。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en-us\">\n    ...\n</html>\n```\n\n#### 4) 字符编码\n\n通过声明一个明确的字符编码，让浏览器轻松、快速的确定适合网页内容的渲染方式，通常指定为'UTF-8'。\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n    </head>\n    ...\n</html>\n```\n\n#### 5) IE兼容模式\n\n用 `` 标签可以指定页面应该用什么版本的IE来渲染；\n\n如果你想要了解更多，请点击[这里](http://stackoverflow.com/questions/6771258/whats-the-difference-if-meta-http-equiv-x-ua-compatible-content-ie-edge-e)；\n\n不同doctype在不同浏览器下会触发不同的渲染模式（[这篇文章](https://hsivonen.fi/doctype/)总结的很到位）。\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">\n    </head>\n    ...\n</html>\n```\n\n#### 6) 引入CSS, JS\n\n根据HTML5规范, 通常在引入CSS和JS时不需要指明 `type`，因为 `text/css`和 `text/javascript` 分别是他们的默认值。\n\n**HTML5 规范链接**\n\n- [使用link](http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-link-element)\n- [使用style](http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-style-element)\n- [使用script](http://www.w3.org/TR/2011/WD-html5-20110525/scripting-1.html#the-script-element)\n\n```html\n<!-- External CSS -->\n<link rel=\"stylesheet\" href=\"code_guide.css\">\n\n<!-- In-document CSS -->\n<style>\n    ...\n</style>\n\n<!-- External JS -->\n<script src=\"code_guide.js\"></script>\n\n<!-- In-document JS -->\n<script>\n    ...\n</script>\n```\n\n#### 7) 属性顺序\n\n属性应该按照特定的顺序出现以保证易读性；\n\n- `class`\n- `id`\n- `name`\n- `data-*`\n- `src`, `for`, `type`, `href`, `value` , `max-length`, `max`, `min`, `pattern`\n- `placeholder`, `title`, `alt`\n- `aria-*`, `role`\n- `required`, `readonly`, `disabled`\n\n`class`是为高可复用组件设计的，所以应处在第一位；\n\n`id` 具体且应该尽量少使用，所以将它放在第二位。\n\n```html\n<a class=\"...\" id=\"...\" data-modal=\"toggle\" href=\"#\">Example link</a>\n\n<input class=\"form-control\" type=\"text\">\n\n<img src=\"...\" alt=\"...\">\n```\n\n#### 8) boolean属性\n\nboolean属性指不需要声明取值的属性，XHTML需要每个属性声明取值，但是HTML5并不需要；\n\n更多内容可以参考 [WhatWG section on boolean attributes](http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#boolean-attributes)：\n\n> boolean属性的存在表示取值为true，不存在则表示取值为false。\n\n```html\n<input type=\"text\" disabled>\n\n<input type=\"checkbox\" value=\"1\" checked>\n\n<select>\n    <option value=\"1\" selected>1</option>\n</select>\n```\n\n#### 9) JS生成标签\n\n在JS文件中生成标签让内容变得更难查找，更难编辑，性能更差。应该尽量避免这种情况的出现。\n\n#### 10) 减少标签数量\n\n在编写HTML代码时，需要尽量避免多余的父节点；\n\n很多时候，需要通过迭代和重构来使HTML变得更少。\n\n```html\n<!-- 不建议这么做 -->\n<span class=\"avatar\">\n    <img src=\"...\">\n</span>\n\n<!-- 建议这么做 -->\n<img class=\"avatar\" src=\"...\">\n```\n\n#### 11) 实用高于完美\n\n尽量遵循HTML标准和语义，但是不应该以浪费实用性作为代价；\n\n任何时候都要用尽量小的复杂度和尽量少的标签来解决问题。\n\n### 4 css、less\n\n#### 1) 缩进\n\n使用soft tab（4个空格）\n\n```less\n.element {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n\n    border-radius: 10px;\n    width: 50px;\n    height: 50px;\n}\n```\n\n#### 2)分号\n\n每个属性声明末尾都要加分号。\n\n```less\n.element {\n    width: 20px;\n    height: 20px;\n\n    background-color: red;\n}\n```\n\n#### 3)空格\n\n以下几种情况不需要空格：\n\n- 属性名后\n- 多个规则的分隔符','前\n- `!important` '!'后\n- 属性值中'('后和')'前\n- 行末不要有多余的空格\n\n以下几种情况需要空格：\n\n- 属性值前\n- 选择器'>', '+', '~'前后\n- '{'前\n- `!important` '!'前\n- `@else` 前后\n- 属性值中的','后\n- 注释'/*'后和'*/'前\n\n```less\n/* not good */\n.element {\n    color :red! important;\n    background-color: rgba(0,0,0,.5);\n}\n\n/* good */\n.element {\n    color: red !important;\n    background-color: rgba(0, 0, 0, .5);\n}\n\n/* not good */\n.element ,\n.dialog{\n    ...\n}\n\n/* good */\n.element,\n.dialog {\n\n}\n\n/* not good */\n.element>.dialog{\n    ...\n}\n\n/* good */\n.element > .dialog{\n    ...\n}\n\n/* not good */\n.element{\n    ...\n}\n\n/* good */\n.element {\n    ...\n}\n\n/* not good */\n@debug: true;\n\nheader {\n  background-color: (yellow)when(@debug = true);\n}\n\n\n/* good */\nheader {\n  background-color: (yellow) when (@debug = true);\n}\n```\n\n#### 4) 空行\n\n以下几种情况需要空行：\n\n- 文件最后保留一个空行\n- '}'后最好跟一个空行，包括scss中嵌套的规则\n- 属性之间需要适当的空行，具体见[属性声明顺序](http://alloyteam.github.io/CodeGuide/#css-declaration-order)\n\n```less\n/* not good */\n.element {\n    ...\n}\n.dialog {\n    color: red;\n    &:after {\n        ...\n    }\n}\n\n/* good */\n.element {\n    ...\n}\n\n.dialog {\n    color: red;\n\n    &:after {\n        ...\n    }\n}\n```\n\n#### 5) 注释\n\n注释统一用'/* */'（scss中也不要用'//'），具体参照右边的写法；\n\n缩进与下一行代码保持一致；\n\n可位于一个代码行的末尾，与代码间隔一个空格。\n\n```less\n/* Modal header */\n.modal-header {\n    ...\n}\n\n/*\n * Modal header\n */\n.modal-header {\n    ...\n}\n\n.modal-header {\n    /* 50px */\n    width: 50px;\n\n    color: red; /* color red */\n}\n```\n\n#### 6) 引号\n\n最外层统一使用双引号；\n\nurl的内容要用引号；\n\n属性选择器中的属性值需要引号。\n\n```less\n.element:after {\n    content: \"\";\n    background-image: url(\"logo.png\");\n}\n\nli[data-type=\"single\"] {\n    ...\n}\n```\n\n#### 7)`命名`\n\n- 类名使用`小写字母`，以`中划线`分隔\n- id采用`驼峰式`命名\n- `less`中的变量、函数以`中划线`分隔命名\n\n```less\n/* class */\n.element-content {\n    ...\n}\n\n/* id */\n#myDialog {\n    ...\n}\n\n/* 变量 */\n@color-black: #000;\n\n/* mixins */\n.my-mixin() {\n  color: black;\n}\n\n```\n\n#### 8)`属性声明顺序`\n\n相关的属性声明按右边的顺序做分组处理，组之间需要有一个空行。\n\n```less\n.declaration-order {\n    display: block;\n    float: right;\n\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    z-index: 100;\n\n    border: 1px solid #e5e5e5;\n    border-radius: 3px;\n    width: 100px;\n    height: 100px;\n\n    font: normal 13px \"Helvetica Neue\", sans-serif;\n    line-height: 1.5;\n    text-align: center;\n\n    color: #333;\n    background-color: #f5f5f5;\n\n    opacity: 1;\n}\n```\n\n`书写顺序前后`为：\n\n（1）`定位属性`：position  display  float  left  top  right  bottom   overflow  clear   z-index\n\n（2）`自身属性`：width  height  padding  border  margin   background\n\n（3）`文字样式`：font-family   font-size   font-style   font-weight   font-varient   color\n\n（4）`文本属性`text-align   vertical-align   text-wrap   text-transform   text-indent    text-decoration   letter-spacing    word-spacing    white-space   text-overflow\n\n**目的**：减少浏览器reflow（回流），提升浏览器渲染dom的性能\n\n`原理：浏览器的渲染流程为：`\n\n1、解析html构建dom树，解析css构建css树：将html解析成树形的数据结构，将css解析成树形的数据结构\n\n2、构建render树：DOM树和CSS树合并之后形成的render树。\n\n3、布局render树：有了render树，浏览器已经知道那些网页中有哪些节点，各个节点的css定义和以及它们的从属关系，从而计算出每个节点在屏幕中的位置。\n\n4、绘制render树：按照计算出来的规则，通过显卡把内容画在屏幕上。\n\ncss样式解析到显示至浏览器屏幕上就发生在234步骤，可见浏览器并不是一获取到css样式就立马开始解析而是根据css样式的书写顺序将之按照dom树的结构分布render样式，完成第2步，然后开始遍历每个树结点的css样式进行解析，此时的css样式的遍历顺序完全是按照之前的书写顺序。在解析过程中，一旦浏览器发现某个元素的定位变化影响布局，则需要倒回去重新渲染正如按照这样的书写书序：\n\n```less\n.demo{\n    width: 100px;\n\theight: 100px;\n\tbackground-color: red ;\n\n\tposition: absolute;\n}\n```\n\n当浏览器解析到position的时候突然发现该元素是绝对定位元素需要脱离文档流，而之前却是按照普通元素进行解析的，所以不得不重新渲染，解除该元素在文档中所占位置，然而由于该元素的占位发生变化，其他元素也可能会受到它回流的影响而重新排位。最终导致③步骤花费的时间太久而影响到④步骤的显示，影响了用户体验。\n\n```less\n// 下面是推荐的属性的顺序\n[\n    [\n        \"display\",\n        \"visibility\",\n        \"float\",\n        \"clear\",\n        \"overflow\",\n        \"overflow-x\",\n        \"overflow-y\",\n        \"clip\",\n        \"zoom\"\n    ],\n    [\n        \"table-layout\",\n        \"empty-cells\",\n        \"caption-side\",\n        \"border-spacing\",\n        \"border-collapse\",\n        \"list-style\",\n        \"list-style-position\",\n        \"list-style-type\",\n        \"list-style-image\"\n    ],\n    [\n        \"-webkit-box-orient\",\n        \"-webkit-box-direction\",\n        \"-webkit-box-decoration-break\",\n        \"-webkit-box-pack\",\n        \"-webkit-box-align\",\n        \"-webkit-box-flex\"\n    ],\n    [\n        \"position\",\n        \"top\",\n        \"right\",\n        \"bottom\",\n        \"left\",\n        \"z-index\"\n    ],\n    [\n        \"margin\",\n        \"margin-top\",\n        \"margin-right\",\n        \"margin-bottom\",\n        \"margin-left\",\n        \"-webkit-box-sizing\",\n        \"-moz-box-sizing\",\n        \"box-sizing\",\n        \"border\",\n        \"border-width\",\n        \"border-style\",\n        \"border-color\",\n        \"border-top\",\n        \"border-top-width\",\n        \"border-top-style\",\n        \"border-top-color\",\n        \"border-right\",\n        \"border-right-width\",\n        \"border-right-style\",\n        \"border-right-color\",\n        \"border-bottom\",\n        \"border-bottom-width\",\n        \"border-bottom-style\",\n        \"border-bottom-color\",\n        \"border-left\",\n        \"border-left-width\",\n        \"border-left-style\",\n        \"border-left-color\",\n        \"-webkit-border-radius\",\n        \"-moz-border-radius\",\n        \"border-radius\",\n        \"-webkit-border-top-left-radius\",\n        \"-moz-border-radius-topleft\",\n        \"border-top-left-radius\",\n        \"-webkit-border-top-right-radius\",\n        \"-moz-border-radius-topright\",\n        \"border-top-right-radius\",\n        \"-webkit-border-bottom-right-radius\",\n        \"-moz-border-radius-bottomright\",\n        \"border-bottom-right-radius\",\n        \"-webkit-border-bottom-left-radius\",\n        \"-moz-border-radius-bottomleft\",\n        \"border-bottom-left-radius\",\n        \"-webkit-border-image\",\n        \"-moz-border-image\",\n        \"-o-border-image\",\n        \"border-image\",\n        \"-webkit-border-image-source\",\n        \"-moz-border-image-source\",\n        \"-o-border-image-source\",\n        \"border-image-source\",\n        \"-webkit-border-image-slice\",\n        \"-moz-border-image-slice\",\n        \"-o-border-image-slice\",\n        \"border-image-slice\",\n        \"-webkit-border-image-width\",\n        \"-moz-border-image-width\",\n        \"-o-border-image-width\",\n        \"border-image-width\",\n        \"-webkit-border-image-outset\",\n        \"-moz-border-image-outset\",\n        \"-o-border-image-outset\",\n        \"border-image-outset\",\n        \"-webkit-border-image-repeat\",\n        \"-moz-border-image-repeat\",\n        \"-o-border-image-repeat\",\n        \"border-image-repeat\",\n        \"padding\",\n        \"padding-top\",\n        \"padding-right\",\n        \"padding-bottom\",\n        \"padding-left\",\n        \"width\",\n        \"min-width\",\n        \"max-width\",\n        \"height\",\n        \"min-height\",\n        \"max-height\"\n    ],\n    [\n        \"font\",\n        \"font-family\",\n        \"font-size\",\n        \"font-weight\",\n        \"font-style\",\n        \"font-variant\",\n        \"font-size-adjust\",\n        \"font-stretch\",\n        \"font-effect\",\n        \"font-emphasize\",\n        \"font-emphasize-position\",\n        \"font-emphasize-style\",\n        \"font-smooth\",\n        \"line-height\",\n        \"text-align\",\n        \"-webkit-text-align-last\",\n        \"-moz-text-align-last\",\n        \"-ms-text-align-last\",\n        \"text-align-last\",\n        \"vertical-align\",\n        \"white-space\",\n        \"text-decoration\",\n        \"text-emphasis\",\n        \"text-emphasis-color\",\n        \"text-emphasis-style\",\n        \"text-emphasis-position\",\n        \"text-indent\",\n        \"-ms-text-justify\",\n        \"text-justify\",\n        \"letter-spacing\",\n        \"word-spacing\",\n        \"-ms-writing-mode\",\n        \"text-outline\",\n        \"text-transform\",\n        \"text-wrap\",\n        \"-ms-text-overflow\",\n        \"text-overflow\",\n        \"text-overflow-ellipsis\",\n        \"text-overflow-mode\",\n        \"-ms-word-wrap\",\n        \"word-wrap\",\n        \"-ms-word-break\",\n        \"word-break\"\n    ],\n    [\n        \"color\",\n        \"background\",\n        \"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader\",\n        \"background-color\",\n        \"background-image\",\n        \"background-repeat\",\n        \"background-attachment\",\n        \"background-position\",\n        \"-ms-background-position-x\",\n        \"background-position-x\",\n        \"-ms-background-position-y\",\n        \"background-position-y\",\n        \"-webkit-background-clip\",\n        \"-moz-background-clip\",\n        \"background-clip\",\n        \"background-origin\",\n        \"-webkit-background-size\",\n        \"-moz-background-size\",\n        \"-o-background-size\",\n        \"background-size\"\n    ],\n    [\n        \"outline\",\n        \"outline-width\",\n        \"outline-style\",\n        \"outline-color\",\n        \"outline-offset\",\n        \"opacity\",\n        \"filter:progid:DXImageTransform.Microsoft.Alpha(Opacity\",\n        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.Alpha\",\n        \"-ms-interpolation-mode\",\n        \"-webkit-box-shadow\",\n        \"-moz-box-shadow\",\n        \"box-shadow\",\n        \"filter:progid:DXImageTransform.Microsoft.gradient\",\n        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.gradient\",\n        \"text-shadow\"\n    ],\n    [\n        \"-webkit-transition\",\n        \"-moz-transition\",\n        \"-ms-transition\",\n        \"-o-transition\",\n        \"transition\",\n        \"-webkit-transition-delay\",\n        \"-moz-transition-delay\",\n        \"-ms-transition-delay\",\n        \"-o-transition-delay\",\n        \"transition-delay\",\n        \"-webkit-transition-timing-function\",\n        \"-moz-transition-timing-function\",\n        \"-ms-transition-timing-function\",\n        \"-o-transition-timing-function\",\n        \"transition-timing-function\",\n        \"-webkit-transition-duration\",\n        \"-moz-transition-duration\",\n        \"-ms-transition-duration\",\n        \"-o-transition-duration\",\n        \"transition-duration\",\n        \"-webkit-transition-property\",\n        \"-moz-transition-property\",\n        \"-ms-transition-property\",\n        \"-o-transition-property\",\n        \"transition-property\",\n        \"-webkit-transform\",\n        \"-moz-transform\",\n        \"-ms-transform\",\n        \"-o-transform\",\n        \"transform\",\n        \"-webkit-transform-origin\",\n        \"-moz-transform-origin\",\n        \"-ms-transform-origin\",\n        \"-o-transform-origin\",\n        \"transform-origin\",\n        \"-webkit-animation\",\n        \"-moz-animation\",\n        \"-ms-animation\",\n        \"-o-animation\",\n        \"animation\",\n        \"-webkit-animation-name\",\n        \"-moz-animation-name\",\n        \"-ms-animation-name\",\n        \"-o-animation-name\",\n        \"animation-name\",\n        \"-webkit-animation-duration\",\n        \"-moz-animation-duration\",\n        \"-ms-animation-duration\",\n        \"-o-animation-duration\",\n        \"animation-duration\",\n        \"-webkit-animation-play-state\",\n        \"-moz-animation-play-state\",\n        \"-ms-animation-play-state\",\n        \"-o-animation-play-state\",\n        \"animation-play-state\",\n        \"-webkit-animation-timing-function\",\n        \"-moz-animation-timing-function\",\n        \"-ms-animation-timing-function\",\n        \"-o-animation-timing-function\",\n        \"animation-timing-function\",\n        \"-webkit-animation-delay\",\n        \"-moz-animation-delay\",\n        \"-ms-animation-delay\",\n        \"-o-animation-delay\",\n        \"animation-delay\",\n        \"-webkit-animation-iteration-count\",\n        \"-moz-animation-iteration-count\",\n        \"-ms-animation-iteration-count\",\n        \"-o-animation-iteration-count\",\n        \"animation-iteration-count\",\n        \"-webkit-animation-direction\",\n        \"-moz-animation-direction\",\n        \"-ms-animation-direction\",\n        \"-o-animation-direction\",\n        \"animation-direction\"\n    ],\n    [\n        \"content\",\n        \"quotes\",\n        \"counter-reset\",\n        \"counter-increment\",\n        \"resize\",\n        \"cursor\",\n        \"-webkit-user-select\",\n        \"-moz-user-select\",\n        \"-ms-user-select\",\n        \"user-select\",\n        \"nav-index\",\n        \"nav-up\",\n        \"nav-right\",\n        \"nav-down\",\n        \"nav-left\",\n        \"-moz-tab-size\",\n        \"-o-tab-size\",\n        \"tab-size\",\n        \"-webkit-hyphens\",\n        \"-moz-hyphens\",\n        \"hyphens\",\n        \"pointer-events\"\n    ]\n]\n```\n\n#### 9)颜色\n\n颜色16进制用小写字母；\n\n颜色16进制尽量用简写。\n\n```less\n/* not good */\n.element {\n    color: #ABCDEF;\n    background-color: #001122;\n}\n\n/* good */\n.element {\n    color: #abcdef;\n    background-color: #012;\n}\n```\n\n#### 10)属性简写\n\n属性简写需要你非常清楚属性值的正确顺序，而且在大多数情况下并不需要设置属性简写中包含的所有值，所以建议尽量分开声明会更加清晰；\n\n`margin` 和 `padding` 相反，需要使用简写；\n\n常见的属性简写包括：\n\n- `font`\n- `background`\n- `transition`\n- `animation`\n\n```less\n/* not good */\n.element {\n    transition: opacity 1s linear 2s;\n}\n\n/* good */\n.element {\n    transition-delay: 2s;\n    transition-timing-function: linear;\n    transition-duration: 1s;\n    transition-property: opacity;\n}\n```\n\n#### 11)`媒体查询`\n\n尽量将媒体查询的规则靠近与他们相关的规则，不要将他们一起放到一个独立的样式文件中，或者丢在文档的最底部，这样做只会让大家以后更容易忘记他们。\n\n```less\n.element {\n    ...\n}\n\n.element-avatar{\n    ...\n}\n\n@media (min-width: 480px) {\n    .element {\n        ...\n    }\n\n    .element-avatar {\n        ...\n    }\n}\n```\n\n#### 12)`Less相关`\n\n每个模块应该有一个单独的less, 然后每个最外层的父类 className 应该写在第一位，所有子Node的样式都写在里面，这样是为了避免命名冲突。比如\n\n```less\n//out: false\n.parent-name{\n\n    .child-name{\n        ...\n    }\n\n    ...\n}\n```\n\n`@import` 引入的文件不需要结尾的'.less'\n\n`LESS嵌套最多不能超过5层`；\n\n不允许有空的规则；\n\n元素选择器用小写字母；\n\n去掉小数点前面的0；\n\n去掉数字中不必要的小数点和末尾的0；\n\n属性值'0'后面不要加单位；\n\n同个属性不同前缀的写法需要在垂直方向保持对齐，具体参照右边的写法；\n\n无前缀的标准属性应该写在有前缀的属性后面；\n\n不要在同个规则里出现重复的属性，如果重复的属性是连续的则没关系；\n\n不要在一个文件里出现两个相同的规则；\n\n用 `border: 0;` 代替 `border: none;`；\n\n`CSS选择器不要超过3层`；\n\n尽量少用`'*'`选择器。\n\n```less\n/* not good */\n.element {\n}\n\n/* not good */\nLI {\n    ...\n}\n\n/* good */\nli {\n    ...\n}\n\n/* not good */\n.element {\n    color: rgba(0, 0, 0, 0.5);\n}\n\n/* good */\n.element {\n    color: rgba(0, 0, 0, .5);\n}\n\n/* not good */\n.element {\n    width: 50.0px;\n}\n\n/* good */\n.element {\n    width: 50px;\n}\n\n/* not good */\n.element {\n    width: 0px;\n}\n\n/* good */\n.element {\n    width: 0;\n}\n\n/* not good */\n.element {\n    border-radius: 3px;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n\n    background: linear-gradient(to bottom, #fff 0, #eee 100%);\n    background: -webkit-linear-gradient(top, #fff 0, #eee 100%);\n    background: -moz-linear-gradient(top, #fff 0, #eee 100%);\n}\n\n/* good */\n.element {\n    -webkit-border-radius: 3px;\n       -moz-border-radius: 3px;\n            border-radius: 3px;\n\n    background: -webkit-linear-gradient(top, #fff 0, #eee 100%);\n    background:    -moz-linear-gradient(top, #fff 0, #eee 100%);\n    background:         linear-gradient(to bottom, #fff 0, #eee 100%);\n}\n\n/* not good */\n.element {\n    color: rgb(0, 0, 0);\n    width: 50px;\n    color: rgba(0, 0, 0, .5);\n}\n\n/* good */\n.element {\n    color: rgb(0, 0, 0);\n    color: rgba(0, 0, 0, .5);\n}\n```\n\n### 5 JavaScript\n\n#### 1)缩进\n\n使用soft tab（4个空格）。\n\n```javascript\nvar x = 1,\n    y = 1;\n\nif (x < y) {\n    x += 10;\n} else {\n    x += 1;\n}\n```\n\n#### 2)分号\n\n以下几种情况后需加分号：\n\n- 变量声明\n- 表达式\n- return\n- throw\n- break\n- continue\n- do-while\n\n```javascript\n/* var declaration */\nvar x = 1;\n\n/* expression statement */\nx++;\n\n/* do-while */\ndo {\n    x++;\n} while (x < 10);\n```\n\n#### 3)空格\n\n以下几种情况不需要空格：\n\n- 对象的属性名后\n- 前缀一元运算符后\n- 后缀一元运算符前\n- 函数调用括号前\n- 无论是函数声明还是函数表达式，'('前不要空格\n- 数组的'['后和']'前\n- 对象的'{'后和'}'前\n- 运算符'('后和')'前\n\n以下几种情况需要空格：\n\n- 二元运算符前后\n- 三元运算符'?:'前后\n- 代码块'{'前\n- 下列关键字前：`else`, `while`, `catch`, `finally`\n- 下列关键字后：`if`, `else`, `for`, `while`, `do`, `switch`, `case`, `try`,`catch`, `finally`, `with`, `return`, `typeof`\n- 单行注释'//'后（若单行注释和代码同行，则'//'前也需要），多行注释'*'后\n- 对象的属性值前\n- for循环，分号后留有一个空格，前置条件如果有多个，逗号后留一个空格\n- 无论是函数声明还是函数表达式，'{'前一定要有空格\n- 函数的参数之间\n\n```javascript\n// not good\nvar a = {\n    b :1\n};\n\n// good\nvar a = {\n    b: 1\n};\n\n// not good\n++ x;\ny ++;\nz = x?1:2;\n\n// good\n++x;\ny++;\nz = x ? 1 : 2;\n\n// not good\nvar a = [ 1, 2 ];\n\n// good\nvar a = [1, 2];\n\n// not good\nvar a = ( 1+2 )*3;\n\n// good\nvar a = (1 + 2) * 3;\n\n// no space before '(', one space before '{', one space between function parameters\nvar doSomething = function(a, b, c) {\n    // do something\n};\n\n// no space before '('\ndoSomething(item);\n\n// not good\nfor(i=0;i<6;i++){\n    x++;\n}\n\n// good\nfor (i = 0; i < 6; i++) {\n    x++;\n}\n```\n\n#### 4)空行\n\n以下几种情况需要空行：\n\n- 变量声明后（当变量声明在代码块的最后一行时，则无需空行）\n- 注释前（当注释在代码块的第一行时，则无需空行）\n- 代码块后（在函数调用、数组、对象中则无需空行）\n- 文件最后保留一个空行\n\n```javascript\n// need blank line after variable declaration\nvar x = 1;\n\n// not need blank line when variable declaration is last expression in the current block\nif (x >= 1) {\n    var y = x + 1;\n}\n\nvar a = 2;\n\n// need blank line before line comment\na++;\n\nfunction b() {\n    // not need blank line when comment is first line of block\n    return a;\n}\n\n// need blank line after blocks\nfor (var i = 0; i < 2; i++) {\n    if (true) {\n        return false;\n    }\n\n    continue;\n}\n\nvar obj = {\n    foo: function() {\n        return 1;\n    },\n\n    bar: function() {\n        return 2;\n    }\n};\n\n// not need blank line when in argument list, array, object\nfunc(\n    2,\n    function() {\n        a++;\n    },\n    3\n);\n\nvar foo = [\n    2,\n    function() {\n        a++;\n    },\n    3\n];\n\nvar foo = {\n    a: 2,\n    b: function() {\n        a++;\n    },\n    c: 3\n};\n```\n\n#### 5)换行\n\n换行的地方，行末必须有','或者运算符；\n\n以下几种情况不需要换行：\n\n- 下列关键字后：`else`, `catch`, `finally`\n- 代码块'{'前\n\n以下几种情况需要换行：\n\n- 代码块'{'后和'}'前\n- 变量赋值后\n\n```javascript\n// not good\nvar a = {\n    b: 1\n    , c: 2\n};\n\nx = y\n    ? 1 : 2;\n\n// good\nvar a = {\n    b: 1,\n    c: 2\n};\n\nx = y ? 1 : 2;\nx = y ?\n    1 : 2;\n\n// no need line break with 'else', 'catch', 'finally'\nif (condition) {\n    ...\n} else {\n    ...\n}\n\ntry {\n    ...\n} catch (e) {\n    ...\n} finally {\n    ...\n}\n\n// not good\nfunction test()\n{\n    ...\n}\n\n// good\nfunction test() {\n    ...\n}\n\n// not good\nvar a, foo = 7, b,\n    c, bar = 8;\n\n// good\nvar a,\n    foo = 7,\n    b, c, bar = 8;\n```\n\n#### 6)单行注释\n\n双斜线后，必须跟一个空格；\n\n缩进与下一行代码保持一致；\n\n可位于一个代码行的末尾，与代码间隔一个空格。\n\n```javascript\nif (condition) {\n    // if you made it here, then all security checks passed\n    allowed();\n}\n\nvar zhangsan = 'zhangsan'; // one space after code\n```\n\n#### 7)多行注释\n\n最少三行, '*'后跟一个空格，具体参照右边的写法；\n\n建议在以下情况下使用：\n\n- 难于理解的代码段\n- 可能存在错误的代码段\n- 浏览器特殊的HACK代码\n- 业务逻辑强相关的代码\n\n```javascript\n/*\n * one space after '*'\n */\nvar x = 1;\n```\n\n#### 8)`文档注释`\n\n各类标签@param, @method等请参考[usejsdoc](http://usejsdoc.org/)和[JSDoc Guide](http://yuri4ever.github.io/jsdoc/)；\n\n建议在以下情况下使用：\n\n- 所有常量\n- 所有函数\n- 所有类\n\n```\n/**\n * @func\n * @desc 一个带参数的函数\n * @param {string} a - 参数a\n * @param {number} b=1 - 参数b默认值为1\n * @param {string} c=1 - 参数c有两种支持的取值</br>1—表示x</br>2—表示xx\n * @param {object} d - 参数d为一个对象\n * @param {string} d.e - 参数d的e属性\n * @param {string} d.f - 参数d的f属性\n * @param {object[]} g - 参数g为一个对象数组\n * @param {string} g.h - 参数g数组中一项的h属性\n * @param {string} g.i - 参数g数组中一项的i属性\n * @param {string} [j] - 参数j是一个可选参数\n */\nfunction foo(a, b, c, d, g, j) {\n    ...\n}\n```\n\n#### 9)引号\n\n最外层统一使用单引号。\n\n```javascript\n// not good\nvar x = \"test\";\n\n// good\nvar y = 'foo',\n    z = '<div id=\"test\"></div>';\n```\n\n#### 10)变量命名\n\n- 标准变量采用驼峰式命名（除了对象的属性外，主要是考虑到cgi返回的数据）\n- 'ID'在变量名中全大写\n- 'URL'在变量名中全大写\n- 'Android'在变量名中大写第一个字母\n- 'iOS'在变量名中小写第一个，大写后两个字母\n- 常量全大写，用下划线连接\n- 构造函数，大写第一个字母\n- jquery对象必须以'$'开头命名\n\n```javascript\nvar thisIsMyName;\n\nvar goodID;\n\nvar reportURL;\n\nvar AndroidVersion;\n\nvar iOSVersion;\n\nvar MAX_COUNT = 10;\n\nfunction Person(name) {\n    this.name = name;\n}\n\n// not good\nvar body = $('body');\n\n// good\nvar $body = $('body');\n```\n\n#### 11)变量声明\n\n一个函数作用域中所有的变量声明尽量提到函数首部，用一个var 声明，不允许出现两个连续的var声明。\n\n```javascript\nfunction doSomethingWithItems(items) {\n    // use one var\n    var value = 10,\n        result = value + 10,\n        i,\n        len;\n\n    for (i = 0, len = items.length; i < len; i++) {\n        result += 10;\n    }\n}\n```\n\n#### 12)函数\n\n无论是函数声明还是函数表达式，'('前不要空格，但'{'前一定要有空格；\n\n函数调用括号前不需要空格；\n\n立即执行函数外必须包一层括号；\n\n不要给inline function命名；\n\n参数之间用', '分隔，注意逗号后有一个空格。\n\n```javascript\n// no space before '(', but one space before'{'\nvar doSomething = function(item) {\n    // do something\n};\n\nfunction doSomething(item) {\n    // do something\n}\n\n// not good\ndoSomething (item);\n\n// good\ndoSomething(item);\n\n// requires parentheses around immediately invoked function expressions\n(function() {\n    return 1;\n})();\n\n// not good\n[1, 2].forEach(function x() {\n    ...\n});\n\n// good\n[1, 2].forEach(function() {\n    ...\n});\n\n// not good\nvar a = [1, 2, function a() {\n    ...\n}];\n\n// good\nvar a = [1, 2, function() {\n    ...\n}];\n\n// use ', ' between function parameters\nvar doSomething = function(a, b, c) {\n    // do something\n};\n```\n\n#### 13)数组、对象\n\n对象属性名不需要加引号；\n\n对象以缩进的形式书写，不要写在一行；\n\n数组、对象最后不要有逗号。\n\n```javascript\n// not good\nvar a = {\n    'b': 1\n};\n\nvar a = {b: 1};\n\nvar a = {\n    b: 1,\n    c: 2,\n};\n\n// good\nvar a = {\n    b: 1,\n    c: 2\n};\n```\n\n#### 14)括号\n\n下列关键字后必须有大括号（即使代码块的内容只有一行）：`if`, `else`,`for`, `while`, `do`, `switch`, `try`, `catch`, `finally`, `with`。\n\n```javascript\n// not good\nif (condition)\n    doSomething();\n\n// good\nif (condition) {\n    doSomething();\n}\n```\n\n#### 15)null\n\n适用场景：\n\n- 初始化一个将来可能被赋值为对象的变量\n- 与已经初始化的变量做比较\n- 作为一个参数为对象的函数的调用传参\n- 作为一个返回对象的函数的返回值\n\n不适用场景：\n\n- 不要用null来判断函数调用时有无传参\n- 不要与未初始化的变量做比较\n\n```javascript\n// not good\nfunction test(a, b) {\n    if (b `= null) {\n        // not mean b is not supply\n        ...\n    }\n}\n\nvar a;\n\nif (a `= null) {\n    ...\n}\n\n// good\nvar a = null;\n\nif (a `= null) {\n    ...\n}\n```\n\n#### 16)undefined\n\n永远不要直接使用undefined进行变量判断；\n\n使用typeof和字符串'undefined'对变量进行判断。\n\n```javascript\n// not good\nif (person `= undefined) {\n    ...\n}\n\n// good\nif (typeof person `= 'undefined') {\n    ...\n}\n```\n\n#### 17)jshint\n\n用'`=', '!`'代替'`', '!='；\n\nfor-in里一定要有hasOwnProperty的判断；\n\n不要在内置对象的原型上添加方法，如Array, Date；\n\n不要在内层作用域的代码里声明了变量，之后却访问到了外层作用域的同名变量；\n\n变量不要先使用后声明；\n\n不要在一句代码中单单使用构造函数，记得将其赋值给某个变量；\n\n不要在同个作用域下声明同名变量；\n\n不要在一些不需要的地方加括号，例：delete(a.b)；\n\n不要使用未声明的变量（全局变量需要加到.jshintrc文件的globals属性里面）；\n\n不要声明了变量却不使用；\n\n不要在应该做比较的地方做赋值；\n\ndebugger不要出现在提交的代码里；\n\n数组中不要存在空元素；\n\n不要在循环内部声明函数；\n\n不要像这样使用构造函数，例：`new function () { ... }`, `new Object`；\n\n```javascript\n// not good\nif (a ` 1) {\n    a++;\n}\n\n// good\nif (a `= 1) {\n    a++;\n}\n\n// good\nfor (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n        // be sure that obj[key] belongs to the object and was not inherited\n        console.log(obj[key]);\n    }\n}\n\n// not good\nArray.prototype.count = function(value) {\n    return 4;\n};\n\n// not good\nvar x = 1;\n\nfunction test() {\n    if (true) {\n        var x = 0;\n    }\n\n    x += 1;\n}\n\n// not good\nfunction test() {\n    console.log(x);\n\n    var x = 1;\n}\n\n// not good\nnew Person();\n\n// good\nvar person = new Person();\n\n// not good\ndelete(obj.attr);\n\n// good\ndelete obj.attr;\n\n// not good\nif (a = 10) {\n    a++;\n}\n\n// not good\nvar a = [1, , , 2, 3];\n\n// not good\nvar nums = [];\n\nfor (var i = 0; i < 10; i++) {\n    (function(i) {\n        nums[i] = function(j) {\n            return i + j;\n        };\n    }(i));\n}\n\n// not good\nvar singleton = new function() {\n    var privateVar;\n\n    this.publicMethod = function() {\n        privateVar = 1;\n    };\n\n    this.publicMethod2 = function() {\n        privateVar = 2;\n    };\n};\n```\n\n#### 18)杂项\n\n不要混用tab和space；\n\n不要在一处使用多个tab或space；\n\n换行符统一用'LF'；\n\n对上下文this的引用只能使用'_this', 'that', 'self'其中一个来命名；\n\n行尾不要有空白字符；\n\nswitch的falling through和no default的情况一定要有注释特别说明；\n\n不允许有空的代码块。\n\n```javascript\n// not good\nvar a   = 1;\n\nfunction Person() {\n    // not good\n    var me = this;\n\n    // good\n    var _this = this;\n\n    // good\n    var that = this;\n\n    // good\n    var self = this;\n}\n\n// good\nswitch (condition) {\n    case 1:\n    case 2:\n        ...\n        break;\n    case 3:\n        ...\n    // why fall through\n    case 4\n        ...\n        break;\n    // why no default\n}\n\n// not good with empty block\nif (condition) {\n\n}\n```\n","slug":"前端规范","published":1,"date":"2020-03-04T23:38:32.733Z","updated":"2020-03-05T00:31:15.568Z","title":"前端规范","comments":1,"layout":"post","photos":[],"link":"","_id":"ck7e0nvtj0008ntcycrn774qg","content":"<h2 id=\"前端代码规范\"><a href=\"#前端代码规范\" class=\"headerlink\" title=\"前端代码规范\"></a>前端代码规范</h2><p>[TOC]</p>\n<h3 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1 前言\"></a>1 前言</h3><p>随着团队人数的增加，每个人的代码编写喜好不同，代码风格也迥然不同。如果有一个大家的统一的愿意遵守的代码规范，肯定事半功倍，提高效率，避免代码<code>Review</code>和<code>重构</code>。</p>\n<p>目前这只是一个基础的版本，如果有哪些规则不太好，大家可以提出<code>issues</code> 然后一起沟通协商规则。</p>\n<p>其中一部分规则参考了 腾讯<code>alloyteam</code>团队的代码规范，如有错误，请指出，将会非常感谢。</p>\n<p>坚持好的代码风格规范，从你我做起。</p>\n<h3 id=\"2-命名规范\"><a href=\"#2-命名规范\" class=\"headerlink\" title=\"2 命名规范\"></a>2 命名规范</h3><h4 id=\"1-项目命名\"><a href=\"#1-项目命名\" class=\"headerlink\" title=\"1) 项目命名\"></a>1) 项目命名</h4><p>全部采用小写方式， 以下划线分隔。</p>\n<p>例：<code>my_project_name</code></p>\n<h4 id=\"2-目录命名\"><a href=\"#2-目录命名\" class=\"headerlink\" title=\"2 )目录命名\"></a>2 )目录命名</h4><p>参照项目命名规则；</p>\n<p>有复数结构时，要采用复数命名法。</p>\n<p>例：<code>pages</code>, <code>assets</code>, <code>directives</code>, <code>components</code>, <code>mixins</code>, <code>utils</code></p>\n<h4 id=\"3-javaScript-文件命名\"><a href=\"#3-javaScript-文件命名\" class=\"headerlink\" title=\"3)javaScript 文件命名\"></a>3)<code>javaScript</code> 文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>account_model.js</code></p>\n<h4 id=\"4-CSS-less文件命名\"><a href=\"#4-CSS-less文件命名\" class=\"headerlink\" title=\"4)CSS,less文件命名\"></a>4)<code>CSS</code>,<code>less</code>文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>retina_sprites.less</code></p>\n<h4 id=\"5-HTML文件命名\"><a href=\"#5-HTML文件命名\" class=\"headerlink\" title=\"5)HTML文件命名\"></a>5)HTML文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>error_report.html</code></p>\n<h4 id=\"6-如果使用Vue或者React技术栈，组件Component命名\"><a href=\"#6-如果使用Vue或者React技术栈，组件Component命名\" class=\"headerlink\" title=\"6) 如果使用Vue或者React技术栈，组件Component命名\"></a>6) 如果使用<code>Vue</code>或者<code>React</code>技术栈，组件<code>Component</code>命名</h4><p>所有组件名字需要首字母大写，然后驼峰格式</p>\n<p>例：<code>CalendarList.vue</code></p>\n<h3 id=\"3-HTML\"><a href=\"#3-HTML\" class=\"headerlink\" title=\"3 HTML\"></a>3 HTML</h3><h4 id=\"1-语法\"><a href=\"#1-语法\" class=\"headerlink\" title=\"1) 语法\"></a>1) 语法</h4><ul>\n<li>缩进使用soft tab（4个空格）；</li>\n<li>嵌套的节点应该缩进；</li>\n<li>在属性上，使用双引号，不要使用单引号；</li>\n<li>属性名全小写，用中划线做分隔符；</li>\n<li>不要在自动闭合标签结尾处使用斜线（<a href=\"http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag\" target=\"_blank\" rel=\"noopener\">HTML5 规范</a> 指出他们是可选的）；</li>\n<li>不要忽略可选的关闭标签;</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Page title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"images/company_logo.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"Company\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">class</span>=<span class=\"string\">\"hello-world\"</span>&gt;</span>Hello, world!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-HTML5-doctype\"><a href=\"#2-HTML5-doctype\" class=\"headerlink\" title=\"2) HTML5 doctype\"></a>2) HTML5 doctype</h4><p>在页面开头使用这个简单地doctype来启用标准模式，使其在每个浏览器中尽可能一致的展现；</p>\n<p>虽然doctype不区分大小写，但是按照惯例，doctype大写 （<a href=\"http://stackoverflow.com/questions/15594877/is-there-any-benefits-to-use-uppercase-or-lowercase-letters-with-html5-tagname\" target=\"_blank\" rel=\"noopener\">关于html属性，大写还是小写</a>）。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">\t...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-lang属性\"><a href=\"#3-lang属性\" class=\"headerlink\" title=\"3) lang属性\"></a>3) lang属性</h4><p>根据HTML5规范：</p>\n<blockquote>\n<p>应在html标签上加上lang属性。这会给语音工具和翻译工具帮助，告诉它们应当怎么去发音和翻译。</p>\n</blockquote>\n<p>更多关于 <code>lang</code> 属性的说明<a href=\"http://www.w3.org/html/wg/drafts/html/master/semantics.html#the-html-element\" target=\"_blank\" rel=\"noopener\">在这里</a>；</p>\n<p>在sitepoint上可以查到<a href=\"http://reference.sitepoint.com/html/lang-codes\" target=\"_blank\" rel=\"noopener\">语言列表</a>；</p>\n<p>但sitepoint只是给出了语言的大类，例如中文只给出了zh，但是没有区分香港，台湾，大陆。而微软给出了一份更加<a href=\"http://msdn.microsoft.com/en-us/library/ms533052(v=vs.85).aspx\" target=\"_blank\" rel=\"noopener\">详细的语言列表</a>，其中细分了zh-cn, zh-hk, zh-tw。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en-us\"</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-字符编码\"><a href=\"#4-字符编码\" class=\"headerlink\" title=\"4) 字符编码\"></a>4) 字符编码</h4><p>通过声明一个明确的字符编码，让浏览器轻松、快速的确定适合网页内容的渲染方式，通常指定为’UTF-8’。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-IE兼容模式\"><a href=\"#5-IE兼容模式\" class=\"headerlink\" title=\"5) IE兼容模式\"></a>5) IE兼容模式</h4><p>用 `` 标签可以指定页面应该用什么版本的IE来渲染；</p>\n<p>如果你想要了解更多，请点击<a href=\"http://stackoverflow.com/questions/6771258/whats-the-difference-if-meta-http-equiv-x-ua-compatible-content-ie-edge-e\" target=\"_blank\" rel=\"noopener\">这里</a>；</p>\n<p>不同doctype在不同浏览器下会触发不同的渲染模式（<a href=\"https://hsivonen.fi/doctype/\" target=\"_blank\" rel=\"noopener\">这篇文章</a>总结的很到位）。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=Edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-引入CSS-JS\"><a href=\"#6-引入CSS-JS\" class=\"headerlink\" title=\"6) 引入CSS, JS\"></a>6) 引入CSS, JS</h4><p>根据HTML5规范, 通常在引入CSS和JS时不需要指明 <code>type</code>，因为 <code>text/css</code>和 <code>text/javascript</code> 分别是他们的默认值。</p>\n<p><strong>HTML5 规范链接</strong></p>\n<ul>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-link-element\" target=\"_blank\" rel=\"noopener\">使用link</a></li>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-style-element\" target=\"_blank\" rel=\"noopener\">使用style</a></li>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/scripting-1.html#the-script-element\" target=\"_blank\" rel=\"noopener\">使用script</a></li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- External CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"code_guide.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- In-document CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- External JS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"code_guide.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- In-document JS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-属性顺序\"><a href=\"#7-属性顺序\" class=\"headerlink\" title=\"7) 属性顺序\"></a>7) 属性顺序</h4><p>属性应该按照特定的顺序出现以保证易读性；</p>\n<ul>\n<li><code>class</code></li>\n<li><code>id</code></li>\n<li><code>name</code></li>\n<li><code>data-*</code></li>\n<li><code>src</code>, <code>for</code>, <code>type</code>, <code>href</code>, <code>value</code> , <code>max-length</code>, <code>max</code>, <code>min</code>, <code>pattern</code></li>\n<li><code>placeholder</code>, <code>title</code>, <code>alt</code></li>\n<li><code>aria-*</code>, <code>role</code></li>\n<li><code>required</code>, <code>readonly</code>, <code>disabled</code></li>\n</ul>\n<p><code>class</code>是为高可复用组件设计的，所以应处在第一位；</p>\n<p><code>id</code> 具体且应该尽量少使用，所以将它放在第二位。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">data-modal</span>=<span class=\"string\">\"toggle\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span>&gt;</span>Example link<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-boolean属性\"><a href=\"#8-boolean属性\" class=\"headerlink\" title=\"8) boolean属性\"></a>8) boolean属性</h4><p>boolean属性指不需要声明取值的属性，XHTML需要每个属性声明取值，但是HTML5并不需要；</p>\n<p>更多内容可以参考 <a href=\"http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#boolean-attributes\" target=\"_blank\" rel=\"noopener\">WhatWG section on boolean attributes</a>：</p>\n<blockquote>\n<p>boolean属性的存在表示取值为true，不存在则表示取值为false。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">disabled</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">checked</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">selected</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-JS生成标签\"><a href=\"#9-JS生成标签\" class=\"headerlink\" title=\"9) JS生成标签\"></a>9) JS生成标签</h4><p>在JS文件中生成标签让内容变得更难查找，更难编辑，性能更差。应该尽量避免这种情况的出现。</p>\n<h4 id=\"10-减少标签数量\"><a href=\"#10-减少标签数量\" class=\"headerlink\" title=\"10) 减少标签数量\"></a>10) 减少标签数量</h4><p>在编写HTML代码时，需要尽量避免多余的父节点；</p>\n<p>很多时候，需要通过迭代和重构来使HTML变得更少。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 不建议这么做 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"avatar\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 建议这么做 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">\"avatar\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-实用高于完美\"><a href=\"#11-实用高于完美\" class=\"headerlink\" title=\"11) 实用高于完美\"></a>11) 实用高于完美</h4><p>尽量遵循HTML标准和语义，但是不应该以浪费实用性作为代价；</p>\n<p>任何时候都要用尽量小的复杂度和尽量少的标签来解决问题。</p>\n<h3 id=\"4-css、less\"><a href=\"#4-css、less\" class=\"headerlink\" title=\"4 css、less\"></a>4 css、less</h3><h4 id=\"1-缩进\"><a href=\"#1-缩进\" class=\"headerlink\" title=\"1) 缩进\"></a>1) 缩进</h4><p>使用soft tab（4个空格）</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-分号\"><a href=\"#2-分号\" class=\"headerlink\" title=\"2)分号\"></a>2)分号</h4><p>每个属性声明末尾都要加分号。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-空格\"><a href=\"#3-空格\" class=\"headerlink\" title=\"3)空格\"></a>3)空格</h4><p>以下几种情况不需要空格：</p>\n<ul>\n<li>属性名后</li>\n<li>多个规则的分隔符’,’前</li>\n<li><code>!important</code> ‘!’后</li>\n<li>属性值中’(‘后和’)’前</li>\n<li>行末不要有多余的空格</li>\n</ul>\n<p>以下几种情况需要空格：</p>\n<ul>\n<li>属性值前</li>\n<li>选择器’&gt;’, ‘+’, ‘~’前后</li>\n<li>‘{‘前</li>\n<li><code>!important</code> ‘!’前</li>\n<li><code>@else</code> 前后</li>\n<li>属性值中的’,’后</li>\n<li>注释’/<em>‘后和’</em>/‘前</li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color </span>:red! important;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red <span class=\"meta\">!important</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> ,</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>&gt;<span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &gt; <span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"variable\">@debug:</span> true;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: (yellow)when(<span class=\"variable\">@debug</span> = true);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: (yellow) when (<span class=\"variable\">@debug</span> = true);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-空行\"><a href=\"#4-空行\" class=\"headerlink\" title=\"4) 空行\"></a>4) 空行</h4><p>以下几种情况需要空行：</p>\n<ul>\n<li>文件最后保留一个空行</li>\n<li>‘}’后最好跟一个空行，包括scss中嵌套的规则</li>\n<li>属性之间需要适当的空行，具体见<a href=\"http://alloyteam.github.io/CodeGuide/#css-declaration-order\" target=\"_blank\" rel=\"noopener\">属性声明顺序</a></li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-注释\"><a href=\"#5-注释\" class=\"headerlink\" title=\"5) 注释\"></a>5) 注释</h4><p>注释统一用’/* */‘（scss中也不要用’//‘），具体参照右边的写法；</p>\n<p>缩进与下一行代码保持一致；</p>\n<p>可位于一个代码行的末尾，与代码间隔一个空格。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Modal header */</span></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Modal header</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 50px */</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red; <span class=\"comment\">/* color red */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-引号\"><a href=\"#6-引号\" class=\"headerlink\" title=\"6) 引号\"></a>6) 引号</h4><p>最外层统一使用双引号；</p>\n<p>url的内容要用引号；</p>\n<p>属性选择器中的属性值需要引号。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">\"logo.png\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">li</span><span class=\"selector-attr\">[data-type=\"single\"]</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-命名\"><a href=\"#7-命名\" class=\"headerlink\" title=\"7)命名\"></a>7)<code>命名</code></h4><ul>\n<li>类名使用<code>小写字母</code>，以<code>中划线</code>分隔</li>\n<li>id采用<code>驼峰式</code>命名</li>\n<li><code>less</code>中的变量、函数以<code>中划线</code>分隔命名</li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* class */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element-content</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* id */</span></span><br><span class=\"line\"><span class=\"selector-id\">#myDialog</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 变量 */</span></span><br><span class=\"line\"><span class=\"variable\">@color-black:</span> <span class=\"number\">#000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* mixins */</span></span><br><span class=\"line\"><span class=\"selector-class\">.my-mixin</span>() &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-属性声明顺序\"><a href=\"#8-属性声明顺序\" class=\"headerlink\" title=\"8)属性声明顺序\"></a>8)<code>属性声明顺序</code></h4><p>相关的属性声明按右边的顺序做分组处理，组之间需要有一个空行。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.declaration-order</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: right;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#e5e5e5</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">font</span>: normal <span class=\"number\">13px</span> <span class=\"string\">\"Helvetica Neue\"</span>, sans-serif;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#f5f5f5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>书写顺序前后</code>为：</p>\n<p>（1）<code>定位属性</code>：position  display  float  left  top  right  bottom   overflow  clear   z-index</p>\n<p>（2）<code>自身属性</code>：width  height  padding  border  margin   background</p>\n<p>（3）<code>文字样式</code>：font-family   font-size   font-style   font-weight   font-varient   color</p>\n<p>（4）<code>文本属性</code>text-align   vertical-align   text-wrap   text-transform   text-indent    text-decoration   letter-spacing    word-spacing    white-space   text-overflow</p>\n<p><strong>目的</strong>：减少浏览器reflow（回流），提升浏览器渲染dom的性能</p>\n<p><code>原理：浏览器的渲染流程为：</code></p>\n<p>1、解析html构建dom树，解析css构建css树：将html解析成树形的数据结构，将css解析成树形的数据结构</p>\n<p>2、构建render树：DOM树和CSS树合并之后形成的render树。</p>\n<p>3、布局render树：有了render树，浏览器已经知道那些网页中有哪些节点，各个节点的css定义和以及它们的从属关系，从而计算出每个节点在屏幕中的位置。</p>\n<p>4、绘制render树：按照计算出来的规则，通过显卡把内容画在屏幕上。</p>\n<p>css样式解析到显示至浏览器屏幕上就发生在234步骤，可见浏览器并不是一获取到css样式就立马开始解析而是根据css样式的书写顺序将之按照dom树的结构分布render样式，完成第2步，然后开始遍历每个树结点的css样式进行解析，此时的css样式的遍历顺序完全是按照之前的书写顺序。在解析过程中，一旦浏览器发现某个元素的定位变化影响布局，则需要倒回去重新渲染正如按照这样的书写书序：</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.demo</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: red ;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当浏览器解析到position的时候突然发现该元素是绝对定位元素需要脱离文档流，而之前却是按照普通元素进行解析的，所以不得不重新渲染，解除该元素在文档中所占位置，然而由于该元素的占位发生变化，其他元素也可能会受到它回流的影响而重新排位。最终导致③步骤花费的时间太久而影响到④步骤的显示，影响了用户体验。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 下面是推荐的属性的顺序</span></span><br><span class=\"line\"><span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">    [</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"display\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"visibility\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"float\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"clear\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"zoom\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"table-layout\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"empty-cells\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"caption-side\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-collapse\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-type\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-image\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-orient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-decoration-break\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-pack\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-flex\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"z-index\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-top-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-topleft\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-top-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-topright\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-bottom-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-bottomright\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-bottom-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-bottomleft\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"min-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"max-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"min-height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"max-height\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-family\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-weight\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-variant\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-size-adjust\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-stretch\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-effect\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-smooth\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"line-height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"vertical-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"white-space\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-decoration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-indent\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-justify\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-justify\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"letter-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-writing-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-outline\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow-ellipsis\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-word-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-word-break\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-break\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-attachment\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-background-position-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-background-position-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-size\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-offset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"opacity\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.Alpha(Opacity\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.Alpha\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-interpolation-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.gradient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.gradient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-shadow\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-direction\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"content\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"quotes\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"counter-reset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"counter-increment\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"resize\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"cursor\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-index\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-up\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-down\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"pointer-events\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-颜色\"><a href=\"#9-颜色\" class=\"headerlink\" title=\"9)颜色\"></a>9)颜色</h4><p>颜色16进制用小写字母；</p>\n<p>颜色16进制尽量用简写。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ABCDEF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#001122</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#abcdef</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#012</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"10-属性简写\"><a href=\"#10-属性简写\" class=\"headerlink\" title=\"10)属性简写\"></a>10)属性简写</h4><p>属性简写需要你非常清楚属性值的正确顺序，而且在大多数情况下并不需要设置属性简写中包含的所有值，所以建议尽量分开声明会更加清晰；</p>\n<p><code>margin</code> 和 <code>padding</code> 相反，需要使用简写；</p>\n<p>常见的属性简写包括：</p>\n<ul>\n<li><code>font</code></li>\n<li><code>background</code></li>\n<li><code>transition</code></li>\n<li><code>animation</code></li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: opacity <span class=\"number\">1s</span> linear <span class=\"number\">2s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transition-delay</span>: <span class=\"number\">2s</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transition-timing-function</span>: linear;</span><br><span class=\"line\">    <span class=\"attribute\">transition-duration</span>: <span class=\"number\">1s</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transition-property</span>: opacity;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-媒体查询\"><a href=\"#11-媒体查询\" class=\"headerlink\" title=\"11)媒体查询\"></a>11)<code>媒体查询</code></h4><p>尽量将媒体查询的规则靠近与他们相关的规则，不要将他们一起放到一个独立的样式文件中，或者丢在文档的最底部，这样做只会让大家以后更容易忘记他们。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.element-avatar</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@media</span> (<span class=\"attribute\">min-width</span>: <span class=\"number\">480px</span>) &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.element-avatar</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12-Less相关\"><a href=\"#12-Less相关\" class=\"headerlink\" title=\"12)Less相关\"></a>12)<code>Less相关</code></h4><p>每个模块应该有一个单独的less, 然后每个最外层的父类 className 应该写在第一位，所有子Node的样式都写在里面，这样是为了避免命名冲突。比如</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//out: false</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent-name</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.child-name</span>&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@import</code> 引入的文件不需要结尾的’.less’</p>\n<p><code>LESS嵌套最多不能超过5层</code>；</p>\n<p>不允许有空的规则；</p>\n<p>元素选择器用小写字母；</p>\n<p>去掉小数点前面的0；</p>\n<p>去掉数字中不必要的小数点和末尾的0；</p>\n<p>属性值’0’后面不要加单位；</p>\n<p>同个属性不同前缀的写法需要在垂直方向保持对齐，具体参照右边的写法；</p>\n<p>无前缀的标准属性应该写在有前缀的属性后面；</p>\n<p>不要在同个规则里出现重复的属性，如果重复的属性是连续的则没关系；</p>\n<p>不要在一个文件里出现两个相同的规则；</p>\n<p>用 <code>border: 0;</code> 代替 <code>border: none;</code>；</p>\n<p><code>CSS选择器不要超过3层</code>；</p>\n<p>尽量少用<code>&#39;*&#39;</code>选择器。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">LI</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50.0px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">0px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background</span>: linear-gradient(to bottom, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -moz-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">       <span class=\"attribute\">-moz-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>:    -moz-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>:         linear-gradient(to bottom, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-JavaScript\"><a href=\"#5-JavaScript\" class=\"headerlink\" title=\"5 JavaScript\"></a>5 JavaScript</h3><h4 id=\"1-缩进-1\"><a href=\"#1-缩进-1\" class=\"headerlink\" title=\"1)缩进\"></a>1)缩进</h4><p>使用soft tab（4个空格）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>,</span><br><span class=\"line\">    y = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x &lt; y) &#123;</span><br><span class=\"line\">    x += <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    x += <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-分号-1\"><a href=\"#2-分号-1\" class=\"headerlink\" title=\"2)分号\"></a>2)分号</h4><p>以下几种情况后需加分号：</p>\n<ul>\n<li>变量声明</li>\n<li>表达式</li>\n<li>return</li>\n<li>throw</li>\n<li>break</li>\n<li>continue</li>\n<li>do-while</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* var declaration */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* expression statement */</span></span><br><span class=\"line\">x++;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* do-while */</span></span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125; <span class=\"keyword\">while</span> (x &lt; <span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-空格-1\"><a href=\"#3-空格-1\" class=\"headerlink\" title=\"3)空格\"></a>3)空格</h4><p>以下几种情况不需要空格：</p>\n<ul>\n<li>对象的属性名后</li>\n<li>前缀一元运算符后</li>\n<li>后缀一元运算符前</li>\n<li>函数调用括号前</li>\n<li>无论是函数声明还是函数表达式，’(‘前不要空格</li>\n<li>数组的’[‘后和’]’前</li>\n<li>对象的’{‘后和’}’前</li>\n<li>运算符’(‘后和’)’前</li>\n</ul>\n<p>以下几种情况需要空格：</p>\n<ul>\n<li>二元运算符前后</li>\n<li>三元运算符’?:’前后</li>\n<li>代码块’{‘前</li>\n<li>下列关键字前：<code>else</code>, <code>while</code>, <code>catch</code>, <code>finally</code></li>\n<li>下列关键字后：<code>if</code>, <code>else</code>, <code>for</code>, <code>while</code>, <code>do</code>, <code>switch</code>, <code>case</code>, <code>try</code>,<code>catch</code>, <code>finally</code>, <code>with</code>, <code>return</code>, <code>typeof</code></li>\n<li>单行注释’//‘后（若单行注释和代码同行，则’//‘前也需要），多行注释’*’后</li>\n<li>对象的属性值前</li>\n<li>for循环，分号后留有一个空格，前置条件如果有多个，逗号后留一个空格</li>\n<li>无论是函数声明还是函数表达式，’{‘前一定要有空格</li>\n<li>函数的参数之间</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b :<span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">++ x;</span><br><span class=\"line\">y ++;</span><br><span class=\"line\">z = x?<span class=\"number\">1</span>:<span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">++x;</span><br><span class=\"line\">y++;</span><br><span class=\"line\">z = x ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [ <span class=\"number\">1</span>, <span class=\"number\">2</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = ( <span class=\"number\">1</span>+<span class=\"number\">2</span> )*<span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = (<span class=\"number\">1</span> + <span class=\"number\">2</span>) * <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no space before '(', one space before '&#123;', one space between function parameters</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no space before '('</span></span><br><span class=\"line\">doSomething(item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">6</span>;i++)&#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">6</span>; i++) &#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-空行-1\"><a href=\"#4-空行-1\" class=\"headerlink\" title=\"4)空行\"></a>4)空行</h4><p>以下几种情况需要空行：</p>\n<ul>\n<li>变量声明后（当变量声明在代码块的最后一行时，则无需空行）</li>\n<li>注释前（当注释在代码块的第一行时，则无需空行）</li>\n<li>代码块后（在函数调用、数组、对象中则无需空行）</li>\n<li>文件最后保留一个空行</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// need blank line after variable declaration</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not need blank line when variable declaration is last expression in the current block</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y = x + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// need blank line before line comment</span></span><br><span class=\"line\">a++;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// not need blank line when comment is first line of block</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// need blank line after blocks</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    bar: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not need blank line when in argument list, array, object</span></span><br><span class=\"line\">func(</span><br><span class=\"line\">    <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = [</span><br><span class=\"line\">    <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span></span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    b: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    c: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-换行\"><a href=\"#5-换行\" class=\"headerlink\" title=\"5)换行\"></a>5)换行</h4><p>换行的地方，行末必须有’,’或者运算符；</p>\n<p>以下几种情况不需要换行：</p>\n<ul>\n<li>下列关键字后：<code>else</code>, <code>catch</code>, <code>finally</code></li>\n<li>代码块’{‘前</li>\n</ul>\n<p>以下几种情况需要换行：</p>\n<ul>\n<li>代码块’{‘后和’}’前</li>\n<li>变量赋值后</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span></span><br><span class=\"line\">    , <span class=\"attr\">c</span>: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">x = y</span><br><span class=\"line\">    ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">x = y ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\">x = y ?</span><br><span class=\"line\">    <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no need line break with 'else', 'catch', 'finally'</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a, foo = <span class=\"number\">7</span>, b,</span><br><span class=\"line\">    c, bar = <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a,</span><br><span class=\"line\">    foo = <span class=\"number\">7</span>,</span><br><span class=\"line\">    b, c, bar = <span class=\"number\">8</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-单行注释\"><a href=\"#6-单行注释\" class=\"headerlink\" title=\"6)单行注释\"></a>6)单行注释</h4><p>双斜线后，必须跟一个空格；</p>\n<p>缩进与下一行代码保持一致；</p>\n<p>可位于一个代码行的末尾，与代码间隔一个空格。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// if you made it here, then all security checks passed</span></span><br><span class=\"line\">    allowed();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> zhangsan = <span class=\"string\">'zhangsan'</span>; <span class=\"comment\">// one space after code</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-多行注释\"><a href=\"#7-多行注释\" class=\"headerlink\" title=\"7)多行注释\"></a>7)多行注释</h4><p>最少三行, ‘*’后跟一个空格，具体参照右边的写法；</p>\n<p>建议在以下情况下使用：</p>\n<ul>\n<li>难于理解的代码段</li>\n<li>可能存在错误的代码段</li>\n<li>浏览器特殊的HACK代码</li>\n<li>业务逻辑强相关的代码</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * one space after '*'</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-文档注释\"><a href=\"#8-文档注释\" class=\"headerlink\" title=\"8)文档注释\"></a>8)<code>文档注释</code></h4><p>各类标签@param, @method等请参考<a href=\"http://usejsdoc.org/\" target=\"_blank\" rel=\"noopener\">usejsdoc</a>和<a href=\"http://yuri4ever.github.io/jsdoc/\" target=\"_blank\" rel=\"noopener\">JSDoc Guide</a>；</p>\n<p>建议在以下情况下使用：</p>\n<ul>\n<li>所有常量</li>\n<li>所有函数</li>\n<li>所有类</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @func</span><br><span class=\"line\"> * @desc 一个带参数的函数</span><br><span class=\"line\"> * @param &#123;string&#125; a - 参数a</span><br><span class=\"line\"> * @param &#123;number&#125; b&#x3D;1 - 参数b默认值为1</span><br><span class=\"line\"> * @param &#123;string&#125; c&#x3D;1 - 参数c有两种支持的取值&lt;&#x2F;br&gt;1—表示x&lt;&#x2F;br&gt;2—表示xx</span><br><span class=\"line\"> * @param &#123;object&#125; d - 参数d为一个对象</span><br><span class=\"line\"> * @param &#123;string&#125; d.e - 参数d的e属性</span><br><span class=\"line\"> * @param &#123;string&#125; d.f - 参数d的f属性</span><br><span class=\"line\"> * @param &#123;object[]&#125; g - 参数g为一个对象数组</span><br><span class=\"line\"> * @param &#123;string&#125; g.h - 参数g数组中一项的h属性</span><br><span class=\"line\"> * @param &#123;string&#125; g.i - 参数g数组中一项的i属性</span><br><span class=\"line\"> * @param &#123;string&#125; [j] - 参数j是一个可选参数</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function foo(a, b, c, d, g, j) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-引号\"><a href=\"#9-引号\" class=\"headerlink\" title=\"9)引号\"></a>9)引号</h4><p>最外层统一使用单引号。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"string\">\"test\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"string\">'foo'</span>,</span><br><span class=\"line\">    z = <span class=\"string\">'&lt;div id=\"test\"&gt;&lt;/div&gt;'</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"10-变量命名\"><a href=\"#10-变量命名\" class=\"headerlink\" title=\"10)变量命名\"></a>10)变量命名</h4><ul>\n<li>标准变量采用驼峰式命名（除了对象的属性外，主要是考虑到cgi返回的数据）</li>\n<li>‘ID’在变量名中全大写</li>\n<li>‘URL’在变量名中全大写</li>\n<li>‘Android’在变量名中大写第一个字母</li>\n<li>‘iOS’在变量名中小写第一个，大写后两个字母</li>\n<li>常量全大写，用下划线连接</li>\n<li>构造函数，大写第一个字母</li>\n<li>jquery对象必须以’$’开头命名</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> thisIsMyName;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> goodID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> reportURL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> AndroidVersion;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> iOSVersion;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MAX_COUNT = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> body = $(<span class=\"string\">'body'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> $body = $(<span class=\"string\">'body'</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-变量声明\"><a href=\"#11-变量声明\" class=\"headerlink\" title=\"11)变量声明\"></a>11)变量声明</h4><p>一个函数作用域中所有的变量声明尽量提到函数首部，用一个var 声明，不允许出现两个连续的var声明。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomethingWithItems</span>(<span class=\"params\">items</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// use one var</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"number\">10</span>,</span><br><span class=\"line\">        result = value + <span class=\"number\">10</span>,</span><br><span class=\"line\">        i,</span><br><span class=\"line\">        len;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>, len = items.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">        result += <span class=\"number\">10</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12-函数\"><a href=\"#12-函数\" class=\"headerlink\" title=\"12)函数\"></a>12)函数</h4><p>无论是函数声明还是函数表达式，’(‘前不要空格，但’{‘前一定要有空格；</p>\n<p>函数调用括号前不需要空格；</p>\n<p>立即执行函数外必须包一层括号；</p>\n<p>不要给inline function命名；</p>\n<p>参数之间用’, ‘分隔，注意逗号后有一个空格。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// no space before '(', but one space before'&#123;'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">doSomething (item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">doSomething(item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// requires parentheses around immediately invoked function expressions</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">x</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// use ', ' between function parameters</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"13-数组、对象\"><a href=\"#13-数组、对象\" class=\"headerlink\" title=\"13)数组、对象\"></a>13)数组、对象</h4><p>对象属性名不需要加引号；</p>\n<p>对象以缩进的形式书写，不要写在一行；</p>\n<p>数组、对象最后不要有逗号。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"string\">'b'</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;<span class=\"attr\">b</span>: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"14-括号\"><a href=\"#14-括号\" class=\"headerlink\" title=\"14)括号\"></a>14)括号</h4><p>下列关键字后必须有大括号（即使代码块的内容只有一行）：<code>if</code>, <code>else</code>,<code>for</code>, <code>while</code>, <code>do</code>, <code>switch</code>, <code>try</code>, <code>catch</code>, <code>finally</code>, <code>with</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition)</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"15-null\"><a href=\"#15-null\" class=\"headerlink\" title=\"15)null\"></a>15)null</h4><p>适用场景：</p>\n<ul>\n<li>初始化一个将来可能被赋值为对象的变量</li>\n<li>与已经初始化的变量做比较</li>\n<li>作为一个参数为对象的函数的调用传参</li>\n<li>作为一个返回对象的函数的返回值</li>\n</ul>\n<p>不适用场景：</p>\n<ul>\n<li>不要用null来判断函数调用时有无传参</li>\n<li>不要与未初始化的变量做比较</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (b <span class=\"string\">`= null) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        // not mean b is not supply</span></span><br><span class=\"line\"><span class=\"string\">        ...</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">var a;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">if (a `</span>= <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a <span class=\"string\">`= null) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    ...</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"16-undefined\"><a href=\"#16-undefined\" class=\"headerlink\" title=\"16)undefined\"></a>16)undefined</h4><p>永远不要直接使用undefined进行变量判断；</p>\n<p>使用typeof和字符串’undefined’对变量进行判断。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (person <span class=\"string\">`= undefined) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    ...</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">// good</span></span><br><span class=\"line\"><span class=\"string\">if (typeof person `</span>= <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"17-jshint\"><a href=\"#17-jshint\" class=\"headerlink\" title=\"17)jshint\"></a>17)jshint</h4><p>用’<code>=&#39;, &#39;!</code>‘代替’`’, ‘!=’；</p>\n<p>for-in里一定要有hasOwnProperty的判断；</p>\n<p>不要在内置对象的原型上添加方法，如Array, Date；</p>\n<p>不要在内层作用域的代码里声明了变量，之后却访问到了外层作用域的同名变量；</p>\n<p>变量不要先使用后声明；</p>\n<p>不要在一句代码中单单使用构造函数，记得将其赋值给某个变量；</p>\n<p>不要在同个作用域下声明同名变量；</p>\n<p>不要在一些不需要的地方加括号，例：delete(a.b)；</p>\n<p>不要使用未声明的变量（全局变量需要加到.jshintrc文件的globals属性里面）；</p>\n<p>不要声明了变量却不使用；</p>\n<p>不要在应该做比较的地方做赋值；</p>\n<p>debugger不要出现在提交的代码里；</p>\n<p>数组中不要存在空元素；</p>\n<p>不要在循环内部声明函数；</p>\n<p>不要像这样使用构造函数，例：<code>new function () { ... }</code>, <code>new Object</code>；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a <span class=\"string\">` 1) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    a++;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">// good</span></span><br><span class=\"line\"><span class=\"string\">if (a `</span>= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// be sure that obj[key] belongs to the object and was not inherited</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.count = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    x += <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span>(obj.attr);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> obj.attr;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a = <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, , , <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> nums = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">        nums[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> i + j;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;(i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> privateVar;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.publicMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        privateVar = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.publicMethod2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        privateVar = <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"18-杂项\"><a href=\"#18-杂项\" class=\"headerlink\" title=\"18)杂项\"></a>18)杂项</h4><p>不要混用tab和space；</p>\n<p>不要在一处使用多个tab或space；</p>\n<p>换行符统一用’LF’；</p>\n<p>对上下文this的引用只能使用’_this’, ‘that’, ‘self’其中一个来命名；</p>\n<p>行尾不要有空白字符；</p>\n<p>switch的falling through和no default的情况一定要有注释特别说明；</p>\n<p>不允许有空的代码块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a   = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// not good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> me = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">switch</span> (condition) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    <span class=\"comment\">// why fall through</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">4</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"comment\">// why no default</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good with empty block</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前端代码规范\"><a href=\"#前端代码规范\" class=\"headerlink\" title=\"前端代码规范\"></a>前端代码规范</h2><p>[TOC]</p>\n<h3 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1 前言\"></a>1 前言</h3><p>随着团队人数的增加，每个人的代码编写喜好不同，代码风格也迥然不同。如果有一个大家的统一的愿意遵守的代码规范，肯定事半功倍，提高效率，避免代码<code>Review</code>和<code>重构</code>。</p>\n<p>目前这只是一个基础的版本，如果有哪些规则不太好，大家可以提出<code>issues</code> 然后一起沟通协商规则。</p>\n<p>其中一部分规则参考了 腾讯<code>alloyteam</code>团队的代码规范，如有错误，请指出，将会非常感谢。</p>\n<p>坚持好的代码风格规范，从你我做起。</p>\n<h3 id=\"2-命名规范\"><a href=\"#2-命名规范\" class=\"headerlink\" title=\"2 命名规范\"></a>2 命名规范</h3><h4 id=\"1-项目命名\"><a href=\"#1-项目命名\" class=\"headerlink\" title=\"1) 项目命名\"></a>1) 项目命名</h4><p>全部采用小写方式， 以下划线分隔。</p>\n<p>例：<code>my_project_name</code></p>\n<h4 id=\"2-目录命名\"><a href=\"#2-目录命名\" class=\"headerlink\" title=\"2 )目录命名\"></a>2 )目录命名</h4><p>参照项目命名规则；</p>\n<p>有复数结构时，要采用复数命名法。</p>\n<p>例：<code>pages</code>, <code>assets</code>, <code>directives</code>, <code>components</code>, <code>mixins</code>, <code>utils</code></p>\n<h4 id=\"3-javaScript-文件命名\"><a href=\"#3-javaScript-文件命名\" class=\"headerlink\" title=\"3)javaScript 文件命名\"></a>3)<code>javaScript</code> 文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>account_model.js</code></p>\n<h4 id=\"4-CSS-less文件命名\"><a href=\"#4-CSS-less文件命名\" class=\"headerlink\" title=\"4)CSS,less文件命名\"></a>4)<code>CSS</code>,<code>less</code>文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>retina_sprites.less</code></p>\n<h4 id=\"5-HTML文件命名\"><a href=\"#5-HTML文件命名\" class=\"headerlink\" title=\"5)HTML文件命名\"></a>5)HTML文件命名</h4><p>参照项目命名规则。</p>\n<p>例：<code>error_report.html</code></p>\n<h4 id=\"6-如果使用Vue或者React技术栈，组件Component命名\"><a href=\"#6-如果使用Vue或者React技术栈，组件Component命名\" class=\"headerlink\" title=\"6) 如果使用Vue或者React技术栈，组件Component命名\"></a>6) 如果使用<code>Vue</code>或者<code>React</code>技术栈，组件<code>Component</code>命名</h4><p>所有组件名字需要首字母大写，然后驼峰格式</p>\n<p>例：<code>CalendarList.vue</code></p>\n<h3 id=\"3-HTML\"><a href=\"#3-HTML\" class=\"headerlink\" title=\"3 HTML\"></a>3 HTML</h3><h4 id=\"1-语法\"><a href=\"#1-语法\" class=\"headerlink\" title=\"1) 语法\"></a>1) 语法</h4><ul>\n<li>缩进使用soft tab（4个空格）；</li>\n<li>嵌套的节点应该缩进；</li>\n<li>在属性上，使用双引号，不要使用单引号；</li>\n<li>属性名全小写，用中划线做分隔符；</li>\n<li>不要在自动闭合标签结尾处使用斜线（<a href=\"http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag\" target=\"_blank\" rel=\"noopener\">HTML5 规范</a> 指出他们是可选的）；</li>\n<li>不要忽略可选的关闭标签;</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Page title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"images/company_logo.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"Company\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">class</span>=<span class=\"string\">\"hello-world\"</span>&gt;</span>Hello, world!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-HTML5-doctype\"><a href=\"#2-HTML5-doctype\" class=\"headerlink\" title=\"2) HTML5 doctype\"></a>2) HTML5 doctype</h4><p>在页面开头使用这个简单地doctype来启用标准模式，使其在每个浏览器中尽可能一致的展现；</p>\n<p>虽然doctype不区分大小写，但是按照惯例，doctype大写 （<a href=\"http://stackoverflow.com/questions/15594877/is-there-any-benefits-to-use-uppercase-or-lowercase-letters-with-html5-tagname\" target=\"_blank\" rel=\"noopener\">关于html属性，大写还是小写</a>）。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">\t...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-lang属性\"><a href=\"#3-lang属性\" class=\"headerlink\" title=\"3) lang属性\"></a>3) lang属性</h4><p>根据HTML5规范：</p>\n<blockquote>\n<p>应在html标签上加上lang属性。这会给语音工具和翻译工具帮助，告诉它们应当怎么去发音和翻译。</p>\n</blockquote>\n<p>更多关于 <code>lang</code> 属性的说明<a href=\"http://www.w3.org/html/wg/drafts/html/master/semantics.html#the-html-element\" target=\"_blank\" rel=\"noopener\">在这里</a>；</p>\n<p>在sitepoint上可以查到<a href=\"http://reference.sitepoint.com/html/lang-codes\" target=\"_blank\" rel=\"noopener\">语言列表</a>；</p>\n<p>但sitepoint只是给出了语言的大类，例如中文只给出了zh，但是没有区分香港，台湾，大陆。而微软给出了一份更加<a href=\"http://msdn.microsoft.com/en-us/library/ms533052(v=vs.85).aspx\" target=\"_blank\" rel=\"noopener\">详细的语言列表</a>，其中细分了zh-cn, zh-hk, zh-tw。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en-us\"</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-字符编码\"><a href=\"#4-字符编码\" class=\"headerlink\" title=\"4) 字符编码\"></a>4) 字符编码</h4><p>通过声明一个明确的字符编码，让浏览器轻松、快速的确定适合网页内容的渲染方式，通常指定为’UTF-8’。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-IE兼容模式\"><a href=\"#5-IE兼容模式\" class=\"headerlink\" title=\"5) IE兼容模式\"></a>5) IE兼容模式</h4><p>用 `` 标签可以指定页面应该用什么版本的IE来渲染；</p>\n<p>如果你想要了解更多，请点击<a href=\"http://stackoverflow.com/questions/6771258/whats-the-difference-if-meta-http-equiv-x-ua-compatible-content-ie-edge-e\" target=\"_blank\" rel=\"noopener\">这里</a>；</p>\n<p>不同doctype在不同浏览器下会触发不同的渲染模式（<a href=\"https://hsivonen.fi/doctype/\" target=\"_blank\" rel=\"noopener\">这篇文章</a>总结的很到位）。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=Edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-引入CSS-JS\"><a href=\"#6-引入CSS-JS\" class=\"headerlink\" title=\"6) 引入CSS, JS\"></a>6) 引入CSS, JS</h4><p>根据HTML5规范, 通常在引入CSS和JS时不需要指明 <code>type</code>，因为 <code>text/css</code>和 <code>text/javascript</code> 分别是他们的默认值。</p>\n<p><strong>HTML5 规范链接</strong></p>\n<ul>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-link-element\" target=\"_blank\" rel=\"noopener\">使用link</a></li>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/semantics.html#the-style-element\" target=\"_blank\" rel=\"noopener\">使用style</a></li>\n<li><a href=\"http://www.w3.org/TR/2011/WD-html5-20110525/scripting-1.html#the-script-element\" target=\"_blank\" rel=\"noopener\">使用script</a></li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- External CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"code_guide.css\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- In-document CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- External JS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"code_guide.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- In-document JS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-属性顺序\"><a href=\"#7-属性顺序\" class=\"headerlink\" title=\"7) 属性顺序\"></a>7) 属性顺序</h4><p>属性应该按照特定的顺序出现以保证易读性；</p>\n<ul>\n<li><code>class</code></li>\n<li><code>id</code></li>\n<li><code>name</code></li>\n<li><code>data-*</code></li>\n<li><code>src</code>, <code>for</code>, <code>type</code>, <code>href</code>, <code>value</code> , <code>max-length</code>, <code>max</code>, <code>min</code>, <code>pattern</code></li>\n<li><code>placeholder</code>, <code>title</code>, <code>alt</code></li>\n<li><code>aria-*</code>, <code>role</code></li>\n<li><code>required</code>, <code>readonly</code>, <code>disabled</code></li>\n</ul>\n<p><code>class</code>是为高可复用组件设计的，所以应处在第一位；</p>\n<p><code>id</code> 具体且应该尽量少使用，所以将它放在第二位。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">data-modal</span>=<span class=\"string\">\"toggle\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span>&gt;</span>Example link<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-boolean属性\"><a href=\"#8-boolean属性\" class=\"headerlink\" title=\"8) boolean属性\"></a>8) boolean属性</h4><p>boolean属性指不需要声明取值的属性，XHTML需要每个属性声明取值，但是HTML5并不需要；</p>\n<p>更多内容可以参考 <a href=\"http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#boolean-attributes\" target=\"_blank\" rel=\"noopener\">WhatWG section on boolean attributes</a>：</p>\n<blockquote>\n<p>boolean属性的存在表示取值为true，不存在则表示取值为false。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">disabled</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">checked</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">selected</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-JS生成标签\"><a href=\"#9-JS生成标签\" class=\"headerlink\" title=\"9) JS生成标签\"></a>9) JS生成标签</h4><p>在JS文件中生成标签让内容变得更难查找，更难编辑，性能更差。应该尽量避免这种情况的出现。</p>\n<h4 id=\"10-减少标签数量\"><a href=\"#10-减少标签数量\" class=\"headerlink\" title=\"10) 减少标签数量\"></a>10) 减少标签数量</h4><p>在编写HTML代码时，需要尽量避免多余的父节点；</p>\n<p>很多时候，需要通过迭代和重构来使HTML变得更少。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 不建议这么做 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"avatar\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 建议这么做 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">\"avatar\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"...\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-实用高于完美\"><a href=\"#11-实用高于完美\" class=\"headerlink\" title=\"11) 实用高于完美\"></a>11) 实用高于完美</h4><p>尽量遵循HTML标准和语义，但是不应该以浪费实用性作为代价；</p>\n<p>任何时候都要用尽量小的复杂度和尽量少的标签来解决问题。</p>\n<h3 id=\"4-css、less\"><a href=\"#4-css、less\" class=\"headerlink\" title=\"4 css、less\"></a>4 css、less</h3><h4 id=\"1-缩进\"><a href=\"#1-缩进\" class=\"headerlink\" title=\"1) 缩进\"></a>1) 缩进</h4><p>使用soft tab（4个空格）</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-分号\"><a href=\"#2-分号\" class=\"headerlink\" title=\"2)分号\"></a>2)分号</h4><p>每个属性声明末尾都要加分号。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-空格\"><a href=\"#3-空格\" class=\"headerlink\" title=\"3)空格\"></a>3)空格</h4><p>以下几种情况不需要空格：</p>\n<ul>\n<li>属性名后</li>\n<li>多个规则的分隔符’,’前</li>\n<li><code>!important</code> ‘!’后</li>\n<li>属性值中’(‘后和’)’前</li>\n<li>行末不要有多余的空格</li>\n</ul>\n<p>以下几种情况需要空格：</p>\n<ul>\n<li>属性值前</li>\n<li>选择器’&gt;’, ‘+’, ‘~’前后</li>\n<li>‘{‘前</li>\n<li><code>!important</code> ‘!’前</li>\n<li><code>@else</code> 前后</li>\n<li>属性值中的’,’后</li>\n<li>注释’/<em>‘后和’</em>/‘前</li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color </span>:red! important;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,.<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red <span class=\"meta\">!important</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> ,</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>&gt;<span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &gt; <span class=\"selector-class\">.dialog</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"variable\">@debug:</span> true;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: (yellow)when(<span class=\"variable\">@debug</span> = true);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: (yellow) when (<span class=\"variable\">@debug</span> = true);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-空行\"><a href=\"#4-空行\" class=\"headerlink\" title=\"4) 空行\"></a>4) 空行</h4><p>以下几种情况需要空行：</p>\n<ul>\n<li>文件最后保留一个空行</li>\n<li>‘}’后最好跟一个空行，包括scss中嵌套的规则</li>\n<li>属性之间需要适当的空行，具体见<a href=\"http://alloyteam.github.io/CodeGuide/#css-declaration-order\" target=\"_blank\" rel=\"noopener\">属性声明顺序</a></li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.dialog</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-注释\"><a href=\"#5-注释\" class=\"headerlink\" title=\"5) 注释\"></a>5) 注释</h4><p>注释统一用’/* */‘（scss中也不要用’//‘），具体参照右边的写法；</p>\n<p>缩进与下一行代码保持一致；</p>\n<p>可位于一个代码行的末尾，与代码间隔一个空格。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Modal header */</span></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Modal header</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.modal-header</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 50px */</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red; <span class=\"comment\">/* color red */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-引号\"><a href=\"#6-引号\" class=\"headerlink\" title=\"6) 引号\"></a>6) 引号</h4><p>最外层统一使用双引号；</p>\n<p>url的内容要用引号；</p>\n<p>属性选择器中的属性值需要引号。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">\"logo.png\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">li</span><span class=\"selector-attr\">[data-type=\"single\"]</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-命名\"><a href=\"#7-命名\" class=\"headerlink\" title=\"7)命名\"></a>7)<code>命名</code></h4><ul>\n<li>类名使用<code>小写字母</code>，以<code>中划线</code>分隔</li>\n<li>id采用<code>驼峰式</code>命名</li>\n<li><code>less</code>中的变量、函数以<code>中划线</code>分隔命名</li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* class */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element-content</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* id */</span></span><br><span class=\"line\"><span class=\"selector-id\">#myDialog</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 变量 */</span></span><br><span class=\"line\"><span class=\"variable\">@color-black:</span> <span class=\"number\">#000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* mixins */</span></span><br><span class=\"line\"><span class=\"selector-class\">.my-mixin</span>() &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-属性声明顺序\"><a href=\"#8-属性声明顺序\" class=\"headerlink\" title=\"8)属性声明顺序\"></a>8)<code>属性声明顺序</code></h4><p>相关的属性声明按右边的顺序做分组处理，组之间需要有一个空行。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.declaration-order</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: right;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#e5e5e5</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">font</span>: normal <span class=\"number\">13px</span> <span class=\"string\">\"Helvetica Neue\"</span>, sans-serif;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#f5f5f5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>书写顺序前后</code>为：</p>\n<p>（1）<code>定位属性</code>：position  display  float  left  top  right  bottom   overflow  clear   z-index</p>\n<p>（2）<code>自身属性</code>：width  height  padding  border  margin   background</p>\n<p>（3）<code>文字样式</code>：font-family   font-size   font-style   font-weight   font-varient   color</p>\n<p>（4）<code>文本属性</code>text-align   vertical-align   text-wrap   text-transform   text-indent    text-decoration   letter-spacing    word-spacing    white-space   text-overflow</p>\n<p><strong>目的</strong>：减少浏览器reflow（回流），提升浏览器渲染dom的性能</p>\n<p><code>原理：浏览器的渲染流程为：</code></p>\n<p>1、解析html构建dom树，解析css构建css树：将html解析成树形的数据结构，将css解析成树形的数据结构</p>\n<p>2、构建render树：DOM树和CSS树合并之后形成的render树。</p>\n<p>3、布局render树：有了render树，浏览器已经知道那些网页中有哪些节点，各个节点的css定义和以及它们的从属关系，从而计算出每个节点在屏幕中的位置。</p>\n<p>4、绘制render树：按照计算出来的规则，通过显卡把内容画在屏幕上。</p>\n<p>css样式解析到显示至浏览器屏幕上就发生在234步骤，可见浏览器并不是一获取到css样式就立马开始解析而是根据css样式的书写顺序将之按照dom树的结构分布render样式，完成第2步，然后开始遍历每个树结点的css样式进行解析，此时的css样式的遍历顺序完全是按照之前的书写顺序。在解析过程中，一旦浏览器发现某个元素的定位变化影响布局，则需要倒回去重新渲染正如按照这样的书写书序：</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.demo</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: red ;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当浏览器解析到position的时候突然发现该元素是绝对定位元素需要脱离文档流，而之前却是按照普通元素进行解析的，所以不得不重新渲染，解除该元素在文档中所占位置，然而由于该元素的占位发生变化，其他元素也可能会受到它回流的影响而重新排位。最终导致③步骤花费的时间太久而影响到④步骤的显示，影响了用户体验。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 下面是推荐的属性的顺序</span></span><br><span class=\"line\"><span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">    [</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"display\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"visibility\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"float\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"clear\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"overflow-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"zoom\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"table-layout\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"empty-cells\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"caption-side\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-collapse\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-type\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"list-style-image\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-orient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-decoration-break\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-pack\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-flex\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"z-index\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"margin-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"box-sizing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-right-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-left-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-top-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-topleft\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-top-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-topright\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-top-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-bottom-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-bottomright\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-right-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-bottom-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-radius-bottomleft\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-bottom-left-radius\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-source\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-slice\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-outset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"border-image-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-top\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-bottom\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"padding-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"min-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"max-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"min-height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"max-height\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-family\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-weight\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-variant\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-size-adjust\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-stretch\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-effect\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-emphasize-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"font-smooth\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"line-height\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-align-last\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"vertical-align\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"white-space\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-decoration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-emphasis-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-indent\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-justify\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-justify\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"letter-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-spacing\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-writing-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-outline\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-text-overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow-ellipsis\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-overflow-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-word-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-wrap\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-word-break\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"word-break\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-image\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-repeat\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-attachment\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-background-position-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position-x\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-background-position-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-position-y\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-clip\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-background-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"background-size\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-width\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-style\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-color\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"outline-offset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"opacity\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.Alpha(Opacity\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.Alpha\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-interpolation-mode\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"box-shadow\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"filter:progid:DXImageTransform.Microsoft.gradient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-filter:\\\\'progid:DXImageTransform.Microsoft.gradient\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"text-shadow\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transition-property\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transform\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"transform-origin\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-name\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-duration\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-play-state\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-timing-function\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-delay\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-iteration-count\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-animation-direction\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"animation-direction\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span>,</span><br><span class=\"line\">    <span class=\"selector-attr\">[</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"content\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"quotes\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"counter-reset\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"counter-increment\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"resize\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"cursor\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-ms-user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"user-select\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-index\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-up\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-right\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-down\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"nav-left\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-o-tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"tab-size\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-webkit-hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"-moz-hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"hyphens\",</span></span><br><span class=\"line\"><span class=\"selector-attr\">        \"pointer-events\"</span></span><br><span class=\"line\"><span class=\"selector-attr\">    ]</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-颜色\"><a href=\"#9-颜色\" class=\"headerlink\" title=\"9)颜色\"></a>9)颜色</h4><p>颜色16进制用小写字母；</p>\n<p>颜色16进制尽量用简写。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ABCDEF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#001122</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#abcdef</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#012</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"10-属性简写\"><a href=\"#10-属性简写\" class=\"headerlink\" title=\"10)属性简写\"></a>10)属性简写</h4><p>属性简写需要你非常清楚属性值的正确顺序，而且在大多数情况下并不需要设置属性简写中包含的所有值，所以建议尽量分开声明会更加清晰；</p>\n<p><code>margin</code> 和 <code>padding</code> 相反，需要使用简写；</p>\n<p>常见的属性简写包括：</p>\n<ul>\n<li><code>font</code></li>\n<li><code>background</code></li>\n<li><code>transition</code></li>\n<li><code>animation</code></li>\n</ul>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: opacity <span class=\"number\">1s</span> linear <span class=\"number\">2s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transition-delay</span>: <span class=\"number\">2s</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transition-timing-function</span>: linear;</span><br><span class=\"line\">    <span class=\"attribute\">transition-duration</span>: <span class=\"number\">1s</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transition-property</span>: opacity;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-媒体查询\"><a href=\"#11-媒体查询\" class=\"headerlink\" title=\"11)媒体查询\"></a>11)<code>媒体查询</code></h4><p>尽量将媒体查询的规则靠近与他们相关的规则，不要将他们一起放到一个独立的样式文件中，或者丢在文档的最底部，这样做只会让大家以后更容易忘记他们。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.element-avatar</span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@media</span> (<span class=\"attribute\">min-width</span>: <span class=\"number\">480px</span>) &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.element-avatar</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12-Less相关\"><a href=\"#12-Less相关\" class=\"headerlink\" title=\"12)Less相关\"></a>12)<code>Less相关</code></h4><p>每个模块应该有一个单独的less, 然后每个最外层的父类 className 应该写在第一位，所有子Node的样式都写在里面，这样是为了避免命名冲突。比如</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//out: false</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent-name</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.child-name</span>&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@import</code> 引入的文件不需要结尾的’.less’</p>\n<p><code>LESS嵌套最多不能超过5层</code>；</p>\n<p>不允许有空的规则；</p>\n<p>元素选择器用小写字母；</p>\n<p>去掉小数点前面的0；</p>\n<p>去掉数字中不必要的小数点和末尾的0；</p>\n<p>属性值’0’后面不要加单位；</p>\n<p>同个属性不同前缀的写法需要在垂直方向保持对齐，具体参照右边的写法；</p>\n<p>无前缀的标准属性应该写在有前缀的属性后面；</p>\n<p>不要在同个规则里出现重复的属性，如果重复的属性是连续的则没关系；</p>\n<p>不要在一个文件里出现两个相同的规则；</p>\n<p>用 <code>border: 0;</code> 代替 <code>border: none;</code>；</p>\n<p><code>CSS选择器不要超过3层</code>；</p>\n<p>尽量少用<code>&#39;*&#39;</code>选择器。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">LI</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50.0px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">0px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background</span>: linear-gradient(to bottom, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -moz-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">       <span class=\"attribute\">-moz-border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>:    -moz-linear-gradient(top, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background</span>:         linear-gradient(to bottom, <span class=\"number\">#fff</span> <span class=\"number\">0</span>, <span class=\"number\">#eee</span> <span class=\"number\">100%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* not good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* good */</span></span><br><span class=\"line\"><span class=\"selector-class\">.element</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgba(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, .<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-JavaScript\"><a href=\"#5-JavaScript\" class=\"headerlink\" title=\"5 JavaScript\"></a>5 JavaScript</h3><h4 id=\"1-缩进-1\"><a href=\"#1-缩进-1\" class=\"headerlink\" title=\"1)缩进\"></a>1)缩进</h4><p>使用soft tab（4个空格）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>,</span><br><span class=\"line\">    y = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x &lt; y) &#123;</span><br><span class=\"line\">    x += <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    x += <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-分号-1\"><a href=\"#2-分号-1\" class=\"headerlink\" title=\"2)分号\"></a>2)分号</h4><p>以下几种情况后需加分号：</p>\n<ul>\n<li>变量声明</li>\n<li>表达式</li>\n<li>return</li>\n<li>throw</li>\n<li>break</li>\n<li>continue</li>\n<li>do-while</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* var declaration */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* expression statement */</span></span><br><span class=\"line\">x++;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* do-while */</span></span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125; <span class=\"keyword\">while</span> (x &lt; <span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-空格-1\"><a href=\"#3-空格-1\" class=\"headerlink\" title=\"3)空格\"></a>3)空格</h4><p>以下几种情况不需要空格：</p>\n<ul>\n<li>对象的属性名后</li>\n<li>前缀一元运算符后</li>\n<li>后缀一元运算符前</li>\n<li>函数调用括号前</li>\n<li>无论是函数声明还是函数表达式，’(‘前不要空格</li>\n<li>数组的’[‘后和’]’前</li>\n<li>对象的’{‘后和’}’前</li>\n<li>运算符’(‘后和’)’前</li>\n</ul>\n<p>以下几种情况需要空格：</p>\n<ul>\n<li>二元运算符前后</li>\n<li>三元运算符’?:’前后</li>\n<li>代码块’{‘前</li>\n<li>下列关键字前：<code>else</code>, <code>while</code>, <code>catch</code>, <code>finally</code></li>\n<li>下列关键字后：<code>if</code>, <code>else</code>, <code>for</code>, <code>while</code>, <code>do</code>, <code>switch</code>, <code>case</code>, <code>try</code>,<code>catch</code>, <code>finally</code>, <code>with</code>, <code>return</code>, <code>typeof</code></li>\n<li>单行注释’//‘后（若单行注释和代码同行，则’//‘前也需要），多行注释’*’后</li>\n<li>对象的属性值前</li>\n<li>for循环，分号后留有一个空格，前置条件如果有多个，逗号后留一个空格</li>\n<li>无论是函数声明还是函数表达式，’{‘前一定要有空格</li>\n<li>函数的参数之间</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b :<span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">++ x;</span><br><span class=\"line\">y ++;</span><br><span class=\"line\">z = x?<span class=\"number\">1</span>:<span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">++x;</span><br><span class=\"line\">y++;</span><br><span class=\"line\">z = x ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [ <span class=\"number\">1</span>, <span class=\"number\">2</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = ( <span class=\"number\">1</span>+<span class=\"number\">2</span> )*<span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = (<span class=\"number\">1</span> + <span class=\"number\">2</span>) * <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no space before '(', one space before '&#123;', one space between function parameters</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no space before '('</span></span><br><span class=\"line\">doSomething(item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">6</span>;i++)&#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">6</span>; i++) &#123;</span><br><span class=\"line\">    x++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-空行-1\"><a href=\"#4-空行-1\" class=\"headerlink\" title=\"4)空行\"></a>4)空行</h4><p>以下几种情况需要空行：</p>\n<ul>\n<li>变量声明后（当变量声明在代码块的最后一行时，则无需空行）</li>\n<li>注释前（当注释在代码块的第一行时，则无需空行）</li>\n<li>代码块后（在函数调用、数组、对象中则无需空行）</li>\n<li>文件最后保留一个空行</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// need blank line after variable declaration</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not need blank line when variable declaration is last expression in the current block</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y = x + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// need blank line before line comment</span></span><br><span class=\"line\">a++;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// not need blank line when comment is first line of block</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// need blank line after blocks</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    bar: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not need blank line when in argument list, array, object</span></span><br><span class=\"line\">func(</span><br><span class=\"line\">    <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = [</span><br><span class=\"line\">    <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span></span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    b: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        a++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    c: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-换行\"><a href=\"#5-换行\" class=\"headerlink\" title=\"5)换行\"></a>5)换行</h4><p>换行的地方，行末必须有’,’或者运算符；</p>\n<p>以下几种情况不需要换行：</p>\n<ul>\n<li>下列关键字后：<code>else</code>, <code>catch</code>, <code>finally</code></li>\n<li>代码块’{‘前</li>\n</ul>\n<p>以下几种情况需要换行：</p>\n<ul>\n<li>代码块’{‘后和’}’前</li>\n<li>变量赋值后</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span></span><br><span class=\"line\">    , <span class=\"attr\">c</span>: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">x = y</span><br><span class=\"line\">    ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">x = y ? <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\">x = y ?</span><br><span class=\"line\">    <span class=\"number\">1</span> : <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// no need line break with 'else', 'catch', 'finally'</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a, foo = <span class=\"number\">7</span>, b,</span><br><span class=\"line\">    c, bar = <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a,</span><br><span class=\"line\">    foo = <span class=\"number\">7</span>,</span><br><span class=\"line\">    b, c, bar = <span class=\"number\">8</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-单行注释\"><a href=\"#6-单行注释\" class=\"headerlink\" title=\"6)单行注释\"></a>6)单行注释</h4><p>双斜线后，必须跟一个空格；</p>\n<p>缩进与下一行代码保持一致；</p>\n<p>可位于一个代码行的末尾，与代码间隔一个空格。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// if you made it here, then all security checks passed</span></span><br><span class=\"line\">    allowed();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> zhangsan = <span class=\"string\">'zhangsan'</span>; <span class=\"comment\">// one space after code</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"7-多行注释\"><a href=\"#7-多行注释\" class=\"headerlink\" title=\"7)多行注释\"></a>7)多行注释</h4><p>最少三行, ‘*’后跟一个空格，具体参照右边的写法；</p>\n<p>建议在以下情况下使用：</p>\n<ul>\n<li>难于理解的代码段</li>\n<li>可能存在错误的代码段</li>\n<li>浏览器特殊的HACK代码</li>\n<li>业务逻辑强相关的代码</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * one space after '*'</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"8-文档注释\"><a href=\"#8-文档注释\" class=\"headerlink\" title=\"8)文档注释\"></a>8)<code>文档注释</code></h4><p>各类标签@param, @method等请参考<a href=\"http://usejsdoc.org/\" target=\"_blank\" rel=\"noopener\">usejsdoc</a>和<a href=\"http://yuri4ever.github.io/jsdoc/\" target=\"_blank\" rel=\"noopener\">JSDoc Guide</a>；</p>\n<p>建议在以下情况下使用：</p>\n<ul>\n<li>所有常量</li>\n<li>所有函数</li>\n<li>所有类</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @func</span><br><span class=\"line\"> * @desc 一个带参数的函数</span><br><span class=\"line\"> * @param &#123;string&#125; a - 参数a</span><br><span class=\"line\"> * @param &#123;number&#125; b&#x3D;1 - 参数b默认值为1</span><br><span class=\"line\"> * @param &#123;string&#125; c&#x3D;1 - 参数c有两种支持的取值&lt;&#x2F;br&gt;1—表示x&lt;&#x2F;br&gt;2—表示xx</span><br><span class=\"line\"> * @param &#123;object&#125; d - 参数d为一个对象</span><br><span class=\"line\"> * @param &#123;string&#125; d.e - 参数d的e属性</span><br><span class=\"line\"> * @param &#123;string&#125; d.f - 参数d的f属性</span><br><span class=\"line\"> * @param &#123;object[]&#125; g - 参数g为一个对象数组</span><br><span class=\"line\"> * @param &#123;string&#125; g.h - 参数g数组中一项的h属性</span><br><span class=\"line\"> * @param &#123;string&#125; g.i - 参数g数组中一项的i属性</span><br><span class=\"line\"> * @param &#123;string&#125; [j] - 参数j是一个可选参数</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function foo(a, b, c, d, g, j) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"9-引号\"><a href=\"#9-引号\" class=\"headerlink\" title=\"9)引号\"></a>9)引号</h4><p>最外层统一使用单引号。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"string\">\"test\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"string\">'foo'</span>,</span><br><span class=\"line\">    z = <span class=\"string\">'&lt;div id=\"test\"&gt;&lt;/div&gt;'</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"10-变量命名\"><a href=\"#10-变量命名\" class=\"headerlink\" title=\"10)变量命名\"></a>10)变量命名</h4><ul>\n<li>标准变量采用驼峰式命名（除了对象的属性外，主要是考虑到cgi返回的数据）</li>\n<li>‘ID’在变量名中全大写</li>\n<li>‘URL’在变量名中全大写</li>\n<li>‘Android’在变量名中大写第一个字母</li>\n<li>‘iOS’在变量名中小写第一个，大写后两个字母</li>\n<li>常量全大写，用下划线连接</li>\n<li>构造函数，大写第一个字母</li>\n<li>jquery对象必须以’$’开头命名</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> thisIsMyName;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> goodID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> reportURL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> AndroidVersion;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> iOSVersion;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MAX_COUNT = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> body = $(<span class=\"string\">'body'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> $body = $(<span class=\"string\">'body'</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"11-变量声明\"><a href=\"#11-变量声明\" class=\"headerlink\" title=\"11)变量声明\"></a>11)变量声明</h4><p>一个函数作用域中所有的变量声明尽量提到函数首部，用一个var 声明，不允许出现两个连续的var声明。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomethingWithItems</span>(<span class=\"params\">items</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// use one var</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"number\">10</span>,</span><br><span class=\"line\">        result = value + <span class=\"number\">10</span>,</span><br><span class=\"line\">        i,</span><br><span class=\"line\">        len;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>, len = items.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">        result += <span class=\"number\">10</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"12-函数\"><a href=\"#12-函数\" class=\"headerlink\" title=\"12)函数\"></a>12)函数</h4><p>无论是函数声明还是函数表达式，’(‘前不要空格，但’{‘前一定要有空格；</p>\n<p>函数调用括号前不需要空格；</p>\n<p>立即执行函数外必须包一层括号；</p>\n<p>不要给inline function命名；</p>\n<p>参数之间用’, ‘分隔，注意逗号后有一个空格。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// no space before '(', but one space before'&#123;'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">doSomething (item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">doSomething(item);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// requires parentheses around immediately invoked function expressions</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">x</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// use ', ' between function parameters</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> doSomething = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"13-数组、对象\"><a href=\"#13-数组、对象\" class=\"headerlink\" title=\"13)数组、对象\"></a>13)数组、对象</h4><p>对象属性名不需要加引号；</p>\n<p>对象以缩进的形式书写，不要写在一行；</p>\n<p>数组、对象最后不要有逗号。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"string\">'b'</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;<span class=\"attr\">b</span>: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    b: <span class=\"number\">1</span>,</span><br><span class=\"line\">    c: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"14-括号\"><a href=\"#14-括号\" class=\"headerlink\" title=\"14)括号\"></a>14)括号</h4><p>下列关键字后必须有大括号（即使代码块的内容只有一行）：<code>if</code>, <code>else</code>,<code>for</code>, <code>while</code>, <code>do</code>, <code>switch</code>, <code>try</code>, <code>catch</code>, <code>finally</code>, <code>with</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition)</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"15-null\"><a href=\"#15-null\" class=\"headerlink\" title=\"15)null\"></a>15)null</h4><p>适用场景：</p>\n<ul>\n<li>初始化一个将来可能被赋值为对象的变量</li>\n<li>与已经初始化的变量做比较</li>\n<li>作为一个参数为对象的函数的调用传参</li>\n<li>作为一个返回对象的函数的返回值</li>\n</ul>\n<p>不适用场景：</p>\n<ul>\n<li>不要用null来判断函数调用时有无传参</li>\n<li>不要与未初始化的变量做比较</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (b <span class=\"string\">`= null) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        // not mean b is not supply</span></span><br><span class=\"line\"><span class=\"string\">        ...</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">var a;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">if (a `</span>= <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a <span class=\"string\">`= null) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    ...</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"16-undefined\"><a href=\"#16-undefined\" class=\"headerlink\" title=\"16)undefined\"></a>16)undefined</h4><p>永远不要直接使用undefined进行变量判断；</p>\n<p>使用typeof和字符串’undefined’对变量进行判断。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (person <span class=\"string\">`= undefined) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    ...</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">// good</span></span><br><span class=\"line\"><span class=\"string\">if (typeof person `</span>= <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"17-jshint\"><a href=\"#17-jshint\" class=\"headerlink\" title=\"17)jshint\"></a>17)jshint</h4><p>用’<code>=&#39;, &#39;!</code>‘代替’`’, ‘!=’；</p>\n<p>for-in里一定要有hasOwnProperty的判断；</p>\n<p>不要在内置对象的原型上添加方法，如Array, Date；</p>\n<p>不要在内层作用域的代码里声明了变量，之后却访问到了外层作用域的同名变量；</p>\n<p>变量不要先使用后声明；</p>\n<p>不要在一句代码中单单使用构造函数，记得将其赋值给某个变量；</p>\n<p>不要在同个作用域下声明同名变量；</p>\n<p>不要在一些不需要的地方加括号，例：delete(a.b)；</p>\n<p>不要使用未声明的变量（全局变量需要加到.jshintrc文件的globals属性里面）；</p>\n<p>不要声明了变量却不使用；</p>\n<p>不要在应该做比较的地方做赋值；</p>\n<p>debugger不要出现在提交的代码里；</p>\n<p>数组中不要存在空元素；</p>\n<p>不要在循环内部声明函数；</p>\n<p>不要像这样使用构造函数，例：<code>new function () { ... }</code>, <code>new Object</code>；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a <span class=\"string\">` 1) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    a++;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">// good</span></span><br><span class=\"line\"><span class=\"string\">if (a `</span>= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// be sure that obj[key] belongs to the object and was not inherited</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.count = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    x += <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span>(obj.attr);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> obj.attr;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a = <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, , , <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> nums = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">        nums[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> i + j;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;(i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> privateVar;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.publicMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        privateVar = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.publicMethod2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        privateVar = <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"18-杂项\"><a href=\"#18-杂项\" class=\"headerlink\" title=\"18)杂项\"></a>18)杂项</h4><p>不要混用tab和space；</p>\n<p>不要在一处使用多个tab或space；</p>\n<p>换行符统一用’LF’；</p>\n<p>对上下文this的引用只能使用’_this’, ‘that’, ‘self’其中一个来命名；</p>\n<p>行尾不要有空白字符；</p>\n<p>switch的falling through和no default的情况一定要有注释特别说明；</p>\n<p>不允许有空的代码块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// not good</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a   = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// not good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> me = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// good</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">switch</span> (condition) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    <span class=\"comment\">// why fall through</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">4</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"comment\">// why no default</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// not good with empty block</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (condition) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ck7e0nvti0007ntcy72nvfbxg","category_id":"ck7e0nvtf0004ntcya5gxfhkl","_id":"ck7e0nvtm000dntcy4ka541xo"},{"post_id":"ck7e0nvt50000ntcyhcv0605e","category_id":"ck7e0nvtf0004ntcya5gxfhkl","_id":"ck7e0nvtn000hntcyfk55fsca"},{"post_id":"ck7e0nvtj0008ntcycrn774qg","category_id":"ck7e0nvtf0004ntcya5gxfhkl","_id":"ck7e0nvto000intcy6q859pls"},{"post_id":"ck7e0nvtc0002ntcycsfi9sqm","category_id":"ck7e0nvtf0004ntcya5gxfhkl","_id":"ck7e0nvto000lntcy32hmcvy8"},{"post_id":"ck7e0nvth0006ntcy4i50dfsm","category_id":"ck7e0nvtf0004ntcya5gxfhkl","_id":"ck7e0nvtp000mntcybxr5alkt"}],"PostTag":[{"post_id":"ck7e0nvti0007ntcy72nvfbxg","tag_id":"ck7e0nvtg0005ntcy2tm3fltz","_id":"ck7e0nvtl000bntcy9ipeg6sa"},{"post_id":"ck7e0nvt50000ntcyhcv0605e","tag_id":"ck7e0nvtg0005ntcy2tm3fltz","_id":"ck7e0nvtm000cntcy1th59m5j"},{"post_id":"ck7e0nvtc0002ntcycsfi9sqm","tag_id":"ck7e0nvtg0005ntcy2tm3fltz","_id":"ck7e0nvtn000gntcy2qibgoxp"},{"post_id":"ck7e0nvth0006ntcy4i50dfsm","tag_id":"ck7e0nvtg0005ntcy2tm3fltz","_id":"ck7e0nvto000kntcy9kmu5k4o"},{"post_id":"ck7e0nvtj0008ntcycrn774qg","tag_id":"ck7e0nvto000jntcy66ui1t0m","_id":"ck7e0nvtp000nntcy1ciah9z5"}],"Tag":[{"name":"后端","_id":"ck7e0nvtg0005ntcy2tm3fltz"},{"name":"前端","_id":"ck7e0nvto000jntcy66ui1t0m"}]}}